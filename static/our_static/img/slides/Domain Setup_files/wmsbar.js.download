function Util(){this.trimLength=trimLength,this.toggle=function(a){a.style.display=="block"?a.style.display="none":a.style.display="block"},this.checkSessionConfig=function(a){return(_WMSCONFIG&WMSSessionConfig[a])===WMSSessionConfig[a]?!0:!1},this.escapeHTML=function(a){return typeof a=="string"?a.replace(/&/g,"&amp;").replace(/>/g,"&gt;").replace(/</g,"&lt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/\//g,"&#x2F;").replace(/&amp;quot;/g,"&quot;").replace(/&amp;gt;/g,"&gt;").replace(/&amp;lt;/g,"&lt;").replace(/&amp;#x27;/g,"&#x27;").replace(/&amp;#x2F;/g,"&#x2F;").replace(/&amp;amp;/g,"&amp;"):a},this.throttle=function(a,b,c){var d=-1;return function(){var e=arguments;(new Date).getTime()-d>c&&(d=(new Date).getTime(),a.apply(b,e))}},this.getCssAnimEndListener=function(){var a="Webkit Moz O ms".split(" "),b={noprefix:"animationend",Moz:"animationend",Webkit:"webkitAnimationEnd",O:"oAnimationEnd",ms:"MSAnimationEnd"};if(document.body.style.animationName!==undefined)return b.noprefix;for(var c=0;c<a.length;c++)if(document.body.style[a[c]+"AnimationName"]!==undefined)return b[a[c]]},this.addMultipleListeners=function(a,b,c,d,e){if(!(b instanceof Array))throw'addMultipleListeners: please supply an array of eventstrings (like ["click","mouseover"])';var f=function(a){c.call(this,a,e)};for(var g=0;g<b.length;g++)this.addEvent(a,b[g],f,d)},this.indexOf=function(a,b){if(Array.prototype.indexOf)return Array.prototype.indexOf.call(a,b);for(var c=0;c<a.length;c++)if(b===a[c])return c;return-1},this.getObjectLength=function(a){if(typeof a=="object"){if(Object&&Object.keys)return Object.keys(a).length;var b=0;for(var c in a)b++;return b}},this.getCSRF=function(){return WmsConstants.CHATCFPARAMNAME+"="+Cookie.getCustomCookie(WmsConstants.CHATCFCOOKIENAME)},this.getNextRotationalNode=function(a,b){if(b===39||b===40)return a.nextSibling||a.parentNode.firstChild;if(b===37||b===38)return a.previousSibling||a.parentNode.lastChild},this.moveCaretPosition=function(a,b,c){if(a.setSelectionRange)a.focus(),a.setSelectionRange(b,c);else if(a.createTextRange){var d=a.createTextRange();d.collapse(!0),d.moveEnd("character",c),d.moveStart("character",b),d.select()}},this.positionElement=function(a,b,c){var d,e,f,g,h=45,i=21,j=a.getBoundingClientRect();f=window.innerWidth-(j.left+a.offsetWidth),g=window.innerHeight-b.offsetHeight-i,e=f>b.offsetWidth?j.left+a.offsetWidth:j.left-b.offsetWidth,e=c?e+parseInt(c):e,d=j.top+a.offsetHeight/2-b.offsetHeight/2,d=Math.min(g,d),d=Math.max(h,d),b.style.top=d+"px",b.style.left=e+"px"},this.createElement=function(a,b,c,d,e){var f=document.createElement(a);b&&(f.className=b),c&&(f.id=c),e&&(f.innerHTML=e);if(d)for(var g in d)f.setAttribute(g,d[g]);return f},this.consoleWarn=function(a){WebMessanger.orgid==="456089"&&typeof console!="undefined"&&console.warn&&console.warn(a)}}function getSource(a){return ie?window.event.srcElement:a.target}function addEvent(a,b,c,d,e){d=typeof d=="boolean"?d:!0;var f=function(a){c.call(this,a,e)};a.attachEvent?a.attachEvent("on"+b,f):a.addEventListener?a.addEventListener(b,f,d):a["on"+b]=f}function removeEvent(a,b,c){a.detachEvent?a.detachEvent("on"+b,c):a.removeEventListener?a.removeEventListener(b,c,!0):a["on"+b]=null}function trimLength(a,b){return a.length>b+2&&(a=a.substr(0,b)+".."),a}function getEventTarget(a){return ie?window.event.srcElement:a.target}function HtmlTag(){}function ClientDecoder(){}function push(a){WebMessanger.push(a),setTimeout(function(){WebMessanger.updateClientDebugStore(a)},1),WebMessanger.lastmessage=a,WebMessanger.lastmessagetime=new Date}function getPrd(){return WebMessanger.getPrd()}function getWmsConfig(){return _WMSCONFIG}function getUserName(){return WebMessanger.getUserName()}function getNickName(){return WebMessanger.getNickName()}function getZuid(){return WebMessanger.getZuid()}function getUserId(){return WebMessanger.getUserId()}function getSid(){return WebMessanger.getSid()}function _getAuthType(){return WebMessanger.authtype}function getAuthToken(){return _WMSAUTHTOKEN}function getAuthScope(){return _WMSAUTHSCOPE}function getZAID(){return _WMSZAID}function getRawSid(){return WebMessanger.getRawSid()}function getWmsContacts(){return WmsContacts.getcontacts()}function updateWmsContacts(a){WmsContacts.init(a)}function isReconnecting(){return WebMessanger.isReconnecting()}function disablewms(){WebMessanger.disable()}function isdisablewms(){return WebMessanger.isdisablewms()}function WebMessanger(){}function EventsUtil(){}function isLongPollingForced(){return _WMS_LP}function WMSUI(){}function ZMSGUI(){}function WmsResource(){this.MessageObject}function WmsContacts(){}function WmsMPAccounts(){}function ChatWindow(){this.atmentions="",this.selectedoptions="",this.win=null,this.partinfo={},this.partcount=0,this.top=20,this.width=WindowHandler.cwsize,this.height=200,this.scrollTop=0,this.msgdisp,this.ftools,this.composer,this.headernode,this.scode,this.smsg,this.stype,this.recipant,this.objId,this.maximized,this.winIndex=-1,this.prevIndex=-1,this.imgurl="https://img.zohostatic.com/ichat/v282_https/images/bar/contactphoto.gif",this.addinfo={},this.prechattime=null,this.offlinemessage=!1,this.ctype=-1,this.attached=!1,this.channelphotoid,this.channeldesc="",this.channeltype,this.channelid,this.channelsoid,this.channelservicecode,this.mutedinterval=null,this.ispinned=!1,this.iscallongoing=!1,this.msgdelaytimer=null,this.msghidetimer=null,this.scrolltimer=null,this.addinfotemplate,this.deleteinfotemplate,this.titleinfotemplate,this.clickedfailurenode,this.lastEnterKeyTime=-1,this.create=function(a,b){var c="chatwin",d="wms-cw",e;c=b.divId,this.recipant=b.recipant,this.title=b.title,this.scode=b.scode,this.stype=b.stype,this.smsg=WebMessanger.unescapeHTML(b.smsg),this.ctype=b.ctype,this.savehistory=b.historystorage,this.attached=b.attached,this.partcount=b.pcount,this.prdcode=b.prdcode,this.mutedinterval=b.mutedinterval,this.entityweburl=b.entityweburl,this.entityid=b.entityid,this.salesiqchat=b.salesiqchat;var f=b.showminimizehint,g=b.winstate||"max",h=b.composertext,i=b.lastmsgtime;this.updateAddInfo(b.addinfo);if(document.getElementById(c)!=null){document.getElementById(c).style.display="block";var m=WindowHandler.getWinObjById(c);WmsMainUI.isAutoFocusScheduled()&&m.getMeFront(),WmsMainUI.removeAutoFocusSchedule();return}e=document.createElement("DIV"),e.id=c,this.setObjId(c);var j=this;$WC.$CUtil.addEvent(e,"click",function(){j.makeNormalAndPropagate()});var k;typeof WmsUIImpl!="undefined"&&(k=WmsImplHandler.invokeSynchronously(WmsUIImpl.getChatWindowContainer,this.objId,this.ctype,this.getChannelUID(),this.getChannelServiceCode(),this.getChannelSOID())),k?(this.detached=!0,k.appendChild(e)):WindowHandler.chatbar.insertBefore(e,document.getElementById("wmsbarmovablehint"));if($WC.$CUtil.isBotChid(this.objId))var l=WmsChannels.getBotId(this.objId);e.outerHTML=$WC.template.replace(a,{chid:this.objId,title:this.title,photo:this.imgurl,statusmsg:this.smsg||"",winindex:this.winIndex,userid:l?l:this.recipant||"",style:this.recipant||l?"style=cursor:pointer":""});var n=WmsRecentChats.getFromPinnedChatList(this.objId);n?this.ispinned=!0:this.ispinned=!1,e.className=d,this.win=document.getElementById(this.objId),this.mainwin=this.win.querySelector("[data-main]"),this.barwin=this.win.querySelector("[data-bar]"),this.msgdisp=this.win.querySelector("[data-msgdisp]"),this.statusmsgnode=this.win.querySelector("[data-statusmsg]"),this.avatarnode=this.win.querySelector("[data-avatar]"),this.composer=this.win.querySelector("[data-composer]"),this.listcommon=new ListCommon(this.composer,this.getInnerObject("wms-autocomplete","div")),this.ctrlcomp=this.win.querySelector("[data-ctrlcomp]"),this.datehintnode=this.win.querySelector("[data-datecomp]"),this.errormsgnode=this.win.querySelector("[data-errormsg]"),this.dragcomp=this.win.querySelector("[data-dragcomp]"),this.photo=this.win.querySelector("[data-photo]"),this.baravatarnode=this.win.querySelector("[data-baravatar]"),this.headernode=this.win.querySelector("[data-header]"),this.titlenode=this.win.querySelector("[data-titlecontainer]"),this.bartitlenode=this.win.querySelector("[data-bartitle]"),this.smileycontainer=this.win.querySelector("[data-smileycontainer]"),this.smileyinvoker=this.getInnerObject("wms-smileyinvoker","DIV"),this.msgdisp.setAttribute("data-chid",this.objId),this.membersdispnode=this.win.querySelector("[data-members]"),this.progressbarnode=this.win.querySelector("[data-progressbar]"),this.actionlistnode=this.win.querySelector("[data-actionlist]"),this.actionbutton=this.win.querySelector("[data-action]"),this.typingstatusnode=this.win.querySelector("[data-typingstatusnode]"),this.typingindicatornode=this.win.querySelector("[data-typingsymbol]"),this.barmsgcountnode=this.win.querySelector("[data-barmsgcount]"),this.videoinfonode=this.win.querySelector("[data-videoinfo]"),this.videoiconnode=this.win.querySelector("[data-videoicon]"),this.videodropdownnode=this.win.querySelector("[data-videodropdown]"),this.videocontainer=this.win.querySelector("[data-videospace]"),this.audioiconnode=this.win.querySelector("[data-audioicon]"),this.attachmentnode=this.win.querySelector("[data-attachment]"),this.footernode=this.win.querySelector("[data-footercont]"),this.edittitleiconnode=this.win.querySelector("[data-edittitleicon]"),this.addmemberhiddeninputnode=this.win.querySelector("[data-addmemberhiddeninput]"),this.populateActionList(),this.recentchatsnode=this.win.querySelector("[data-recentchats]"),this.meetingnode=this.win.querySelector("[data-meeting]"),this.pinactionnode=this.win.querySelector("[data-pinchat]"),this.addmembernode=this.win.querySelector("[data-addparticipant]"),this.historyoffnode=this.win.querySelector("[data-historyoff]"),this.leavechannelnode=this.win.querySelector("[data-leavechannel]"),this.reverttitlenode=this.win.querySelector("[data-reverttitle]"),this.mutechatnode=this.win.querySelector('[data-mute="true"]'),this.minimizeiconnode=this.win.querySelector("[data-minimizeicon]"),this.resendoverlay=this.win.querySelector("[data-resendoverlay]"),this.resendallnode=this.win.querySelector('[data-operation="wms-resendall"]'),this.editorreplydiv=this.win.querySelector("[data-editorreply]"),this.autocompletediv=this.win.querySelector("[data-autocomplete]"),this.invisiblediv=this.win.querySelector("[data-invisiblediv]"),this.showmembersnode=this.win.querySelector("[data-showmembers]"),this.enlargeicon=this.win.querySelector("[data-enlargeicon]"),this.unsubscribebotnode=this.win.querySelector("[data-unsubscribe]"),this.updatePinnedInfo(this.ispinned),this.setTitle(this.title),this.avatarnode.innerHTML=WmsHybridSearch.generateImageHtml("",WmsHybridSearch.constants.CONTACT),this.baravatarnode.innerHTML=WmsHybridSearch.generateImageHtml("",WmsHybridSearch.constants.CONTACT),this.updateUserStatus(this.scode,this.smsg,this.stype),navigator.userAgent.indexOf("Firefox")==-1&&(this.composer.onpaste=function(a){var b=this.getAttribute("chid");WindowHandler.getWinObjById(b).ctype!="5"&&WmsFileUpload.handlePaste(a),a.stopPropagation()});if(h){this.composer.focus(),this.atmentions=WmsSessionStorage.getChatInfo(this.objId,"atmentions"),this.composer.value=h;if(this.atmentions){var o=WMSUI.atMentions.formatAtMentions(h,this.atmentions,this.objId);this.invisiblediv.innerHTML=o}}if(this.ctype==="8"){this.meetingnode.style.display="none",WmsChannels.isUserHasPermission(this.objId,WmsConstants.USERPERMISSIONS.ADD_MEMBER)===!1&&(this.addmembernode.style.display="none"),this.reverttitlenode.style.display="none",this.historyoffnode.style.display="none";if(!WmsChannels.get(this.objId)||WmsChannels.get(this.objId).leave_allowed!=0)this.leavechannelnode.style.display="block";this.edittitleiconnode.style.display="none",this.titlenode.style.cursor="default",this.statusmsgnode.style.cursor="pointer"}this.ctype==="9"&&(this.edittitleiconnode.style.display="none",this.titlenode.style.cursor="default",this.actionbutton.style.display="block",this.recentchatsnode.style.display="none",this.meetingnode.style.display="none",this.addmembernode.style.display="none",this.historyoffnode.style.display="none",this.leavechannelnode.style.display="none",this.reverttitlenode.style.display="none",$WC.$CUtil.isCustomBot(this.objId)&&(this.unsubscribebotnode.style.display="block")),this.ctype==="5"&&(this.removeSendFile(),this.reverttitlenode.style.display="none",this.historyoffnode.style.display="none",this.addmembernode.style.display="none",this.edittitleiconnode.style.display="none",this.titlenode.style.cursor="default"),this.ctype==="10"&&(this.meetingnode.style.display="none",this.addmembernode.style.display="none",this.reverttitlenode.style.display="none",this.edittitleiconnode.style.display="none",this.recentchatsnode.style.display="none",this.titlenode.style.cursor="default",this.statusmsgnode.style.cursor="pointer",this.partcount>2&&(this.showmembersnode.style.display="block")),this.ctype==="1"&&(WmsSettings.getAdminSetting("isDisableHistoryAllowed")||(this.historyoffnode.style.display="none"));if(typeof WmsUIImpl!="undefined"){var p=WmsImplHandler.invokeSynchronously(WmsUIImpl.getHeaderHTML,this.objId,this.ctype,this.getChannelUID(),this.getChannelServiceCode(),this.getChannelSOID());p&&(this.headernode.innerHTML=p);var q=WmsImplHandler.invokeSynchronously(WmsUIImpl.getStatusHTML,this.objId,this.ctype,this.getChannelUID(),this.getChannelServiceCode(),this.getChannelSOID());q&&(this.statuslinenode.innerHTML=q)}if(typeof WmsUIImpl!="undefined"){var r=WmsImplHandler.invokeSynchronously(WmsUIImpl.getChatWindowOptions,this.objId,this.ctype,this.getChannelUID(),this.getChannelServiceCode(),this.getChannelSOID());r&&this.applyCustomCWOptions(r)}WindowHandler.count++,WmsMainUI.isAutoFocusScheduled()&&(this.getMeFront(),this.focus()),WmsMainUI.isAutoFocusScheduled()==0&&g==="min"?(WindowHandler.openedChats[this.objId]="min",this.minimize()):(this.maximized=!0,WindowHandler.openedChats[this.objId]="max"),WmsMainUI.removeAutoFocusSchedule(),this.storeWindowState(g);if(WmsChatCache.isAvailable(this.objId))this.msgdisp.innerHTML=WmsChatCache.get(this.objId),this.scrollDisplay();else{var s=document.createElement("div");i&&s.setAttribute("data-nexttime",i),s.setAttribute("data-latestchunk","true"),s.style="display:none",this.msgdisp.appendChild(s),this.partcount<=100&&_WMSWINFOCUS||this.maximized?Message.loadSpecificTranscript(this.objId,this.msgdisp,s):this.lazyload_transcript=s}WmsMainUI.getUnreadCount(this.objId)&&this.highlight(),this.updateSaveHistoryInUI();var t={chid:this.objId,removed:"false"};this.salesiqchat&&(t.salesiqchat="true"),WmsSessionStorage.setChatInfo(t);var u=util.indexOf(WindowHandler.removed,this.getObjId());u!==-1&&WindowHandler.removed.splice(u,1),WindowHandler.removeExcessChat(this.getObjId()),this.registerEvent(),this.showVideoDropdown(),WmsAVChat.notifyChatwinOpen(this),this.showRestrictedChannelIcon(),WmsChannels.get(this.objId)&&WmsChannels.isUserHasPermission(this.objId,WmsConstants.USERPERMISSIONS.SEND_MESSAGE)==0&&(this.permdenied=!0,this.disableComposerOptions(WmsResource.getRealValue("channels.announcementonly")));var v=this;return $WC.$CUtil.addEvent(this.statusmsgnode,"click",function(a){if(a.target.id==="wms-muteinfoicon"||a.target.closest("[data-mute]")||a.target.id==="wms_cw_videoinfo"||a.target.closest("[data-videodropdown]"))return;v.isZohoGroupChat()||v.partcount>2&&v.ctype==="1"||v.ctype==="5"||v.ctype==="8"?v.disablemembercontrol||v.toggleGroupMembers():v.ctype==="10"&&(v.entityweburl?(window.open(v.smsg,"_blank"),ChatletImpl.handleURLInvocation(v.entityid,v.smsg)):v.toggleGroupMembers())}),$WC.$CUtil.addEvent(this.ctrlcomp,"scroll",util.throttle(this.showDateHint,this,50)),f&&!this.disableminimize&&(WMSUI.showminhint=!1,this.updateUserInfoStatus(WmsResource.getRealValue("chat.minimizehint")),setTimeout(function(){j.updateUserInfoStatus("")},5e3)),c},this.showBotSuggestions=function(a){if(a.temp_info&&a.temp_info.suggestions){var b=a.temp_info.suggestions,c='<div data-list=true class="wms-autocompleteheader wms-truncate-ellipsis wms-commandlist" title="'+a.msg+'">'+a.msg+"</div>";b.forEach(function(a){var b=$WC.$CUtil.safeHTML(a.text);c+='<div class="wms-commandlist" data-list=true data-botsuggestion=true data-suggestiontext="'+b+'"><span class="wms-botsuggestion  wms-truncate-ellipsis" title="'+b+'">'+b+"</span></div>"}),this.listcommon.showUI(c,!0,!0),this.autocompletediv.style.display="block",this.footernode.style.borderRadius="0px 0px 5px 5px"}},this.showAddUserPrompt=function(){if(this.atmentions&&WMSUI.curtrigger===WmsConstants.TRIGGERS.ATMENTION){var a=this.atmentions.slice(0,-1).split(","),b=[],c=[],d=this.partinfo;a.forEach(function(a){d[a]===undefined&&(b.push(a),c.push('<span data-zcprofileid="'+a+'">'+($WC.$CUtil.getContactName(a)||this.partinfo[a].dname)+"</span>"))});if(b.length){var e=WmsResource.getRealValue("chat.infomsg.adduser",[c.join(", "),'<span data-id="'+b.join(",")+'" data-operation="addmem">'+WmsResource.getRealValue("chat.infomsg.addtext")+"</span>"]);this.updateInfoMessage(e,null,"promptinfo")}}},this.removePromptMsg=function(){var a=this.msgdisp.querySelector('[data-infotype="promptinfo"]');a&&a.parentNode&&$WC.$CUtil.removeElement(a.parentNode)},this.setLastEnterKeyPressTime=function(a){this.lastEnterKeyTime=a},this.isDoubleEnter=function(){var a=(new Date).getTime()-this.lastEnterKeyTime;return a<500},this.createChatwindowOverlay=function(){this.resendoverlay.style.display="block";var a=""+this.msgdisp.querySelectorAll("[data-msgfailure]").length;a>1&&(this.resendallnode.style.display="block",$WC.$CUtil.setInnerText(this.resendallnode,WmsResource.getRealValue("chat.msg.resendall",[a])))},this.showDateHint=function(){var a=this.ctrlcomp.getBoundingClientRect().top,b=this.ctrlcomp.getElementsByClassName("wms-msgdate");this.datehintnode.style.display="block";for(var c=0;c<b.length;c++){var d=b[c],e=d.getBoundingClientRect().top,f=e-d.firstChild.offsetHeight;if(f>a)if(b[c-1]){var g=b[c-1].textContent;this.datehintnode.textContent!=g&&(this.datehintnode.textContent=g),c=b.length}else this.datehintnode.textContent=d.textContent;else b[c+1]==undefined&&this.datehintnode.textContent!=d.textContent&&(this.datehintnode.textContent=d.textContent)}var h=this.ctrlcomp.scrollHeight-this.ctrlcomp.clientHeight<=this.ctrlcomp.scrollTop+20?!0:!1;h||(this.datehintnode.style.display="block"),clearTimeout(this.datehint_timer_hide),this.datehint_timer_hide=setTimeout(function(a){clearTimeout(a.datehint_display_timer),a.datehint_display_timer=setTimeout(function(a){a.datehintnode.style.display=""},400,a)},1e3,this)},this.applyCustomCWOptions=function(a){a.customClassName&&($WC.$CUtil.addClass(this.mainwin,a.customClassName),$WC.$CUtil.addClass(this.barwin,a.customClassName)),a.customActions&&a.customActions.length>0&&this.generateCustomActionList(a.customActions),a.membercontrol==="disable"&&(this.addmembernode&&(this.addmembernode.style.display="none"),this.disablemembercontrol=!0),a.recentchats_option==="disable"&&(this.recentchatsnode&&(this.recentchatsnode.style.display="none"),this.disablerecentchatsoption=!0),a.screenshare==="disable"&&(this.meetingnode&&(this.meetingnode.style.display="none"),this.disablescreenshare=!0),a.store_chathistory==="disable"&&(this.historyoffnode&&(this.historyoffnode.style.display="none"),this.disablehistory=!0),a.pinaction==="disable"&&(this.pinactionnode&&(this.pinactionnode.style.display="none"),this.disablepinaction=!0),a.minimize==="disable"&&(this.minimizeiconnode&&(this.minimizeiconnode.style.display="none"),this.disableminimize=!0),a.enlarge==="disable"&&this.enlargeicon&&(this.enlargeicon.style.display="none"),a.mutechat==="disable"&&(this.mutechatnode&&(this.mutechatnode.style.display="none"),this.disablemuteaction=!0),a.transcript_view_height&&(this.ctrlcomp.style.height=a.transcript_view_height),a.chatwindow_width&&(this.mainwin.style.width=a.chatwindow_width),a.file_upload==="disable"&&(this.attachmentnode&&(this.attachmentnode.style.display="none",this.attachmentnode.setAttribute("data-attachment","false")),this.restrict_file_upload=!0)},this.populateActionList=function(){var a=[{label:"chats.common",dataAttr:"recentchats",dataVal:"true",actionCallback:this.getRecentChats},{label:"Share_Desktop",dataAttr:"meeting",dataVal:"true",actionCallback:this.startMeeting},{label:"chat.title.revert",dataAttr:"reverttitle",dataVal:"true",actionCallback:this.revertTitle},{label:"chat.action.addparticipant",dataAttr:"addparticipant",dataVal:"true",actionCallback:this.insertAddParticipant},{label:"history.off",dataAttr:"historyoff",dataVal:"true",actionCallback:this.setHistoryStorage},{label:"common.shortcut.description.leave",dataAttr:"leaveChannel",dataVal:"true",actionCallback:this.leaveChannel},{label:"common.shortcut.description.pin",className:"wms_cw_pinchat",dataAttr:"pinchat",dataVal:"true",actionCallback:this.pinChat,style:"display: block;"},{label:"chat.members.show",className:"wms_cw_showmem",dataAttr:"showmembers",dataVal:"true",actionCallback:this.toggleGroupMembers,style:"display:none;"},{label:"common.shortcut.description.mute",className:"wms_cw_muteaction",dataAttr:"mute",dataVal:"true",actionCallback:this.muteChat},{label:"bot.action.unsubscribe",className:"wms_cw_unsubscribe",dataAttr:"unsubscribe",dataVal:"true",actionCallback:this.unsubscribeBot,style:"display:none;"}];a.forEach(function(a){a.label&&a.actionCallback&&(a.className=a.className?"wms_cw_toolbar_actionitem "+a.className:"wms_cw_toolbar_actionitem",a.style=a.style?a.style:"",this.actionlistnode.insertAdjacentHTML("beforeend",this.generateCWActionHtml(a)),this.actionlistnode.querySelector("[data-"+a.dataAttr+"]").addEventListener("click",a.actionCallback.bind(this)))}.bind(this))},this.generateCWActionHtml=function(a){var b="";return a.dataAttr=="mute"&&a.className.indexOf("wms_cw_muteaction")>-1?b='<div class="{{className}}" data-{{dataAttr}}="{{dataVal}}" style="{{style}}"><span data-mutetitle>'+WmsResource.getRealValue(a.label)+"</span>"+'<ul class="wms-muteinterval" >'+'<li data-duration="3600">'+WmsResource.getRealValue("chat.hour","1")+"</li>"+'<li data-duration="28800">'+WmsResource.getRealValue("chat.hours","8")+"</li>"+'<li data-duration="86400">'+WmsResource.getRealValue("chat.day","1")+"</li>"+'<li data-duration="604800">'+WmsResource.getRealValue("chat.week","1")+"</li>"+'<li data-duration="-1">'+WmsResource.getRealValue("chat.forever")+"</li>"+"</ul>"+"</div>":a.dataAttr&&a.dataVal?b='<div class="{{className}}" data-{{dataAttr}}="{{dataVal}}"  style="{{style}}">'+WmsResource.getRealValue(a.label)+"</div>":a.data_customAction&&(b='<div class="{{className}}" data-customAction="{{data_customAction}}"> {{label}} </div>'),$WC.template.replace(b,{className:a.className,dataAttr:a.dataAttr,dataVal:a.dataVal,actionCallback:a.actionCallback,label:a.label,style:a.style,data_customAction:a.data_customAction})},this.generateCustomActionList=function(a,b){b=b||this.actionlistnode,a.forEach(function(a){a.label&&a.actionCallback&&a.data_customAction&&(a.className=a.className?"wms_cw_toolbar_actionitem "+a.className:"wms_cw_toolbar_actionitem",b.insertAdjacentHTML("beforeend",this.generateCWActionHtml(a)),b.querySelector('[data-customAction="'+a.data_customAction+'"]').addEventListener("click",a.actionCallback.bind(null,this.objId))),a.submenu&&(b.querySelector('[data-customAction="'+a.data_customAction+'"]').insertAdjacentHTML("beforeend",'<div class="wms_cw_toolbar_actionwrapper"></div>'),this.generateCustomActionList(a.submenu,b.querySelector('[class="wms_cw_toolbar_actionwrapper"]')))}.bind(this))},this.registerEvent=function(){var a=this;try{var b=this.objId;if(!ie&&_WMSDRAGDROP&&!a.restrict_file_upload){var c=!1,d=null;this.win.addEventListener("dragstart",function(a){WmsDragDrop.dragged_file=a.target,a.dataTransfer.setData("isdragfromcwin","true")},!0),this.win.addEventListener("dragover",function(a){a.preventDefault()},!0),this.win.addEventListener("drop",function(d){d.preventDefault(),d.dataTransfer.getData("isdragfromcwin")?(WmsDragDrop.onDropEvent(b,d,!0,!0),WmsDragDrop.dragged_file=""):WmsDragDrop.onDropEvent(b,d,!0),a.ctrlcomp.style.display="block",a.dragcomp.style.display="none",c=!1,d.stopPropagation()},!0),this.win.addEventListener("dragenter",function(b){b.preventDefault(),d=b.target,!c&&WmsDragDrop.isFileSharable()&&(a.ctrlcomp.style.display="none",a.dragcomp.style.display="flex",c=!0)},!0),this.win.addEventListener("dragleave",function(b){b.preventDefault(),d==b.target&&(a.ctrlcomp.style.display="block",a.dragcomp.style.display="none",c=!1)},!0)}var e=util.getCssAnimEndListener();$WC.$CUtil.addEvent(this.headernode,e,function(){this.classList.remove("wms-titleglow")},!0),$WC.$CUtil.addEvent(this.barwin,e,function(){this.classList.remove("wms-titleglow")},!0)}catch(f){}Message.addEventListenersForTranscript(this.msgdisp,b),Gator(this.videocontainer).on("click","[video-action]",function(){var a=this.getAttribute("video-action");WmsAVChat.handleAction(a)}),Gator(a.resendoverlay).on("click","[data-operation]",function(){var b=this.getAttribute("data-operation");b==="wms-resend"?Message.resend(a.msgdisp,a.clickedfailurenode,!1):b==="wms-resendall"?Message.resend(a.msgdisp,a.clickedfailurenode,!0):b==="wms-resenddel"&&Message.removeFailedMessages(a.clickedfailurenode),a.resendoverlay.style.display="none",a.resendallnode.style.display="none"}),Gator(this.actionlistnode).on("click",'[data-purpose="wms_botactions"]',function(){a.hideActions(),Commands.showLoadingIcon(a.autocompletediv,a.objId);var b=this.getAttribute("data-botid"),c=this.getAttribute("data-display_props"),d="v1/bots/"+b+"/executeaction",e={};e.exec_id=this.getAttribute("data-exec_id");var f={"Content-Type":"application/json","X-ZCSRF-TOKEN":$WC.$CUtil.getCSRF()},g=function(){Commands.hideLoadingIcon(a.objId);var d=JSON.parse(this.response).data.dreResponse,e=[];d.output||(d.output={}),d.output.sender=b,d.output.isTempResponse=!0,d.output.meta||(d.output.meta={},d.output.meta.usermessagedetails={},d.output.meta.usermessagedetails.msg_title=c);if(d.status==="Success"&&d.output){if(!d.output.msg)return;e.push(d.output)}a.updateMessage(e)},h=function(){Commands.hideLoadingIcon(a.objId)};$WC.Ajax.postRequestToChat(d,e,g,h,null,null,f)}),Gator(this.editorreplydiv).on("click",".wms_cw_replyclose, [data-replymsgtime]",function(b){this.getAttribute("data-replymsgtime")?(Message.glowBubble(this.getAttribute("data-replymsgtime"),a.ctrlcomp),b.stopPropagation()):a.closeReplyPreview()})},this.blurChat=function(){Self.status.idle(this.objId)},this.updatePinnedInfo=function(a){this.ispinned=a,a?(this.pinactionnode.className="wms_cw_toolbar_actionitem wms_cw_unpinchat",$WC.$CUtil.isBotChid(this.objId)?$WC.$CUtil.setInnerText(this.pinactionnode,WmsResource.getRealValue("chat.unpinbot")):$WC.$CUtil.setInnerText(this.pinactionnode,WmsResource.getRealValue("common.shortcut.description.unpin"))):(this.pinactionnode.className="wms_cw_toolbar_actionitem wms_cw_pinchat",$WC.$CUtil.isBotChid(this.objId)?$WC.$CUtil.setInnerText(this.pinactionnode,WmsResource.getRealValue("chat.pinbot")):$WC.$CUtil.setInnerText(this.pinactionnode,WmsResource.getRealValue("common.shortcut.description.pin")))},this.updateMuteInfo=function(a){this.mutedinterval=a;var b=this.mutechatnode;a?(b.setAttribute("data-mute","true"),$WC.$CUtil.removeClass(b,"wms_cw_muteaction"),$WC.$CUtil.addClass(b,"wms_cw_unmuteaction")):(b.setAttribute("data-mute","false"),$WC.$CUtil.removeClass(b,"wms_cw_unmuteaction"),$WC.$CUtil.addClass(b,"wms_cw_muteaction")),this.updateMuteTitle()},this.updateMuteTitle=function(){var a=this.mutedinterval,b=this.mutechatnode.querySelector("[data-mutetitle]");if(a){var c=WmsResource.getRealValue("chat.mute.onmute");if(a=="9223372036854775807")c+=" "+WmsResource.getRealValue("chat.forever");else if(a!=1){var d=(new Date).getTime(),e=a-d,f=new Date(e),g=f.getUTCDate()-1,h=f.getUTCHours(),i=f.getUTCMinutes(),j="";g&&(j+=" "+g+" ",j+=g==1?WmsResource.getRealValue("chat.mute.day"):WmsResource.getRealValue("chat.mute.days")),h&&(j+=" "+h+" ",j+=h==1?WmsResource.getRealValue("chat.mute.hour"):WmsResource.getRealValue("chat.mute.hours")),i&&(j+=" "+i+" ",j+=i==1?WmsResource.getRealValue("chat.mute.minute"):WmsResource.getRealValue("chat.mute.minutes")),j==""&&(j=" "+WmsResource.getRealValue("chat.mute.seconds")),c+=j+" "+WmsResource.getRealValue("chat.mute.timeleft")}this.mutechatnode.title=c,$WC.$CUtil.setInnerText(b,WmsResource.getRealValue("common.shortcut.description.unmute"))}else this.mutechatnode.title=WmsResource.getRealValue("common.shortcut.description.mute"),$WC.$CUtil.setInnerText(b,WmsResource.getRealValue("common.shortcut.description.mute"))},this.updateUserStatus=function(a,b,c){if(this.ctype==="8")return;if(this.ctype==="9"){b="chatbot.smsg",a="chatbot";if($WC.$CUtil.isBotChid(this.objId)){var d=WmsChannels.getBotId(this.objId);WmsContacts.contactslist[d]&&WmsContacts.contactslist[d].STATUSMSG&&(b=WmsContacts.contactslist[d].STATUSMSG)}}b==undefined&&(b=""),b=WebMessanger.unescapeHTML(b),this.smsg=b,b=WmsResource.getRealValue(b),this.statusmsgnode.title=b,$WC.$CUtil.setInnerText(this.statusmsgnode,b),this.stype=WMSUI.getStype(c),this.scode=a;var e=this.avatarnode&&this.avatarnode.firstChild,f=this.baravatarnode&&this.baravatarnode.firstChild,g="wms_badge_imgwrapper wms_badge_statusicon_"+WmsContacts.getStatusClassName(null,this.scode,this.stype);e&&(e.className=g,e.title=WmsResource.getRealValue(WebMessanger.statusarr[a])),f&&(f.className=g);var h="wms_cw_bar_typing_indicator ";a=="0"?h+="wms_cw_bar_typing_offline":a=="1"?h+="wms_cw_bar_typing_online":a=="3"?h+="wms_cw_bar_typing_busy":a=="4"&&(h+="wms_cw_bar_typing_idle"),a!=""&&a!="10"&&(this.typingindicatornode.className=h)},this.updateChannelInfo=function(a){var b=this.statusmsgnode,c=a.cd;c&&($WC.$CUtil.setInnerText(b,c),b.style.marginLeft="7px",b.title=c,this.channeldesc=c),this.channelphotoid=a.photoid,this.channeltype=a.sc,this.channelid=a.oc_id,this.channelservicecode=a.service,this.channelsoid=a.servicespecid},this.updatePartCount=function(a){var b=a,c=b>=2?WmsResource.getRealValue("chat.participants"):WmsResource.getRealValue("chat.participant"),d=b+" "+c;b==0&&(d=WmsResource.getRealValue("chat.participants.none")),$WC.$CUtil.setInnerText(this.statusmsgnode,d),$WC.$CUtil.addClass(this.statusmsgnode,"wms_cw_activeusers")},this.updatePartinfo=function(a,b,c,d){for(var e in this.partinfo){var f=this.partinfo[e],g=f.uname;WmsProfileInfo.details[g]||(WmsProfileInfo.details[g]={}),WmsProfileInfo.details[g].dname=f.dname;if(g==a){this.partinfo[e].scode=b,this.partinfo[e].smsg=c,this.partinfo[e].stype=d;break}}},this.updateOfflineMessage=function(){this.partcount===2&&(this.composer.placeholder=WmsResource.getRealValue("chat.userofflineinfo"),this.offlinemessage=!0)},this.updateOnlineMessage=function(){this.partcount===2&&(this.composer.placeholder="",this.offlinemessage=!1)},this.updateUserInfoStatus=function(a){this.typingstatusnode.innerHTML=a,this.typingstatusnode.setAttribute("title",a)},this.selectChat=function(){try{WindowHandler.lastViewed!=this.winIndex&&WindowHandler.lastViewed!=-1&&WindowHandler.exist[WindowHandler.lastViewed]!=null&&WindowHandler.exist[WindowHandler.lastViewed]!="empty"&&(this.prevIndex=WindowHandler.lastViewed),WindowHandler.lastViewed=this.winIndex}catch(a){}},this.getMeFront=function(){this.selectChat();try{if(document.activeElement.type=="text"&&document.activeElement.nodeName=="TEXTAREA")return}catch(a){}},this.getScode=function(){return this.scode},this.getSmsg=function(){return this.smsg},this.getStype=function(){return this.stype},this.getTitle=function(){return this.title},this.getObjId=function(){return this.objId},this.setObjId=function(a){this.objId=a},this.closeAndPropagate=function(a){if(this.iscallongoing){var b=this,c='<div class="wms-dialog-txtcont">'+$WC.$CUtil.getConfig("Resource").getRealValue("mediacall.close.confirm")+"<br>"+$WC.$CUtil.getConfig("Resource").getRealValue("mediacall.close.continue")+"</div>",d={bodyhtml:c,focusbutton:2,operations:[{name:$WC.$CUtil.getConfig("Resource").getRealValue("mediacall.close.proceed"),action:function(){b.close(),WmsAVChat.close(),b.propagateOperation("close"),WmsDialog.removeModal()}},{name:$WC.$CUtil.getConfig("Resource").getRealValue("Cancel"),classname:"wms-dialog-rejectbtn",action:function(){WmsDialog.removeModal()}}]};WmsDialog.showModal(d)}else this.close(),this.propagateOperation("close");a&&(typeof a.stopPropagation=="function"?a.stopPropagation():a.cancelBubble=!0)},this.close=function(a){WmsMediaPlayer.stopPlayingMedia("chatwindow",this.objId),WmsMediaPlayer.showPlay(this.objId),ChatBlink.stopRepeat(),a?WmsChatCache.remove(this.getObjId()):this.msgdisp.firstChild&&this.msgdisp.firstChild.matches("[data-loading]")===!0?WmsChatCache.remove(this.objId):!this.mutedinterval&&WebMessanger.scode!=3&&!this.lazyload_transcript&&(Message.furlVideoElement(this.msgdisp),WmsChatCache.insert(this.objId,this.msgdisp.innerHTML));var b=function(a,b){if(document.getElementById(b.getObjId())){$WC.$CUtil.removeElement(b.win),WindowHandler.openedChats[b.getObjId()]="close";try{WindowHandler.exist[b.getPreIndex()].focus()}catch(c){WindowHandler.moveFocus(b.getObjId(),"",!0)}Factory.destroyDialog(b.winIndex,!0),WindowHandler.count--}};if(this.savehistory=="0"&&util.getCssAnimEndListener()){var c=util.getCssAnimEndListener();$WC.$CUtil.addEvent(this.win,c,b,!0,this),$WC.$CUtil.addClass(this.win,"delete-chat")}else b(null,this);Message.PREV_SENDER["ch"+this.objId]&&delete Message.PREV_SENDER["ch"+this.objId],this.removeWindowState(),typeof WmsUIImpl!="undefined"&&WmsImplHandler.invoke(WmsUIImpl.handleChatWindowClose,this.ctype,this.objId,this.getChannelUID())},this.isMaximised=function(){return this.maximized},this.hide=function(){this.win.style.display="none"},this.hideWin=function(){this.win.style.display="none",WindowHandler.rearrange()},this.showWin=function(){this.win.style.display="block";var a=WindowHandler.getBarObject("b"+this.objId,"DIV");a.className="wms-tab-selected",a.style.display="block",this.maximized=!0,WindowHandler.removeExcessChat(this.getObjId())},this.display=function(){this.win.style.display="block";var a=WindowHandler.getBarObject("b"+this.objId,"DIV");a.className="wms-tab-selected",a.style.display="block",this.maximized=!0,WindowHandler.removeExcessChat(this.getObjId())},this.makeNormalAndPropagate=function(){this.makeNormal(!0)},this.makeNormal=function(a){this.resetBarStatusIcon(),this.headernode.className.indexOf("wms_cw_highlight")!==-1&&($WC.$CUtil.removeClass(this.headernode,"wms_cw_highlight"),$WC.$CUtil.removeClass(this.barwin,"wms_cw_highlight"),a&&this.propagateOperation("seen"))},this.highlight=function(){this.maximized?$WC.$CUtil.addClass(this.headernode,"wms_cw_highlight"):(this.updateBarMsgcount(),$WC.$CUtil.addClass(this.headernode,"wms_cw_highlight"),$WC.$CUtil.addClass(this.barwin,"wms_cw_highlight"))},this.titleGlow=function(){this.maximized?$WC.$CUtil.addClass(this.headernode,"wms-titleglow"):$WC.$CUtil.addClass(this.barwin,"wms-titleglow"),this.focus()},this.setWinId=function(a){this.winId=a},this.getWinId=function(){return this.winId},this.getObj=function(){return this.win},this.getInnerObject=function(a,b){return WindowHandler.getObjectInObject(this.win,a,b)},this.syncComposerFormat=function(){var a=new RegExp("\\s?(wmsbold|wmsitalic|wmsunderline)\\d?","g"),b=this.composer.className;a.test(b)&&(b=b.replace(a,""));var c=this.ftools.getElementsByTagName("div"),d=new Array("wmsbold","wmsitalic","wmsunderline");for(var e=0;e<c.length;e++)for(var f=0;f<d.length;f++)if(c[e].id==d[f]&&c[e].className=="wmsselected"){b=b+" "+d[f];break}this.composer.className=b},this.checkSelectionAndFocus=function(a){window.getSelection().toString()===""&&this.focus(a)},this.focus=function(a){if(a){var b=getEventTarget(a);if(b.id==="wmseditchattitletxt"||b.getAttribute("data-title")==="true"||b.getAttribute("data-edittitleicon")==="true"||b.getAttribute("data-videoinfo")==="true")return;(b.getAttribute("data-previewable")!=="true"&&b.getAttribute("data-titlecontainer")!=="true"||b.className.indexOf("zcmsg_bx")!==-1)&&this.composer.focus()}else this.composer.focus();this.makeNormalAndPropagate(),this.hideActions(),this.hideVideoDropdown(),ChatBlink.stopRepeat(),Smiley.hide(this.smileycontainer)},this.checkAndToggleGroupMembers=function(){this.membersdispnode.style.display=="block"&&this.toggleGroupMembers()},this.maximize=function(){this.mainwin.style.display="flex",this.barwin.style.display="none",this.scrollDisplay(),this.focus(),this.maximized=!0;try{this.getMeFront()}catch(a){}WindowHandler.openedChats[this.getObjId()]="max",this.storeWindowState("max"),this.updateBarMsgcount(),this.lazyload_transcript&&(Message.loadSpecificTranscript(this.objId,this.msgdisp,this.lazyload_transcript),this.lazyload_transcript=null)},this.textAreaMinimize=function(){this.composer.value===""&&this.minimizeAndPropagate()},this.checkAndMinimize=function(a){var b=getEventTarget(a);(b.getAttribute("data-footer")||b.getAttribute("data-toolbar"))&&this.minimizeAndPropagate()},this.minimizeAndPropagate=function(){this.disableminimize||(this.minimize(!0),this.propagateOperation("min"))},this.minimize=function(a){this.disableminimize||(Self.Idle=!1,this.mainwin.style.display="none",this.barwin.style.display="block",this.maximized=!1,WindowHandler.lastViewed=-1,WindowHandler.openedChats[this.getObjId()]="min",a&&this.resetBarStatusIcon(),this.storeWindowState("min"))},this.propagateOperation=function(a){var b="chid="+this.objId+"&action="+a;a==="close"&&(b+="&uname="+myMsgObj.sender+"&sid="+encodeURIComponent(WebMessanger.getSid())),a==="seen"?$WC.Ajax.requestToChat("propagatemsgseen.do","chid="+this.objId):$WC.Ajax.request("sendchatwindowopr.do",b)},this.scrollDisplay=function(a,b){b=b||this.ctrlcomp;if(typeof a=="boolean"&&a===!1)return;b.scrollHeight!==0&&(b.scrollTop=b.scrollHeight-b.clientHeight)},this.updateChatTitle=function(a){var b=this.titlenode.querySelector('[data-title="true"]');a=="Group Chat"&&(a=WmsResource.getRealValue("Group_Chat")),this.title=a,a=WebMessanger.unescapeHTML(a),$WC.$CUtil.setInnerText(b,a),$WC.$CUtil.setInnerText(this.bartitlenode,a),b.setAttribute("title",a)},this.setTitle=function(a){this.updateChatTitle(a),this.partcount>2||this.title===WmsContacts.getDisplayName(this.recipant)||!!this.salesiqchat?this.reverttitlenode.style.display="none":this.reverttitlenode.style.display="block"},this.setIndex=function(a){this.winIndex=a},this.getIndex=function(){return this.winIndex},this.getPreIndex=function(){return this.prevIndex},this.setPreIndex=function(a){this.prevIndex=a},this.isMinimized=function(){return!this.maximized},this.updateParticipantsFromJoin=function(a){this.addParticipants(a,!1)},this.getImageUrl=function(){return this.imgurl},this.updateAvatar=function(a){this.avatarnode.innerHTML=a,$WC.$CUtil.loadOriginalImage(this.avatarnode,null,!0),this.baravatarnode.innerHTML=a,$WC.$CUtil.loadOriginalImage(this.baravatarnode,null,!0)},this.updateChannelImage=function(){var a=WmsHybridSearch.generateImageHtml(this.objId,WmsHybridSearch.constants.CHANNEL);this.updateAvatar(a)},this.updateBotImage=function(a){var b=WmsHybridSearch.generateImageHtml(a,WmsHybridSearch.constants.BOT);this.updateAvatar(b)},this.updateWebUrl=function(a){var b=JSON.parse(a).weburl;b&&this.updateUserStatus("",b)},this.clearChatContent=function(){this.msgdisp.innerHTML=""},this.updateInfoMsgTemplate=function(a){var b=JSON.parse(a).infomsgtemplate;this.addinfotemplate=b&&b.addmem,this.deleteinfotemplate=b&&b.deletemem,this.titleinfotemplate=b&&b.chattitle},this.populateParticipants=function(){var a="10",b=" ",c;if(this.ctype==1&&this.partcount==2){var d=Object.keys(this.partinfo)[0];if(d){e=WmsHybridSearch.generateImageHtml(d,WmsHybridSearch.constants.CONTACT),this.updateAvatar(e),a=this.partinfo[d].scode,b=this.partinfo[d].smsg,c=WMSUI.getStype(this.partinfo[d].st);if(a!=="0"||a!=="2")this.composer.placeholder=""}this.recentchatsnode.style.display="block",this.videoinfonode.className="wms_cw_videoinfo",this.videoinfonode.removeAttribute("title")}else{var e=WmsHybridSearch.generateImageHtml(this.objId,WmsHybridSearch.constants.CHAT,{TITLE:this.title},!0);this.updateAvatar(e),b=this.getGroupStatus(),$WC.$CUtil.addClass(this.statusmsgnode,"wms_cw_activeusers"),this.meetingnode.style.display="none",this.recentchatsnode.style.display="none",this.videoinfonode.className="wms_cw_primetime",this.videoinfonode.setAttribute("title",WmsResource.getRealValue("videobroadcast.primetime")+" - "+WmsResource.getRealValue("videobroadcast.dlg.imagetitle")),delete WebMessanger.ucmap[WebMessanger.chatmap[this.objId]],delete WebMessanger.chatmap[this.objId]}this.ctype==="10"&&(b=this.entityweburl||b),this.updateUserStatus(a,b,c)},this.addParticipants=function(a,b){a.forEach(function(a){this.partinfo[a.uname]=a},this),b&&this.updateParticipantsCount(),this.populateParticipants()},this.getGroupStatus=function(){var a=$WC.$CUtil.getObjectLength(this.partinfo),b=this.partinfo[WebMessanger.zuid]!=undefined?a:a+1,c=b>=2?WmsResource.getRealValue("chat.participants"):WmsResource.getRealValue("chat.participant"),d=b+" "+c;return b==0&&(d=WmsResource.getRealValue("chat.participants.none")),d},this.updateParticipantsCount=function(){this.partcount=$WC.$CUtil.getObjectLength(this.partinfo)+1},this.deleteParticipants=function(a){for(var b=0;b<a.length;b++){var c=a[b].uname;try{delete this.partinfo[c]}catch(d){}}this.updateParticipantsCount(),this.populateParticipants()},this.updateAddInfo=function(a){if(a){var b=a.split(":"),c={};for(var d=0;d<b.length;d+=2){var e=b[d];e!=undefined&&(c[e]=b[d+1]!=undefined?b[d+1]:"")}this.addinfo=c}},this.isMultiProtocolChat=function(){return this.getChatType()==CT_NFY_MULTIPROTOCOL?!0:!1},this.isLiveSupportChat=function(){return this.getChatType()==CT_NFY_LIVESUPPORT?!0:!1},this.isZohoGroupChat=function(){return this.getChatType()==CT_NFY_ZOHOGROUP?!0:!1},this.getChatType=function(){try{return this.addinfo.CT_TYPE}catch(a){return null}},this.getGroupID=function(){return this.isZohoGroupChat()?this.addinfo.GROUPID:null},this.getProtocol=function(){return this.isMultiProtocolChat()?this.addinfo.PROTOCOL:null},this.getToolBarStatus=function(){if(this.ctype!=="5"&&this.ctype!=="8"&&this.partcount===2&&this.isLiveSupportChat()===!1&&this.isZohoGroupChat()===!1&&this.isMultiProtocolChat()===!1)if(WMSUI.isVideoEnabled()||WMSUI.isAudioEnabled()||WebMessanger.meeting)return!0;return!1},this.checkAndHideVideoDropdown=function(a){if(a.relatedTarget&&(a.relatedTarget.getAttribute("data-videodropdown")||a.relatedTarget.closest("[data-videodropdown=true]")))return;this.hideVideoDropdown()},this.toggleVideoDropdown=function(a){this.videodropdownshown?(this.hideVideoDropdown(),this.videodropdownshown=!1):(this.showVideoDropdown(a),this.videodropdownshown=!0)},this.hideVideoDropdown=function(){this.videodropdownnode.style.display="none",this.videodropdownnode.className="wms_videoinfo_dropdown",this.videodropdownshown=!1},this.showVideoDropdown=function(a){if(a&&getEventTarget(a).id!=="wms_cw_videoinfo")return;if(this.getToolBarStatus()){var b="none",c="none",d="none";try{WMSUI.isVideoEnabled()&&WmsSettings.getAdminSetting("isMediacallAllowed")&&!this.isMultiProtocolChat()&&(b="block")}catch(e){}try{WMSUI.isAudioEnabled()&&WmsSettings.getAdminSetting("isMediacallAllowed")&&!this.isMultiProtocolChat()&&(c="block")}catch(e){}WebMessanger.meeting&&this.ctype!=="5"&&this.ctype!=="8"&&this.ctype!=="10"&&(d="block"),this.meetingnode.style.display=d;if(b==="none"&&c==="none")this.videoinfonode.style.display="none";else if(a){c!=="none"&&(this.audioiconnode.style.display="block"),b!=="none"&&(this.videoiconnode.style.display="block");var f=this.videodropdownnode;f.style.display="block"}}else(this.isZohoGroupChat()||this.partcount>2&&this.ctype==="1"||this.ctype==="8")&&WebMessanger.isCliqUser()&&($WC.$CUtil.isChrome()||$WC.$CUtil.isFirefox())?(this.videoinfonode.className="wms_cw_primetime",this.videoinfonode.setAttribute("title",WmsResource.getRealValue("videobroadcast.primetime")+" - "+WmsResource.getRealValue("videobroadcast.dlg.imagetitle"))):this.videoinfonode.style.display="none"},this.clearTypingStatus=function(){var a=this.typingstatusnode;$WC.$CUtil.addClass(a,"wms_cw_typingstatus_animate"),a.setAttribute("data-typingstatus",!1)},this.handleAudioVideoChat=function(a){var b=getEventTarget(a);b.getAttribute("data-audioicon")?this.startAudioChat():b.getAttribute("data-videoicon")&&this.startVideoChat(),this.checkAndHideVideoDropdown(a),a.stopPropagation()},this.startVideoChat=function(){if(this.getToolBarStatus())for(var a in this.partinfo){var b=this.partinfo[a].zuid.trim();if(b.length>0){WMSUI.makeVideoCall(b,WebMessanger.ismediacallnewwindow,this);break}}else if(this.isZohoGroupChat()||this.partcount>2&&this.ctype==="1"||this.ctype==="8"){var c=_WMSCHATURL+"startprimetime.do?chid="+encodeURIComponent(this.objId),d=WmsSettings.primetime_onboard_count;if(d>2)window.open(c);else{var e="primetime_onboard_count="+(parseInt(d)+1);WebMessanger.updateSettings(e);if(document.getElementById("zcwindows")===null){var f=document.createElement("div");f.id="zcwindows",f.className="zcoverlay",f.style.zIndex=WebMessanger.setzindex,document.body.appendChild(f)}var g='<div class="mcontent"><div class="zcprime_lhs"><img src="https://img.zohostatic.com/ichat/v282_https/images/bar/pt_dialog.png" width="280" height="218" />'+'<strong class="zcprime_content">'+WmsResource.getRealValue("videobroadcast.dlg.imagetitle")+"</strong></div>"+'<div class="zcprime_rhs">'+"<p>"+WmsResource.getRealValue("videobroadcast.dlg.title")+"</p>"+"<ul>"+'<li class="mcontent_p">'+WmsResource.getRealValue("videobroadcast.dlg.desc1")+"</li>"+'<li class="mcontent_p">'+WmsResource.getRealValue("videobroadcast.dlg.desc2")+"</li>"+'<li class="mcontent_p">'+WmsResource.getRealValue("videobroadcast.dlg.desc3")+"</li>"+"</ul>"+'<a href=" '+_PRIMETIMEHELPLINK+'" target="_blank">'+WmsResource.getRealValue("common.learnmore")+"</a>"+'<div class="zcprime_confirm">'+"<p>"+WmsResource.getRealValue("videobroadcast.dlg.session")+"</p>"+'<div id="primetime_start_confirm" class="zcdbtn">'+WmsResource.getRealValue("videobroadcast.dlg.proceed")+"</div>"+"</div>"+"</div>"+"</div>";$WC.$Win.create({id:"primetime_trigger",header:'<div class="wms_cw_primetime "><strong>'+WmsResource.getRealValue("videobroadcast.primetime")+"</strong></div>",html:g,"class":"zcprime"});var h=document.getElementById("primetime_start_confirm");Gator(h).on("click",function(){$WC.$Win.destroy("primetime_trigger"),window.open(c)})}}return!1},this.startAudioChat=function(){if(this.getToolBarStatus())for(var a in this.partinfo){var b=this.partinfo[a].zuid.trim();if(b.length>0){WMSUI.makeAudioCall(b,WebMessanger.ismediacallnewwindow,this);break}}return!1},this.startMeeting=function(){if(this.getToolBarStatus())for(var a in this.partinfo){var b=this.partinfo[a].zuid.trim();b==""&&(b=a.substring(a.indexOf("|")+1,a.length));if(b.length>0){WMSUI.startMeeting(b);break}}return this.hideActions(),!1},this.toggleActions=function(){this.actionlistnode.style.display==="block"?this.hideActions():($WC.$CUtil.addClass(this.actionbutton,"wms_cw_toolbar_actionbutton_selected"),this.actionlistnode.style.display="block",this.makeNormalAndPropagate())},this.hideActions=function(){this.actionlistnode.style.display==="block"&&(this.actionlistnode.style.display="none",$WC.$CUtil.removeClass(this.actionbutton,"wms_cw_toolbar_actionbutton_selected"),this.makeNormalAndPropagate())},this.getActions=function(a){if(this.actionlistnode.querySelector('[data-purpose="wms_botactions"]'))return;var b=WmsContacts.contactslist[a],c=this.objId;if(!$WC.$CUtil.isEmpty(b)&&b.actionhandles){this.updateActionsUI(a);return}WmsContacts.updateBotActions(a,[]);var d=function(){var b=JSON.parse(this.response);WmsContacts.updateBotActions(a,b.data.actions);var d=WindowHandler.getWinObjById(c);d&&(d.updateActionsUI(a),d.updatePinnedInfo(d.ispinned))},e=function(){WmsContacts.updateBotActions(a,undefined)},f=_WMSCFPARAMNAME+"="+Cookie.getCustomCookie(_WMSCFCOOKIENAME),g="v1/bots/"+a+"/getactions";$WC.Ajax.requestToChat(g,f,d,e)},this.updateActionsUI=function(a){var b="",c=WmsContacts.contactslist[a];if(!$WC.$CUtil.isEmpty(c)&&typeof c.actionhandles!="undefined")for(var d=0;d<c.actionhandles.length;d++){var e=c.actionhandles[d];b+='<div data-purpose="wms_botactions" data-botid="'+a+'" data-exec_id="'+e.id+'" data-display_props="'+e.display_props.name+'" class="wms_cw_toolbar_actionitem wms_botactionicn">'+e.display_props.name+"</div>"}this.actionlistnode.insertAdjacentHTML("beforeend",b)},this.populateChatTitleEdit=function(){var a=this.partcount>2||this.isLiveSupportChat()||this.isZohoGroupChat()?"wms-gni":"wms-cni";return'<form onsubmit="WindowHandler.exist['+this.winIndex+'].saveChatTitle(this.wmseditchattitletxt.value);return false;"><input type="text" class="'+a+'" id="wmseditchattitletxt" onkeydown="WindowHandler.exist['+this.winIndex+'].checkkey(event)"  onblur="WindowHandler.exist['+this.winIndex+'].checkChatTitle(this.value)"; autocomplete="off"/></form>'},this.checkkey=function(a){a.keyCode==27&&this.setTitle(this.getTitle())},this.focusChatTitle=function(){try{var a=this.getInnerObject("wmseditchattitletxt","INPUT");a.select(),a.focus()}catch(b){}},this.getRecentChats=function(){if($WC.$CUtil.getObjectLength(this.partinfo)===1){for(var a in this.partinfo)var b=a;ZMSGUI.showChatHistory(b)}this.hideActions()},this.muteChat=function(a){var b=getEventTarget(a),c=!0,d=b.getAttribute("data-duration");this.mutedinterval?c=!1:d||(d="-1"),this.updateMuteInfo(c),this.hideActions(),WebMessanger.muteChat(this.objId,d,c)},this.unsubscribeBot=function(a){var b=WmsChannels.getBotId(this.objId);$WC.Ajax.postRequestToChat("v1/bots/"+b+"/unsubscribe"),this.closeAndPropagate(a)},this.showInfoMsg=function(a){this.showErrorMsg(a,"info")},this.showErrorMsg=function(a,b){$WC.$CUtil.setInnerText(this.errormsgnode,a),b==="info"&&(this.errormsgnode.className="wms_cw_infomsg wms-halign"),this.errormsgnode.style.display="block",this.error_timer=setTimeout(function(a){a.hideErrorMsg()},3e3,this)},this.hideErrorMsg=function(){this.errormsgnode.style.display="",$WC.$CUtil.setInnerText(this.errormsgnode,"")},this.pinChat=function(){WebMessanger.pinChat(this.objId,!this.ispinned),this.hideActions()},this.revertTitle=function(){var a=WmsContacts.getDisplayName(this.recipant)||this.partinfo[this.recipant].dname;WebMessanger.setChatTitle(this.objId,a,this.title),this.hideActions()},this.toggleChatTitle=function(){this.getInnerObject("wms-chattitle","P").getAttribute("data-purpose")==="cleartitle"?WebMessanger.setChatTitle(this.objId,""):this.editChatTitle()},this.editChatTitle=function(){if(this.ctype==="8"||this.ctype==="5"||this.ctype==="10"||document.activeElement.id==="wmseditchattitletxt"||WMSUI.showErrorIfPermDenied(this.objId))return;var a=this.titlenode.querySelector('[data-title="true"]');a.innerHTML=this.populateChatTitleEdit();var b=WindowHandler.getObjectInObject(a,"wmseditchattitletxt","INPUT");b.value=WebMessanger.unescapeHTML(this.getTitle()),this.focusChatTitle()},this.checkChatTitle=function(a){try{a=a.trim();if(a.length>200)return this.focusChatTitle(),!1;this.setTitle(unescape(this.getTitle()))}catch(b){return!1}},this.saveChatTitle=function(a){try{a=a.trim();var b=this.getTitle();if(b!=a){if(a.length==0)return alert(WmsResource.getRealValue("Please_enter_the_chat_title")),this.focusChatTitle(),!1;if(a.length>200)return alert(WmsResource.getRealValue("Max_200_chatracters_allowed_for_chat_title")),this.focusChatTitle(),!1;WebMessanger.setChatTitle(this.objId,a,b),this.setTitle(a)}else this.setTitle(a)}catch(c){}},this.insertAddParticipant=function(a){this.hideActions();if(WMSUI.showErrorIfPermDenied(this.objId))return;var b=this.composer.selectionStart;this.composer.value=this.composer.value.substring(0,b)+"+"+this.composer.value.substring(b),util.moveCaretPosition(this.composer,b+1,b+1),WMSUI.handleStatus(a,this.composer,this.objId)},this.setHistoryStorage=function(){this.hideActions();if(WMSUI.showErrorIfPermDenied(this.objId))return;this.savehistory==="0"?(WebMessanger.setHistoryStorage("enable",this.objId),$WC.$CUtil.setInnerText(this.actionlistnode.querySelector("[data-historyoff]"),WmsResource.getRealValue("history.off"))):(WebMessanger.setHistoryStorage("disable",this.objId),$WC.$CUtil.setInnerText(this.actionlistnode.querySelector("[data-historyoff]"),WmsResource.getRealValue("history.on")))},this.leaveChannel=function(){WebMessanger.leaveChannel(this.objId),this.hideActions()},this.updateSaveHistory=function(a){this.savehistory=a},this.updateSaveHistoryInUI=function(){this.savehistory==="0"?($WC.$CUtil.setInnerText(this.actionlistnode.querySelector("[data-historyoff]"),WmsResource.getRealValue("history.on")),WmsChatCache.get(this.objId)||this.updateInfoMessage(WmsResource.getRealValue("history.message"))):this.savehistory==="1"&&$WC.$CUtil.setInnerText(this.actionlistnode.querySelector("[data-historyoff]"),WmsResource.getRealValue("history.off"))},this.changeActive=function(){WMSUI.handleDocumentActive()},this.joinChat=function(){this.objId!=undefined&&setTimeout("WebMessanger.join('"+this.objId+"',true)",3e3)},this.checkAndPopulateGroupMembers=function(){this.membersdispnode.style.display=="block"&&this.populateGroupMembers()},this.populateGroupMembers=function(){var a=this.membersdispnode,b="",c="",d="",e="",f="",g=[];for(var h in this.partinfo){g.push(this.partinfo[h]);if(this.partinfo[h].zuid===WebMessanger.zuid)var i=!0}i||g.push({dname:WebMessanger.nname,uname:WebMessanger.uname,zuid:WebMessanger.zuid});var j=g.sort($WC.$CUtil.sortBy("dname",!1,function(a){return a.toLowerCase()}));for(var k=0;k<j.length;k++){var l=j[k].uname.trim(),m=j[k].dname,n=WmsContacts.status(l.substring(l.indexOf(" | ")+1,l.length)),o="wms-bar-status";if(n==1)b+=this.getGroupMemberHTML(l,m,o,n);else if(n==3)c+=this.getGroupMemberHTML(l,m,o,n);else if(n==4)d+=this.getGroupMemberHTML(l,m,o,n);else if(n===!1||n==="-5"||n==="-1")f+=this.getGroupMemberHTML(l,m,o,n);else if(n==="0"||n==="2")e+=this.getGroupMemberHTML(l,m,o,n)}this.ctrlcomp.className=="wmscmda"&&(this.ctrlcomp.style.height="",this.ctrlcomp.className="wmscmd");var p='<span class="wms_cw_memberlist_closeicon" onclick="WindowHandler.exist['+this.winIndex+'].toggleGroupMembers()"></span>';a.innerHTML='<div class="wms_cw_memberlist">'+b+c+d+e+f+"</div>"+p,a.style.display="block"},this.getGroupMemberHTML=function(a,b,c,d){var e="",f="wms-groups-prt1",g="https://img.zohostatic.com/ichat/v282_https/images/bar/contactphoto.gif",h=a;a.trim()!=""&&(g=_WMSPHOTOSERVER+"/file?ID="+a+"&t=user&height=30&width=30"),WmsContacts.isMPUser(a)&&(h=a.substring(a.indexOf(" | ")+1,a.length),g=WmsContacts.getMPUserPhoto(h)),WmsContacts.contactslist[h]!=undefined&&(b=WmsContacts.contactslist[h].DNAME),b==undefined&&(b=WmsContacts.getMPDispName(h));var i=32,j=32,k=this.objId;if(d==1||d==3||d==4||d==0)var l=f,m=f+" wmsdelicosho";else l=f+" wmsgrpmemoff",m=f+" wmsgrpmemhov wmsdelico";e+='<div class="'+l+'" onmouseover="this.className=\''+m+"';\" onmouseout=\"this.className='"+l+'\';"><img data-zcprofileid="'+a+'" src="'+g+'" title="'+$WC.$CUtil.safeHTML(b)+'" alt="" height="'+i+'" width="'+j+'"/>';var n=WmsContacts.status(h);return n!==!1&&n!=="-5"&&n!=="-1"&&n>-1&&n<=4&&(e+=WmsBadgeImage.getStatusHtml(h,!0)),this.partcount>2&&this.ctype!=8&&this.ctype!=10&&(e+='<span title="'+WmsResource.getRealValue("Delete")+"\" class=\"wms-delmemshow\" onclick=\"WMSUI.deleteParticipant('CHATID','ZUID','DNAME')\" data-memdel=true></span>"),e+="</div>",e=e.replace(/CHATID/g,k),e=e.replace(/ZUID/g,a),e=e.replace(/DNAME/g,$WC.$CUtil.safeHTML(b)),e},this.toggleGroupMembers=function(){var a=this.membersdispnode;a.style.display=="block"?(a.style.display="none",this.msgdisp.style.display="table-cell",this.ctrlcomp.scrollTop=this.scrollTop,this.showmembersnode.innerHTML=WmsResource.getRealValue("chat.members.show"),this.showmembersnode.title=WmsResource.getRealValue("chat.members.show"),this.showmembersnode.setAttribute("data-showmembers",!0)):(this.scrollTop=this.ctrlcomp.scrollTop,this.ctype==="8"&&$WC.$CUtil.getObjectLength(this.partinfo)<this.partcount?WebMessanger.fetchAndShowChannelMembers(this.objId,!0):(this.populateGroupMembers(),this.showmembersnode.innerHTML=WmsResource.getRealValue("Hide_Members"),this.showmembersnode.title=WmsResource.getRealValue("Hide_Members"),this.showmembersnode.setAttribute("data-showmembers",!1))),this.hideActions()},this.showProgress=function(a){var b=a/100;if(a==-1){var c='<div class="wms_progressbar_failure_text">'+WmsResource.getRealValue("Sharing_failed")+'<span class="wms_cw_progressbar_cls" onclick="WindowHandler.exist['+this.winIndex+'].clearProgress()"><span class="wms_cw_opr_close"></span></span></div>';this.progressbarnode.style.display="block",this.progressbarnode.innerHTML=c}else if(this.progressbarnode.style.display!=="block")c='<div class="wms_cw_progress_shadow"><div class="wms_cw_progressholder"><div class="wms-loading-sub" data-progressindicator="true" style="transform: scaleX('+b+')"></div></div>'+'<span id="wmsloadingtxt"class="wms-loading-text" data-progresstext="true">'+WmsResource.getRealValue("Sharing")+" "+a+"%</span>"+'<span class="wms_cw_progressbar_cls wms_cw_closeicon" onclick="WindowHandler.exist['+this.winIndex+'].cancelProgress()">'+"</span>"+"</div>",this.progressbarnode.style.display="block",this.progressbarnode.innerHTML=c;else{var d=this.progressbarnode.querySelector("[data-progressindicator]");d.style.transform="scaleX("+b+")";var e=this.progressbarnode.querySelector("[data-progresstext]");$WC.$CUtil.setInnerText(e,WmsResource.getRealValue("Sharing")+" "+a+"%")}},this.clearProgress=function(){this.progressbarnode.style.display="none",this.progressbarnode.innerHTML="",delete WmsFileUpload.req[this.objId]},this.cancelProgress=function(){WmsFileUpload.abort(this.objId),this.clearProgress(this.objId)},this.removeSendFile=function(){this.attachmentnode.style.display="none"},this.storeWindowState=function(a){WmsSessionStorage.setChatInfo({chid:this.objId,state:a})},this.removeWindowState=function(){WmsSessionStorage.removeChatState(this.objId)},this.updateAttachInfo=function(a){this.attached=a},this.replaceMessages=function(a){$WC.$CUtil.isArray(a)&&a.length>0&&(Message.constructAndAppendChatContent(a,this.msgdisp,this.getObjId()),this.scrollDisplay())},this.isMsgAlreadyUpdated=function(a,b){var c=b.querySelector('[data-msgid="'+a.sender+"_"+a.msgid+'"],[data-msgid="'+a.sender+"_"+a.time+'"]');return c?!0:!1},this.updateMessage=function(a){var b=this.ctrlcomp,c=this.scrollDisplay,d,e,f=b.scrollHeight-b.clientHeight<=b.scrollTop+20?!0:!1;$WC.$CUtil.isArray(a)||(a=[a]);var g=this.msgdisp.querySelectorAll("#"+this.msgdisp.id+" > [data-senderzuid]");g.length>0&&(a.previoussender=g[g.length-1].getAttribute("data-senderzuid"));var h=this.msgdisp.querySelectorAll("[data-msgtime]");h.length>0&&(a.previoustime=h[h.length-1].getAttribute("data-msgtime")),a.previoustime==""&&h[h.length-2]&&(a.previoustime=h[h.length-2].getAttribute("data-msgtime"));if(a[0]&&Message.isDelayMsg(a[0])){var i=parseInt(a[0].meta.config.d);d=this.msgdisp,clearTimeout(this.msgdelaytimer),this.msgdelaytimer=setTimeout(function(){Message.constructAndAppendChatContent(a,d,this.getObjId()),c(f,b)},i)}else e=this.typingstatusnode.getAttribute("data-typingstatus"),e&&this.typingstatusnode&&!Message.isLocalUser(a[0].sender)&&($WC.$CUtil.addClass(this.typingstatusnode,"wms_cw_typingstatus_animate"),clearTimeout(Self.Timer[this.getObjId()])),Message.constructAndAppendChatContent(a,this.msgdisp,this.getObjId()),a[0].sender==$WC.$CUtil.getConfig("zuid")&&this.scrollDisplay();this.scrollDisplay(f,b),typeof WmsUIImpl!="undefined"&&WmsImplHandler.invoke(WmsUIImpl.handleNewMessage,this.ctype,this.objId,this.getChannelUID(),a[0]&&a[0].msg)},this.updateMessageFragment=function(a,b){var c=b.querySelector('[data-msgid="'+a.sender+"_"+a.msgid+'"]');if(!c)return;var d=Message.getMessageType(a);if(Message.isMetaMsg(a)||d===Message.types.IMGATT||d===Message.types.FILEATT||d===Message.types.AUDIOATT||d===Message.types.VIDEOATT){var e=b.scrollHeight-b.clientHeight<=b.scrollTop+20?!0:!1,f={};Message.isMetaMsg(a)?(f.dname=a.dname,f.meta=a.meta,f.msg=a.msg,f.msgid=a.msgid,f.sender=a.sender,f.time=a.time):f=a,$WC.$CUtil.isArray(f)||(f=[f]);var g=b.querySelectorAll("[data-senderzuid]");g.length>0&&(f.previoussender=g[g.length-1].getAttribute("data-senderzuid"));var h=b.querySelectorAll("[data-msgtime]");h.length>0&&(f.previoustime=h[h.length-1].getAttribute("data-msgtime"));if(!c.querySelector("[data-furl]")){var l=Message.constructChatContent(f,"",a.chid);c.nextSibling&&c.nextSibling.className==="wms-msgtime"&&$WC.$CUtil.removeElement(c.nextSibling),c.outerHTML=l,this.scrollDisplay(e,b);return}var i="/"+_CHATCONT+"/v1/attachments/"+f[0].msg.url;c.querySelector("[data-furl]").setAttribute("data-src",f[0].msg.url);if(c.querySelector("[href]")){var j=c.querySelectorAll("[href]");for(var k=0;k<j.length;k++)j[k].href=i}c.querySelector("[data-media]")&&c.querySelector("[data-media]").setAttribute("source",i),c.querySelector("[data-fcontent]")&&c.querySelector("[data-fcontent]").setAttribute("data-fcontent",f[0].msg.content)}else $WC.$CUtil.setInnerText(c.querySelector('[class="wms-msgtime"]'),MyDate.formatTime(a.time));c.setAttribute("data-msgtime",a.time),c.setAttribute("data-msgid",a.sender+"_"+a.time),c.removeAttribute("data-notack")},this.updateInfoMessage=function(a,b,c){a={msg:a,type:c};var d={msg:a,messagetype:Message.types.INFOMSG,time:b||(new Date).getTime()};this.updateMessage(d)},this.toggleSmiley=function(a){this.permdenied||Smiley.toggle(this.smileycontainer,a)},this.resetBarStatusIcon=function(){WmsMainUI.resetUnreadCount(this.objId),WmsRecentChats.removeFromUnreadChats(this.objId),WmsMainUI.updateUnreadChatsCount(),this.updateBarMsgcount()},this.updateBarMsgcount=function(){$WC.$CUtil.setInnerText(this.barmsgcountnode,WmsMainUI.getUnreadCount(this.objId)),WmsMainUI.updateUnreadCountInUI(this.objId),WmsMainUI.getUnreadCount(this.objId)>0?this.barmsgcountnode.style.display="block":this.barmsgcountnode.style.display="none"},this.getChannelUID=function(){return this.channelid||WmsChannels.get(this.objId)&&WmsChannels.get(this.objId).oc_id},this.getChannelServiceCode=function(){return this.channelservicecode||WmsChannels.get(this.objId)&&WmsChannels.get(this.objId).service},this.getChannelSOID=function(){return this.channelsoid||WmsChannels.get(this.objId)&&WmsChannels.get(this.objId).servicespecid},this.getReplyMessageId=function(){var a,b;return this.editorreplydiv.style.display=="block"&&(a=this.editorreplydiv.querySelector("[data-replymsgtime]"),b=a.getAttribute("data-replysenderzuid")+"_"+a.getAttribute("data-replymsgtime")),b},this.constructReplyMessageObject=function(a,b,c){var d,e=a.getAttribute("data-msgtime"),f=a.getAttribute("data-msgid"),g=a.querySelector("[data-sendername]"),h=a.getAttribute("data-sendername")||g&&g.getAttribute("data-sendername");d=Message.getMsgFromDom(this.objId,f,!1,!0);var i=Message.getMessageType(d),j=f.split("_")[0],k={meta:{opr_replydetails:{messagetype:i,msgtime:e,sender:j,sendername:h}}};b&&(k.msg=b,k.time=c,k.sender=WebMessanger.zuid);if(i===Message.types.IMGATT)var l="addinfo";else l="msg";return k.meta.opr_replydetails[l]=d,k},this.showReplyPreview=function(a){this.closeReplyPreview();var b=Message.constructReplyMessageFragment(this.constructReplyMessageObject(a),!0);this.focus(),this.footernode.style.borderRadius="0px 0px 5px 5px",this.editorreplydiv.innerHTML=b,this.editorreplydiv.style.display="block"},this.closeReplyPreview=function(){this.editorreplydiv.innerHTML="",this.editorreplydiv.style.display="none",this.footernode.style.borderRadius="5px 5px 5px 5px"},this.showRestrictedChannelIcon=function(){var a=this.win.querySelector("[data-channelrestricted]"),b=WmsChannels.get(this.objId)&&WmsChannels.get(this.objId).open_to_all;b=="false"&&$WC.$CUtil.setAttribute(a,"data-channelrestricted",!0)},this.disableActions=function(a){a=a||this;if(a.actionbutton){var b=a.actionbutton;b.style.cursor="not-allowed",b.disabled="true"}},this.disableComposerOptions=function(a,b){b=b||this;var c=b.composer;c.style.cursor="not-allowed",c.disabled="true",a&&(c.placeholder=a);if(b.attachmentnode){var d=b.attachmentnode.querySelector('[id="wms-file"]');d.style.cursor="not-allowed",d.disabled="true"}var e=b.smileyinvoker;e.style.cursor="not-allowed",e.disabled="true",e.className="wms-smileyinvokerdisabled wms-valign-mid-block"},this.hideActionItem=function(a,b){var c=this.actionlistnode.querySelector("[data-"+a+'="'+b+'"]');c.style.display="none"},this.toggleEnlargeWindow=function(){this.isEnlarged?this.shrinkEnlargedWindow():(WindowHandler.shrinkEnlargedWindows(),this.focus(),this.isEnlarged=!0,this.enlargeicon.title=WmsResource.getRealValue("chat.shrink"),$WC.$CUtil.addClass(this.mainwin,"wms_cw_enlarged"),$WC.$CUtil.addClass(this.enlargeicon,"wms_cw_enlargeicon_rotate")),WindowHandler.onResize()},this.shrinkEnlargedWindow=function(){this.isEnlarged=!1,this.enlargeicon.title=WmsResource.getRealValue("chat.enlarge"),$WC.$CUtil.removeClass(this.enlargeicon,"wms_cw_enlargeicon_rotate"),$WC.$CUtil.removeClass(this.mainwin,"wms_cw_enlarged")}}function Factory(){}function WindowHandler(){}function Message(){}function Chat(){}function MyDate(){}function Self(){Self.prevIdleStatus}function Smiley(){}function Cookie(){}function WMSZohoApi(){}function WmsGroups(){}function WMSKeyHandler(){}function WMSSessionConfig(){}function WmsSound(){}function WmsSettings(){}function WmsDragDrop(){}function PubSubObject(a,b,c,d,e,f){this.pskey=a,this.config=c,this.psuri=b,this.maxulist=-1,d!=undefined&&(this.maxulist=d),this.authtype=e,this.authid=f,this.userinfo={},this.wmsids=new Array,this.getUsers=function(){return this.userinfo},this.reInitUsers=function(){this.userinfo={},this.wmsids=new Array},this.addUsers=function(a){for(var b in a)this.addUser(b,a[b])},this.removeUsers=function(a){for(var b in a)this.removeUser(b,a[b])},this.addUser=function(a,b){var c=this.wmsids.indexOf(a);c!=-1&&this.wmsids.splice(c,1),this.wmsids.push(a),this.userinfo[a]=b;if(this.maxulist!=-1&&this.wmsids.length>this.maxulist){var d=this.wmsids.splice(0,1);delete this.userinfo[d]}},this.removeUser=function(a){var b=this.wmsids.indexOf(a);if(b!=-1){var c=this.wmsids.splice(b,1);delete this.userinfo[c]}},this.userCount=function(){return this.wmsids.length}}function PubSubApi(){}function PubSubBridge(){}function WmsNotification(){}function ListCommon(a,b){this.container=b,this.input=a,this.selectedelem="";var c=this;a.addEventListener("keydown",function(a){c.container.style.display==="block"&&c.handleKeyMovement(a,c)}),b.addEventListener("click",function(a){var b=getEventTarget(a);c.handleClick(b,c),typeof WmsUIImpl!="undefined"&&WmsImplHandler.invoke(WmsUIImpl.onChatWindowDropUpClick,a,c)})}"use strict";var $WC=$WC||{};$WC.VirtualList=function(a){function l(){if(Date.now()-k>100){var a=this.container.querySelectorAll('[data-rm="1"]');for(var b=0,c=a.length;b<c;b++)this.container.removeChild(a[b])}}var b=a&&a.w+"px"||"100%",c=a&&a.h+"px"||"100%",d=this.itemHeight=a.itemHeight;this.excessHeightObj={},this.items=a.items,this.generatorFn=a.generatorFn,this.hoverFunction=a.hoverFunction,this.totalRows=a.totalRows||a.items&&a.items.length;var e=$WC.VirtualList.createScroller(d*this.totalRows);this.container=a.container?a.container:$WC.VirtualList.createContainer(b,c),this.container.appendChild(e);var f=Math.ceil(a.h/d);this.cachedItemsLen=f*4;if(this.container.scrollTop!=0){var g=parseInt(this.container.scrollTop/d)-f;g=g<0?Math.ceil(this.container.scrollTop/d):g,this.container.scrollTop=g*d,this._renderChunk(this.container,g)}else this._renderChunk(this.container,0);var h=this,i,j=f*d,k=0;this.onScroll=function(a){var b=a.target.scrollTop,c=h.container.querySelector("[data-id]");if(!i||c.getAttribute("data-select")&&c.getAttribute("data-rc")!=0||Math.abs(b-i)>j){var e=h.container.querySelector("[data-select]"),g=parseInt(b/d)-f;h._renderChunk(h.container,g<0?0:g),e=e?h.container.querySelector('[data-rc="'+e.getAttribute("data-rc")+'"]:not([data-rm])'):"",e&&h.hoverFunction(e),i=b}k=Date.now(),a.preventDefault&&a.preventDefault(),h.rmNodeInterval==null&&(h.rmNodeInterval=setInterval(l.bind(h),300)),$WC.$CUtil.debounce(function(){clearInterval(h.rmNodeInterval),h.rmNodeInterval=null},h,1e3)},this.clearRmNodeInterval=$WC.$CUtil.debounce(function(){clearInterval(this.rmNodeInterval),this.rmNodeInterval=null},this,1e3),this.remove_event_listeners=function(){this.container.removeEventListener("scroll",this.onScroll),this.container.removeEventListener("scroll",this.clearRmNodeInterval)},this.container.addEventListener("scroll",this.onScroll),this.container.addEventListener("scroll",this.clearRmNodeInterval)},$WC.VirtualList.prototype.createRow=function(a){var b;if(this.generatorFn)b=this.generatorFn(a);else if(this.items)if(typeof this.items[a]=="string"){var c=document.createTextNode(this.items[a]);b=document.createElement("div"),b.style.height=this.itemHeight+"px",b.appendChild(c)}else b=this.items[a];$WC.$CUtil.isArray(b)&&(this.excessHeightObj[a]=b[1],b=b[0]);var d=0;for(var e in this.excessHeightObj)a>e&&(d+=this.excessHeightObj[e]);return b.style.position="absolute",b.style.top=a*this.itemHeight+d+"px",$WC.$CUtil.setAttribute(b,"data-rc",a),b},$WC.VirtualList.prototype._renderChunk=function(a,b){var c=b+this.cachedItemsLen;c>this.totalRows&&(c=this.totalRows);var d=document.createDocumentFragment();for(var e=b;e<c;e++)d.appendChild(this.createRow(e));for(var f=1,g=a.childNodes.length;f<g;f++)a.childNodes[f].style.display="none",a.childNodes[f].setAttribute("data-rm","1");a.appendChild(d)},$WC.VirtualList.createContainer=function(a,b){var c=document.createElement("div");return c.style.width=a,c.style.height=b,c.style.overflow="auto",c.style.position="relative",c.style.padding=0,c.style.border="1px solid black",c},$WC.VirtualList.createScroller=function(a){var b=document.createElement("div");return b.style.opacity=0,b.style.position="absolute",b.style.top=0,b.style.left=0,b.style.width="1px",b.style.height=a+"px",b};var $WC=$WC||{},op=/opera|opera 5|opera\/5/i.test(navigator.userAgent),ie=!op&&/msie/i.test(navigator.userAgent);$WC.$CUtil={processXSS:function(a,b){return a?(b||(a=this.decodeHTMLEntities(a)),a.replace(/&/g,"&amp;").replace(/\"/g,"&quot;").replace(/\'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;")):a},decodeHTMLEntities:function(a){return a.replace(/&#x2F;/g,"/").replace(/&#39;|&#x27;/g,"'").replace(/&quot;/g,'"').replace(/&gt;/g,">").replace(/&lt;/g,"<").replace(/&amp;/g,"&")},isEmpty:function(a){return a===undefined||a===null||a===""?!0:!1},isEmptyObject:function(a){for(var b in a)if(a.hasOwnProperty(b))return!1;return JSON.stringify(a)===JSON.stringify({})},trim:function(a){return a.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")},getObjectLength:function(a){if(typeof a=="object"){if(Object&&Object.keys)return Object.keys(a).length;var b=0;for(var c in a)b++;return b}},getEventTarget:function(a){return ie?window.event.srcElement:a.target},getNextRotationalNode:function(a,b){if(b===39||b===40)return a.nextSibling||a.parentNode.firstChild;if(b===37||b===38)return a.previousSibling||a.parentNode.lastChild},center:function(a){if(!a)return;var b=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight,c=a.offsetHeight,d=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,e=a.offsetWidth,f=a.style,g=b<c?0:(b-c)/2,h=d<e?0:(d-e)/2;f.top=g+"px",f.left=h+"px"},extend:function(){function k(a){return typeof a=="function"&&a.constructor===Function}function l(a){return a instanceof Array}function m(a){return typeof a=="object"&&a.constructor==Object}var a,b,c,d,e,f,g=arguments[0]||{},h=1,i=arguments.length,j=!1;typeof g=="boolean"&&(j=g,g=arguments[h]||{},h++),typeof g!="object"&&!k(g)&&(g={}),h===i&&(g=this,h--);for(;h<i;h++)if((e=arguments[h])!=null)for(d in e){a=g[d],c=e[d];if(g===c)continue;j&&c&&(m(c)||(b=l(c)))?(b?(b=!1,f=a&&l(a)?a:[]):f=a&&m(a)?a:{},g[d]=$WC.$CUtil.extend(j,f,c)):c!==undefined&&c!==null&&(g[d]=c)}return g},removeAllClass:function(a,b){if(!a)return;var c=a.querySelectorAll("."+b),d=c.length;if(!d)return;for(var e=0;e<d;e++)$WC.$CUtil.removeClass(c[e],b)},cloneObject:function(a,b){return b?$WC.$CUtil.extend(!0,{},a):$WC.$CUtil.extend({},a)},cloneArray:function(a){return a.slice(0)},getConfig:function(a){return this.globalconf?this.globalconf[a]:null},setConfig:function(a){if(typeof a=="object"){this.globalconf||(this.globalconf={});for(var b in a)this.globalconf[b]=a[b];a.Resource&&($WC.Resource=a.Resource)}},getCSRF:function(){return $WC.$CUtil.getConfig("CHATCFPARAMNAME")+"="+$WC.Cookie.get($WC.$CUtil.getConfig("CHATCFCOOKIENAME"))},nocachefix:function(a){if(a)return"&nocache="+(new Date).getTime();var b="";return $WC.$CUtil.getConfig("WMSCFPARAMNAME")!=undefined&&(b="&"+$WC.$CUtil.getConfig("WMSCFPARAMNAME")+"="+$WC.Cookie.get($WC.$CUtil.getConfig("_WMSCFCOOKIENAME"))),b+="&nocache="+(new Date).getTime(),b},debounce:function(a,b,c,d){var e,f=0;return function(){var g=arguments,h=b||this;d===!0?(Date.now()-f>c&&a.apply(h,g),f=Date.now()):(clearTimeout(e),e=setTimeout(function(){a.apply(h,g)},c))}},addEvent:function(a,b,c,d,e){d=typeof d=="boolean"?d:!0;var f=function(a){c.call(this,a,e)};return a.addEventListener?a.addEventListener(b,f,d):a.attachEvent?a.attachEvent("on"+b,f):a["on"+b]=f,f},getInnerText:function(a){if(!a)return;var b=document.getElementsByTagName("body")[0];return b.textContent?a.textContent:a.innerText},setInnerTextById:function(a,b){return $WC.$CUtil.setInnerText(document.getElementById(a),b)},setInnerText:function(a,b){if(!a)return;var c=document.getElementsByTagName("body")[0];c.textContent?a.textContent=b:a.innerText=b},sortBy:function(a,b,c){var d=c?function(b){return c(b[a])}:function(b){return b[a]};return b=b?-1:1,function(a,c){return a=d(a),c=d(c),b*((a>c)-(c>a))}},isEmptyString:function(a){return a&&a.trim().length>0?!1:!0},isArray:function(a){return Object.prototype.toString.call(a)==="[object Array]"},convertToArray:function(a){return Array.prototype.slice.call(a,0)},removeElement:function(a){if(a)return a.parentNode.removeChild(a)},splitWmsFormattedString:function(a,b,c){var d=0;b-=1;for(var e=0;e<a.length;e++)if(a.charAt(e)==":"){d++;if(d==b){var f=e;break}}var g=a.substring(0,f),h=g.split(":"),i=a.substring(f+1);return c?h.push(JSON.parse(i)):h.push(i),h},addClass:function(a,b){if(a.classList)a.classList.add(b);else{var c=a.className.split(" ");c.indexOf(b)===-1&&(a.className+=" "+b)}},unescapeHTML:function(a){if(a)return a.replace(/&gt;/g,">").replace(/&lt;/g,"<").replace(/&quot;/g,'"').replace(/&#39;/g,"'").replace(/&amp;/g,"&").replace(/&#x2F;/g,"/").replace(/&#x27;/g,"'")},removeClass:function(a,b){if(a.classList)a.classList.remove(b);else{var c=new RegExp("(?:^|\\s)"+b+"(?!\\S)");a.className=a.className.replace(c,"")}},safeHTML:function(a){var b={"&":"&amp;",">":"&gt;","<":"&lt;",'"':"&quot;","'":"&#x27;"};return(""+a).replace(/[&><"']/g,function(a){return b[a]})},getContactName:function(a,b,c){var d=b;if(a==null||a==undefined)d=b;return $WC.$CUtil.isZuid(a)||(d=b),!b&&$WC.$CUtil.getConfig("zuid")==a&&(d=$WC.$CUtil.getConfig("Resource").getRealValue("chat.you")),WmsContacts.contactslist[a]!=undefined?d=WmsContacts.contactslist[a].DNAME||WmsContacts.contactslist[a].EMAILID:WmsOrgContacts.contactslist[a]&&(d=WmsOrgContacts.contactslist[a].DNAME),c?$WC.$CUtil.safeHTML(d):d},formatMentions:function(a){var b=function(b,c){a=$WC.Matcher.replace(b,a,function(a,b,d){var e=d.split(":")[1],f=d.split(":")[3],g=$WC.$CUtil.getConfig("zuid")==e?$WC.$CUtil.safeHTML(WebMessanger.unescapeHTML($WC.$CUtil.getConfig("dname"))):$WC.$CUtil.getContactName(e,f,!0);return c+g})};return b("atmention_for_transcript","@"),b("addmember_for_transcript","+"),b("deletemember_for_transcript","-"),a},getConditionalNextNode:function(a,b,c){function d(b,c){if(a[c]){if(a[c].getAttribute(b))return a[c];var d=a[c];while(d){if(d.getAttribute(b))return d;d=d[c]}}var e=a.parentNode.querySelectorAll("["+b+"]");if(e&&e.length>1){if(c==="nextSibling")return e[0];if(c==="previousSibling")return e[e.length-1]}return a}if(b===39||b===40)return d(c,"nextSibling");if(b===37||b===38)return d(c,"previousSibling")},removeEvent:function(a,b,c){a.detachEvent?a.detachEvent("on"+b,c):a.removeEventListener?a.removeEventListener(b,c,!0):a["on"+b]=null},loadImageWithDebounce:function(a){return $WC.$CUtil.debounce(function(){$WC.$CUtil.loadOriginalImage(a)},null,100)},loadOriginalImage:function(a,b,c){function e(){if(this.existingnode&&this.existingnode.parentNode)if(!b||this.existingnode.getAttribute("data-imgid")===this.getAttribute("data-zcprofileid")){b?this.existingnode.parentNode.insertBefore(this,this.existingnode.parentNode.firstChild):this.existingnode.parentNode.appendChild(this);var a=this;setTimeout(function(){a.style.opacity="1",a.existingnode.removeAttribute("data-originalsrc"),b&&$WC.$CUtil.removeElement(a.existingnode)},20)}$WC.$CUtil.logLazyLoadedImages(this.getAttribute("data-zcprofileid"))}var d=a.querySelectorAll("div[data-originalsrc]");for(var f in d)if(d.hasOwnProperty(f))if(c||$WC.$CUtil.isScrolledIntoView(d[f],a,!0)){var g=d[f],h=new Image;h.setAttribute("data-zcprofileid",g.getAttribute("data-imgid")),h.className="wms_userphoto_trans",h.existingnode=g,h.onload=e,h.src=g.getAttribute("data-originalsrc")}},loadedImages:{},logLazyLoadedImages:function(a){$WC.$CUtil.loadedImages[a]=!0},isImageLazyLoaded:function(a){return $WC.$CUtil.loadedImages[a]},bringElemToView:function(a,b,c){c?$WC.$CUtil.isViewableInScroll(a,!0)===!1&&(b===WmsConstants.KEYCODES.LEFT?a.parentNode.scrollLeft=a.offsetLeft:b===WmsConstants.KEYCODES.RIGHT&&(a.parentNode.scrollLeft=a.offsetLeft+a.offsetWidth-a.parentNode.offsetWidth)):$WC.$CUtil.isViewableInScroll(a)===!1&&(b===38||b===37||b===39?a.parentNode.scrollTop=a.offsetTop:b===40&&(a.parentNode.scrollTop=a.offsetTop+a.offsetHeight-a.parentNode.offsetHeight))},isViewableInScroll:function(a,b){if(b){var c=a.parentNode.scrollLeft,d=a.parentNode.scrollLeft+a.parentNode.offsetWidth,e=a.offsetLeft+a.offsetWidth;if(a.offsetLeft>=c&&e<d)return!0}else{var f=a.parentNode.scrollTop,g=a.parentNode.scrollTop+a.parentNode.offsetHeight,h=a.offsetTop+a.offsetHeight;if(a.offsetTop>=f&&h<g)return!0}return!1},isScrolledIntoView:function(a,b,c){var d=b.getBoundingClientRect().top,e=b.getBoundingClientRect().bottom,f=a.getBoundingClientRect().top,g=a.getBoundingClientRect().bottom;return d===0&&e===0||f===0&&g===0?!1:c?g>=d&&f<=e:f>=d&&g<=e},isZuid:function(a){return!isNaN(a)},preventHandlingTabUpDownEnter:function(a){(a.keyCode===WmsConstants.KEYCODES.DOWN||a.keyCode===WmsConstants.KEYCODES.UP||a.keyCode===WmsConstants.KEYCODES.ENTER||a.keyCode===WmsConstants.KEYCODES.TAB)&&a.preventDefault()},hasClass:function(a,b){return(new RegExp("(\\s|^)"+b+"(\\s|$)")).test(a.className)},hasFocus:function(a){if(a)return a===document.activeElement&&(!document.hasFocus||document.hasFocus())&&!!(a.type||a.href||~a.tabIndex);return},getAttribute:function(a,b){if(!a||typeof a.getAttribute!="function")return;return a.getAttribute(b)},setAttribute:function(a,b,c){if(!a||typeof a.getAttribute!="function")return;return a.setAttribute(b,c)},getDirectText:function(a){var b=a.firstChild,c=[];while(b)b.nodeType==3&&c.push(b.data),b=b.nextSibling;return c.join("")},getDirectTextFromHtmlString:function(a){var b=document.createElement("div");b.innerHTML=a;var c=b.firstChild,d=[];while(c)c.nodeType==3?d.push(c.data):d.push(c.textContent),c=c.nextSibling;return d.join("")},createOverlay:function(a){if(document.getElementById("wms-overlay")==null){var b=document.createElement("div");b.id="wms-overlay",b.className="wms-overlay",b.onclick=a,b.style.zIndex=$WC.$CUtil.getConfig("zindex");var c=document.getElementById("wmstoolbar");c?document.body.insertBefore(b,c.nextSibling):document.body.appendChild(b)}},removeOverlay:function(){var a=document.getElementById("wms-overlay");a&&a.parentNode.removeChild(a)},removeElementFromArray:function(a,b){var c=a.indexOf(b);c!==-1&&a.splice(c,1)},getAspectRatioFit:function(a,b,c,d,e){var f=[c/a,d/b];return f=Math.min(f[0],f[1]),!e&&f>1?{width:a,height:b}:{width:a*f,height:b*f,ratio:f}},getBrowserName:function(){var a=navigator.userAgent.toLowerCase();if($WC.Matcher.check("firefox_useragent_lowercase",a))return"firefox";if($WC.Matcher.check("opera_useragent_lowercase",a))return"opera";if($WC.Matcher.check("chrome_useragent_lowercase",a))return"chrome";if($WC.Matcher.check("safari_useragent_lowercase",a))return"safari";if($WC.Matcher.check("ie_useragent_lowercase",a))return"ie"},isChrome:function(){return this.getBrowserName()==="chrome"},isFirefox:function(){return this.getBrowserName()==="firefox"},isSafari:function(){return this.getBrowserName()==="safari"},isIEVersion11:function(){var a=navigator.userAgent.toLowerCase();if(a.indexOf("trident/")>0){var b=a.indexOf("rv:"),c=a.substring(b+3,a.indexOf(".",b));return c=="11"}},checkAndUpdateLocationPermissionStatus:function(){typeof navigator!="undefined"&&navigator.permissions!==undefined&&navigator.permissions.query({name:"geolocation"}).then(function(a){$WC.$CUtil.getConfig("LOCATION_INFO").PERMISSIONSTATE=a.state,a.onchange=function(){$WC.$CUtil.getConfig("LOCATION_INFO").PERMISSIONSTATE=a.state}})},chatTypes:{CHANNEL:1,DEFAULT_BOT:"B1",CUSTOM_BOT:"B2"},getChatType:function(a){var b=a.split("_",3);if(b.length==3){var c=b[2],d=c.split("-",2);if(d.length==2)return d[1]=="C4"?$WC.$CUtil.chatTypes.CHANNEL:d[1];if(d.length==1)return $WC.$CUtil.chatTypes.CHANNEL}},isChannelChid:function(a){return $WC.$CUtil.getChatType(a)===$WC.$CUtil.chatTypes.CHANNEL},isBotChid:function(a){var b=$WC.$CUtil.getChatType(a);return b===$WC.$CUtil.chatTypes.DEFAULT_BOT||b===$WC.$CUtil.chatTypes.CUSTOM_BOT},isCustomBot:function(a){var b=$WC.$CUtil.getChatType(a);return b===$WC.$CUtil.chatTypes.CUSTOM_BOT}},$WC.$CUtil.pubsub={},function(a){var b={},c=-1;a.subscribe=function(a,d){b[a]||(b[a]=[]);var e=(++c).toString();return b[a].push({token:e,func:d}),e},a.publish=function(){var a=arguments,c=a[0];return b[c]?(setTimeout(function(){var d=b[c],e=d?d.length:0;while(e--)d[e].func.apply(null,a)},0),!0):!1},a.unsubscribe=function(a){for(var c in b)if(b[c])for(var d=0,e=b[c].length;d<e;d++)if(b[c][d].token===a)return b[c].splice(d,1),a;return!1}}($WC.$CUtil.pubsub),Object.keys===undefined&&(Object.keys=function(a){var b=[];for(var c in a)b.push(c);return b}),String.prototype.startsWith||(String.prototype.startsWith=function(a,b){return b=b||0,this.indexOf(a,b)===b}),String.prototype.endsWith||(String.prototype.endsWith=function(a,b){if(b===undefined||b>this.length)b=this.length;return this.substring(b-a.length,b)===a}),Array.prototype.filter||(Array.prototype.filter=function(a){"use strict";if(this===void 0||this===null)throw new TypeError;var b=Object(this),c=b.length>>>0;if(typeof a!="function")throw new TypeError;var d=[],e=arguments.length>=2?arguments[1]:void 0;for(var f=0;f<c;f++)if(f in b){var g=b[f];a.call(e,g,f,b)&&d.push(g)}return d}),Array.prototype.map||(Array.prototype.map=function(a,b){var c,d,e;if(this===null||this===undefined)throw new TypeError(" this is null or not defined");var f=Object(this),g=f.length>>>0;if(typeof a!="function")throw new TypeError(a+" is not a function");arguments.length>1&&(c=b),d=new Array(g),e=0;while(e<g){var h,i;e in f&&(h=f[e],i=a.call(c,h,e,f),d[e]=i),e++}return d}),Array.prototype.forEach||(Array.prototype.forEach=function(a,b){var c,d;if(this===null||this===undefined)throw new TypeError(" this is null or not defined");var e=Object(this),f=e.length>>>0;if(typeof a!="function")throw new TypeError(a+" is not a function");arguments.length>1&&(c=b),d=0;while(d<f){var g;d in e&&(g=e[d],a.call(c,g,d,e)),d++}}),Array.prototype.find||Object.defineProperty(Array.prototype,"find",{value:function(a){if(this==null)throw new TypeError("'this' is null or not defined");var b=Object(this),c=b.length>>>0;if(typeof a!="function")throw new TypeError("predicate must be a function");var d=arguments[1],e=0;while(e<c){var f=b[e];if(a.call(d,f,e,b))return f;e++}return undefined}}),Element.prototype.matches||(Element.prototype.matches=Element.prototype.matchesSelector||Element.prototype.mozMatchesSelector||Element.prototype.msMatchesSelector||Element.prototype.oMatchesSelector||Element.prototype.webkitMatchesSelector||function(a){var b=(this.document||this.ownerDocument).querySelectorAll(a),c=b.length;while(--c>=0&&b.item(c)!==this)continue;return c>-1}),Element.prototype.closest||(Element.prototype.closest=function(a){var b=this;while(b.matches){if(b.matches(a))return b;b=b.parentNode}return null}),Array.prototype.some||(Array.prototype.some=function(a){if(this==null)throw new TypeError("Array.prototype.some called on null");if(typeof a!="function")throw new TypeError;var b=Object(this),c=b.length>>>0,d=arguments.length>=2?arguments[1]:void 0;for(var e=0;e<c;e++)if(e in b&&a.call(d,b[e],e,b))return!0;return!1}),window.WmsConstants={CHATCFPARAMNAME:"zchat_csrparam",WMSCFPARAMNAME:"wms_csrparam",CHATCFCOOKIENAME:"CT_CSRF_TOKEN",WMSCFCOOKIENAME:"WMS_CSRF_TOKEN",REQSTATUS:{LOADING:1,SUCCESS:2,FAILED:3,NORESULTS:4,INITIALSTATE:5},KEYCODES:{BACKSPACE:8,TAB:9,LEFT:37,UP:38,RIGHT:39,DOWN:40,ESCAPE:27,ENTER:13,SPACE:32},TRIGGERS:{ADDMEM:"+",DELMEM:"-",ATMENTION:"@",SMILEY:":",SLASH:"/"},CONTACTSTATUS:{UNAPRD:-1,REJECT:-2,REQACC:-3,DELETE:-4,REMOVE:-5,NOCHAT:-6,ACCEPT:10},USERPERMISSIONS:{ADD_MEMBER:6,REMOVE_MEMBER:7,SEND_MESSAGE:8,MENTION_USERS:9},USERROLES:{SUPER_ADMIN:0,ADMIN:1,CREATOR:2,MODERATOR:3,PARTICIPANT:4,ALLOWED_USER:5,NONE:-1},CHANNELS:{ORG:"1",TEAM:"2",PRIVATE:"3",SHARED:"4"}};var op=/opera|opera 5|opera\/5/i.test(navigator.userAgent),ie=!op&&/msie/i.test(navigator.userAgent),mz=!op&&!ie&&/mozilla\/5/i.test(navigator.userAgent),util=new Util;typeof String.prototype.trim!="function"&&(String.prototype.trim=function(){var a=this;return a=a.replace(/^\s*(.*)/,"$1"),a=a.replace(/(.*?)\s*$/,"$1"),a}),HtmlTag.cure=function(a){return a=HtmlTag.identifyLink(a),a},HtmlTag.identifyLink=function(a){try{var b="://",c=/([a-z0-9]([a-z0-9_\-.]*)@([a-z0-9_\-.]*)(\.[a-z]{2,3}(\.[a-z]{2}){0,2}))/gi,d=/((href|src)=["'])?(((https?:\/\/[^(www.)])|(https?:\/\/www.))([a-z0-9](([a-z0-9_\-.]*)(\.[a-z]{2,3}(.[a-z]{2}){0,2}([^( <)]*)))))/gi,e=/((href|src)=["'])?([^/])((www\.)([a-z0-9](([a-z0-9_\-.]*)(\.[a-z]{2,3}(\.[a-z]{2}){0,2}([^( <)|(https?://)]*)))))/gi;a=a.replace(c,"<a href='mailto:$1' target='_blank'>$1</a>"),a=a.replace(d,function(a,b){return b==""||b==undefined?"<a href='"+a+"' target='_blank'>"+a+"</a>":a}),a=a.replace(e,function(a,c,d,e,f){return c==""||c==undefined?e+"<a href='http"+b+f+"' target='_blank'>"+f+"</a>":a})}catch(f){}return a},ClientDecoder.getDecodedValue=function(a){var b=document.createElement("DIV");return b.innerHTML=a,b.innerHTML};var $WC=$WC||{};$WC.Matcher={regexes:{gmail:/^[A-Za-z0-9](\.?[A-Za-z0-9]){5,}@gmail\.com$/,facebook:/^[A-Za-z0-9\.]+$/,yahoo:/^[A-Za-z0-9]((\.|_)?[A-Za-z0-9]){5,}@(yahoo|ymail|rocketmail)\.com$/,msn:/^[A-Za-z0-9-_](\.?[A-Za-z0-9-_]){5,}@(outlook|hotmail|live)\.com$/,edge_useragent_lowercase:/edge\/(\d+)/,chrome_useragent_lowercase:/(?:chrome|crios)\/(\d+)/,firefox_useragent_lowercase:/(?:firefox|fxios)\/(\d+)/,opera_useragent_lowercase:/(?:^opera.+?version|opr)\/(\d+)/,ie_useragent_lowercase:/(?:msie |trident.+?; rv:)(\d+)/,safari_useragent_lowercase:/version\/(\d+).+?safari/,qq:/^[0-9]+$/,icq:/^[0-9]+$/,emailid:/^[A-Za-z0-9]([A-Za-z0-9-._%+]*)@[A-Za-z0-9-.]+\.[a-zA-Z]{2,30}$/,empty:/^\s*$/,hexcolourcode:/^([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$/,customdate:/^(0?[1-9]|1[012])\/(0?[1-9]|[12][0-9]|3[01])\/([0-9]{1,4})$/,time:/^(0?[1-9]|1[012])(:[0-5]\d)[APap][mM]$|^([01]?[0-9]|2[0-3]):[0-5]\d$/,escaperegexp:/[-[\]{}()*+?.,\\^$|#\s]/g,escapeReplacementString:/\$/g,removespaces:/ /g,removehtmltag:/<([a-z0-9]+)(?:.*?)(?:>(?:([\s\S]*?)<\/\1>)?)/g,containerid:/[^a-zA-Z0-9]/g,mail:/([a-z0-9]([a-z0-9_\-\.+]*)@([a-z0-9_\-\.]*)(\.[a-z]{2,3}(\.[a-z]{2}){0,2}))/,link:/(?:(href|src)=["']?)?((https?:\/\/(?:www\.)?|www\.)[a-z0-9][^@]*?)(?=[\s"'<]|$)/gi,markdown_image:/(^|\s)!\[(.+?)\]\(((?:https?:\/\/(?:www\.)?|www\.)[a-z0-9][^@ ]*?)\)(?=$|\s)/gi,markdown_link:/(^|\s)\[(.+?)\]\(((?:https?:\/\/(?:www\.)?|www\.)[a-z0-9][^@ ]*?)\)(?=$|\s|\.)/gi,markdown_quote:/(?:^|\n)!(.+?)(?:\n|$)/gm,markdown_heading:/(?:^|\n)(\#{1,6}) (.*?\S *)(?:\n|$)/gm,markdown_line:/(^|[\n])(\*{3,}|\-{3,})(?=$|[\n])(.*)/g,markdown_codeblock:/(^|\s)`{3}((?:(?:.*?$)\n)?(?:[\s\S]*?))`{3}(?=$|\s)/g,markdown_code:/(^|\s)\`(.*?\S *)?\`(?=$|\s)/g,markdown_bold:/(^|\s|[{\[])\*(.*?\S *)?\*(?=$|\s|[\.,\?:;\-}\]](?:$|\s))/g,markdown_italic:/(^|\s|[{\[])\_(.*?\S *)?\_(?=$|\s|[\.,\?:;\-}\]](?:$|\s))/g,markdown_strike:/(^|\s|[{\[])\~(.*?\S *)?\~(?=$|\s|[\.,\?:;\-}\]](?:$|\s))/g,atmention:/{mention:(.+?):([0-9]):(.+?):mention}/g,zcatmention:/{mention:(.*?):mention}/,atmention_for_transcript:/<div prop="mention"(.*?)>(.*?)<\/div><span prop="dname">(.*?)<\/span>/g,addmember:/{addchatmember:(.+?):([0-9]):(.+?):addchatmember}/g,addmember_for_transcript:/<div prop="addchatmember"(.*?)>(.*?)<\/div><span prop="dname">(.*?)<\/span>/g,deletemember:/{deletechatmember:(.+?):([0-9]):(.+?):deletechatmember}/g,deletemember_for_transcript:/<div prop="deletechatmember"(.*?)>(.*?)<\/div><span prop="dname">(.*?)<\/span>/g,text_doublequoted:/(^|\s|[{\[])\"(.*?\S *)?\"(?=$|\s|[\.,\?:;\-}\]](?:$|\s))/g,text_singlequoted:/(^|\s|[{\[])\'(.*?\S *)?\'(?=$|\s|[\.,\?:;\-}\]](?:$|\s))/g,addchatmember:/{addchatmember:(.*?):addchatmember}/g,deletechatmember:/{deletechatmember:(.*?):deletechatmember}/g,atmentiontemplate:/<div prop="(mention|addchatmember|deletechatmember)"(.*?)>(.*?)<\/div><span prop="dname">(.*?)<\/span>/,imagemimetype:/^image\/.+$/,audiomimetype:/^audio\/.+$/,videomimetype:/^video\/.+$/,ipaddress:/^[0-9]+\.[0-9]+\.[0-9]+\.[0-9]+$/,invalidfilenamechars:/[`~!\$%\^&\|\\\"<>\?\/]/g,chrome_useragent:/Chrome[\/\s]/g,domainurl:/((?:https?:\/\/)(?:www\.)?((?:[^\/]+)))(?:.*)/g,textpattern:/^[0-9a-zA-Z_\-#\&\,\.';\$@\?\,\:\+\%\^\*\(\)\`\|\\\=\/\!\[\]~\{\}\u0080-\u9fff\s]+$/,linkRegExp:/(((http(s){0,1}:\/\/))([^ <\n\"]*))/,invalidlink:/((href|src)=["']((http(s){0,1}:\/\/)|(www\.))([^ <\n]*))/,WWWlinkRegExp:/([^(href|src|\/\/)"'=])?((www\.)([^ <\n\"]*))/,zcWWWlinkRegExp:/((www\.)[a-z0-9][^@]*?)(?=&quot;|&#x27;|&lt;|[\s"')<]|$)/,threeletterendinglink:/(^|\ )(([\w\d-]+\.)+(com|org|net|int|edu|gov|mil|biz|info))(?=( |$))/,twoletterendinglink:/(^|\ )(([\w\d\-]+\.)+((?!js|cp|do)[a-z]){2})(?=( |$))/,escaperegexpinid:/([:\.\[\],\!\"\#\$@%\&\'\(\)\*\+\/\;\?\^\`\{\}\|\~])/g,commandpattern:/^([a-zA-Z])*$/,functionname:/^([a-zA-Z])*$/,removespecialchars:/(\s+)?[-~!@%&[\]{}<>()*+?.,_\/\\^$|:;'`"#\s](\s+)?/g,imagesize:/^(stamp|thumb|medium|original)$/,horizontal_rule_tag:/<hr>/,markdown_blockquote_html:/<blockquote>(.*?)<\/blockquote>/,markdown_codeblock_html:/<pre>(.*?)<\/pre>/,channelpermalink:/^\/channel\/((ext:)?[a-zA-Z])*$/},regexReplaceStr:{escapeReplacementString:"$$$",escaperegexp:"\\$&",escaperegexpinid:"\\$1",removespaces:"",trimBRtag:"",containerid:"",mail:"<a href='mailto:$1'>$1</a>"},check:function(a,b,c){return c&&b&&(b=b.trim()),this.regexes[a].lastIndex=0,this.regexes[a].test(b)},checkWithFlag:function(a,b,c,d){d&&b&&(b=b.trim()),this.regexes[a].lastIndex=0;var e=new RegExp(this.regexes[a].source,c);return e.test(b)},match:function(a,b,c){var c=typeof c!="undefined"?c:"g",d=new RegExp(this.regexes[a].source,c);return b.match(d)},replacer:function(a,b,c,d){return typeof d=="undefined"&&(d=this.regexReplaceStr[b]),c.replace(a,d)},replace:function(a,b,c){return this.replacer(this.regexes[a],a,b,c)},replaceWithFlag:function(a,b,c,d){var e=new RegExp(this.regexes[a].source,c);return this.replacer(e,a,b,d)},getRegexToGetAttrValueInHtmlTag:function(a,b){return new RegExp("(<("+a+")[^>]*?\\s"+b+"=(\"|'|\\\\\"|\\\\'))(\\S+)((\\3)([^>]*?(?:>(?:[^<]*?<\\/\\2>)?)))")},getRegexToAddAttrToHtmlTag:function(a){return new RegExp("(<("+a+"))([^>]*?(\\s\\S+=\\S+)?>(?:(?:[^<]*?)<\\/\\2>)?)")}};var $WC=$WC||{};$WC.Markdown={apply:function(a){return a=""+a,a=this.applyOnce(a),a=this.applyRecursive(a),a=this.decodeChars(a),a},applyOnce:function(a){return a=$WC.Matcher.replace("markdown_image",a,this.getImageHTML),a=$WC.Matcher.replace("markdown_link",a,this.getLinkHTML),a=$WC.Matcher.replace("markdown_quote",a,this.getQuoteHTML),a=$WC.Matcher.replace("markdown_heading",a,this.getHeadingHTML),a=$WC.Matcher.replace("markdown_codeblock",a,this.getCodeblockHTML),a=$WC.Matcher.replace("markdown_code",a,this.getCodeHTML),a},applyRecursive:function(a){return a=$WC.Matcher.replace("markdown_bold",a,this.getBoldHTML),a=$WC.Matcher.replace("markdown_italic",a,this.getItalicHTML),a=$WC.Matcher.replace("markdown_strike",a,this.getStrikeHTML),a=$WC.Matcher.replace("markdown_line",a,this.getLineHTML),a},getImageHTML:function(a,b,c,d,e){var f=e==="www."?"http://"+d:d;return b+'<img src="'+f+'" alt="'+$WC.Markdown.encodeChars(c)+'" />'},getLinkHTML:function(a,b,c,d,e){var f=e==="www."?"http://"+d:d;return b+'<a href="'+f+'" target="_blank">'+$WC.Markdown.encodeChars(c)+"</a>"},getQuoteHTML:function(a,b){return b=b.trim(),b.length===0?a:"<blockquote>"+$WC.Markdown.applyRecursive(b)+"</blockquote>"},getHeadingHTML:function(a,b,c){var d=b.length;return"<h"+d+">"+$WC.Markdown.encodeChars(c)+"</h"+d+">"},getLineHTML:function(a,b,c,d){return"<hr>"+$WC.Markdown.applyRecursive(d)},getCodeblockHTML:function(a,b,c){return c=c.trim(),c.length===0?a:b+"<pre>"+$WC.Markdown.encodeChars(c)+"</pre>"},getCodeHTML:function(a,b,c){return!c||!c.match(/[^_*`~]/)||c[0]==="`"||c[c.length-1]==="`"||c[0]===" "&&c[c.length-1]===" "?a:b+"<code>"+$WC.Markdown.encodeChars(c)+"</code>"},getBoldHTML:function(a,b,c){return!c||!c.match(/[^_*`~]/)||c[0]==="*"||c[c.length-1]==="*"||c[0]===" "&&c[c.length-1]===" "?a:b+"<strong>"+$WC.Markdown.applyRecursive(c)+"</strong>"},getItalicHTML:function(a,b,c){return!c||!c.match(/[^_*`~]/)||c[0]==="_"||c[c.length-1]==="_"||c[0]===" "&&c[c.length-1]===" "?a:b+"<i>"+$WC.Markdown.applyRecursive(c)+"</i>"},getStrikeHTML:function(a,b,c){return!c||!c.match(/[^_*`~]/)||c[0]==="~"||c[c.length-1]==="~"||c[0]===" "&&c[c.length-1]===" "?a:b+"<strike>"+$WC.Markdown.applyRecursive(c)+"</strike>"},encodeChars:function(a){return a.replace(/\*/g,"&ast;").replace(/\_/g,"&#95;").replace(/\~/g,"&#126;")},decodeChars:function(a){return a.replace(/&ast;/g,"*").replace(/&#95;/g,"_").replace(/&#126;/g,"~")}};var $WC=$WC||{};$WC.template={},$WC.template.setResource=function(a){this.resource=a},$WC.template.replace=function(a,b,c){function e(a){var b={"&":"&amp;",">":"&gt;","<":"&lt;",'"':"&quot;","'":"&#x27;"};return(""+a).replace(/[&><"']/g,function(a){return b[a]})}function f(a){return Object.prototype.toString.call(a)==="[object Array]"}function g(a){var b=a;if(f(b)){var c=b[1];return c=f(c)?c:[c],c=c.map(function(a){return e(a)}),b[1]=c,$WC.template.resource.getRealValue.apply($WC.template.resource,b)}return $WC.template.resource.getRealValue(b)}var d={};for(var h in b){var i=/^\$/.test(h);if(i){var j=g(b[h]);h=h.substring(1),d[h]=j}else d[h]=c==="InSecureHTML"?b[h]:e(b[h])}var k=Object.keys(d).join("|"),l=new RegExp("{{("+k+")}}","g");return a.replace(l,function(a){return a=a.substring(2).slice(0,-2),d[a]})};var $WC=$WC||{};$WC.Cookie={set:function(a,b,c,d){var e="";d=d||"",c&&(e=new Date,e.setTime(e.getTime()+c),e=e.toUTCString()),document.cookie=a+"="+b+";"+"expires="+e+";domain="+d+";path=/"},get:function(a){var b=document.cookie.indexOf(a);if(b===-1)return"";var c,d=document.cookie.length;return document.cookie.indexOf(";",b)!==-1&&(d=document.cookie.indexOf(";",b)),c=document.cookie.substring(b,d),c.split("=")[1]},remove:function(a,b){b=b||"",document.cookie=a+"=;"+"expires=Thu, 01 Jan 1970 00:00:01 GMT;domain="+b+";path=/"}};var $WC=$WC||{};$WC.NotificationOwner=function(a,b,c){function k(a){clearTimeout(d),d=setTimeout(k,4e3);if(c||a||m()||n()){var b=$WC.Cookie.get(h);if(b&&b.indexOf("_f")!==-1&&c!==!0)return;var e=i;c&&(e+="_f"),$WC.Cookie.set(h,e,1e4,j)}}function l(){var a=$WC.Cookie.get(h);return a===""?g:a===i||a===i+"_f"?e:f}function m(){return l()===e?!0:!1}function n(){return l()===g?!0:!1}function o(){clearTimeout(d),$WC.Cookie.remove(h,j)}var d,e=1,f=2,g=3,h="com_"+a+"_owner",i=""+(new Date).getTime(),j=b&&document.location.hostname.split(".").splice(1).join(".");return c=c||!1,k(),window.addEventListener("focus",k),{isOwner:m,clearOwnerSync:o}};var $WC=$WC||{};$WC.DesktopNotification={},$WC.DesktopNotification.Notifications={},$WC.DesktopNotification.close=function(a){$WC.DesktopNotification.Notifications[a]!==undefined&&($WC.DesktopNotification.Notifications[a].notifyobj.close(),clearTimeout($WC.DesktopNotification.Notifications[a].timer),delete $WC.DesktopNotification.Notifications[a])},$WC.DesktopNotification.requestPermission=function(){typeof Notification!="undefined"&&Notification.permission==="default"&&Notification.requestPermission()},$WC.DesktopNotification.show=function(){return function(a){if(typeof Notification!="undefined"&&Notification.permission==="granted"){if(a.checkownership&&a.checkownership.isOwner()===!1)return;a.tag=a.id,$WC.DesktopNotification.close(a.id),$WC.DesktopNotification.Notifications[a.id]===undefined&&($WC.DesktopNotification.Notifications[a.id]={});var b=new Notification(a.title,a);return $WC.DesktopNotification.Notifications[a.id].notifyobj=b,a.duration&&($WC.DesktopNotification.Notifications[a.id].timer=setTimeout(function(){$WC.DesktopNotification.close(a.id)},a.duration)),b.onclick=function(c){window.focus(),typeof a.onclick=="function"&&a.onclick.call(b,c),$WC.DesktopNotification.close(a.id)},b}}}();var $WC=$WC||{};$WC.Ajax={},$WC.Ajax._makeRequest=function(a){var b=a.type?a.type:"GET",c=typeof a.async=="boolean"?a.async:!0,d=a.callback,e=a.url,f;window.XMLHttpRequest?f=new XMLHttpRequest:window.ActiveXObject&&(f=new ActiveXObject("Microsoft.XMLHTTP")),f.opts=a.opts,f.onreadystatechange=d,f.open(b,e,c),f.setRequestHeader("Accept","*/*"),a.reqheaders&&a.reqheaders["Content-Type"]?f.setRequestHeader("Content-Type","application/json"):f.setRequestHeader("Content-Type","application/x-www-form-urlencoded;charset=UTF-8");if(a.reqheaders)for(var g in a.reqheaders)f.setRequestHeader(g,a.reqheaders[g]);f.send(a.params)},$WC.Ajax._getRequest=function(a,b,c,d,e,f,g,h){a&&(b="/"+a+"/"+b),c?b+="?"+c+$WC.$CUtil.nocachefix(!0):b+="?nocache="+(new Date).getTime();var i={onsuccess:d,onfailure:e,callbackargs:f},j={callback:$WC.Ajax.callbackDispatcher,opts:i,url:b,async:g,reqheaders:h};$WC.Ajax._makeRequest(j)},$WC.Ajax._postRequest=function(a,b,c,d,e,f,g,h){a&&(b="/"+a+"/"+b);if(h&&h["Content-Type"]==="application/json")c=JSON.stringify(c);else{var i=$WC.$CUtil.getCSRF();c=c?c+"&"+i:i,c+=$WC.$CUtil.nocachefix(!0)}var j={onsuccess:d,onfailure:e,callbackargs:f},k={type:"POST",callback:$WC.Ajax.callbackDispatcher,url:b,params:c,opts:j,async:g,reqheaders:h};$WC.Ajax._makeRequest(k)},$WC.Ajax._putRequest=function(a,b,c,d,e,f,g,h){a&&(b="/"+a+"/"+b);if(h&&h["Content-Type"]==="application/json")c=JSON.stringify(c);else{var i=$WC.$CUtil.getCSRF();c=c?c+"&"+i:i,c+=$WC.$CUtil.nocachefix(!0)}var j={onsuccess:d,onfailure:e,callbackargs:f},k={type:"PUT",callback:$WC.Ajax.callbackDispatcher,url:b,params:c,opts:j,async:g,reqheaders:h};$WC.Ajax._makeRequest(k)},$WC.Ajax.request=function(a,b,c,d,e,f,g){$WC.Ajax._getRequest($WC.$CUtil.getConfig("WMSCONT"),a,b,c,d,e,f,g)},$WC.Ajax.postRequest=function(a,b,c,d,e,f,g){$WC.Ajax._postRequest($WC.$CUtil.getConfig("WMSCONT"),a,b,c,d,e,f,g)},$WC.Ajax.putRequest=function(a,b,c,d,e,f,g){$WC.Ajax._putRequest($WC.$CUtil.getConfig("WMSCONT"),a,b,c,d,e,f,g)},$WC.Ajax.requestToChat=function(a,b,c,d,e,f,g){$WC.Ajax._getRequest($WC.$CUtil.getConfig("CHATCONT"),a,b,c,d,e,f,g)},$WC.Ajax.postRequestToChat=function(a,b,c,d,e,f,g){$WC.Ajax._postRequest($WC.$CUtil.getConfig("CHATCONT"),a,b,c,d,e,f,g)},$WC.Ajax.putRequestToChat=function(a,b,c,d,e,f,g){$WC.Ajax._putRequest($WC.$CUtil.getConfig("CHATCONT"),a,b,c,d,e,f,g)},$WC.Ajax.postRequestToChatWithLocation=function(a,b,c,d,e,f,g){var h=$WC.$CUtil.getConfig("LOCATION_INFO").PERMISSIONSTATE;if(h==="granted"){var i=function(){var h=$WC.$CUtil.cloneObject($WC.$CUtil.getConfig("LOCATION_INFO").CACHED.coords);h.status="granted",g=g||{},g["X-Geo-Location"]=JSON.stringify(h),$WC.Ajax.postRequestToChat(a,b,c,d,e,f,g)};if($WC.$CUtil.getConfig("LOCATION_INFO").CACHED!==undefined)i();else{$WC.$CUtil.getConfig("LOCATION_INFO").WATCH_ID!==undefined&&navigator.geolocation.clearWatch($WC.$CUtil.getConfig("LOCATION_INFO").WATCH_ID);var j=function(a){var b=$WC.$CUtil.getConfig("LOCATION_INFO").CACHED===undefined;$WC.$CUtil.getConfig("LOCATION_INFO").CACHED=a,$WC.$CUtil.getConfig("LOCATION_INFO").PERMISSIONSTATE="granted",b&&i()},k=function(h){var i;h.code===1?(i="denied",$WC.$CUtil.getConfig("LOCATION_INFO").PERMISSIONSTATE=i):i="failure";var j=$WC.$CUtil.getConfig("LOCATION_INFO").CACHED===undefined;j&&(g=g||{},g["X-Geo-Location"]=JSON.stringify({status:i}),$WC.Ajax.postRequestToChat(a,b,c,d,e,f,g)),delete $WC.$CUtil.getConfig("LOCATION_INFO").CACHED};$WC.$CUtil.getConfig("LOCATION_INFO").WATCH_ID=navigator.geolocation.watchPosition(j,k)}}else g=g||{},g["X-Geo-Location"]=JSON.stringify({status:h}),$WC.Ajax.postRequestToChat(a,b,c,d,e,f,g)},$WC.Ajax.callbackDispatcher=function(){if(this.readyState===4)if(this.status===200||this.status===204){var a=this.responseText;if(a!==""){var b;try{b=JSON.parse(a)}catch(c){try{a=a.slice(0,-1),a="[["+a+"]]",b=JSON.parse(a)}catch(d){typeof this.opts.onsuccess=="function"&&this.opts.onsuccess.call(this)}}if(b===null||b===undefined)return;var e=b.length,f=0;if(e)for(f=0;f<e;f++){var g=b[f],h=g.objString;g.objType&&g.objType==="do"&&(h=$WC.Ajax.getObject(g.objType,g.objString));if(typeof this.opts.onsuccess=="function")this.opts.onsuccess.call(this,h);else if($WC.$CUtil.getConfig("AjaxDispatcher")){var i=$WC.$CUtil.getConfig("AjaxDispatcher");i(g.module,g.objType,h)}}else typeof this.opts.onsuccess=="function"&&this.opts.onsuccess.call(this,a)}else typeof this.opts.onsuccess=="function"&&this.opts.onsuccess.call(this)}else typeof this.opts.onfailure=="function"&&this.opts.onfailure.call(this)},$WC.Ajax.getObject=function(a,b){if(a==="do"){var c=new $WC.DataObject.construct;for(var d=0;d<b.length;d++){var e=b[d],f=e.tname,g=e.cols,h=e.rows;for(var i=0;i<h.length;i++){var j=h[i],k=[];for(var l=0;l<j.length;l++)k[l]=[g[l],j[l]];c.addRowsForTable(f,k)}}return c}return b};var $WC=$WC||{};$WC.DataObject={},$WC.DataObject.construct=function(){this.tableToRowList={},this.tableArray=new Array(0),this.getRowsForTable=$WC.DataObject.getRowsForTable,this.containsTable=$WC.DataObject.containsTable,this.addNewTable=$WC.DataObject.addNewTable,this.addRowsForTable=$WC.DataObject.addRowsForTable},$WC.DataObject.containsTable=function(a){var b=this.tableArray.length;for(var c=0;c<b;c++)if(this.tableArray[c]==a)return!0;return!1},$WC.DataObject.getRowsForTable=function(a){return this.tableToRowList[a]},$WC.DataObject.addNewTable=function(a){this.tableArray.push(a),this.tableToRowList[a]=new Array(0);return},$WC.DataObject.addRowsForTable=function(a,b){this.containsTable(a)||this.addNewTable(a);var c=this.tableToRowList[a];return c[c.length]=$WC.DataObject.createRow(b),!0},$WC.DataObject.createRow=function(a){var b={};for(var c=0;c<a.length;c++)b[a[c][0]]=a[c][1];return b};var $WC=$WC||{};$WC.Functions={},$WC.Functions.init=function(){Gator(document).on("click","[custombuttonclick_onmsg],[zc-quickbutton]",function(a){$WC.CMsgUtil.handleButtons(this,a,function(b,c,d,e){var f=$WC.Functions.isTempResponse(a.target);$WC.Functions.execute(b,c,d,e,f,a.type)})})},$WC.Functions.execute=function(a,b,c,d,e,f){var g="chid="+b+"&msgid="+c+"&fname="+a+"&btnindex="+d+"&isTempResponse="+e+"&event="+f,h=document.getElementById("buttonconfirminput");h&&(g+="&input="+h.value);var i={"X-XHR-exception":"true","X-ZCSRF-TOKEN":$WC.$CUtil.getCSRF()},j=function(){var c=JSON.parse(this.response)[0].objString;if(c.status==="Success"){var d=c.output;if(d)if(d.widget){var e=JSON.parse(d.widget);$WC.Widgets.construct(e)}else d.msg&&typeof $WC.Functions.showResponse=="function"&&$WC.Functions.showResponse(c.output,b)}else if(c.status==="Failure"&&typeof $WC.Functions.showErrorResponse=="function")if(!$WC.$CUtil.isEmpty(c.resumeUrl)){if(document.getElementById("zcwindows")===null){var f=document.createElement("div");f.id="zcwindows",f.className="zcoverlay",f.style.zIndex=WebMessanger.setzindex,document.body.appendChild(f)}var g="<b>"+c.connectionDetails.serviceName+"</b>",h="<b>"+a+"</b>";$WC.$Dlg.confirm({id:"wms_oauthprompt",bodyhtml:WmsResource.getRealValue("common.access.permission",[h,g]),imagehtml:"<img src="+c.connectionDetails.imageUrl+">",buttons:[{text:WmsResource.getRealValue("common.authenticate"),action:function(){window.open(c.resumeUrl)}}]})}else $WC.Functions.showErrorResponse({msg:$WC.Resource.getRealValue("functions.exec.error")},b)};$WC.Ajax.postRequestToChat("executefunction.do",g,j,null,null,null,i)};var WmsImplHandler={};WmsImplHandler.invoke=function(){var a=arguments;setTimeout(function(){var b=Array.prototype.slice.call(a,1);typeof a[0]=="function"&&a[0].apply(null,b)},1)},WmsImplHandler.invokeSynchronously=function(){var a=arguments[0],b=Array.prototype.slice.call(arguments,1);if(typeof a=="function")try{return a.apply(null,b)}catch(c){setTimeout(function(){throw c},1)}};var WmsAVChat={};WmsAVChat={CALLSTATUSCODE:{STARTED:0,CALLING:1,WAITING:2,CONNECTING:3,CONNECTED:4,ENDED:5},DISCONNECT_MSG:{ERROR:"0",CANCELLED:"4",COMPLETED:"3",REJECTED:"5",NORESPONSE:"6",BUSY_ON_OTHER_CALL:"15"},CALL_TYPE_VOICE:"voice",CALL_TYPE_VIDEO:"video",CALL_MODE_INCOMING:"incoming",CALL_MODE_OUTGOING:"outgoing",CALLCONNECTION_TIMEOUT:2e4,PERMISSION_DIALOGUE_DELAY:1200,isRunning:!1,isFullScreen:!1,isConnectNotifyReceived:!1,isMinimized:!1,isVideoSwitched:!1,callType:null,logData:[],api:{},localStream:null,remoteStream:null,lastCallAPI:null,zuid:"",chid:"",devicePreference:{},dom:{localVideo:null,remoteVideo:null,localuserimg:null,remoteuserimg:null,videocontainer:null},init:function(){if(!$WC.$CUtil.isFirefox()){var a=WmsLocalStorage.getItem("mediadevicepref");$WC.$CUtil.isEmpty(a)||(this.devicePreference=a)}this.AnswerCall.init(),this.bindEvents()},bindEvents:function(){var a="onfullscreenchange"in document?"fullscreenchange":"onwebkitfullscreenchange"in document?"webkitfullscreenchange":"mozfullscreenchange";document.addEventListener(a,function(){WmsAVChat.isRunning&&WmsAVChat.toggleFullscreen(!0)})},close:function(a){this.isRunning=!1;try{a||this.api.stopChat(),this.AnswerCall.isVisible||VideoCallReceiver.stop()}catch(b){this.log(b.message)}this.sid=null,this.lastCallAPI=this.api,this.api=null,this.remoteStream=null,this.localStream=null,this.isReconnecting=!1,this.isVideoSwitched=!1,this.isRemoteCamOff=!1,this.isConnectNotifyReceived=!1,this.setCallStatus(this.CALLSTATUSCODE.ENDED),this.handleChatwindowOpen=null,this.isFullScreen&&this.handleAction("togglefullscreen"),$WC.$CUtil.setAttribute(this.dom.videocontainer.querySelector("[video-action='togglemic']"),"data-micoff","false"),$WC.$CUtil.setAttribute(this.dom.videocontainer.querySelector("[video-action='togglemic']"),"title",$WC.$CUtil.getConfig("Resource").getRealValue("mediacall.mic.off")),$WC.$CUtil.setAttribute(this.dom.videocontainer.querySelector("[video-action='togglecam']"),"data-videooff","false"),$WC.$CUtil.setAttribute(this.dom.videocontainer.querySelector("[video-action='togglecam']"),"title",$WC.$CUtil.getConfig("Resource").getRealValue("mediacall.cam.off")),this.isMinimized&&this.toggleMinimize(),$WC.$CUtil.setAttribute(this.dom.localVideo,"src",""),$WC.$CUtil.setAttribute(this.dom.remoteVideo,"src",""),$WC.$CUtil.setAttribute(this.dom.localuserimg.firstChild,"src",""),$WC.$CUtil.setAttribute(this.dom.remoteuserimg.firstChild,"src",""),this.dom.videocontainer.getElementsByClassName("wms_remotevideo_container")[0].className="wms_remotevideo_container",$WC.$CUtil.setInnerText(this.dom.timercontainer,""),this.dom.videocontainer.getElementsByClassName("wms_mediaoff_notify")[0].className="wms_mediaoff_notify",this.dom.videocontainer.getElementsByClassName("wms_videocall_buttons_list")[0].className="wms_videocall_buttons_list";var c=WindowHandler.getWinObjById(this.chid);c&&(c.iscallongoing=!1,c.win.className="wms_chatwindow wms_bubbletheme",this.dom.videocontainer.style.display="none")},establishConnectedCall:function(){WmsAVChat.callType==WmsAVChat.CALL_TYPE_VIDEO&&(WmsAVChat.dom.remoteuserimg.style.display="none",WmsAVChat.dom.remoteVideo.style.display="block",$WC.$CUtil.addClass(WmsAVChat.dom.videocontainer.getElementsByClassName("wms_videocall_buttons_list")[0],"wms-halign")),WmsAVChat.forcePlay(),$WC.$CUtil.setInnerText(WmsAVChat.dom.videocontainer.getElementsByClassName("wms_callstatus_text")[0],""),$WC.$CUtil.setAttribute(WmsAVChat.dom.videocontainer,"data-connecting","")},forcePlay:function(){this.dom.localVideo.src!=""&&this.dom.localVideo.play(),this.dom.remoteVideo.src!=""&&this.dom.remoteVideo.play()},showCallFailedBanner:function(){var a=WindowHandler.getWinObjById(this.chid);a&&a.showErrorMsg($WC.$CUtil.getConfig("Resource").getRealValue("mediacall.failed")),this.log("call_failed")},switchVideo:function(){var a=[];a.push([this.dom.localVideo,this.dom.remoteVideo]),a.push([this.dom.localuserimg,this.dom.remoteuserimg]);for(var b in a){var c=a[b][0],d=a[b][1],e=c.id,f=c.className;c.id=d.id,c.className=d.className,d.id=e,d.className=f;var g=c.parentNode;d.parentNode.prepend(c),g.prepend(d)}this.forcePlay(),this.isVideoSwitched=!this.isVideoSwitched},toggleFullscreen:function(a){var b=this.dom.videocontainer;if(a){this.isFullScreen?($WC.$CUtil.removeClass(b,"wms_mediacall_fullscreen"),this.isFullScreen=!1):($WC.$CUtil.addClass(b,"wms_mediacall_fullscreen"),this.isFullScreen=!0);return}this.isFullScreen?document.webkitExitFullscreen?document.webkitExitFullscreen():document.mozCancelFullScreen&&document.mozCancelFullScreen():b.mozRequestFullScreen?b.mozRequestFullScreen():b.webkitRequestFullscreen&&b.webkitRequestFullscreen()},toggleMinimize:function(){var a=WindowHandler.getWinObjById(this.chid),b=a.win.getElementsByClassName("wms_cw_header_photo")[0];if(this.isMinimized)b.style.display="",$WC.$CUtil.removeElement(a.win.getElementsByClassName("wms_cw_header_video")[0]),$WC.$CUtil.removeClass(a.win,"wms_videocall_minimized"),this.dom.videocontainer.style.display="block",this.isMinimized=!1,this.log("Maximized");else{var c=this.dom.remoteVideo.src;this.isRemoteCamOff&&(c=this.dom.localVideo.src);var d='<video src="'+c+'" class="wms_cw_header_video" onclick="WmsAVChat.toggleMinimize()" title="'+$WC.$CUtil.getConfig("Resource").getRealValue("maximize")+'"></video>';b.insertAdjacentHTML("beforeBegin",d),b.style.display="none";var e=a.win.getElementsByClassName("wms_cw_header_video")[0];e.play(),this.dom.videocontainer.style.display="none",$WC.$CUtil.addClass(a.win,"wms_videocall_minimized"),this.isMinimized=!0,this.log("Minimized")}},notifyChatwinOpen:function(a){typeof this.handleChatwindowOpen=="function"&&this.handleChatwindowOpen(a)},handleAction:function(a){if(a=="togglefullscreen"){this.toggleFullscreen();var b=this.dom.videocontainer.querySelector("[video-action='togglefullscreen']");this.isFullScreen?$WC.$CUtil.setAttribute(b,"title",$WC.$CUtil.getConfig("Resource").getRealValue("mediacall.fullscreen")):$WC.$CUtil.setAttribute(b,"title",$WC.$CUtil.getConfig("Resource").getRealValue("mediacall.exit.fullscreen"))}else if(a=="endcall")this.close();else if(a=="togglemic"){var c=this.dom.videocontainer.querySelector("[video-action='togglemic']");this.api.isMicOff()?(this.api.micOn(),$WC.$CUtil.setAttribute(c,"title",$WC.$CUtil.getConfig("Resource").getRealValue("mediacall.mic.off")),$WC.$CUtil.setAttribute(c,"data-micoff","false")):(this.api.micOff(),$WC.$CUtil.setAttribute(c,"title",$WC.$CUtil.getConfig("Resource").getRealValue("mediacall.mic.on")),$WC.$CUtil.setAttribute(c,"data-micoff","true"))}else if(a=="togglecam"){var d=this.dom.videocontainer.querySelector("[video-action='togglecam']");this.api.isCameraOff()?this.api.cameraOn()&&(this.dom.localVideo.style.display="block",this.dom.localuserimg.style.display="none",$WC.$CUtil.setAttribute(d,"data-videooff","false"),$WC.$CUtil.setAttribute(d,"title",$WC.$CUtil.getConfig("Resource").getRealValue("mediacall.cam.off"))):this.api.cameraOff()&&(this.dom.localVideo.style.display="none",this.dom.localuserimg.style.display="block",$WC.$CUtil.setAttribute(d,"data-videooff","true"),$WC.$CUtil.setAttribute(d,"title",$WC.$CUtil.getConfig("Resource").getRealValue("mediacall.cam.on")))}else a=="switchvideo"?(this.switchVideo(),this.isVideoSwitched?$WC.$CUtil.addClass(this.dom.videocontainer.getElementsByClassName("wms_mediacall_container")[0],"wms_video_switched"):$WC.$CUtil.removeClass(this.dom.videocontainer.getElementsByClassName("wms_mediacall_container")[0],"wms_video_switched")):a=="minimize"?this.toggleMinimize():a=="devicesettings"&&this.showDevicePreference()},setWMSConnectionStatus:function(a){this.isRunning&&this.api&&this.api.setWmsServerUpStatus(a)},log:function(a){this.logData.push((new Date).getTime()+" : "+a),this.logData.length>100&&this.logData.shift()},showMediaPermissionWin:function(){var a=$WC.$CUtil.isChrome()?"chrome":$WC.$CUtil.isFirefox()?"firefox":$WC.$CUtil.isSafari()?"safari":"opera",b=WmsAVChat.callType==WmsAVChat.CALL_TYPE_VIDEO?"cam":"mic",c="permission-"+a+"-"+b+"-2",d=WmsAVChat.callType==WmsAVChat.CALL_TYPE_VIDEO?"videocall":"audiocall",e=$WC.$CUtil.getConfig("Resource").getRealValue(d+".permission.device"),f=$WC.$CUtil.getConfig("Resource").getRealValue(d+".permission.guideline"),g=$WC.$CUtil.getConfig("Resource").getRealValue(d+".permission.info"),h="https://img.zohostatic.com/ichat/v282_https/images/bar/"+c+".png",i='<div class="wms_mediacall_permission_headertext">{{header_text}}</div><img src="{{image_source}}" class="wms_mediacall_permission_img"><div class="wms_mediacall_permission_text">{{permission_guideline}}</br>{{permission_infomsg}}</div>',j=$WC.template.replace(i,{header_text:e,permission_guideline:f,permission_infomsg:g,image_source:h}),k={bodyhtml:j,focusbutton:1,width:690,operations:[{name:$WC.$CUtil.getConfig("Resource").getRealValue("mediacall.permission.okay"),action:function(){WmsDialog.removeModal()}}]};WmsDialog.showModal(k)},startCall:function(a,b,c,d,e){d?WmsAVChat.startMediaChat(d,b,c):(WmsAVChat.handleChatwindowOpen=function(a){(WmsAVChat.AnswerCall.chid&&a.objId==WmsAVChat.AnswerCall.chid||!WmsAVChat.AnswerCall.chid&&a.recipant==WmsAVChat.AnswerCall.zuid)&&WmsAVChat.startMediaChat(a,b,c)},clearTimeout(WmsAVChat.acceptCallTimer),WmsAVChat.acceptCallTimer=setTimeout(function(){WmsAVChat.handleChatwindowOpen=null},WmsAVChat.CALLCONNECTION_TIMEOUT),e=e||"mainui",WebMessanger.openUserChat(a,"","","",e))},startMediaChat:function(a,b,c){if(!this.isRunning){this.isRunning=!0,this.zuid=a.recipant,this.chid=a.objId,this.callType=b,this.dom.localVideo=a.win.getElementsByClassName("wms_localstream")[0],this.dom.remoteVideo=a.win.getElementsByClassName("wms_remotestream")[0],this.dom.localuserimg=a.win.getElementsByClassName("wms_localuserimg")[0],this.dom.remoteuserimg=a.win.getElementsByClassName("wms_remoteuserimg")[0],this.dom.videocontainer=a.win.getElementsByClassName("wms_mediacall_space")[0],this.dom.timercontainer=a.win.getElementsByClassName("wms_mediacall_timer")[0],this.setCallStatus(this.CALLSTATUSCODE.STARTED),$WC.$CUtil.setAttribute(this.dom.localuserimg.firstChild,"src",WmsContacts.getUserPhoto($WC.$CUtil.getConfig("zuid"))),this.dom.localuserimg.style.display="block",$WC.$CUtil.setAttribute(this.dom.remoteuserimg.firstChild,"src",WmsContacts.getUserPhoto(this.zuid)),this.dom.remoteuserimg.style.display="block";var d={zuid:this.zuid,chid:this.chid};a.iscallongoing=!0,a.isMinimized()&&a.maximize(),$WC.$CUtil.setAttribute(this.dom.videocontainer,"data-connecting","true"),c==WmsAVChat.CALL_MODE_OUTGOING?(d.callingZUID=WebMessanger.getZuid(),d.calledZUID=this.zuid,a.win.getElementsByClassName("wms_mediacall_space")[0].style.display="block",$WC.$CUtil.setInnerText(this.dom.videocontainer.getElementsByClassName("wms_callstatus_text")[0],$WC.$CUtil.getConfig("Resource").getRealValue("mediacall.calling")),VideoCallReceiver.startChat(this.zuid,b,d,this.VideoChatHandler)):(this.setCallStatus(this.CALLSTATUSCODE.CONNECTING),$WC.$CUtil.setInnerText(this.dom.videocontainer.getElementsByClassName("wms_callstatus_text")[0],$WC.$CUtil.getConfig("Resource").getRealValue("mediacall.connecting")),a.win.getElementsByClassName("wms_mediacall_space")[0].style.display="block",VideoCallReceiver.answerChat(this.zuid,this.sid,b,this.VideoChatHandler),VideoCallReceiver.stop()),b=="video"?$WC.$CUtil.addClass(a.win,"wms_mediacall_video"):($WC.$CUtil.addClass(this.dom.videocontainer.getElementsByClassName("wms_remotevideo_container")[0],"wms-valign-mid-block"),$WC.$CUtil.addClass(a.win,"wms_mediacall_audio"))}},setCallStatus:function(a){this.callStatus=a},setPreferredDevice:function(a){var b=[],c=function(){if(a.speaker&&a.speaker.deviceId){var c=WmsAVChat.dom.remoteVideo;typeof c.setSinkId=="function"&&(c.setSinkId(a.speaker.deviceId),WmsAVChat.api?WmsAVChat.api.setSpeakerDevice(a.speaker):WmsAVChat.lastCallAPI&&WmsAVChat.lastCallAPI.setSpeakerDevice(a.speaker))}if(WmsAVChat.isRunning&&b.length){var d=WindowHandler.getWinObjById(WmsAVChat.chid),e=WmsAVChat.callType;WmsAVChat.close(),WmsAVChat.startMediaChat(d,e,WmsAVChat.CALL_MODE_OUTGOING)}WmsAVChat.devicePreference=a,WmsLocalStorage.setItem("mediadevicepref",a),WmsDialog.removeModal()};if(this.isRunning)if(!this.devicePreference.hasOwnProperty("mic")||this.devicePreference.mic.deviceId!=a.mic.deviceId){var d='<div class="wms_devicepref_confirm_body"><div class="wms_devicepref_confirm_subheading">'+$WC.$CUtil.getConfig("Resource").getRealValue("mediacall.devicesetting.info")+"</div>"+'<div class="wms_devicepref_confirm_info">'+$WC.$CUtil.getConfig("Resource").getRealValue("mediacall.devicesetting.info1")+"</div>"+'<div class="wms_devicepref_confirm_info">'+$WC.$CUtil.getConfig("Resource").getRealValue("mediacall.devicesetting.info2")+"</div>"+"</div>",e='<div class="wms_devicepref_confirm_header">'+$WC.$CUtil.getConfig("Resource").getRealValue("mediacall.device.settings")+"</div>"+d,f={bodyhtml:e,focusbutton:1,width:650,operations:[{name:$WC.$CUtil.getConfig("Resource").getRealValue("mediacall.close.proceed"),classname:"wms_devicepref_button",action:function(){b.push(a.mic),c()}}]};WmsDialog.showModal(f)}else c();else b.push(a.mic),c()},showDevicePreference:function(){var a={camera:[],mic:[],speaker:[]},b={};navigator.mediaDevices.enumerateDevices().then(function(c){c.forEach(function(c){b[c.kind+"&"+c.deviceId]=c,c.kind=="videoinput"?a.camera.push(c):c.kind=="audioinput"?a.mic.push(c):c.kind=="audiooutput"&&a.speaker.push(c)});var d='<div class="wms_devicepref_header">'+$WC.$CUtil.getConfig("Resource").getRealValue("mediacall.preference.header")+"</div>",e='<div class="wms_devicepref_leftpane"><div class="wms_devicepref_options wms_devicepref_options_input" data-settings="mic">'+$WC.$CUtil.getConfig("Resource").getRealValue("mediacall.preference.input")+"</div>"+'<div class="wms_devicepref_options wms_devicepref_options_output" data-settings="speaker">'+$WC.$CUtil.getConfig("Resource").getRealValue("mediacall.preference.output")+"</div>"+"</div>",f='<div class="wms_devicepref_rightpane"><div id="wms_devicepref_mic" class="wms_devicepref_rightpane_options"><div>'+$WC.$CUtil.getConfig("Resource").getRealValue("mediacall.preference.mic")+'</div><select id="wms_devicelist_mic" class="wms_devicepref_dropdown" style="font-size: 12px;"></select></div>'+'<div id="wms_devicepref_speaker" class="wms_devicepref_rightpane_options"><div>'+$WC.$CUtil.getConfig("Resource").getRealValue("mediacall.preference.speaker")+'</div><select id="wms_devicelist_speaker" class="wms_devicepref_dropdown" style="font-size: 12px;"></select></div>'+"</div>",g='<div id="wms_devicepref_body" class="wms_devicepref_body" data-shown="mic">'+e+f+"</div>",h=d+g,i={bodyhtml:h,focusbutton:1,width:600,operations:[{name:$WC.$CUtil.getConfig("Resource").getRealValue("mediacall.permission.save"),classname:"wms_devicepref_button",action:function(){var a=document.getElementById("wms_devicelist_mic").value,c=document.getElementById("wms_devicelist_speaker").value;WmsAVChat.setPreferredDevice({mic:b["audioinput&"+a],speaker:b["audiooutput&"+c]})}}]};WmsDialog.showModal(i);var j=document.getElementById("wms_devicepref_body"),k='<option value="{{DID}}" {{SEL}}>{{NAME}}</option>',l=function(a,b){var c="";for(var d=0;d<a.length;d++)c+=$WC.template.replace(k,{NAME:a[d].label,DID:a[d].deviceId,SEL:a[d].deviceId==b?'selected="selected"':""});return c};if(a.mic.length){var m="default";WmsAVChat.devicePreference.mic&&(m=WmsAVChat.devicePreference.mic.deviceId),document.getElementById("wms_devicelist_mic").innerHTML=l(a.mic,m)}a.speaker.length&&(m="default",WmsAVChat.devicePreference.speaker&&(m=WmsAVChat.devicePreference.speaker.deviceId),document.getElementById("wms_devicelist_speaker").innerHTML=l(a.speaker,m)),Gator(j).on("click","[data-settings]",function(){var a=this.getAttribute("data-settings");$WC.$CUtil.setAttribute(j,"data-shown",a)})})}},WmsAVChat.AnswerCall={CLOSE_TIMEOUT:3e4,dom:{},zuid:null,sid:null,chid:null,closeTimer:null,isVisible:!1,init:function(){this.dom.main=document.getElementById("wms_incomingcall"),this.dom.acceptButton=document.getElementById("wms_answercall_button"),this.dom.rejectButton=document.getElementById("wms_rejectcall_button"),this.bindEvents()},show:function(a,b,c,d){if(this.isVisible||WmsAVChat.isRunning&&WmsAVChat.zuid==a&&WmsAVChat.callStatus==WmsAVChat.CALLSTATUSCODE.CONNECTED&&!WmsAVChat.isReconnecting){VideoCallReceiver.ignoreChat(a,b,VideoConstants.BUSY_ON_ANOTHER_CALL),VideoCallReceiver.stop();return}if(!WmsSettings.getAdminSetting("isMediacallAllowed")){VideoCallReceiver.stop();return}this.isReplying&&this.hide(!0);var e=WmsContacts.getDisplayName(a),f=WmsContacts.getUserPhoto(a,"200"),g=$WC.$CUtil.getConfig("Resource").getRealValue(c==WmsAVChat.CALL_TYPE_VIDEO?"mediacall.incoming.video":"mediacall.incoming.audio");this.isVisible=!0,this.sid=b,this.zuid=a,this.chid=d.chid||WebMessanger.ucmap[a],this.type=c,c==WmsAVChat.CALL_TYPE_VIDEO?($WC.$CUtil.addClass(this.dom.acceptButton,"wms_video_accept"),$WC.$CUtil.addClass(this.dom.rejectButton,"wms_video_reject")):($WC.$CUtil.removeClass(this.dom.acceptButton,"wms_video_accept"),$WC.$CUtil.removeClass(this.dom.rejectButton,"wms_video_reject")),$WC.$CUtil.setInnerText(document.getElementById("wms_callername"),e),document.getElementById("wms_callerimg").src=f,$WC.$CUtil.setInnerText(document.getElementById("wms_calltype"),g),document.getElementById("wms_caller_container").style.display="block",$WC.$CUtil.setAttribute(document.getElementById("wms_caller_container"),"data-type","3"),$WC.$CUtil.setAttribute(document.getElementById("wms_caller_container"),"data-id",a),WmsNotification.notifyNewCall(e,c,a),this.closeTimer=setTimeout(function(){WmsAVChat.AnswerCall.hide(),VideoCallReceiver.stop()},this.CLOSE_TIMEOUT)},bindEvents:function(){var a=this;Gator(this.dom.main).on("click","[call-action]",function(){var b=this.getAttribute("call-action");b=="acceptcall"?a.checkAndAcceptCall():b=="rejectcall"&&a.rejectCall(),$WC.DesktopNotification.close("call")})},checkAndAcceptCall:function(){if(WmsAVChat.isRunning){var a={bodyhtml:$WC.$CUtil.getConfig("Resource").getRealValue("mediacall.confirm.disconnect",[WmsContacts.getDisplayName(WmsAVChat.zuid),WmsContacts.getDisplayName(WmsAVChat.AnswerCall.zuid)]),focusbutton:2,operations:[{name:$WC.$CUtil.getConfig("Resource").getRealValue("mediacall.close.proceed"),action:function(){WmsAVChat.close(),WmsAVChat.AnswerCall.acceptCall(),WmsDialog.removeModal()}},{name:$WC.$CUtil.getConfig("Resource").getRealValue("Cancel"),classname:"wms-dialog-rejectbtn",action:function(){WmsAVChat.AnswerCall.rejectCall(),WmsDialog.removeModal()}}]};WmsDialog.showModal(a)}else WmsAVChat.AnswerCall.acceptCall()},close:function(a){this.isVisible&&this.sid==a&&this.hide(),VideoCallReceiver.stop()},hide:function(){this.isVisible=!1,clearTimeout(this.closeTimer),ChatBlink.stopRepeat(),this.closeTimer=null,$WC.$CUtil.setAttribute(document.getElementById("wms_callerimg"),"src",""),$WC.$CUtil.setInnerText(document.getElementById("wms_callername"),""),document.getElementById("wms_caller_container").style.display="none",$WC.$CUtil.setAttribute(document.getElementById("wms_caller_container"),"data-type",""),$WC.$CUtil.setAttribute(document.getElementById("wms_caller_container"),"data-id","")},acceptCall:function(){var a=WmsAVChat.AnswerCall.zuid,b=WmsAVChat.AnswerCall.chid||WebMessanger.ucmap[a],c=WmsAVChat.AnswerCall.type,d=null;WmsAVChat.sid=WmsAVChat.AnswerCall.sid,b&&(d=WindowHandler.getWinObjById(b)),WmsAVChat.startCall(a,c,WmsAVChat.CALL_MODE_INCOMING,d),WmsAVChat.AnswerCall.hide(!0),WmsAVChat.log("acceptedcall")},rejectCall:function(){this.hide(!0),VideoCallReceiver.ignoreChat(this.zuid,this.sid,WmsAVChat.DISCONNECT_MSG.REJECTED),VideoCallReceiver.stop(),WmsAVChat.log("rejectedcall")}},WmsAVChat.VideoChatHandler={setVideoChatAPI:function(a){WmsAVChat.api=a;var b=WmsContacts.getDisplayName(WmsAVChat.zuid)||WindowHandler.getWinObjById(WmsAVChat.chid)&&WindowHandler.getWinObjById(WmsAVChat.chid).getTitle();a.setChatUserName(b),WmsAVChat.setWMSConnectionStatus(!WebMessanger.systemdown);var c=[];WmsAVChat.devicePreference.mic&&c.push(WmsAVChat.devicePreference.mic),c&&a.setDevices(c),WmsAVChat.devicePreference.speaker&&a.setSpeakerDevice(WmsAVChat.devicePreference.speaker)},getVideoChatAPI:function(){return WmsAVChat.api},handleMediaPermission:function(a){WmsAVChat.log("handleMediaPermission "+a);if(a=="pending")clearTimeout(WmsAVChat.permissionDialogueTimer),WmsAVChat.permissionDialogueTimer=setTimeout(function(){WmsAVChat.showMediaPermissionWin(),WmsAVChat.setCallStatus(WmsAVChat.CALLSTATUSCODE.WAITING)},WmsAVChat.PERMISSION_DIALOGUE_DELAY);else if(a=="granted")clearTimeout(WmsAVChat.permissionDialogueTimer),WmsDialog.removeModal(),WmsAVChat.callStatus<WmsAVChat.CALLSTATUSCODE.CONNECTING&&(WmsAVChat.callMode==WmsAVChat.CALL_MODE_INCOMMING?WmsAVChat.setCallStatus(WmsAVChat.CALLSTATUSCODE.CONNECTING):WmsAVChat.setCallStatus(WmsAVChat.CALLSTATUSCODE.CALLING));else if(a=="denied"||a=="blocked"){clearTimeout(WmsAVChat.permissionDialogueTimer),WmsDialog.removeModal();var b="";WmsAVChat.callType==WmsAVChat.CALL_TYPE_VIDEO?b=$WC.$CUtil.getConfig("Resource").getRealValue("videocall.permission.device"):b=$WC.$CUtil.getConfig("Resource").getRealValue("audiocall.permission.device"),WmsAVChat.close();var c={bodyhtml:b,focusbutton:1,operations:[{name:$WC.$CUtil.getConfig("Resource").getRealValue("mediacall.permission.okay"),action:function(){WmsDialog.removeModal()}}]};WmsDialog.showModal(c)}},handleChatReceived:function(){},handleChatAnswered:function(){},handleLocalStream:function(a){WmsAVChat.localStream=a,WmsAVChat.log("handleLocalStream "+d);if(!WmsAVChat.isRunning){WmsAVChat.lastCallAPI&&WmsAVChat.lastCallAPI.stopChat(),WmsAVChat.close();return}var b=WmsAVChat.dom.localVideo,c=window.URL||window.webkitURL;if(c&&typeof c.createObjectURL=="function"){var d=c.createObjectURL(a);$WC.$CUtil.setAttribute(b,"src",d)}else b.srcObject=a;b.muted=!0,WmsAVChat.dom.localVideo.style.display="block",WmsAVChat.dom.localuserimg.style.display="none"},handleLocalSrc:function(){},handleRemoteStream:function(a){WmsAVChat.remoteStream=a,WmsAVChat.log("handleRemoteStream "+d);var b=WmsAVChat.dom.remoteVideo;b.muted=!0,$WC.$CUtil.addEvent(b,"loadedmetadata",function(){this.muted=!1,WmsAVChat.isConnectNotifyReceived&&WmsAVChat.establishConnectedCall()});var c=window.URL||window.webkitURL;if(c&&typeof c.createObjectURL=="function"){var d=c.createObjectURL(a);$WC.$CUtil.setAttribute(WmsAVChat.dom.remoteVideo,"src",d)}else b.srcObject=a;$WC.$CUtil.setAttribute(WmsAVChat.dom.remoteVideo,"src",d)},handleRemoteSrc:function(){},handleRemoteMediaStatus:function(a,b){WmsAVChat.log("handleRemoteMediaStatus "+a+b);var c=WmsAVChat.dom.videocontainer.getElementsByClassName("wms_mediaoff_notify")[0];a=="camera"&&(b=="1"?(WmsAVChat.isRemoteCamOff=!1,$WC.$CUtil.removeClass(c,"wms_mediacall_videooff"),WmsAVChat.dom.remoteVideo.style.display="block",WmsAVChat.dom.remoteuserimg.style.display="none"):b=="0"&&(WmsAVChat.isRemoteCamOff=!0,$WC.$CUtil.addClass(c,"wms_mediacall_videooff"),WmsAVChat.dom.remoteVideo.style.display="none",WmsAVChat.dom.remoteuserimg.style.display="block")),a=="mic"&&(b=="1"?$WC.$CUtil.removeClass(c,"wms_mediacall_audiooff"):b=="0"&&$WC.$CUtil.addClass(c,"wms_mediacall_audiooff"))},handleSwitchingDevices:function(){},handleConnectNotify:function(){WmsAVChat.setCallStatus(WmsAVChat.CALLSTATUSCODE.CONNECTED),WmsAVChat.isConnectNotifyReceived=!0,WmsAVChat.establishConnectedCall()},handleChatRunningTime:function(a){$WC.$CUtil.setInnerText(WmsAVChat.dom.timercontainer,a)},handleVideoChatStatus:function(){},handleSessionId:function(a){WmsAVChat.log("handleSessionId "+a),WmsAVChat.sid=a},handleCloseRequest:function(a){if(WmsAVChat.api&&WmsAVChat.api.getSessionId()!==WmsAVChat.sid){WmsAVChat.log("old session id");return}if(WmsAVChat.callStatus==WmsAVChat.CALLSTATUSCODE.CONNECTED&&a==WmsAVChat.DISCONNECT_MSG.NORESPONSE){WmsAVChat.log("Invalid close request");return}WmsAVChat.log("handleCloseRequest "+a);var b=WindowHandler.getWinObjById(WmsAVChat.chid);WmsAVChat.isRunning&&(WmsAVChat.close(!0),b&&(a==WmsAVChat.DISCONNECT_MSG.COMPLETED?b.showErrorMsg($WC.$CUtil.getConfig("Resource").getRealValue("mediacall.ended")):a==WmsAVChat.DISCONNECT_MSG.ERROR?WmsAVChat.showCallFailedBanner():a==WmsAVChat.DISCONNECT_MSG.NORESPONSE?b.showErrorMsg($WC.$CUtil.getConfig("Resource").getRealValue("mediacall.noresponse")):(a==WmsAVChat.DISCONNECT_MSG.REJECTED||a==WmsAVChat.DISCONNECT_MSG.BUSY_ON_OTHER_CALL)&&b.showErrorMsg($WC.$CUtil.getConfig("Resource").getRealValue("mediacall.userbusy"))))},handleReconnect:function(a){WmsAVChat.log("handleReconnect"+a);if(!WmsAVChat.isRunning)return;if(WmsAVChat.api&&WmsAVChat.api.getSessionId()!==WmsAVChat.sid){WmsAVChat.log("old session id");return}if(WmsAVChat.callStatus!=WmsAVChat.CALLSTATUSCODE.CONNECTED){WmsAVChat.close(),WmsAVChat.showCallFailedBanner();return}a=="started"?(WmsAVChat.isReconnecting=!0,WmsAVChat.callType==WmsAVChat.CALL_TYPE_VIDEO&&(WmsAVChat.dom.remoteuserimg.style.display="block",WmsAVChat.dom.remoteVideo.style.display="none",$WC.$CUtil.removeClass(WmsAVChat.dom.videocontainer.getElementsByClassName("wms_videocall_buttons_list")[0],"wms-halign")),$WC.$CUtil.setInnerText(WmsAVChat.dom.videocontainer.getElementsByClassName("wms_callstatus_text")[0],$WC.$CUtil.getConfig("Resource").getRealValue("mediacall.reconnecting")),$WC.$CUtil.setAttribute(WmsAVChat.dom.videocontainer,"data-connecting","true")):a=="connected"?(WmsAVChat.isReconnecting=!1,WmsAVChat.setCallStatus(WmsAVChat.CALLSTATUSCODE.CONNECTED),WmsAVChat.establishConnectedCall()):a=="failed"&&(WmsAVChat.setCallStatus(WmsAVChat.CALLSTATUSCODE.ENDED),WmsAVChat.close(),WmsAVChat.showCallFailedBanner())},handleLocalMediaStatus:function(){},handleVideoError:function(a){WmsAVChat.log("handleVideoError "+a),WmsAVChat.close(),WmsAVChat.showCallFailedBanner()}},WmsAVChat.videoChatImplHandler=function(){window.VideoChatMessageNotifier={handleVideoChat:function(){return WmsAVChat.log("handleVideoChat"),!0},handleChatRequest:function(a,b,c,d,e){WmsAVChat.log("handleChatRequest"),e?e=JSON.parse(e):e={},WmsAVChat.AnswerCall.show(a,c,d,e)},handleChatAnswered:function(a){WmsAVChat.log("handleChatAnswered"),WmsAVChat.AnswerCall.close(a)},handleCloseRequest:function(a,b){WmsAVChat.log("handleCloseRequest"+a+" "+b),WmsAVChat.AnswerCall.close(a)},handleBrowserNotSupported:function(){WmsAVChat.log("handleBrowserNotSupported");var a={bodyhtml:$WC.$CUtil.getConfig("Resource").getRealValue("mediacall.browser.notsupported"),focusbutton:1,operations:[{name:$WC.$CUtil.getConfig("Resource").getRealValue("mediacall.permission.okay"),action:function(){WmsDialog.removeModal()}}]};WmsDialog.showModal(a),WmsAVChat.close(!0)}}};var dext=".sas",lfromstatic=!1,wmsjsversion="v265",silent=!1,WMSIAMURL=window.location.protocol+"//accounts.zoho.com",wmsmeetingurl=window.location.protocol+"//meeting.zoho.com",_WMSIAMTICKETNAME="IAMAGENTTICKET",_WMSMAILURL=window.location.protocol+"//zmail.zoho.com/",_WMSCHATURL=window.location.protocol+"//chat.zoho.com/",_WMSPHOTOSERVER=window.location.protocol+"//contacts.zoho.com",_WMSCONFIG="15",_WMSCALENDARSERVER=window.location.protocol+"//calendar.zoho.com",_WMSCONT="_wms",_CHATCONT="_chat",_WMSDOMAIN="zoho.com",_WMS_SAMEDOMAIN=!1,_WMS_FORCEDOMAIN=!1,_WMS_NODOMAINCHANGE=!1,_WMSCFPARAMNAME,_CHATCFPARAMNAME="zchat_csrparam",_CHATCFTOKEN="CT_CSRF_TOKEN",_WMSDRAGDROP=!0,_WMSSST=!1,_RETRYREGINTERVAL=1e4,iswmsframemonitorrunning=!1,iswmsframeloaded=!1,retryregistertimer=null,wmsdebuginfo,wmsnotifyowner,_WMSWINFOCUS=!0,_WMSEMPTYBAR=!1,_WMSAPPACCOUNTID,_PRIMETIMEHELPLINK="https://www.zoho.com/cliq/help/primetime/",_WMSCONSECUTIVEFAILURECNT=0,_MAX_WMS_FAILURE=3,_isGSearchAppended=!1,_isVideoJSAppended=!1,_WMSDISABLEAVCHAT=!1,_WMS_RETRY_COUNT=0,_WMSAUTHTOKEN,_WMSAUTHSCOPE,_WMSZAID,_WMSORIGINALIMG_LOAD_TIMEOUT=250,_WMS_LP="false",_WMS_REQLOG=[],_TZOFFSET=(new Date).getTimezoneOffset()*-1,op=navigator.userAgent.indexOf("Opera")!=-1,opera_browser=op,ie=!op&&/msie/i.test(navigator.userAgent),mz=!op&&!ie&&/mozilla\/5/i.test(navigator.userAgent),wms_sf=navigator.userAgent.indexOf("Safari")!=-1,WM_ACK_CONNECT=0,WM_INFO=1,WM_CUSTOM=2,WM_LOGOUT=3,WM_CROSSPRODUCT=4,WM_PRESENCE=6,WM_RECONNECT=-1,WM_SERVER_UP=-3,WM_NFY_LOGOUT=-2,WM_AUTH_FAILED=-5,WM_INVALID_AUTH_PARAMS=-12,PS_REG_ACK=-16,WM_INVALID_TOKEN=-17,WM_NFY_ATTACH=-8,WM_NFY_DETACH=-9,SHOW_INFO=-10,CT_JOIN=10,CT_QUIT=11,CT_TXT_MSG=12,CT_NFY_USERSTATUS=13,CT_NFY_USERADD=14,CT_NFY_USERDELETE=15,CT_INF_MSG=16,CT_GUEST_DENIED=17,CT_NFY_GUESTACCESS=18,CT_NFY_APPROVAL=102,CT_ATT_MSG=20,WM_NFY_COLLABADD=21,WM_NFY_COLLABDELETE=22,CT_NFY_SETTITLE=19,WM_NFY_STATUS=23,WM_NFY_CSTATUSCHANGE=24,WM_NFY_USERIMGCHANGE=25,CT_MEET_MSG=26,CONTACT_INFO=27,CT_CLOSE_WIN=28,WM_AV_MSG=29,WM_CLEAR_NOTI=32,CT_NFY_ACTCHATADD=50,CT_NFY_ACTCHATDELETE=34,WM_SKIPTRANS=36,WM_USER_LANG_CHANGE=37,WM_SYSTEM_MSG=38,ACS_MSG=43,WM_TICKET_MSG=46,CT_MSG_STORAGE=47,CT_ATTACH=49,WM_DEF_STATUS=54,CT_NFY_MUTECHAT=58,CT_BOT_LIST=60,CT_BOT_OPR=61,WM_ZTI_CROSSPRODUCT=62,CT_DELETED_MSG=63,CT_NFY_MSG=112,NFY_GUEST_LINK=103,NFY_USER_TYPING=104,NFY_USER_IDLE=105,NFY_USER_ENTERED=110,WM_ZTI_FAIL_MSG=601,WMS_ONLINE=1,WMS_OFFLINE=0,WMS_INVISIBLE=2,WMS_BUSY=3,WMS_IDLE=4,CT_NFY_LIVESUPPORT=4,CT_NFY_ZOHOGROUP=5,CT_NFY_MULTIPROTOCOL=6,NFY_REQ_CSUPPORT=106,NFY_ACC_CSUPPORT=108,NFY_QIT_CSUPPORT=109,NFY_ENDLIVESUPPORT=113,CT_GUEST_REQ=100,WM_PUB_SUB=800,MP_LOGIN=300,MP_LOGOUT=301,MP_RELOGIN=302,MP_PRESENCE=303,MP_CONTACT_UPDATE=304,MP_CONTACT_INF_UPDATE=305,MP_SERVER_DOWN=306,MP_ADDBOOK=307,MP_CAPTCHA=309,PR_MSG=700;WebMessanger.chatdeactivated=!1,WebMessanger.allprdchatdeactivated=!1,WebMessanger.chatdisabled=!1,WebMessanger.ismediacallnewwindow=!0,WebMessanger.jsstaticdomain="js.zohostatic.com",WebMessanger.cssstaticdomain="css.zohostatic.com",WebMessanger.isIdle=!1,WebMessanger.smartchatshortcutdisabled=!1,$WC.$CUtil.addEvent(window,"beforeunload",function(a){if(_WMS_REQLOG.length){var b="Your message is being sent. Do you still want to leave this page?";return a.returnValue=b,b}}),WebMessanger.checkNetworkAndUpdateBanner=function(){var a,b="https://img.zohostatic.com/ichat/v282_https/images/spacer.gif";return function(){typeof a=="undefined"&&(a=document.createElement("img"),a.style.display="none",document.body.appendChild(a),EventsUtil.attachonload.call(a,function(){document.getElementById("wmsbannertext")&&setTimeout(function(){document.getElementById("wmsbannertext").innerHTML=WmsResource.getRealValue("connectionerror.chatfail")},1)})),a.src=b+"?nocache="+(new Date).getTime()}}(),function(){var a=(new Date).getTime()+"_"+Math.floor(Math.random()*1e4);window.getWmsTabId=function(){return WebMessanger.zuid+"_"+WebMessanger.prd+"_"+a}}(),WebMessanger.getDebugInfo=function(){return wmsdebuginfo},WebMessanger.updateDebugInfo=function(a){wmsdebuginfo=a},function(){var a=[];WebMessanger.updateClientDebugStore=function(b){a.length>=1e3&&a.shift(),b.timestamp=(new Date).getTime(),b.mtype&&b.mtype==="12"&&b.msg&&(b.msg.msg="******"),a.push(b)},WebMessanger.getClientDebugStore=function(){return a}}(),WebMessanger.postDebugInfoToServer=function(a,b){var c="zuid="+WebMessanger.zuid+"&wmsdebuginfo="+JSON.stringify(WebMessanger.getDebugInfo())+"&sid="+WebMessanger.sid+"&rawsid="+WebMessanger.rawsid;b&&(c+="&source="+b),document.location.hostname.indexOf(".manageengine.com")===-1&&$WC.Ajax.postRequestToChat("printlog.do",c,function(){a&&WMSUI.showInfoMsg("Debug info sent successfully!")})},WebMessanger.showBanner=util.throttle(function(a,b){WebMessanger.offline=!0,WebMessanger.checkNetworkAndUpdateBanner();var c=!WMSUI.isBannerShown("wms-netdownbanner")||WebMessanger.initcountdown?!0:!1;WebMessanger.initcountdown=!1,iswmsframeloaded===!1?(WMSUI.showBanner("WebMessanger.forceRegister"),WebMessanger.reconnectTimer(c,WebMessanger.retryRegister,a,b)):(WMSUI.showBanner("WebMessanger.forceReconnect"),WebMessanger.reconnectTimer(c,WebMessanger.triggerbind,a,b))},null,4e3),WebMessanger.hideBanner=function(){WebMessanger.offline=!1,WMSUI.hideBanner()},WebMessanger.loadRebrandCSS=function(){if(this.rebrand!=""){var a=document.createElement("link");a.rel="stylesheet";if(this.cssstaticdomain!="css.zohostatic.com"){var b=window.location.protocol+"//"+this.cssstaticdomain+"/ichat/"+wmsjsversion+"/css/rebrand/"+this.rebrand+"/"+this.theme+"/rebrand.css?version="+wmsjsversion;window.location.href.indexOf("https")!=-1&&(b=window.location.protocol+"//"+this.cssstaticdomain+"/ichat/"+wmsjsversion+"_https/css/rebrand/"+this.rebrand+"/"+this.theme+"/rebrand.css?version="+wmsjsversion)}else var b="/"+_WMSCONT+"/style/rebrand/"+this.rebrand+"/"+this.theme+"/rebrand.css?version="+wmsjsversion;a.href=b,document.body.appendChild(a)}},WebMessanger.init=function(a){_WMS_NODOMAINCHANGE||!_WMS_SAMEDOMAIN&&!opera_browser&&(!ie||ie&&_WMS_FORCEDOMAIN)&&(document.domain=_WMSDOMAIN);if(typeof document.querySelector!="undefined"){var b=document.querySelector('script[src*="wmsbar"]');b&&(WebMessanger.jsstaticdomain=b.src.split("/")[2]);var c=document.querySelector("link[href*=wmsbar]");c&&(WebMessanger.cssstaticdomain=c.href.split("/")[2])}silent=a,typeof this.countrycode=="undefined"&&(this.countrycode="US"),typeof this.language=="undefined"&&(this.language="en"),typeof this.rebrand=="undefined"&&(this.rebrand=""),typeof this.meeting=="undefined"&&(this.meeting=!0),typeof this.theme=="undefined"&&(this.theme="grey"),typeof this.setzindex=="undefined"&&(this.setzindex=999),typeof this.disablenetworkdownbanner=="undefined"&&(this.disablenetworkdownbanner=!1),WebMessanger.statusarr=new Array("Offline","Available","Invisible","Busy","Idle"),WebMessanger.scodearr=new Array(0,1,3,4),WebMessanger.lastconnect=-1,WebMessanger.wmsservicestatus=!0,WebMessanger.offline=!0;try{WebMessanger.locationurl=window.location.href}catch(d){}WebMessanger.loadRebrandCSS(),WebMessanger.disablewms=!1,WebMessanger.showbannertime=0,WebMessanger.showchatbannertime=0,WebMessanger.lastmessage="",WebMessanger.lastmessagetime="",WebMessanger.reconnectPrevlimit=30,WebMessanger.isPresenceEnabled()&&(setTimeout(function(){WMSUI.runIdleTimer()},10),setTimeout(function(){WMSUI.checkDocumentActive()},20)),WMSUI.init(),WebMessanger.systemdown=!1,WebMessanger.ucmap={},WebMessanger.waitchats={},WebMessanger.liveChats=new Array,WebMessanger.chatmap={}},WebMessanger.forceRegister=function(){WebMessanger.initcountdown=!0,document.getElementById("recntime").innerHTML=WmsResource.getRealValue("connectionerror.reconnect"),WebMessanger.retryRegister()},WebMessanger.forceReconnect=function(){WebMessanger.initcountdown=!0,document.getElementById("recntime").innerHTML=WmsResource.getRealValue("connectionerror.reconnect"),WebMessanger.triggerbind()},WebMessanger.reconnectTimer=function(){function c(a,b){return a=+a,b=+b,Math.floor(Math.random()*(b-a+1)+a)}var a=[30,60,90,120,300],b=0;return function(d,e,f,g){d?(b=0,a[0]=c(5,30)):b<a.length-1&&b++;var h=a[b];f&&(g=g||f,h=c(f,g)),WMSUI.showCountDownInBanner(h,e)}}(),WebMessanger.reconnect=function(a,b,c){c!=null&&c==1&&(this.reconnecting=!1);if(this.reconnecting==1)return;this.reconnecting=!0,this.retry==undefined&&(this.retry=0),this.retry++,setTimeout(function(){WebMessanger.registerWms(WebMessanger.prd,WebMessanger.zuid,WebMessanger.uname,WebMessanger.nname,silent,!0)},a),WebMessanger.serverdown(),WMSUI.RestartTimers()},WebMessanger.isReconnecting=function(){return this.reconnecting},WebMessanger.registerZuid=function(a,b,c,d){WebMessanger.registerWms(a,b,c,null,d)},WebMessanger.registerAnnon=function(a,b,c,d){WebMessanger.disableContacts(),WebMessanger.disableGroups(),WebMessanger.disableActiveChat(),WebMessanger.disableProfile(),WebMessanger.disableMeeting(),WebMessanger.disableNotification(),WebMessanger.disableCWActions(),WebMessanger.disableSmartChat(),this.registerAnnonUser=!0,WebMessanger.authtype=4,WebMessanger.registerWms(a,b,b,c,d)},WebMessanger.register=function(a,b,c,d,e,f){function j(){_WMSAUTHTOKEN=d,_WMSAUTHSCOPE=e,_WMSZAID=f,_WMSAUTHTOKEN&&_WMSAUTHSCOPE&&(c=!0,WebMessanger.authtype=1),_WMSAUTHTOKEN&&_WMSZAID&&(c=!0,WebMessanger.authtype=8),_WMSZAID&&WebMessanger.tokenpairauth&&(c=!0,WebMessanger.authtype=10),$WC.$CUtil.isZuid(b)?WebMessanger.registerWms(a,b,null,null,c):WebMessanger.registerWms(a,null,b,null,c)}if(typeof JSON=="undefined"){var g=document.createElement("script"),h=window.location.protocol,i=h==="https:"?wmsjsversion+"_https":wmsjsversion;g.type="text/javascript",g.src=h+"//"+this.jsstaticdomain+"/ichat/"+i+"/js/json2.min.js",document.body.appendChild(g),EventsUtil.attachonload.call(g,j)}else j()},WebMessanger.showEmptyBar=function(){_WMSEMPTYBAR=!0},WebMessanger.disableToggleUI=function(){WMSUI.disableShowHide()},WebMessanger.disableDragDrop=function(){_WMSDRAGDROP=!1},WebMessanger.setIamTicketName=function(a){_WMSIAMTICKETNAME=a},WebMessanger.setPhotoServer=function(a){_WMSPHOTOSERVER=window.location.protocol+"//"+a,$WC.$CUtil.setConfig({photoserver:_WMSPHOTOSERVER})},WebMessanger.setIamServer=function(a){WMSIAMURL=a},WebMessanger.setChatServer=function(a){_WMSCHATURL=window.location.protocol+"//"+a+"/"},WebMessanger.setMailServer=function(a){_WMSMAILURL=window.location.protocol+"//"+a+"/"},WebMessanger.setCalendarServer=function(a){_WMSCALENDARSERVER=window.location.protocol+"//"+a},WebMessanger.setTheme=function(a){},WebMessanger.setDomain=function(a){_WMSDOMAIN=a},WebMessanger.isChatPaused=function(){return WebMessanger.chatdeactivated||WebMessanger.allprdchatdeactivated||WebMessanger.chatdisabled},WebMessanger.disableAudioVideoChat=function(){_WMSDISABLEAVCHAT=!0},WebMessanger.enableMediacallInNewWindow=function(){WebMessanger.ismediacallnewwindow=!0},WebMessanger.getDomain=function(){return _WMSDOMAIN},WebMessanger.getServiceName=function(){return this.servicename},WebMessanger.setConfig=function(a){_WMSCONFIG=a},WebMessanger.setChatBarPrimaryColor=function(a){document.documentElement.style.setProperty("--wms-primary-color",a)},WebMessanger.registerNotifications=function(a,b,c){_WMSCONFIG=0,WebMessanger.registerWms(a,b,b,c,!0)},WebMessanger.loadAVjscss=function(){if(_WMSDISABLEAVCHAT)return;if(!_isVideoJSAppended){var a=document.getElementsByTagName("head");if(!a||a.length==0)a=[],a[0]=document.createElement("head"),document.insertBefore(doc.body,a[0]);if(wmsUserConfig.zvv){var b=document.createElement("link");b.rel="stylesheet",b.href=window.location.protocol+"//"+WebMessanger.cssstaticdomain+"/zohovideo/"+wmsUserConfig.zvv+"/styles/blue/zvasall.css",a[0].appendChild(b);var c=document.createElement("script");c.defer=!0,c.src=window.location.protocol+"//"+WebMessanger.jsstaticdomain+"/zohovideo/"+wmsUserConfig.zvv+"/js/zvaschat.js",c.onload=function(){WmsAVChat.init(),MediaFrameWorkAPI.init()},a[0].appendChild(c)}_isVideoJSAppended=!0}},WebMessanger.disableTextArea=function(a){var b=WindowHandler.getWinObjById(a);b.disableComposerOptions(),b.disableActions()},WebMessanger.hideActionsPanel=function(a){var b=WindowHandler.getWinObjById(a);b.hideActions()},WebMessanger.hideActionItem=function(a,b,c){var d=WindowHandler.getWinObjById(a);d.hideActionItem(b,c)},EventsUtil.attachonload=function(a){typeof this.readyState!="undefined"?this.onreadystatechange=function(){(this.readyState=="loaded"||this.readyState=="complete")&&a.call(this)}:this.onload=function(){a.call(this)}},WebMessanger.registerWms=function(a,b,c,d,e,f){this.prd=a,this.uname=c!=null&&c!=undefined?c:"",this.zuid=b!=null&&b!=undefined?b:"",WebMessanger.authtype===undefined&&WebMessanger.enableTokenPairAuth(),typeof this.nname=="undefined"&&(this.nname=d!=null&&d!=undefined?d:""),f==undefined&&this.settings==undefined&&WebMessanger.init(e!=undefined?e:!1);var g=document.getElementById("pconnect");if(!g){var h=document.createElement("iframe");h.name="wmspconnect",h.id="pconnect",h.style.display="none",document.body.appendChild(h),g=document.getElementById("pconnect")}if((new Date).getTime()-WebMessanger.lastconnect>_RETRYREGINTERVAL){WebMessanger.lastconnect=(new Date).getTime();var i=this.zuid!=""?this.zuid:this.uname,j=!1;e||(j=!0);var k=this.prd;_WMS_RETRY_COUNT++;var l="/"+_WMSCONT+"/pconnect"+dext+"?prd="+k+"&uname="+i+"&ie="+(_WMS_FORCEDOMAIN?!1:ie)+"&opera="+opera_browser+"&samedomain="+_WMS_SAMEDOMAIN+"&safari="+wms_sf+$WC.$CUtil.nocachefix(!0)+"&config="+_WMSCONFIG+"&settings="+j+"&wmscont="+_WMSCONT+"&nodomainchange="+_WMS_NODOMAINCHANGE+"&retrycount="+_WMS_RETRY_COUNT;lfromstatic&&(l+="&staticdomain="+WebMessanger.jsstaticdomain+"&staticversion="+wmsjsversion),_WMSSST&&(l+="&sst=true"),WebMessanger.tokenpairauth&&(l+="&tokenpair=true"),WebMessanger.frameorigin&&(l+="&frameorigin="+WebMessanger.frameorigin),g.src=l}WebMessanger.scheduleWMSFrameMonitor()},WebMessanger.scheduleWMSFrameMonitor=function(){iswmsframemonitorrunning||(iswmsframemonitorrunning=!0,clearTimeout(retryregistertimer),retryregistertimer=setTimeout(function(){WebMessanger.registerMonitor()},_RETRYREGINTERVAL*6))},WebMessanger.registerMonitor=function(){WebMessanger.offline=!0,WebMessanger.isReuseSession()?WebMessanger.retryRegister():WebMessanger.showBanner()},WebMessanger.clearWMSFrameMonitor=function(a){clearTimeout(retryregistertimer),iswmsframemonitorrunning=!1,a&&(WebMessanger.offline=!1,WebMessanger.isReuseSession()||WebMessanger.hideBanner())},WebMessanger.retryRegister=function(){WebMessanger.isReuseSession()?(op||!top.WebMessanger.offline)&&WebMessanger.reconnect(0,"Retry Register",!0):WebMessanger.reconnect(0,"Retry Register",!0),clearTimeout(retryregistertimer),retryregistertimer=setTimeout(function(){WebMessanger.registerMonitor()},_RETRYREGINTERVAL)},WebMessanger.isReuseSession=function(){return(_WMSCONFIG&WMSSessionConfig.REUSE_SESSION)==WMSSessionConfig.REUSE_SESSION},WebMessanger.getZuid=function(){return this.zuid},WebMessanger.uisettingsconst={contacts:1,groups:2,activechats:4,notifications:8,settings:16,smartchat:32},WebMessanger.disableContacts=function(){WMSUI.contactsenabled=!1,WebMessanger.disabledmenus|=WebMessanger.uisettingsconst.contacts},WebMessanger.disableGroups=function(){WMSUI.groupsenabled=!1,WebMessanger.disabledmenus|=WebMessanger.uisettingsconst.groups},WebMessanger.disableActiveChat=function(){WMSUI.activechatenabled=!1,WebMessanger.disabledmenus|=WebMessanger.uisettingsconst.activechats},WebMessanger.disableProfile=function(){WMSUI.profileenabled=!1,WebMessanger.disabledmenus|=WebMessanger.uisettingsconst.settings},WebMessanger.disableNotification=function(){WMSUI.notificationenabled=!1,WebMessanger.disabledmenus|=WebMessanger.uisettingsconst.notifications},WebMessanger.disableSmartChat=function(){WMSUI.smartchatenabled=!1,WebMessanger.disabledmenus|=WebMessanger.uisettingsconst.smartchat},WebMessanger.disableCWActions=function(){this.disableCWAction=!0},WebMessanger.enableGlobalSearch=function(a){WMSUI.globalsearchenabled=!0,a!=undefined&&(WMSUI.hidegsicon=a)},WebMessanger.setDateFormat=function(a){var b=/^((dd|MM|y{2,4})( {0,1})\/( {0,1})(dd|MM)( {0,1})\/( {0,1})(dd|MM|y{2,4}))$/;b.test(a)&&(this.dateformat=a)},WebMessanger.getDateFormat=function(){return this.dateformat},WebMessanger.getUserName=function(){return this.uname},WebMessanger.getNickName=function(){return this.nname},WebMessanger.setNickName=function(a){this.nname=a},WebMessanger.getUserId=function(){return this.uid},WebMessanger.getPrd=function(){return this.prd},WebMessanger.getSid=function(){return this.sid},WebMessanger.setSid=function(a){this.sid=a},WebMessanger.getRawSid=function(){return this.rawsid},WebMessanger.getRebrand=function(){return this.rebrand},WebMessanger.encode=function(a){try{var b=/<([^<>]*)>/g;return a.replace(b,"&lt;$1&gt;")}catch(c){return a}},WebMessanger.decodehtml=function(a){var a=a.replace(/&lt;/g,"<");return a=a.replace(/&gt;/g,">"),a},WebMessanger.getNotification=util.throttle(function(){$WC.Ajax.requestToChat("getnoti.do")},null,500),WebMessanger.getUnreadFeeds=function(){$WC.Ajax.requestToChat("unreadzmsg.do")},WebMessanger.getPinnedChats=function(){var a="getpinnedchannels=true";$WC.Ajax.requestToChat("getpinnedchats.do",a)},WebMessanger.sendMailTranscript=function(a,b){var c="chid="+a+"&mailid="+encodeURIComponent(b);$WC.Ajax.postRequestToChat("sendtranscriptasmail.do",c)},WebMessanger.setStatus=function(a,b){if(a>4&&a<0)return;WmsResource.getRealValue("Available")==b?b="Available":WmsResource.getRealValue("Busy")==b?b="Busy":a==2&&(b="Invisible");var c="smsg="+encodeURIComponent(b)+"&scode="+a;$WC.Ajax.postRequestToChat("setstatus.do",c)},WebMessanger.getStatusMessage=function(){$WC.Ajax.requestToChat("getdefaultstatus.do")},WebMessanger.syncStatusMessage=function(){function b(){this.responseText!==""&&(a=JSON.parse(this.responseText)[0].objString)}var a=null;return $WC.Ajax.requestToChat("getdefaultstatus.do",null,b,null,null,!1),a},WebMessanger.getAllStatusMessage=function(){var a=function(){var a=JSON.parse(this.response);a[0].objString.ERRCODE==9005&&WMSUI.showErrorMsg(WmsResource.getRealValue("status.change.notallowed"))},b={"X-XHR-exception":"true"};$WC.Ajax.requestToChat("getcstatus.do",null,null,a,null,null,b)},WebMessanger.getBarChatSettings=function(a){$WC.Ajax.requestToChat("getwmssettings.do","property="+encodeURIComponent(a))},WebMessanger.UpdateWmsSettings=function(a,b,c,d,e,f,g){var h="property="+encodeURIComponent(a)+"&key="+b+"&value="+c;h+=d?"&prd="+d:"",h+=e?"&opr="+e:"",$WC.Ajax.postRequestToChat("updwmssettings.do",h,f,g)},WebMessanger.updateSettings=function(a,b,c){var d={"X-XHR-exception":"true"};$WC.Ajax.postRequestToChat("updbsettings.do",a,b,c,null,null,d)},WebMessanger.clearCustomStatus=function(){$WC.Ajax.postRequestToChat("clearcstatus.do")},WebMessanger.clearReminder=function(a){var b="calid="+encodeURIComponent(a);$WC.Ajax.postRequest("clearreminder"+dext,b)},WebMessanger.getZohoGroups=function(){$WC.Ajax.requestToChat("getgroups.do","module=fetchgroup&pno=1&lim=1")},WebMessanger.getChatTranscript=function(a){var b=a?a:(new Date).getTime(),c="limit="+ZMSG_CHATCOUNT+"&totime="+b;c+=ZMSG_SEARCHVALUE&&"&content="+ZMSG_SEARCHVALUE,c+=ZMSG_USERID&&"&recipient="+ZMSG_USERID;var d={"X-XHR-exception":"true","X-ZCSRF-TOKEN":$WC.$CUtil.getCSRF()},e=function(){if(!silent){var a=JSON.parse(this.response).data;ZMSGUI.populate(a.chats)}};$WC.Ajax.requestToChat("v1/chats",c,e,null,null,null,d)},WebMessanger.getChatCount=function(){$WC.Ajax.requestToChat("getchatcount.do","search="+encodeURIComponent(ZMSG_SEARCHVALUE))},WebMessanger.deleteSelectedChats=function(a){$WC.Ajax.postRequestToChat("deleteselectedchat.do","chid="+a)},WebMessanger.deleteChat=function(a){$WC.Ajax.postRequestToChat("deletechat.do","chid="+a)},WebMessanger.continueChat=function(a){var b=!0,c=!1,d="chid="+a+"&btf="+b+"&autojoin="+c+"&sid="+encodeURIComponent(WebMessanger.getSid());$WC.Ajax.postRequestToChat("continuechat.do",d)},WebMessanger.disable=function(){this.disablewms=!0,this.abortBind(),this.clearWMSFrameMonitor()},WebMessanger.isOnline=function(a){$WC.Ajax.postRequest("isonline"+dext,"ulist="+encodeURIComponent(a))},WebMessanger.isdisablewms=function(){return this.disablewms},WebMessanger.setRebrand=function(a){if(a==="baihui")return;this.rebrand=a},WebMessanger.setJsStaticDomain=function(a){this.jsstaticdomain=a},WebMessanger.setCssStaticDomain=function(a){this.cssstaticdomain=a},WebMessanger.useSameDomain=function(){_WMS_SAMEDOMAIN=!0},WebMessanger.setWmsContext=function(a){_WMSCONT=a,$WC.$CUtil.setConfig({WMSCONT:_WMSCONT})},WebMessanger.forceDomainChange=function(){_WMS_FORCEDOMAIN=!0},WebMessanger.setNoDomainChange=function(){_WMS_NODOMAINCHANGE=!0},WebMessanger.silentOverriddenForAnnouncement=!1,WebMessanger.overrideSilentForAnnouncement=function(){WebMessanger.silentOverriddenForAnnouncement=!0},WebMessanger.setLocale=function(a,b){var c=new Array("en","zh","ta","ja","de","ca","cs","da","el","es","et","fi","fr","hr","hu","it","ko","lt","nb","nl","pl","pt","ro","ru","sk","sv","th","tr","uk","vi"),d=-1;for(var e=0;e<c.length;e++)if(c[e]==a){d=e;break}d>-1?(this.language=a,this.countrycode=b):(this.language="en",this.countrycode="US")},WebMessanger.disableMeeting=function(){this.meeting=!1},WebMessanger.setMeetingUrl=function(a){wmsmeetingurl=window.location.protocol+"//"+a},WebMessanger.setAppAccountId=function(a){_WMSAPPACCOUNTID=a},WebMessanger.isCliqUser=function(){return _WMSAPPACCOUNTID?!0:!1},WebMessanger.reload=function(){try{var a=newurl=window.location.href;a.indexOf("#")>-1&&(newurl=window.location.href.substring(0,window.location.href.indexOf("#"))),setTimeout(function(){return window.location.href=newurl,!0},3e3)}catch(b){setTimeout(function(){return window.location.href=WebMessanger.locationurl,!0},3e3)}},WebMessanger.setMaxChatWindow=function(a){WebMessanger.forceMaxWin=a},WebMessanger.push=function(a){if(a.mtype==WM_RECONNECT){var b=a.msg||{},c;if(b&&b.instruction){var d=b.instruction.split("-");c=d[0]}c===undefined&&WebMessanger.reconnect(CT_JOIN,"psdown",!0),silent||(WmsMainUI.resetAllUnreadCount(),WmsRecentChats.resetUnreadChats())}else if(a.mtype==WM_NFY_LOGOUT||a.mtype==WM_AUTH_FAILED){WebMessanger.disable();var b=a.msg;setTimeout(function(){a.mtype==WM_NFY_LOGOUT?(WebMessanger.clearTicket(b.ticket),WmsImplHandler.invoke(Collaboration.handleLogout,b&&b.reason),WebMessanger.reload()):(WmsImplHandler.invoke(Collaboration.handleWmsDisable,b&&b.reason),WebMessanger.postDebugInfoToServer(null,"AuthFailed"))},1),WmsSessionStorage.removeItem("wms_openchats")}else if(a.mtype==PS_REG_ACK)iswmsframeloaded=!0,WebMessanger.clearWMSFrameMonitor();else if(a.mtype==WM_INVALID_AUTH_PARAMS||a.mtype==WM_INVALID_TOKEN){iswmsframeloaded=!1,WebMessanger.scheduleWMSFrameMonitor();var e=a.mtype==WM_INVALID_AUTH_PARAMS?"InvalidAuthParam":"InvalidToken";WebMessanger.postDebugInfoToServer(null,e)}else if(a.mtype==WM_SERVER_UP)silent||(WmsMainUI.resetAllUnreadCount(),WmsRecentChats.resetUnreadChats(),WmsHybridSearch.populateRecentChats(),Commands.clear()),WmsChatCache.removeAll(),typeof AcsApi!="undefined"&&WmsImplHandler.invoke(AcsApi.handleServerUP),WmsImplHandler.invoke(Collaboration.serverup),WmsChannels.sync=!0,WmsPinnedChats.last_fetched_time=null,WindowHandler.syncChatWindowTranscripts();else if(a.mtype==WM_NFY_ATTACH){var f=a.msg;this.uid=f.uid,f.nname!=""&&(this.nname=f.nname),this.sid=f.sid,this.rawsid=f.rsid,myMsgObj.sender=f.uname,myMsgObj.nname=this.nname,myMsgObj.dname=this.nname,myMsgObj.nickname=this.nname,myMsgObj.zuid=f.zuid,this.zuid=f.zuid,WebMessanger.clearWMSFrameMonitor(!0),iswmsframeloaded=!0,silent||WmsContacts.updateFromMDParent(WmsContacts.getZohoContacts()),setTimeout(function(){WebMessanger.serverup(a.msg)},100),WmsImplHandler.invoke(WmsContactImpl.handleGetContacts)}else if(a.mtype==WM_NFY_DETACH)setTimeout(function(){WebMessanger.serverdown()},100);else if(a.mtype==-7)WmsImplHandler.invoke(Collaboration.handleServiceMessage,a.msg);else if(a.mtype==NFY_USER_IDLE){var b=a.msg,g=$WC.$CUtil.splitWmsFormattedString(b.oc,4);b.chid=g[0],b.zuid=g[2],b.sender=b.zuid,b.dname=$WC.$CUtil.getContactName(b.zuid,g[3]);var h=b.chid,i=WindowHandler.getWinObjById(h);i&&!Message.isLocalUser(b.zuid)&&i.clearTypingStatus(),b.msg="",silent||Self.status.update(b),WmsImplHandler.invoke(WmsChatUIImpl.handleUserIdle,b.dname,h)}else if(a.mtype==NFY_USER_ENTERED){var b=a.msg,g=$WC.$CUtil.splitWmsFormattedString(b.oc,4);b.chid=g[0],b.zuid=g[2],b.sender=b.zuid,b.dname=$WC.$CUtil.getContactName(b.zuid,g[3]);var h=b.chid,i=WindowHandler.getWinObjById(h);i&&!Message.isLocalUser(b.zuid)&&i.clearTypingStatus(),b.msg="",silent||Self.status.update(b),WmsImplHandler.invoke(WmsChatUIImpl.handleUserEnteredText,b.dname,h)}else if(a.mtype==NFY_USER_TYPING){var b=a.msg,g=$WC.$CUtil.splitWmsFormattedString(b.oc,4);b.chid=g[0],b.zuid=g[2],b.sender=b.zuid,b.dname=$WC.$CUtil.getContactName(b.zuid,g[3],!0),b.mtype=NFY_USER_TYPING;var h=b.chid,i=WindowHandler.getWinObjById(h),j;i&&!Message.isLocalUser(b.zuid)&&(j=i.typingstatusnode,j.innerHTML="",$WC.$CUtil.removeClass(j,"wms_cw_typingstatus_animate"),$WC.$CUtil.isImageLazyLoaded(b.zuid)?j.innerHTML='<img class="wms_cw_userphoto" data-zcprofileid="'+b.zuid+'" src="'+WmsContacts.getUserPhoto(b.zuid)+'" title="'+$WC.$CUtil.getContactName(b.zuid,b.dname)+'">':j.innerHTML='<div class="wms_menu_item_img wms_typingstatus_img" data-imgid="'+b.zuid+'" data-originalsrc="'+WmsContacts.getUserPhoto(b.zuid)+'" title="'+$WC.$CUtil.getContactName(b.zuid,b.dname)+'"></div>',j.innerHTML+='<div class="wms_usertyping_status"><span></span><span></span><span></span></div>',j.setAttribute("data-typingstatus",!0),$WC.$CUtil.isImageLazyLoaded(b.zuid)||$WC.$CUtil.loadOriginalImage(j,!0,!0));if(!silent){Self.status.update(b);var k=b.chid+"."+b.sender,l=b.sender;Self.Timer[k]=setTimeout(function(){Self.status.clear(h,l);var a=WindowHandler.getWinObjById(h);a&&!Message.isLocalUser(b.zuid)&&a.clearTypingStatus()},15e3)}WmsImplHandler.invoke(WmsChatUIImpl.handleUserTyping,b.dname,h)}else if(a.mtype==WM_ACK_CONNECT){var f=a.msg;this.uid=f.uid,f.nname!=""&&(this.nname=f.nname),this.sid=f.sid,this.rawsid=f.rsid,this.uname=f.uname,this.orgid=f.orgid,myMsgObj.sender=f.uname,myMsgObj.nname=this.nname,myMsgObj.dname=this.nname,myMsgObj.nickname=this.nname,myMsgObj.zuid=f.zuid,this.zuid=f.zuid,this.retry=0,this.reconnecting=!1,this.registered=!0,silent||WebMessanger.isOrgUser()||WmsMainUI.removeChannelMenu(),WmsImplHandler.invoke(Collaboration.onConnect),WebMessanger.clearWMSFrameMonitor(!0),iswmsframeloaded=!0,WebMessanger.serverup(a.msg),$WC.$CUtil.setConfig({orgid:WebMessanger.orgid,dname:WebMessanger.nname}),WmsLocalStorage.getItem("wms_firstloaded")==null&&WmsLocalStorage.setItem("wms_firstloaded",(new Date).getTime()),WebMessanger.orgid=="456089"&&(WmsAVChat.videoChatImplHandler(),WebMessanger.isChatPaused()||(WebMessanger.ismediacallnewwindow=!1)),!_WMSEMPTYBAR&&!this.registerAnnonUser&&silent===!1&&this.loadAVjscss(),ChatTour.checkAndScheduleNotifier(WmsLocalStorage.getItem("wms_firstloaded"))}else if(a.mtype==WM_CLEAR_NOTI){var f=a.msg;if(f.opr=="clearunreadcount")silent||ZMSGUI.clearAllUnreadChats();else if(f.opr=="clearallnotifications"){if(!silent)try{ZMSG_CLKUNREAD=!1,WmsUnreadFeeds.count=0,WmsMainUI.updateUnreadChatsCount(),WmsHybridSearch.populateRecentChats(),ZMSGUI.hideunread()}catch(m){}}else if(f.opr=="clearreminder"){var n=f.data;n.reminder!=null&&(silent||WMSUI.removeNotificationHolder("reminder"+n.reminder,!1))}else if(f.opr=="updateunreadcount"){var n=f.data;n.chatcount!=undefined&&!!silent}else if(f.opr=="notifyunreadcount"){var n=f.data;if(n.chatcount!=undefined){if(silent)return;WmsRecentChats.removeFromUnreadChats(n.chid),WmsMainUI.resetUnreadCount(n.chid),WmsMainUI.updateUnreadCountInUI(n.chid),WmsMainUI.updateUnreadChatsCount()}}else f.opr!="clearlivenotifications"}else if(a.mtype==CT_NFY_ACTCHATADD){var f=a.msg.ac;a.msg.uc&&WmsRecentChats.updateUnReadChats(a.msg.uc,WmsUnreadChats.chatlist),WmsRecentChats.updateFromActiveChats(f)}else if(a.mtype==CT_NFY_ACTCHATDELETE)var f=a.msg;else if(a.mtype==CT_NFY_MSG){var f=a.msg;WmsImplHandler.invoke(Collaboration.handleChatNotifyMessage,f.chid,f.sender,f.msg)}else if(a.mtype==CT_INF_MSG){var f=a.msg;if(f.h)return;f.sender="CT_INF_MSG",f.msg=Message.getInfoMsgString(f.msg);var h=f.chid,i=WindowHandler.getWinObjById(h);i&&i.updateInfoMessage(f.msg,f.time)}else if(a.mtype==WM_INFO)try{var f=a.msg;!silent&&!WebMessanger.isTazEnabled()&&(WmsUnreadFeeds.count++,ZMSG_MSGOBJ.push(f),WmsMainUI.updateUnreadChatsCount(),WmsHybridSearch.populateRecentChats()),WmsImplHandler.invoke(Collaboration.handleZohoMessage,a.prd,f.MSG,f.URL,f.URLSTRING,f.CATEGORY,f.SENDER,f.ATTACHMENTS,f.PARAMS,f.ID,f.DNAME,f.ORGS,f.GROUPS)}catch(o){}else if(a.mtype==WM_CUSTOM)a.msg.ACTION==="COMMAND_CREATED"?Commands.updateList(a.msg.data):a.msg.ACTION==="COMMAND_DELETED"&&Commands.deleteObj(a.msg.data),WmsImplHandler.invoke(Collaboration.handleCustomMessage,a.msg);else if(a.mtype==WM_CROSSPRODUCT){if(a.prd=="CL"){var f=a.msg;f.operation=="EVENT REMINDER"&&(silent||WMSUI.showRemainder(f.data))}WmsImplHandler.invoke(Collaboration.handleCrossProductMessage,a.prd,a.msg)}else if(a.mtype==ACS_MSG){var p=a.msg;typeof AcsApi!="undefined"&&WmsImplHandler.invoke(AcsApi.handlePush,p.type,p.data)}else if(a.mtype==WM_PRESENCE)var f=a.msg;else if(a.mtype==WM_ZTI_FAIL_MSG){var f=a.msg;ZTI.handleFailure(f.reason,f)}else if(a.mtype==CT_JOIN){var f=a.msg,q=f.title,h=f.chid,r=f.ctype,s=f.salesiqchat||!1;if(f.users)for(var t=0;t<f.users.length;t++){var g=$WC.$CUtil.splitWmsFormattedString(f.users[t].s,3);f.users[t].zuid=g[0],f.users[t].uname=g[0],f.users[t].dname=g[2],WmsContacts.updateUserStatus(f.users[t].zuid,f.users[t].scode,f.users[t].st,f.users[t].smsg)}if(!WmsContacts.isMP&&f.addinfo.indexOf("CT_TYPE:6")==0)return;WebMessanger.liveChats.push(h),r==1&&WmsImplHandler.invoke(WmsChatUIImpl.handleNewChat,f);if((r==1||r==5||r==8||r==9||r==10||r==4&&s)&&!silent){if(r!=5||!CustomChat.isActive(h,f.addinfo)){if(WmsChatUIImpl.isActive(h))return;try{if(f.silent=="true")return}catch(u){}setTimeout(function(){WmsContacts.verifyUserStatus(f.users)},1),f.mprecipant&&WmsContacts.isMPUser(f.mprecipant)&&(f.sender=f.mprecipant),r==8&&(_WMSWINFOCUS?WmsChannels.getChannels():WmsChannels.get_channels_onfocus=!0),r==="5"&&(f.prd=a.prd),f.pcount=+f.pcount,Chat.isExists(h)?WmsMainUI.removeAutoFocusSchedule():WMSUI.createNewChatWindow(f);var v=WindowHandler.getWinObjById(h);f.mutedinterval&&(v.updateMuteInfo(f.mutedinterval),WmsMainUI.setMuteStatus(h,!0)),r!=8&&r!=9&&v.updateParticipantsFromJoin(f.users),r==8&&(v.updatePartCount(f.pcount),v.updateChannelImage()),r==10&&(v.updateWebUrl(f.context),v.updateInfoMsgTemplate(f.cbdata));if(r==9){var w=f.bots&&f.bots[0];v.updateBotImage(w),v.getActions(w)}f.attached==="1"&&v.updateAttachInfo(!0),WebMessanger.mapChat(f)}}else r==2&&WmsImplHandler.invoke(Collaboration.handleUserList,h,f.users);(r==4||r==5)&&CustomChat.handleUserList(h,f),r==10&&WmsImplHandler.invoke(ChatletImpl.handleUserList,f.entityid,f.users),r==="6"&&WmsImplHandler.invoke(Presence.handleUserList,h,f),WindowHandler.checkAndHighlightChat(h)}else if(a.mtype==WM_PUB_SUB){var x=a.msg,y=x.opr;y=="pubsub.ulist"?(WmsImplHandler.invoke(PubSubApi.addUsers,x.pskey,x.psid,x.ulist),WmsImplHandler.invoke(PubSubImpl.handleUserList,x.pskey,x.ulist)):y=="pubsub.usersubscribed"?(WmsImplHandler.invoke(PubSubApi.addUsers,x.pskey,x.psid,x.ulist),WmsImplHandler.invoke(PubSubImpl.handleUserIn,x.pskey,x.ulist)):y=="pubsub.userunsubscribed"?(WmsImplHandler.invoke(PubSubApi.removeUsers,x.pskey,x.psid,x.ulist),WmsImplHandler.invoke(PubSubImpl.handleUserOut,x.pskey,x.ulist)):y=="pubsub.message"&&WmsImplHandler.invoke(PubSubImpl.handleMessage,x.pskey,x.msg)}else if(a.mtype==CT_ATT_MSG){var b=a.msg,r=b.ctype,h=b.chid;if((r==1||r==5||r==8||r==9||r==10||r==4&&b.salesiqchat)&&!silent&&(b.salesiqchat||Message.isSameBrowser(b.sid)||!Message.isLocalUser(b.uname))&&(b.mod==="att"||b.mod==="contact"||b.mod==="location"||b.mod==="event"))if(r!=5||!CustomChat.isActive(h,b.addinfo)){if(WmsChatUIImpl.isActive(h))return;Message.isLocalUser(b.uname)===!1&&WmsMainUI.incrementUnreadCount(h),b.m?WmsMainUI.setMuteStatus(h,!0):WmsMainUI.setMuteStatus(h,!1);if(!Chat.isExists(h)&&!b.m&&!b.h){b.pcount=+b.pcount,r==="5"&&(b.prd=a.prd);if(typeof WmsUIImpl!="undefined"&&WmsUIImpl.preventChatWindowOpen)var z=WmsImplHandler.invokeSynchronously(WmsUIImpl.preventChatWindowOpen,r,h);if(WebMessanger.scode!=3&&!z){if(Message.isLocalUser(b.sender)&&b.pcount===2){var A=JSON.parse(b.t121t);delete A[b.sender];var B=Object.keys(A)[0];b.title=WmsContacts.getDisplayName(B)||A[B]}WMSUI.createNewChatWindow(b),WindowHandler.getWinObjById(h).updateMessage(b),WebMessanger.join(h)}Self.Idle=!0;var C=b.a==="1"?!0:!1;WmsNotification.notifyNewMessage(b,"newchat",C)}else{var i=WindowHandler.getWinObjById(h);if(i){a.msg.msgackid=a.msg.msgid,a.msg.msgid&&i.msgdisp.querySelector('[data-msgackid="'+a.msg.msgid+'"]')?i.updateMessageFragment(a.msg,i.msgdisp):i.updateMessage(a.msg);if(!b.m){var C=b.a==="1"?!0:!1;Self.Idle=!0,WmsNotification.notifyNewMessage(b,"chatmsg",C)}}}WmsRecentChats.updateLastMsgInfo({chid:h,sender:b.sender,dname:b.dname,msg:b.msg,lmtime:b.time,module:b.mod})}(r==4||r==5)&&!b.h&&CustomChat.handleAttachmentMessage(b)}else if(a.mtype==CT_TXT_MSG){var f=a.msg,r=f.ctype,h=f.chid,i=WindowHandler.getWinObjById(h),s=f.salesiqchat||!1;if(!WmsContacts.isMP&&f.addinfo.indexOf("CT_TYPE:6")==0)return;r==1&&WmsImplHandler.invoke(WmsChatUIImpl.handleChatMessage,f);if((r==1||r==5||r==8||r==9||r==10||r==4&&s)&&!silent){if(r!=5||!CustomChat.isActive(h,f.addinfo)){if(WmsChatUIImpl.isActive(h))return;if(s||Message.isSameBrowser(f.sid)&&Message.isSentFromApi(f.temp_info)||Message.isLocalUser(f.uname)===!1||r==10||r==9||Message.isBotMsg(f)||Message.isCustomMsg(f)){(i&&!i.isMsgAlreadyUpdated(f,i.ctrlcomp)||!i)&&Message.isLocalUser(f.uname)===!1&&WmsMainUI.incrementUnreadCount(h),f.m?WmsMainUI.setMuteStatus(h,!0):WmsMainUI.setMuteStatus(h,!1);if(!Chat.isExists(h)&&!f.m&&!f.h){if(f.sender!=="CT_INF_MSG"){f.pcount=+f.pcount,WmsContacts.isMPUser(f.sender)&&(f.sender=f.sender.substr(f.sender.indexOf("|")+1)),r==="5"&&(f.prd=a.prd);if(typeof WmsUIImpl!="undefined"&&WmsUIImpl.preventChatWindowOpen)var z=WmsImplHandler.invokeSynchronously(WmsUIImpl.preventChatWindowOpen,r,h);WebMessanger.scode!=3&&!z&&(WMSUI.createNewChatWindow(f),WindowHandler.getWinObjById(h).updateMessage(f),WebMessanger.join(h)),Self.Idle=!0;var C=f.a==="1"?!0:!1;WmsNotification.notifyNewMessage(f,"newchat",C)}}else{Self.Idle=!0;if(i&&!i.isMsgAlreadyUpdated(f,i.ctrlcomp)){i.updateMessage(f),Message.isBotMsg(f)&&f.temp_info&&i.showBotSuggestions(f),Self.status.clear(h,f.sender);if(!f.m&&Message.isLocalUser(f.uname)===!1){var C=f.a==="1"?!0:!1;WmsNotification.notifyNewMessage(f,"chatmsg",C)}}}}else WmsRecentChats.removeFromUnreadChats(h),WmsMainUI.resetUnreadCount(h),WmsMainUI.updateUnreadCountInUI(h),WmsMainUI.updateUnreadChatsCount(),i&&((f.msgid&&Message.isLocalUser(f.uname)===!1||!i.isMsgAlreadyUpdated(f,i.ctrlcomp))&&i.updateMessage(f),i.updateMessageFragment(f,i.ctrlcomp)),f.sid&&(s||!Message.isSameBrowser(f.sid))&&(WebMessanger.removeLiveChat(h),WindowHandler.removeWinById(h),ChatBlink.stopRepeat());WmsRecentChats.updateLastMsgInfo({chid:h,sender:f.sender,dname:f.dname,msg:f.msg,lmtime:f.time})}}else r==2&&WmsImplHandler.invoke(Collaboration.handleMessage,h,f.sender,f.zuid,f.dname,f.msg);(r==4||r==5)&&!f.h&&CustomChat.handleMessage(f)}else if(a.mtype==CT_CLOSE_WIN){var f=a.msg,r=f.ctype;if(r==1||r==4||r==5||r==8||r==9||r==10){var h=f.chid;WmsRecentChats.removeFromUnreadChats(h),WmsMainUI.resetUnreadCount(h),WmsMainUI.updateUnreadCountInUI(h),WmsMainUI.updateUnreadChatsCount(),WebMessanger.removeLiveChat(h),WindowHandler.removeWinById(h),ChatBlink.stopRepeat(),WmsChatCache.remove(h),(r==4||r==5)&&CustomChat.handleCloseWin(h)}}else if(a.mtype==WM_AV_MSG)a.msg.ACTION=="CHAT_REQUEST"&&VideoCallReceiver.setNewWindow(WebMessanger.ismediacallnewwindow),WMSTP.handleAVMessage(a.msg);else if(a.mtype==CT_NFY_USERSTATUS){var f=a.msg,r=f.ctype,h=f.chid;if(r!=1&&r!=5||!!silent)r==2&&WmsImplHandler.invoke(Collaboration.handlePresence,h,f.uname,f.zuid,f.dname,f.status);else if(r!=5||!CustomChat.isActive(h,f.addinfo))if(f.status==0)if(Message.isLocalUser(f.uname)){WebMessanger.removeLiveChat(h);try{f.close!=null&&f.close=="true"&&(WindowHandler.removeWinById(h),ChatBlink.stopRepeat())}catch(m){}}else if(WindowHandler.getWinObjById(h)){var D=WindowHandler.getWinObjById(h).partcount;f.msg="&nbsp;",silent||D==1&&Self.status.update(f)}(r==4||r==5)&&WmsImplHandler.invoke(CustomChat.handlePresence,h,f.uname,f.zuid,f.dname,f.status),r==="6"&&WmsImplHandler.invoke(Presence.handlePresence,h,f.uname,f.zuid,f.dname,f.status)}else if(a.mtype==CT_NFY_USERADD){var f=a.msg,r=f.ctype,h=f.chid;for(var t=0;t<f.users.length;t++){var g=$WC.$CUtil.splitWmsFormattedString(f.users[t].s,3);f.users[t].uname=g[0],f.users[t].cstatus=g[1],f.users[t].dname=g[2]}r!=1&&r!=5&&r!=10||!!silent?r==2&&WmsImplHandler.invoke(Collaboration.handleUserAdd,h,f.users):(r!=5||!CustomChat.isActive(h,f.addinfo))&&WindowHandler.addParticipantsByID(h,f.users),(r==4||r==5)&&WmsImplHandler.invoke(CustomChat.handleUserAdded,h,f.users,f.pcount),r==="6"&&WmsImplHandler.invoke(Presence.handleUserAdded,h,f.users)}else if(a.mtype==CT_NFY_USERDELETE){var f=a.msg,r=f.ctype,h=f.chid;for(var t=0;t<f.users.length;t++){var g=$WC.$CUtil.splitWmsFormattedString(f.users[t].s,3);f.users[t].uname=g[0],f.users[t].cstatus=g[1],f.users[t].dname=g[2]}r!=1&&r!=5&&r!=10||!!silent?r==2&&WmsImplHandler.invoke(Collaboration.handleUserDeleted,h,f.users):(r!=5||!CustomChat.isActive(h,f.addinfo))&&WindowHandler.deleteParticipantsByID(h,f.users),(r==4||r==5)&&WmsImplHandler.invoke(CustomChat.handleUserDeleted,h,f.users,f.pcount),r==="6"&&WmsImplHandler.invoke(Presence.handleUserDeleted,h,f.users)}else if(a.mtype==WM_NFY_COLLABADD){var f=a.msg,g=$WC.$CUtil.splitWmsFormattedString(f.s,5);f.uname=g[0],f.zuid=g[0],f.chid=g[1],f.ctype=g[2],f.time=g[3],f.dname=g[4];var b=WindowHandler.getWinObjById(f.chid);if(b){var E=function(a){var b=a.composer;b.removeAttribute("placeholder"),b.style.cursor="",b.removeAttribute("disabled");if(a.attachmentnode){var c=a.attachmentnode.querySelector('[id="wms-file"]');c.style.cursor="",c.removeAttribute("disabled")}var d=a.smileyinvoker;d.style.cursor="",d.removeAttribute("disabled"),d.className="wms-smileyinvoker wms-valign-mid-block";if(a.actionbutton){var e=a.actionbutton;e.style.cursor="",e.removeAttribute("disabled")}};E(b),b.permdenied=!1,b.clearChatContent();var F=document.createElement("div");F.style="display:none",F.setAttribute("data-latestchunk","true"),b.msgdisp.appendChild(F),Message.loadSpecificTranscript(h,b.msgdisp,F)}WmsImplHandler.invoke(Collaboration.handleCollabAdd,f.uname,f.dname,f.zuid,f.time,f.chid),f.ctype==="6"&&WmsImplHandler.invoke(Presence.handleUserAdd,a.msg),f.ctype==="8"&&WmsChannels.updateChannel(f.chid,"joined",1),!Message.isLocalUser(f.zuid)&&(f.ctype==="1"||f.ctype==="8"||f.ctype==="9"||f.ctype==="10")&&(WmsChatCache.remove(f.chid),f.ctype==="8"?WebMessanger.joinChannel(f.chid):WebMessanger.join(f.chid))}else if(a.mtype==WM_NFY_COLLABDELETE){var f=a.msg,g=$WC.$CUtil.splitWmsFormattedString(f.s,5);f.uname=g[0],f.zuid=g[0],f.chid=g[1],f.ctype=g[2],f.time=g[3],f.dname=g[4],WmsImplHandler.invoke(Collaboration.handleCollabDelete,f.uname,f.dname,f.zuid,f.time,f.chid),f.ctype==="6"&&WmsImplHandler.invoke(Presence.handleUserDelete,a.msg),f.ctype==="8"&&(WmsChannels.updateChannel(f.chid,"joined",0),WindowHandler.getWinObjById(f.chid)&&WindowHandler.getWinObjById(f.chid).close(),WmsRecentChats.removeFromRecentChats(f.chid));var b=WindowHandler.getWinObjById(f.chid);b&&(b.permdenied=!0,b.disableActions(),b.disableComposerOptions(WmsResource.getRealValue("chat.notamember")))}else if(a.mtype==CT_NFY_SETTITLE){var b=a.msg;if(b!=undefined){var G=b.msg,h=G.chid,q=G.title,i=WindowHandler.getWinObjById(h);if(!q){var H,I;if(i){var J=i.partinfo;for(var K in J)i.partcount==2&&(H=J[K].zuid,I=J[K].dname)}else WmsRecentChats.chatlist.forEach(function(a){a.CHATID==h&&a.PARTICIPANTSCOUNT==2&&a.PARTICIPANTS.forEach(function(a){a.zuid!==WebMessanger.zuid&&(H=a.zuid,I=a.dname)})});q=$WC.$CUtil.getContactName(H,I)}i&&WindowHandler.setTitle(h,q),WmsRecentChats.updateTitle(h,q)}}else if(a.mtype==WM_NFY_CSTATUSCHANGE){var f=a.msg,L=WebMessanger.scode,M=f.scode,N=f.smsg;WebMessanger.scode=M,WebMessanger.smsg=N,silent||(setTimeout(function(){WmsMainUI.updateUserStatusIcon(),WmsMainUI.updateUserStatusMsg()},1),WMSUI.changedsmsg=N,WMSUI.changedscode=M,WmsChatCache.removeAll())}else if(a.mtype==WM_NFY_STATUS){if(util.checkSessionConfig("PRESENCE_PERSONAL")){var f=a.msg,O=$WC.$CUtil.splitWmsFormattedString(f.s,5);f.zuid=O[0],f.scode=O[1],f.dname=$WC.$CUtil.getContactName(f.zuid),f.email=O[2],f.st=O[3],f.smsg=O[4]||WmsContacts.defaultstatusmsg[f.scode],WmsImplHandler.invoke(WmsContactImpl.handlePresence,f.zuid,f.zuid,f.dname,f.scode,f.smsg);var P=WmsContacts.status(f.zuid)!==!1&&+WmsContacts.status(f.zuid);WmsContacts.updateStatus(f),WmsHybridSearch.updatePresence(f.zuid),WindowHandler.updateUserStatus(f.zuid,f.scode,f.smsg,f.st),silent||f.m||WMSUI.checkAndNotifyStatus(f,P)}}else if(a.mtype==CONTACT_INFO){var f=a.msg;WmsContacts.updateContacts(f);if(!_WMSEMPTYBAR&&!silent){WmsMainUI.updateChatInvitationCount();var Q=WmsContacts.isInitialised();WmsContacts.initialized=!0,$WC.$CUtil.getConfig("customContacts")||(setTimeout(function(){WmsHybridSearch.populateContactListInMainUI(!0)},1),clearTimeout(this.orgsuggestion_populate_timer),this.orgsuggestion_populate_timer=setTimeout(function(){var a={};a.suggestions="show_suggestions",WmsHybridSearch.populateContactListInMainUI(!0,a)},3e4))}WmsImplHandler.invoke(WmsContactImpl.handleGetContacts)}else if(a.mtype==MP_LOGIN){var f=a.msg;try{if(f.protocol=="gmail"||f.protocol=="yahoo"||f.protocol=="msn"){var R=f.loginid;mailsubscribers[R+f.protocol]={},mailcnt[R+f.protocol+"mailcnt"]=0}}catch(m){}WmsMPAccounts.updateobj(f.loginid,f.status,f.statusmsg,f.protocol,f.userenteredid,f.mailnotification),WmsImplHandler.invoke(WmsContactImpl.handleLogin,f.loginid,f.status,f.statusmsg,f.protocol,f.userenteredid,f.mailnotification)}else if(a.mtype==MP_LOGOUT){var f=a.msg;WmsMPAccounts.updateobj(f.loginid,WmsMPAccounts.accountstatus.LOGGEDOUT,f.statusmsg,f.protocol,f.userenteredid),WmsImplHandler.invoke(WmsContactImpl.handleLogout,f.loginid,WmsMPAccounts.accountstatus.LOGGEDOUT,f.statusmsg,f.protocol,f.userenteredid),WmsContacts.removeList(f.loginid);if(!silent){var Q=WmsContacts.isInitialised();WmsContacts.initialized=!0}}else if(a.mtype==MP_RELOGIN){var f=a.msg;WmsMPAccounts.updateobj(f.loginid,f.status,f.statusmsg,f.protocol,f.userenteredid),WmsImplHandler.invoke(WmsContactImpl.handleRelogin,f.loginid,f.status,f.statusmsg,f.protocol,f.userenteredid)}else if(a.mtype==MP_CONTACT_INF_UPDATE){var f=a.msg;WmsContacts.updatempscontactinfo(f);if(!silent){var Q=WmsContacts.isInitialised();WmsContacts.initialized=!0}}else if(a.mtype==MP_ADDBOOK){var f=a.msg;WmsContacts.updateAddressBook(f);if(!silent){var Q=WmsContacts.isInitialised();WmsContacts.initialized=!0}}else if(a.mtype==MP_PRESENCE){var f=a.msg;WmsContacts.updatempscontactlist(f);for(var t in f)WindowHandler.updateUserStatus(f[t].uname,f[t].scode,f[t].smsg,f[t].st)}else if(a.mtype==MP_CONTACT_UPDATE){var f=a.msg;f.type=="addcon"&&WmsImplHandler.invoke(WmsContactImpl.handleMPInvite,f.protocol,f.contactid,f.loginid)}else if(a.mtype==WM_NFY_USERIMGCHANGE)!!silent;else if(a.mtype==CT_NFY_APPROVAL){var f=a.msg,S=!0;f.status==WmsConstants.CONTACTSTATUS.ACCEPT?(f.status=f.scode,WmsImplHandler.invoke(WmsContactImpl.handleAccept,f.zuid,f.uname,f.dname,f.scode,f.smsg)):f.status==WMS_ONLINE?($WC.$CUtil.removeElementFromArray(WmsContacts.invitedcontactslist,f.zuid),WmsImplHandler.invoke(WmsContactImpl.notifyAccept,f.zuid,f.uname,f.dname,f.scode,f.smsg),f.status=f.scode,silent||setTimeout(function(){WmsHybridSearch.clearInvite(f)},1)):f.status==WmsConstants.CONTACTSTATUS.REQACC?(WmsImplHandler.invoke(WmsContactImpl.handleInvite,f.zuid,f.uname,f.dname,f.scode,f.smsg),silent||setTimeout(function(){WmsHybridSearch.showInvite(f)},1),S=!1):f.status==WmsConstants.CONTACTSTATUS.UNAPRD?(WmsImplHandler.invoke(WmsContactImpl.notifyInvite,f.zuid,f.uname,f.dname,f.scode,f.smsg),silent||setTimeout(function(){WmsHybridSearch.clearInvite(f)},1)):f.status==WmsConstants.CONTACTSTATUS.REJECT?(WmsImplHandler.invoke(WmsContactImpl.handleReject,f.zuid,f.uname,f.dname,f.scode,f.smsg),S=!1):f.status==WmsConstants.CONTACTSTATUS.NOCHAT?($WC.$CUtil.removeElementFromArray(WmsContacts.invitedcontactslist,f.zuid),f.status=f.scode,silent||setTimeout(function(){WmsHybridSearch.clearInvite(f)},1)):f.status==WmsConstants.CONTACTSTATUS.REMOVE?(WmsContacts.deletecontact(f.zuid),WmsImplHandler.invoke(WmsContactImpl.notifyRemove,f.zuid,f.uname,f.dname,f.scode,f.smsg),silent||setTimeout(function(){WmsHybridSearch.clearInvite(f)},1)):f.status==WmsConstants.CONTACTSTATUS.DELETE&&(WmsImplHandler.invoke(WmsContactImpl.handleDelete,f.zuid,f.uname,f.dname,f.scode,f.smsg),silent||(WmsMainUI.removeFromContactList(f.zuid),WmsContacts.deletecontact(f.zuid))),f.scode=f.status,f.dname=$WC.$CUtil.getContactName(f.zuid,f.dname),WmsContacts.updatezohocontacts(f),WmsMainUI.updateChatInvitationCount(),WmsImplHandler.invoke(WmsContactImpl.handlePresence,f.zuid,f.uname,f.dname,f.status,f.smsg)}else if(a.mtype==NFY_REQ_CSUPPORT)silent||(Self.Idle=!0,ChatBlink.start(WmsResource.getRealValue("Live_Support")+" - "+a.msg.guname),WMSUI.createLiveSupport(a.msg));else if(a.mtype==NFY_ACC_CSUPPORT){var b=a.msg;silent||WMSUI.removeLiveSupport(b.chid)}else if(a.mtype==NFY_QIT_CSUPPORT){var b=a.msg;silent||(ChatBlink.stopRepeat(),WMSUI.missedLiveSupport(b.chid))}else if(a.mtype==NFY_ENDLIVESUPPORT){if(!silent){var f=a.msg;silent||WMSUI.endLiveSupport(f)}}else if(a.mtype==CT_GUEST_REQ){if(!silent){var f=a.msg,T="creator="+myMsgObj.sender+"&ulist="+f.guid+"&title="+f.title+"&type=guestim";T=T+"&sid="+encodeURIComponent(WebMessanger.getSid()),$WC.Ajax.postRequest("createchat"+dext,T)}}else if(a.mtype==WM_USER_LANG_CHANGE){var f=a.msg;setTimeout(function(){WebMessanger.clearTicket(),WmsImplHandler.invoke(Collaboration.handleLanguageChange,f)},1)}else if(a.mtype==WM_SYSTEM_MSG){var f=a.msg;if(f.module=="feeddelete")ZohoFeedImpl.handleFeedDelete(f),ZMSGUI.deleteFeed();else if(f.module=="updatewmssettings")silent||WmsSettings.handleUpdateWmsSettings(f.data);else if(f.module==="cw_opr"){if(!silent){var h=f.data.chid,y=f.data.action,i=WindowHandler.getWinObjById(h);y==="pin"?WebMessanger.makeChatPinned(h):y==="unpin"&&WebMessanger.makeChatUnPinned(h),i?y==="min"?(i.minimize(),ChatBlink.stopRepeat()):y==="seen"?(i.makeNormal(),ChatBlink.stopRepeat()):y==="close"&&i.close():(WmsMainUI.resetUnreadCount(h),WmsRecentChats.removeFromUnreadChats(h),WmsMainUI.updateUnreadChatsCount(),WmsMainUI.updateUnreadCountInUI(h))}}else f.module==="system_msg"?f.data.key==="closeticketann"&&!silent&&WMSUI.closeTicketAnnouncement():f.module==="toursettings"&&WmsSettings.handleTourSettings(f.data.settings)}else if(a.mtype==WM_SKIPTRANS){var f=a.msg;WindowHandler.skipTranscript(f)}else if(a.mtype==SHOW_INFO)wmsUserConfig.infomsgid=a.msg.id,wmsUserConfig.infomsgprd=a.prd,WMSUI.processAnnMsg(a.msg.msg,a.msg.type);else if(+a.mtype===CT_MSG_STORAGE){var U=a.msg.opruser,i=WindowHandler.getWinObjById(a.msg.chid);U.dname=U.zuid===myMsgObj.zuid?WmsResource.getRealValue("chat.you"):util.escapeHTML(U.dname),a.msg.history==="0"?key="history.notsaved.user":key="history.saved.user",i.updateInfoMessage(WmsResource.getRealValue(key,U.dname),a.msg.time),i.updateSaveHistory(a.msg.history),i.updateSaveHistoryInUI()}else if(+a.mtype===CT_ATTACH){var h=a.msg.chid,i=WindowHandler.getWinObjById(h);i&&i.updateAttachInfo(!0)}else if(+a.mtype===WM_TICKET_MSG)WMSUI.showTicketAnnouncement(a.msg);else if(+a.mtype===PR_MSG)WmsImplHandler.invoke(Presence.handleMessage,a.msg);else if(+a.mtype===WM_DEF_STATUS){a.msg.scode==0&&(a.msg.scode=2,a.msg.smsg="Invisible"),WebMessanger.smsg=a.msg.smsg,WebMessanger.scode=a.msg.scode;if(!_WMSEMPTYBAR&&!silent)try{WmsMainUI.updateUserStatusIcon(),WmsMainUI.updateUserStatusMsg()}catch(m){}WmsImplHandler.invoke(WmsContactImpl.handleStatusMessage,a.msg.scode,a.msg.smsg)}else if(+a.mtype===CT_NFY_MUTECHAT){var i=WindowHandler.getWinObjById(a.msg.chid);i&&i.updateMuteInfo(a.msg.muteinterval),a.msg.muteinterval?WmsMainUI.setMuteStatus(a.msg.chid,!0):WmsMainUI.setMuteStatus(a.msg.chid,!1)}else if(+a.mtype===CT_BOT_LIST){var f=a.msg;WmsContacts.updateBotContacts(f),!_WMSEMPTYBAR&&!silent&&!$WC.$CUtil.getConfig("customContacts")&&WmsHybridSearch.populateContactListInMainUI(!0)}else if(+a.mtype===CT_BOT_OPR){var f=a.msg,V=f.data;if(f.operation==="add"){var W={};W[V.id]=V,WmsContacts.updateBotContacts(W)}else if(f.operation==="remove"){var h=WmsContacts.contactslist[V.id].CHID;WebMessanger.makeChatUnPinned(h),delete WmsContacts.contactslist[V.id]}WmsHybridSearch.populateContactListInMainUI(!0)}else if(+a.mtype===WM_ZTI_CROSSPRODUCT)WmsImplHandler.invoke(ZTI.handleCrossProductMessage,a.msg);else if(+a.mtype===CT_DELETED_MSG){var f=a.msg,X=f.origin_time,Y=f.sender,Z=Y+"_"+X,$=Message.getDeletedMsgInfo(f.time),i=WindowHandler.getWinObjById(f.chid),_=i&&i.ctrlcomp.querySelector('[data-msgid="'+Z+'"]');_&&(_.innerHTML=$),WmsRecentChats.updateLastMsgInfo({chid:f.chid,sender:f.sender,dname:f.dname,msg:'<span class="wms-delmsg">'+WmsResource.getRealValue("chat.info.deletemsg")+"</span>",lmtime:f.time})}},WebMessanger.mapChat=function(a){try{if(a.ctype==="5")return;var b=a.users,c=a.chid;if(a.pcount==2)var d=b[0].zuid;else var d=a.addinfo.split(":")[3];if(WebMessanger.chatmap[c]!=null&&!d&&d!=WebMessanger.chatmap[c]){delete WebMessanger.ucmap[WebMessanger.chatmap[c]],delete WebMessanger.chatmap[c];return}d&&c&&(WebMessanger.ucmap[d]=c,WebMessanger.chatmap[c]=d,WebMessanger.waitchats[d]="JOIN")}catch(e){}},WebMessanger.callClearNotification=function(){$WC.Ajax.postRequestToChat("clearnotifications.do")},WebMessanger.ClearNotificationById=function(a){var b="nid="+encodeURIComponent(a);$WC.Ajax.postRequest("clearlivenotifications"+dext,b)},WebMessanger.markAllRead=function(){$WC.Ajax.postRequestToChat("deleteuchat.do")},WebMessanger.getChatForUser=function(a){return WebMessanger.ucmap[a]},WebMessanger.loadTranscript=function(a,b,c,d,e){Message.constructAndInsertChatContent(a,d,b,e)},WebMessanger.wmsAjaxDispatcher=function(a,b,c){function o(a){var b=a.ctype,c=a.chid;if((b==="1"||b==="5"||b==="8"||b==="9"||b==="10")&&!silent)if(b!=="5"||!CustomChat.isActive(c,a.addinfo)){if(WmsChatUIImpl.isActive(c)||a.silent==="true")return;a.mprecipant&&WmsContacts.isMPUser(a.mprecipant)&&(a.sender=a.mprecipant),a.pcount=+a.pcount;if(a.pcount===2){var d=a.recipants.split(",");d.splice(d.indexOf(myMsgObj.zuid),1),a.sender=d[0];if(!WmsContacts.getDisplayName(a.sender))return}Chat.isExists(c)||WMSUI.createNewChatWindow(a);if(b==="8"&&a.users){var e=WindowHandler.getWinObjById(c);e.updateParticipantsFromJoin(JSON.parse(a.users))}}}if(a=="unreadmessage"){if(!WebMessanger.isCliqUser()&&c!=="NODATA"){var d=c.tableToRowList&&c.tableToRowList.ZohoMessages;WmsUnreadFeeds.count=d?d.length:0,WmsHybridSearch.populateRecentChats(),WmsMainUI.updateUnreadChatsCount()}}else if(a=="showunread")ZMSGUI.fillunreadChat(c.tableToRowList);else if(a=="zohomessage")ZMSGUI.fillHistory(c.tableToRowList);else if(a=="zohomsgcount"){var e=c==="NODATA"?WmsUnreadFeeds.count:JSON.parse(c);ZMSGUI.fillNavigation(e)}else if(a=="zohomessageapi")ZohoFeedImpl.handleFeedHistory(c.tableToRowList);else if(a=="zohomsgcountapi")ZohoFeedImpl.handleFeedHistoryCount(JSON.parse(c));else if(a=="zohofeedsinrange")ZohoFeedImpl.handleFeedsInRange(c.tableToRowList);else if(a=="unreadmessageapi")ZohoFeedImpl.handleUnreadFeeds(c.tableToRowList);else if(a=="mpsacnts")WmsMPAccounts.updateaccountslist(c.tableToRowList);else if(a=="onlinestatus")WmsImplHandler.invoke(Collaboration.handleIsOnline,c);else if(a=="getdefaultstatus")WebMessanger.smsg=c.smsg,WebMessanger.scode=c.scode,WmsImplHandler.invoke(WmsContactImpl.handleStatusMessage,c.scode,c.smsg);else if(a=="getcustomstatus")silent||WMSUI.populteCustomStatus(c.getRowsForTable("UserStatus")),WmsImplHandler.invoke(WmsContactImpl.handeAllStatusMessages,c.getRowsForTable("UserStatus"));else if(a!="clearcustomstatus")if(a=="addcontact"){if(!silent){if(b=="errorList"){var f="",g="",h="";for(var i in c)f=i,g=c[f];var j=WmsContacts.getDisplayName(f);!j&&typeof WmsProfileInfo!="undefined"&&(j=WmsProfileInfo.details[f]&&WmsProfileInfo.details[f].dname),g=="Same user"?h=WmsResource.getRealValue("contact.invite.sameuser",j):g=="Contact already exists"?h=WmsResource.getRealValue("contact.invite.exists",j):j&&(h=WmsResource.getRealValue("invite.invalid.id",j));var k='<div class="wms-dialog-txtcont">'+h+"</div>",l='<div class="wms-dialog-imgouter"><div class="wms-dialog-imginner"><div class="wms-dialog-img"></div></div></div>',m={imghtml:l,bodyhtml:k,focusbutton:1,operations:[{name:WmsResource.getRealValue("OK"),action:function(){WmsDialog.removeModal()}}]};WmsDialog.showModal(m)}WmsHybridSearch.populateContactListInMainUI(!0,!0)}}else if(a=="reinvitecontactbyemailid")silent||c&&(WMSUI.statusbar.innerHTML=WmsResource.getRealValue("Contact_successfully_reinvited"));else if(a=="getgroups")silent||(WmsGroups.updategrouplist(c),WmsGroups.updategroupUI());else if(a=="gettranscript")silent||ZMSGUI.populate(c);else if(a=="gettranscriptcount")silent||ZMSGUI.showChatCount(c);else if(a=="deletechat")silent||ZMSGUI.handleDeleteChat();else if(a=="deleteselectedchat")silent||ZMSGUI.handleDeleteChat();else if(a=="addmember")silent||c.errorMessage=="Error adding member"&&alert(WmsResource.getRealValue("The_email_address_you_entered_is_invaild"));else if(a==="createim"||a==="joinchat"||a==="attachsession")o(c);else if(a==="wmsupdsettings"||a==="updsettings")silent||WmsSettings.handleUpdateWmsSettings(c);else if(a==="joinchannel"){if(!silent){o(c.CHAT);var n=WindowHandler.getWinObjById(c.CHAT.chid);n.updateChannelInfo(c.CHANNEL),n.updateParticipantsFromJoin(c.CHAT.users)}}else a==="getpinnedchats"&&(silent||WmsRecentChats.updatePinnedChatList(c))},WebMessanger.presenceDispatcher=function(a,b,c){},WebMessanger.clearWaitChat=function(a){try{WebMessanger.waitchats[a]=="WAIT"&&(WebMessanger.waitchats[a]="CLEARED")}catch(b){}},WebMessanger.openUserChat=function(a,b,c,d,e){var f="autojoin=true&attach=true";f=b?f+"&type=nim":f+"&type=im",f+="&userList="+a,c&&(f+="&title="+encodeURIComponent(c)),d&&(f+="&msg="+encodeURIComponent(d)),silent||(f+="&sid="+encodeURIComponent(WebMessanger.getSid())),e&&(f+="&src="+e),$WC.Ajax.postRequestToChat("createim.do",f)},WebMessanger.openGroupChat=function(a,b,c,d){var e="autojoin=true";e+="&type=gim",e+="&gid="+a,c&&(e+="&msg="+encodeURIComponent(c)),silent||(e=e+"&sid="+encodeURIComponent(WebMessanger.getSid())),d&&(e+="&src="+d),$WC.Ajax.postRequestToChat("createim.do",e)},WebMessanger.gchat=function(a){WmsMainUI.scheduleAutoFocus();var b="type=gim&creator="+myMsgObj.sender+"&ulist="+a;silent||(b=b+"&sid="+encodeURIComponent(WebMessanger.getSid())),$WC.Ajax.postRequest("createchat"+dext,b)},WebMessanger.chat=function(a,b){WmsMainUI.scheduleAutoFocus();try{if(WebMessanger.waitchats[a]=="WAIT")return}catch(c){}WebMessanger.waitchats[a]="WAIT",setTimeout("WebMessanger.clearWaitChat('"+a+"')",5e3),ChatBlink.stopRepeat();var d=WebMessanger.ucmap[a];if(d!=undefined)WebMessanger.attachSession(d,b);else if(WmsContacts.isMPUser(a)){var e="type=mp&autojoin=true&userList="+a+"&type=mp";silent||(e=e+"&sid="+encodeURIComponent(WebMessanger.getSid())),$WC.Ajax.postRequestToChat("createim.do",e)}else{var e="type=im&autojoin=true&userList="+a;silent||(e=e+"&sid="+encodeURIComponent(WebMessanger.getSid())),b&&(e+="&src="+b),$WC.Ajax.postRequestToChat("createim.do",e)}},WebMessanger.newChat=function(a){if(WmsContacts.isMPUser(""+a)){WebMessanger.chat(a);return}WmsMainUI.scheduleAutoFocus();try{if(WebMessanger.waitchats[a]=="WAIT")return}catch(b){}WebMessanger.waitchats[a]="WAIT",setTimeout("WebMessanger.clearWaitChat('"+a+"')",5e3),ChatBlink.stopRepeat();var c="creator="+myMsgObj.sender+"&ulist="+a+"&type=nim";silent||(c=c+"&sid="+encodeURIComponent(WebMessanger.getSid())),$WC.Ajax.postRequest("createchat"+dext,c)},WebMessanger.mpchat=function(a){WmsMainUI.scheduleAutoFocus(),ChatBlink.stopRepeat();var b=WebMessanger.ucmap[a];if(b!=undefined)WebMessanger.join(b);else{var c="creator="+myMsgObj.sender+"&type=mp&ulist="+a;silent||(c=c+"&sid="+encodeURIComponent(WebMessanger.getSid())),$WC.Ajax.postRequest("createchat"+dext,c)}},WebMessanger.getZohoContacts=function(){$WC.Ajax.request("getzohocontacts"+dext)},WebMessanger.joinCollab=function(a){if(isNaN(a)||a.trim()=="")return;setTimeout(function(){var b="uname="+myMsgObj.sender+"&chid="+a;b=b+"&sid="+encodeURIComponent(WebMessanger.getSid()),$WC.Ajax.postRequest("joinchat"+dext,b)},100)},WebMessanger.attachSession=function(a,b){var c="";silent||(c="&sid="+encodeURIComponent(WebMessanger.getSid()));var d="chid="+a+c;$WC.Ajax.postRequestToChat("attachsession.do",d)},WebMessanger.join=function(a){var b="",c="";silent||(b="&sid="+encodeURIComponent(WebMessanger.getSid())),c="uname="+myMsgObj.sender+"&chid="+a+b,$WC.Ajax.postRequest("joinchat"+dext,c)},WebMessanger.joinChannel=function(a){var b="",c="";silent||(b="&sid="+encodeURIComponent(WebMessanger.getSid()));var c="chid="+a+b;c+="&attach=true",$WC.Ajax.postRequestToChat("joinchannel.do",c)},WebMessanger.approveChannel=function(a){var b=function(){WMSUI.showInfoMsg(WmsResource.getRealValue("channel.approved",[this.response.data.cn]))},c=function(){WMSUI.showErrorMSg(WmsResource.getRealValue("event.status.update.error"))};$WC.Ajax.postRequestToChat("v1/channels/"+a+"/approve",null,b,c)},WebMessanger.rejectChannel=function(a){var b=function(){WMSUI.showInfoMsg(WmsResource.getRealValue("channel.rejected",[this.response.data.cn]))},c=function(){WMSUI.showErrorMSg(WmsResource.getRealValue("event.status.update.error"))};$WC.Ajax.postRequestToChat("v1/channels/"+a+"/reject",null,b,c)},WebMessanger.handleCalendarEvents=function(a){var b="api="+a,c=function(){var a=this.response?JSON.parse(this.response)[0].objString:"";a.message?WMSUI.showInfoMsg(a.message):a.errorMessage&&WMSUI.showErrorMsg(a.errorMessage)},d=function(){WMSUI.showErrorMsg(WmsResource.getRealValue("event.status.update.error"))};$WC.Ajax.postRequestToChat("executesystemfunction.do",b,c,d)},WebMessanger.fetchAndShowChannelMembers=function(a,b){var c="chid="+a,d=function(){var c=this.response?JSON.parse(this.response)[0].objString:"",d=WindowHandler.getWinObjById(a);c&&(c.length!=1||c[0].zuid!=WebMessanger.zuid)&&(d.updateParticipantsFromJoin(c),b?d.populateGroupMembers():d.autocompletediv&&(Commands.hideLoadingIcon(a),WMSUI.atMentions.init(a,d.composer)))};$WC.Ajax.requestToChat("getchanneljoinedusers.do",c,d)},WebMessanger.fetchTeamChannelMembers=function(a){var b=WmsChannels.get(a),c=[];b.scid.forEach(function(a){WmsChannels.team_memberslist[a]||c.push(a)});if(c.length){var d="groupid="+c.join(","),e=function(){var b=JSON.parse(this.response)[0].objString;for(var c in b)WmsChannels.insertTeamMemberslist(c,b[c]);var d=WindowHandler.getWinObjById(a);d&&(Commands.hideLoadingIcon(a),WMSUI.atMentions.init(a,d.composer))};$WC.Ajax.requestToChat("getgroupmembers.do",d,e)}},WebMessanger.joinChannelWithUID=function(a,b){var c="v1/channels/"+a+"/join",d;b&&(d="attach=true&sid="+encodeURIComponent(WebMessanger.getSid()));var e=function(){var a=JSON.parse(this.response);WebMessanger.wmsAjaxDispatcher("joinchannel","object",a.data)};$WC.Ajax.postRequestToChat(c,d,e)},WebMessanger.quit=function(a){if(isNaN(a)||a.trim()=="")return;$WC.Ajax.postRequest("quitchat"+dext,"close=true&uname="+myMsgObj.sender+"&sid="+encodeURIComponent(WebMessanger.getSid())+"&chid="+a)},WebMessanger.verifyUserStatus=function(a,b){var c="czuid="+a+"&ccode="+b;$WC.Ajax.postRequest("verifystatus"+dext,c)},WebMessanger.skipTranscript=function(a){var b="chid="+encodeURIComponent(a)+"&dname="+encodeURIComponent(WebMessanger.getNickName())+"&skiptrans="+!0;$WC.Ajax.postRequest("skiptranscript"+dext,b)},WebMessanger.enableTranscript=function(a){var b="chid="+encodeURIComponent(a)+"&dname="+encodeURIComponent(WebMessanger.getNickName())+"&skiptrans="+!1;$WC.Ajax.postRequest("skiptranscript"+dext,b)},WebMessanger.setIdle=function(){function d(){var f=setTimeout(function(){$WC.Ajax.postRequest(b,c,e,d)},5e3);a++,a===3&&clearTimeout(f)}function e(){if(WebMessanger.scode==undefined&&WebMessanger.smsg==undefined){var a=WebMessanger.syncStatusMessage();a!=null?(WebMessanger.scode=a.scode,WebMessanger.smsg=a.smsg):(WebMessanger.scode=1,WebMessanger.smsg=WebMessanger.statusarr[WebMessanger.scode])}else WebMessanger.smsg==undefined&&WebMessanger.scode!=undefined&&(WebMessanger.smsg=WebMessanger.statusarr[WebMessanger.scode]);WMSUI.changedscode=WebMessanger.scode,WMSUI.changedsmsg=WebMessanger.smsg,WebMessanger.scode=4;if(WebMessanger.smsg=="Available"||WebMessanger.smsg=="Busy"){var b="Idle";WebMessanger.smsg=b}WebMessanger.isIdle=!0,WebMessanger.setIdleStatusInClient(WebMessanger.isIdle)}WmsImplHandler.invoke(WmsUIImpl.handleDocumentIdle);var a=0,b="useridle"+dext,c="sid="+encodeURIComponent(WebMessanger.getSid());$WC.Ajax.postRequest(b,c,e,d)},WebMessanger.setActive=function(){function d(){var f=setTimeout(function(){$WC.Ajax.postRequest(b,c,e,d)},5e3);a++,a===3&&clearTimeout(f)}function e(){WMSUI.changedscode!=undefined&&WMSUI.changedsmsg!=undefined?(WebMessanger.scode=WMSUI.changedscode,WebMessanger.smsg=WMSUI.changedsmsg):(WMSUI.changedscode=1,WebMessanger.scode=1),WebMessanger.smsg==undefined&&(WebMessanger.smsg=WebMessanger.statusarr[WebMessanger.scode]),WebMessanger.isIdle=!1,WebMessanger.setIdleStatusInClient(WebMessanger.isIdle)}var a=0,b="useractive"+dext,c="sid="+encodeURIComponent(WebMessanger.getSid());$WC.Ajax.postRequest(b,c,e,d)},WebMessanger.setTimeZoneOffset=function(a){_TZOFFSET=a},WebMessanger.getTranscript=function(a,b,c){function o(a){var c=Message.getScrollHeight(b),e=Message.getScrollTop(b);Message.restoreScrollPosition(b,c,e),a=a||this.responseText.slice(0,-1),a=JSON.parse("["+a+"]");if(a.length>0){if(h||j=="insert"){if(h){if(f||g){var i=f-1,l=g,n=a.some(function(a){return a.time==i}),o=a.some(function(a){return a.time==l});if(n){var p=[];a[0].mode==="more"&&a.shift(),a.forEach(function(a){(a.mode==="more"||a.time>f)&&p.push(a)}),a=p}o&&(a=a.filter(function(a){return a.time<g}))}j==="insert"&&m!==m.parentNode.firstChild&&a[0].mode==="more"&&a.shift()}var q=a[a.length-1];q.mode==="more"&&(q=a[a.length-2]);if(g===+q.time){var r=a.pop();r.mode==="more"&&a.pop()}if(a[a.length-1]&&a[a.length-1].mode==="more"){var s=a[a.length-1];s.mode="morebutton"}}WebMessanger.loadTranscript(a,d,j,b,m);if(h){var t=decodeURIComponent(h).split("|")[2];Message.glowBubble(t,Message.getScrollableParent(b))}}m&&$WC.$CUtil.removeElement(m),k&&Message.sendmsg(d,k)}function p(){if(k){Message.sendmsg(d,k);return}f-=1;if(!h&&!f&&!g)var a="true";var c=[{messagetype:Message.types.TRANSERR,msg:{prevtime:f,nexttime:g,mentionmsgid:h,latestchunk:a}}];WebMessanger.loadTranscript(c,d,j,b,m),m&&$WC.$CUtil.removeElement(m)}var d=a.chid,e=a.partial,f=a.fromtime,g=a.totime,h=a.mentionmsgid,i=a.salesiqchat,j=a.type,k=a.msgarr,l=a.lineslimit||50;if(h)var m=b.querySelector('[data-marker="'+h+'"]');else f?m=b.querySelector('[data-marker="'+(f-1)+'"]'):g?m=b.querySelector('[data-marker="'+g+'"]'):b.querySelector('[data-marker="latestchunk"]')&&(m=b.querySelector('[data-marker="latestchunk"]'));var n="gettranscriptfromrsasjson.do";a="chid="+d+"&tzoffset="+_TZOFFSET+"&lang="+WebMessanger.language+"&ccode="+WebMessanger.countrycode,c&&(n="gettranscriptasjsonforweb.do",a="chid="+d+"&tzoffset="+_TZOFFSET,h&&(a+="&mentionmsgid="+encodeURIComponent(h))),typeof e=="boolean"&&(a+="&partial="+e),WebMessanger.getDateFormat()!==undefined&&(a+="&dateformat="+encodeURIComponent(WebMessanger.getDateFormat())),a+="&lineslimit="+l,f&&(a+="&fromtime="+f),g&&(a+="&totime="+g);if(!i)return $WC.Ajax.requestToChat(n,a,o,p);typeof WmsUIImpl!="undefined"&&(a={chatid:d},WmsImplHandler.invoke(WmsUIImpl.getTranscript,a,o,p))},WebMessanger.renderTranscript=function(a,b){ZMSGUI.viewChatTranscript(b,a)},WebMessanger.sendMessage=function(a,b,c){var d="chid="+a+"&sender="+myMsgObj.sender+"&msg="+encodeURIComponent(b)+"&dname="+encodeURIComponent(WebMessanger.getNickName())+"&sid="+encodeURIComponent(WebMessanger.getSid());try{c!=undefined&&c!=""&&(d+="&style="+encodeURIComponent(c))}catch(e){}$WC.Ajax.postRequest("sendmessage"+dext,d),util.consoleWarn("WebMessanger.sendMessage javascript method is deprecated and it will be removed in upcoming release. Use WebMessanger.sendMessage java api instead")},WebMessanger.sendFormattedMessage=function(a,b,c,d,e,f,g,h){function k(a){_WMS_REQLOG.indexOf(a)!==-1&&_WMS_REQLOG.splice(_WMS_REQLOG.indexOf(a),1)}var i,j="chid="+a+"&msg="+encodeURIComponent(b)+"&dname="+encodeURIComponent(WebMessanger.getNickName())+"&sid="+encodeURIComponent(WebMessanger.getSid())+"&msgid="+c;h&&(j+="&repliedmsguid="+encodeURIComponent(h)),_WMS_REQLOG.push(c),Message.isMentionMsg(b)&&WMSUI.atMentions.isLocationAllowedForMentionedBots(a)&&(i=!0),Commands.getCommandId(b)&&Commands.isCommandMsg(b)&&(e=Commands.getCommandId(b),f=f?f:"&commandid="+e,g=!0,Commands.isLocationAllowedForExecution(e)&&(i=!0));var l=function(){k(c);var b=JSON.parse(this.response)[0].objString;if(b.dreResponse)if(b.dreResponse.output&&b.dreResponse.output.msg){var d=WindowHandler.getWinObjById(a);d.updateMessage(b.dreResponse.output)}else b.dreResponse.status==="Failure"&&!$WC.$CUtil.isEmpty(b.dreResponse.resumeUrl)&&Commands.showAuthenticationPrompt(b.dreResponse,a)};if(d&&d.length)var l=function(){k(c),Message.sendmsg(a,d)};var m=function(){k(c);var b=WebMessanger.zuid+"_"+c,e=WindowHandler.getWinObjById(a),f=e.ctrlcomp;WMSUI.handleMessageFailure(f,b),e.scrollDisplay(!0,f),d&&d.length&&Message.sendmsg(a,d)};if(g)var l=function(){k(c);var b=JSON.parse(this.response)[0].objString;Commands.showResponse(a,e,b.dreResponse)},m=function(){k(c),Commands.removeProgressBar(a)};f&&(j+=f),i?$WC.Ajax.postRequestToChatWithLocation("sendofficechatmessage.do",j,l,m):$WC.Ajax.postRequestToChat("sendofficechatmessage.do",j,l,m)},WebMessanger.muteChat=function(a,b,c){var d="chatid="+a+"&mute="+c;b!==null&&(d+="&time="+b);var e=function(){var b=WindowHandler.getWinObjById(a);b&&(b.showErrorMsg(WmsResource.getRealValue("chat.mute.failed")),b.updateMuteInfo(!c))};$WC.Ajax.postRequestToChat("mutechat.do",d,"",e)},WebMessanger.serverup=function(a){WebMessanger.hideBanner(),typeof AcsApi!="undefined"&&WmsImplHandler.invoke(AcsApi.handleServerUP),WmsImplHandler.invoke(Collaboration.serverup,a),WebMessanger.systemdown=!1,!_WMSEMPTYBAR&&!silent&&(WmsChatCache.removeAll(),WindowHandler.restoreChats(),WmsMainUI.updateUserName(),!WebMessanger.registerAnnonUser&&!WebMessanger.isCliqUser()&&WebMessanger.getUnreadFeeds(),Commands.clear(),WmsMainUI.updateChatInvitationCount()),WmsAVChat.setWMSConnectionStatus(!0)},WebMessanger.serverdown=function(a,b){WebMessanger.systemdown=!0,WmsImplHandler.invoke(Collaboration.serverdown),a?(clearTimeout(retryregistertimer),WebMessanger.showBanner(a,b)):iswmsframemonitorrunning||WebMessanger.showBanner(),WindowHandler.resetAllTypingStatus(),WmsContacts.removeInvitations(),WmsAVChat.setWMSConnectionStatus(!1)},WebMessanger.feedhistory=function(){ZMSGUI.launchHistory()},WebMessanger.enableSST=function(){},WebMessanger.enableTokenPairAuth=function(){this.tokenpairauth=!0,this.authtype=10},WebMessanger.documentready=function(){WmsContacts.init(),WindowHandler.init(),WmsGroups.init()},WebMessanger.setCSRFParamName=function(a){_WMSCFPARAMNAME=a,WmsConstants.WMSCFPARAMNAME=a,$WC.$CUtil.setConfig({WMSCFPARAMNAME:_WMSCFPARAMNAME})},WebMessanger.setCSRFTokenCookieName=function(a){_WMSCFCOOKIENAME=a,WmsConstants.WMSCFCOOKIENAME=a,$WC.$CUtil.setConfig({WMSCFCOOKIENAME:_WMSCFCOOKIENAME})},WebMessanger.setChatCSRFCookieName=function(a){_CHATCFTOKEN=a,WmsConstants.CHATCFCOOKIENAME=a,$WC.$CUtil.setConfig({CHATCFCOOKIENAME:_CHATCFTOKEN})},WebMessanger.setChatCSRFParamName=function(a){_CHATCFPARAMNAME=a,$WC.$CUtil.setConfig({CHATCFPARAMNAME:_CHATCFPARAMNAME})},WebMessanger.setBarSettingsValue=function(a){for(var b in a){if(b==undefined&&a[b]==undefined)continue;for(var c in WmsSettings.bsettings)b==c&&(WmsSettings.bsettings[c]=a[b])}var d=document.createElement("script");d.type="text/javascript";var e=this.rebrand?this.rebrand+"_":"";if(this.loadlocalfiles){var f="",g=document.querySelector('script[src*="wms.js"]');if(g){var h=g.src.split("/");f=h[0]+"//"+h[2]}d.src=f+"/"+_WMSCONT+"/javascript/resource/"+e+WebMessanger.language+".js"}else{var i=window.location.protocol,j=i==="https:"?wmsjsversion+"_https":wmsjsversion;d.src=i+"//"+this.jsstaticdomain+"/ichat/"+j+"/js/resource/"+e+WebMessanger.language+".js"}EventsUtil.attachonload.call(d,function(){Smiley.init(),WmsSettings.populate()}),document.body.appendChild(d)};var wmsUserConfig={};WebMessanger.setUserConfig=function(a){wmsUserConfig=a},WebMessanger.appendGlobalSearch=function(){if(!_isGSearchAppended){var a=document.getElementsByTagName("head");if(!a||a.length==0)a=[],a[0]=document.createElement("head"),document.insertBefore(doc.body,a[0]);if(WMSUI.globalsearchenabled&&wmsUserConfig.gsv!=undefined){var b=document.createElement("link");b.rel="stylesheet",b.type="text/css",b.href=window.location.protocol+"//"+this.cssstaticdomain+"/zohosearch/"+wmsUserConfig.gsv+"/css/gshome.css",a[0].appendChild(b);var c=document.createElement("script");c.defer=!0,c.type="text/javascript",WMSUI.hidegsicon==0&&EventsUtil.attachonload.call(c,function(){document.getElementById("wmsglobalsearch").style.display="block"}),c.src=window.location.protocol+"//"+this.jsstaticdomain+"/zohosearch/"+wmsUserConfig.gsv+"/js/gshome.js",a[0].appendChild(c)}_isGSearchAppended=!0}},WebMessanger.unescapeHTML=function(a){if(a)return a.replace(/&gt;/g,">").replace(/&lt;/g,"<").replace(/&quot;/g,'"').replace(/&#39;/g,"'").replace(/&amp;/g,"&").replace(/&#x2F;/g,"/").replace(/&#x27;/g,"'")},WebMessanger.setChatTitle=function(a,b,c){var d="chid="+a+"&uname="+WebMessanger.zuid;b&&(d+="&title="+encodeURIComponent(b));var e=function(){var b=JSON.parse(this.response)[0].objString,c=b.cntid,d=b.title;b.module==="contact_rename"?WmsContacts.contactslist[c].DNAME=d:b.module==="user_rename"&&(WmsOrgContacts.contactslist[c].DNAME=d);var e=WindowHandler.getWinObjById(a);e.setTitle(d),WmsRecentChats.updateTitle(a,d)},f=function(){var b=WindowHandler.getWinObjById(a),d=b.partcount>2?"chat.settitle.error":"contact.rename.errormsg";b.showErrorMsg(WmsResource.getRealValue(d)),b.setTitle(c)};$WC.Ajax.postRequestToChat("settitle.do",d,e,f)},WebMessanger.inviteToChannel=function(a,b){var c=WmsChannels.get(a).oc_id,d="ulist="+encodeURIComponent(b);$WC.Ajax.postRequestToChat("v1/channels/"+c+"/invite",d)},WebMessanger.addMember=function(a,b,c){var d=c,e=b.split(",");for(var f=0,g=c.length-1;f<g;f++)b.indexOf(WmsContacts.getEmailId(d[f]))==-1&&c.splice(f,1);var h=[],i=[];for(var f=0,j=c.length-1;f<=j;f++)WmsContacts.isMPUser(c[f])?h.push(c[f]):i.push(c[f]);var k=function(){var a=JSON.parse(this.response);a[0].objString.ERRCODE==2005&&WMSUI.showErrorMsg(WmsResource.getRealValue("useradd.not.groupadmin"))};if(h.length!=0){var l="chid="+a+"&ulist="+encodeURIComponent(h)+"&type=mp",m={"X-XHR-exception":"true"};$WC.Ajax.postRequestToChat("addmember.do",l,null,k,null,null,m)}if(i.length!=0){var l="chid="+a+"&ulist="+encodeURIComponent(i),m={"X-XHR-exception":"true"};$WC.Ajax.postRequestToChat("addmember.do",l,null,k,null,null,m)}},WebMessanger.deleteMember=function(a,b){var c="chid="+a+"&ulist="+encodeURIComponent(b),d={"X-XHR-exception":"true"},e=function(){var a=JSON.parse(this.response);a[0].objString.ERRCODE==2005&&WMSUI.showErrorMsg(WmsResource.getRealValue("userdelete.not.groupadmin"))};if($WC.$CUtil.isChannelChid(a)){var f=WmsChannels.get(a),g=f.oc_id;c="ulist="+encodeURIComponent(b),d={"X-XHR-exception":"true","X-ZCSRF-TOKEN":$WC.$CUtil.getCSRF()},$WC.Ajax.postRequestToChat("v1/channels/"+g+"/deletemember",c,null,null,null,null,d)}else $WC.Ajax.postRequestToChat("deletemember.do",c,null,e,null,null,d)},WebMessanger.setZIndex=function(a){this.setzindex=a;var b=isNaN(a)?a:+a+1;$WC.$CUtil.setConfig({zindex:b})},WebMessanger.getZIndex=function(){return this.setzindex},WebMessanger.disableWMSStatus=function(){this.wmsservicestatus=!1},WebMessanger.isServiceStatus=function(){return this.wmsservicestatus},WebMessanger.setServiceStatus=function(a){WMSUI.setServiceStatus(a)},WebMessanger.disableNetworkDownBanner=function(){this.disablenetworkdownbanner=!0},WebMessanger.clearTicket=function(a){var b;a!=undefined&&(b="lgtticket="+a),$WC.Ajax.request("cleariamcache"+dext,b)},WebMessanger.isPresenceEnabled=function(){return getWmsConfig()&!0||getWmsConfig()&!0?!0:!1},WebMessanger.makeChatPinned=function(a){var b=WindowHandler.getWinObjById(a);b&&b.updatePinnedInfo(!0),WmsRecentChats.updatePinnedChat(a,!0),WmsHybridSearch.populateRecentChats()},WebMessanger.makeChatUnPinned=function(a){var b=WindowHandler.getWinObjById(a);b&&b.updatePinnedInfo(!1),WmsRecentChats.updatePinnedChat(a,!1),WmsHybridSearch.populateRecentChats()},WebMessanger.removeLiveChat=function(a){var b=util.indexOf(WebMessanger.liveChats,a);b!=-1&&WebMessanger.liveChats.splice(b,1)},WebMessanger.setHistoryStorage=function(a,b){var c="option="+a+"&chid="+b;$WC.Ajax.postRequest("sethistorystorage.do",c)},WebMessanger.pinChat=function(a,b){var c="";if($WC.$CUtil.isChannelChid(a)&&!$WC.$CUtil.isBotChid(a)){var d=WmsChannels.get(a);c="pin="+b+"&channelid="+d.oc_id,$WC.Ajax.postRequestToChat("markchannelaspinned.do",c)}else c="pin="+b+"&chatid="+a,$WC.Ajax.postRequestToChat("markchataspinned.do",c)},WebMessanger.leaveChannel=function(a){var b="chid="+a;$WC.Ajax.postRequestToChat("leavechannel.do",b)},WebMessanger.makeChannelRead=function(a){var b="chid="+a;$WC.Ajax.postRequestToChat("makechannelread.do",b)},WebMessanger.closeTicketAnnouncement=function(){var a="sendsystemmsg.do?key=closeann";$WC.Ajax.request(a),WMSUI.closeTicketAnnouncement()},WebMessanger.turnOffChat=function(){util.checkSessionConfig("CHAT")&&(_WMSCONFIG&=~WMSSessionConfig.CHAT,_isGSearchAppended=!1,WmsChatCache.removeAll(),WmsSessionStorage.removeItem("wms_openchats"),WindowHandler.exist=[],WebMessanger.sid=null,WebMessanger.allprdchatdeactivated===!1&&WebMessanger.chatdeactivated===!1&&WmsSettings.updateWmsSettings("bchatsettings","deact",null,"add"),WebMessanger.clearAndRegister())},WebMessanger.turnOnChat=function(a,b){util.checkSessionConfig("CHAT")||(_WMSCONFIG|=WMSSessionConfig.CHAT,_isGSearchAppended=!1,WebMessanger.sid=null,WebMessanger.allprdchatdeactivated===!0?WmsSettings.updateWmsSettings("bchatsettings","deact","ALL","rem",a,b):WebMessanger.chatdeactivated===!0&&WmsSettings.updateWmsSettings("bchatsettings","deact",null,"rem",a,b),WebMessanger.clearAndRegister())},WebMessanger.unPauseChat=function(a,b){var c=function(){var b=JSON.parse(this.responseText)[0].objString;WmsSettings.handleUpdateWmsSettings(b);if(WebMessanger.chatdeactivated===!0){var c=function(){var b=JSON.parse(this.responseText)[0].objString;WmsSettings.handleUpdateWmsSettings(b),WmsImplHandler.invoke(a)};WebMessanger.turnOnChat(c,d)}else WmsImplHandler.invoke(a)},d=function(){WmsImplHandler.invoke(b)};WebMessanger.turnOnChat(c,d)},WebMessanger.isOrgUser=function(){return WebMessanger.orgid&&WebMessanger.orgid!=="-1"?!0:!1},WebMessanger.isTazEnabled=function(){return WebMessanger.isCliqUser()&&WmsSettings.adminsettings.features&&WmsSettings.adminsettings.features.Taz&&WmsSettings.adminsettings.features.Taz.enabled},WebMessanger.isRegistered=function(){return WebMessanger.registered},WebMessanger.systemApiHandler=function(a,b){var c=a.split("/"),d=c[0],e=c.slice(1);switch(d){case"joinchannel":var f=e[0];WmsChannels.isJoinedChannel(f)===!1&&WebMessanger.joinChannel(f);break;case"startchat":var g=e[0],h=WindowHandler.getWinObjById(g);h?h.highlight():WebMessanger.openUserChat(g,null,null,null,"systemapi");break;case"audiocall":var g=e[0];WMSUI.makeAudioCall(g);break;case"videocall":var g=e[0];WMSUI.makeVideoCall(g);break;case"videobroadcast":var i=e[0];b.sender!==WebMessanger.zuid&&window.open(_WMSCHATURL+"joinprimetime.do?key="+encodeURIComponent(i));break;case"invite":var g=e[0];WMSUI.inviteMember(g);break;case"approvechannel":var f=e[0];WebMessanger.approveChannel(f);break;case"rejectchannel":var f=e[0];WebMessanger.rejectChannel(f);break;case"acceptevent":WebMessanger.handleCalendarEvents(a);break;case"declineevent":WebMessanger.handleCalendarEvents(a);break;case"locationpermission":var j=$WC.$CUtil.getConfig("LOCATION_INFO").PERMISSIONSTATE;if(j==="granted")WMSUI.showInfoMsg(WmsResource.getRealValue("functions.location.granted"));else{if(typeof navigator!="undefined"&&navigator.geolocation!==undefined){var k=function(a){navigator.permissions.query({name:"geolocation"}).then(function(a){$WC.$CUtil.getConfig("LOCATION_INFO").PERMISSIONSTATE=a.state,a.state==="granted"?WMSUI.showInfoMsg(WmsResource.getRealValue("functions.location.allowed")):WMSUI.showInfoMsg(WmsResource.getRealValue("functions.location.allowed.once"))})},l=function(a){WMSUI.showErrorMsg(WmsResource.getRealValue("functions.location.denied.now")),j===undefined&&($WC.$CUtil.getConfig("LOCATION_INFO").PERMISSIONSTATE="denied")};navigator.geolocation.getCurrentPosition(k,l)}j==="denied"&&WMSUI.showErrorMsg(WmsResource.getRealValue("functions.location.denied"))}}},WebMessanger.disableSmartChatKeyboardShortcut=function(){WebMessanger.smartchatshortcutdisabled=!0},WebMessanger.replaceChatWindowHeaderHTML=function(a,b){var c=WindowHandler.getWinObjById(a);c&&(c.headernode.innerHTML=b)},WebMessanger.closeAnnBanner=function(){WMSUI.clearBannerAndUpdate()},WebMessanger.setFrameOrigin=function(a){WebMessanger.frameorigin=a||window.location.origin},WebMessanger.updateTourSettings=function(a,b){var c="settings="+a+"&exitdetails="+b;$WC.Ajax.postRequestToChat("updatetoursettings.do",c)},WebMessanger.useLongPolling=function(){_WMS_LP="true"},WebMessanger.startAudioCall=function(a,b){b=typeof b=="boolean"?b:WebMessanger.ismediacallnewwindow,WMSUI.makeAudioCall(a,b)},WebMessanger.startVideoCall=function(a,b){b=typeof b=="boolean"?b:WebMessanger.ismediacallnewwindow,WMSUI.makeVideoCall(a,b)},WebMessanger.rePopulateCustomContacts=function(){WmsHybridSearch.populateCustomContactListInMainUI()},WebMessanger.localPush=push,WebMessanger.updateContactMenuCount=function(a){WmsMainUI.updateChatInvitationCount(a)};var wmsjsversion="v282";(function(){function f(a,b,c){var d=b=="blur"||b=="focus";a.element.addEventListener(b,c,d)}function g(a){a.preventDefault(),a.stopPropagation()}function h(b){return a?a:b.matches?(a=b.matches,a):b.webkitMatchesSelector?(a=b.webkitMatchesSelector,a):b.mozMatchesSelector?(a=b.mozMatchesSelector,a):b.msMatchesSelector?(a=b.msMatchesSelector,a):b.oMatchesSelector?(a=b.oMatchesSelector,a):(a=n.matchesSelector,a)}function i(a,c,d){if(c=="_root")return d;if(a===d)return;if(h(a).call(a,c))return a;if(a.parentNode)return b++,i(a.parentNode,c,d)}function j(a,b,c,e){d[a.id]||(d[a.id]={}),d[a.id][b]||(d[a.id][b]={}),d[a.id][b][c]||(d[a.id][b][c]=[]),d[a.id][b][c].push(e)}function k(a,b,c,e){if(!d[a.id])return;if(!b){for(var f in d[a.id])d[a.id].hasOwnProperty(f)&&(d[a.id][f]={});return}if(!e&&!c){d[a.id][b]={};return}if(!e){delete d[a.id][b][c];return}if(!d[a.id][b][c])return;for(var g=0;g<d[a.id][b][c].length;g++)if(d[a.id][b][c][g]===e){d[a.id][b][c].splice(g,1);break}}function l(a,c,f){if(!d[a][f])return;var g=c.target||c.srcElement,h,j,k={},l=0,m=0;b=0;for(h in d[a][f])d[a][f].hasOwnProperty(h)&&(j=i(g,h,e[a].element),j&&n.matchesEvent(f,e[a].element,j,h=="_root",c)&&(b++,d[a][f][h].match=j,k[b]=d[a][f][h]));c.stopPropagation=function(){c.cancelBubble=!0};for(l=0;l<=b;l++)if(k[l])for(m=0;m<k[l].length;m++){if(k[l][m].call(k[l].match,c)===!1){n.cancel(c);return}if(c.cancelBubble)return}}function m(a,b,c,e){function h(a){return function(b){l(f,b,a)}}if(!this.element)return;a instanceof Array||(a=[a]),!c&&typeof b=="function"&&(c=b,b="_root");var f=this.id,g;for(g=0;g<a.length;g++){if(e){k(this,a[g],b,c);continue}(!d[f]||!d[f][a[g]])&&n.addEvent(this,a[g],h(a[g])),j(this,a[g],b,c)}return this}function n(a,b){if(!(this instanceof n)){for(var d in e)if(e[d].element===a)return e[d];return c++,e[c]=new n(a,c),e[c]}this.element=a,this.id=b}var a,b=0,c=0,d={},e={};n.prototype.on=function(a,b,c){return m.call(this,a,b,c)},n.prototype.off=function(a,b,c){return m.call(this,a,b,c,!0)},n.matchesSelector=function(){},n.cancel=g,n.addEvent=f,n.matchesEvent=function(){return!0},typeof module!="undefined"&&module.exports&&(module.exports=n),window.Gator=n})();var WmsMainUI={};WmsMainUI._populatestatus={contactlist:!0,grouplist:!0,chatlist:!0},WmsMainUI.populate=function(){function a(){WindowHandler.chatbar=document.getElementById("wms-chatwindowcontainer"),WmsMainUI.maincontainer=document.getElementById("wmstoolbar"),WmsMainUI.menucontainer=document.getElementById("wms-menucontainer"),WmsMainUI.menubar=document.getElementById("wms_menubar"),WmsMainUI.menusearchcontainer=document.getElementById("wms_menu_searchcontainer"),WmsMainUI.statuscontainer=document.getElementById("wms_cstatus"),WmsMainUI.settingsdropdown=document.getElementById("wms_menu_settingsdropdown"),WmsMainUI.settingsdropdownicon=document.getElementById("wms_settings_dropdownicon"),WmsMainUI.settingscontainer=document.getElementById("wms_settingscontainer"),WmsMainUI.menulistcontainer=document.getElementById("wms_menu_listcontainer"),WmsMainUI.settingsnavigator=document.getElementById("wms_settingsnavigator"),WmsMainUI.menu=document.getElementById("wms_menu"),WmsMainUI.menuheader=document.getElementById("wms_menu_header"),WmsMainUI.searchdiv=document.getElementById("wms_menu_search"),WmsMainUI.usernamediv=document.getElementById("wms_menu_username"),WmsMainUI.statusmsgdiv=document.getElementById("wms_menu_userstatus"),WmsMainUI.statusiconwrapper=document.getElementById("wms_menu_userstatusiconwrapper"),WmsMainUI.chatlist=document.getElementById("wms_menu_chatlist"),WmsMainUI.defaultcontactlist=document.getElementById("wms_menu_contactlist_def"),WmsMainUI.searchrescontactlist=document.getElementById("wms_menu_contactlist_searchres"),WmsMainUI.defaultchatlist=document.getElementById("wms_menu_chatlist_def"),WmsMainUI.searchreschatlist=document.getElementById("wms_menu_chatlist_searchres"),WmsMainUI.defaultgrouplist=document.getElementById("wms_menu_grouplist_def"),WmsMainUI.searchresgrouplist=document.getElementById("wms_menu_grouplist_searchres"),WmsMainUI.unreadchatcntdiv=document.getElementById("wms_menu_unreadchats_cnt"),WmsMainUI.invitationscntdiv=document.getElementById("wms_menu_invitations_cnt"),WmsMainUI.servicestatusdiv=document.getElementById("wmsstatusbar"),WmsMainUI.contactdetailsdiv=document.getElementById("wms_contactdetails"),WmsMainUI.notificationholder=document.getElementById("wmsnotificationholder")}function b(){Gator(WmsMainUI.menubar).on("click","[data-menuname]",function(a){if(this.getAttribute("data-menuname")=="chat"&&ChatTour.isTourNotificationShown()){var b={welcome:{title:"",elemid:'id="wms_menubar"',align:"horizontal",content:"tourinfo.intro",position:"fixed",icon:"wms_chattour_icon"},contacts:{title:"Contacts",elemid:'data-title="Contacts"',align:"horizontal",content:"contacts.welcomemessage",position:"fixed",icon:"wms_contacts_icon"},channels:{title:"menuname.channelsandgroups",elemid:'data-title="Channels"',align:"horizontal",content:"tourinfo.channels",position:"fixed",icon:"wms_channels_icon"},chats:{title:"menuname.chats",elemid:'data-title="Chats"',align:"horizontal",content:"tourinfo.chats",icon:"wms_chats_icon"},cliq:{pointer:"none",align:"center",sethtml:'<div class="wms-hysearch wms-hvalign wms_chattour_container"><div data-operation="close" class="wms_chattour_close"></div><img src="https://img.zohostatic.com/ichat/v282_https/images/bar/chatbar_onboard.png" class="wms_chattour_img"><div class="wms_chattour_info">{{CONTENT}}</div><div><button class="wms_chattour_button" data-operation="visitcliq">{{TEXT}}</button></div></div>',replacetext:{CONTENT:"tourinfo.onboarding",TEXT:"visit.cliq"}}},c=WmsRecentChats.getRecentChatTime(),d=!1,e=WebMessanger.isCliqUser(),f;if(c){var g=432e6,h=(new Date).getTime()-g;c>h&&(d=!0)}if(e===!1&&d===!1){f=[b.welcome,b.contacts,b.channels,b.chats,b.cliq];if(WebMessanger.isOrgUser()===!1||$WC.$CUtil.getConfig("channels")=="disable")f=[b.welcome,b.contacts,b.chats,b.cliq]}e===!0&&d===!1&&(f=[b.welcome,b.contacts,b.channels,b.chats]),e===!1&&d===!0&&(f=[b.cliq]);if(f){ChatTour.init(f,document.getElementById("wmstoolbar"));return}}WmsMainUI.toggleMenu(this.getAttribute("data-menuname"),a),WmsMainUI.updateUnreadChatsCount()}),Gator(WmsMainUI.menubar).on("mouseenter",function(){WmsPinnedChats.last_fetched_time===null&&WebMessanger.getPinnedChats()}),Gator(WmsMainUI.settingscontainer).on("click","[data-navigator]",function(){WmsMainUI.settingsdropdownicon.setAttribute("data-settings","false"),WmsMainUI.settingsdropdown.style.display="block",WmsMainUI.settingsdropdownicon.setAttribute("class","wms_settings_close"),WmsMainUI.toggleSettings()}),Gator(WmsMainUI.settingsdropdown).on("click","[data-operation]",function(){var a=this.getAttribute("data-operation");a==="wms_menu_settings"?(WmsMainUI.settingsdropdown.style.display="none",WmsMainUI.settingsdropdownicon.setAttribute("class","wms_settings_close"),WmsMainUI.toggleSettings()):a==="wms_menu_status"?(WmsMainUI.settingsdropdown.style.display="none",WmsMainUI.settingsdropdownicon.setAttribute("class","wms_settings_close"),WmsMainUI.toggleStatus()):a==="wms_menu_chathistory"?(WmsMainUI.settingsdropdown.style.display="none",WmsMainUI.settingsdropdownicon.setAttribute("class","wms_settings"),WmsMainUI.settingsdropdownicon.setAttribute("data-settings","true"),ZMSGUI.showChatHistory()):a==="wms_menu_feedhistory"?(WmsMainUI.settingsdropdown.style.display="none",WmsMainUI.settingsdropdownicon.setAttribute("class","wms_settings"),WmsMainUI.settingsdropdownicon.setAttribute("data-settings","true"),ZMSGUI.launchHistory()):a==="wms_menu_pendinginvitations"&&(WmsMainUI.settingsdropdown.style.display="none",WmsMainUI.settingsdropdownicon.setAttribute("class","wms_settings"),WmsMainUI.settingsdropdownicon.setAttribute("data-settings","true"),WmsMainUI.showPendingInvitations())}),Gator(WmsMainUI.searchdiv).on("keydown",function(a){if(a.keyCode===WmsConstants.KEYCODES.ESCAPE)WmsMainUI.hideMenu();else{if(a.keyCode===WmsConstants.KEYCODES.TAB&&a.shiftKey)return WindowHandler.moveFocus("",!0),!1;if(a.keyCode===WmsConstants.KEYCODES.TAB)return WindowHandler.moveFocus(),!1}}),Gator(WmsMainUI.searchdiv).on("keyup",function(a){WmsHybridSearch.handleEvent(a),$WC.$CUtil.loadOriginalImage(WmsHybridSearch.getNode("searchresultdiv",WmsHybridSearch.getCurrentModule()))}),Gator(WmsMainUI.searchdiv).on("focus",function(){WindowHandler.lastViewed=-1}),Gator(WmsMainUI.menulistcontainer).on("click","[data-id],[data-operation],[data-menuredirect],[data-retry],[data-heading]",function(a){if(this.getAttribute("data-operation"))WmsContacts.handleInviteOperation(this);else if(this.getAttribute("data-retry"))WmsOrgContacts.fetchFromServer("","","suggestionui");else if(this.getAttribute("data-menuredirect")){var b=this.getAttribute("data-menuredirect");(b!="channel"||!!WebMessanger.isOrgUser())&&WmsMainUI.showMenu(b)}else if(this.getAttribute("data-heading")){var c=this.getAttribute("data-heading"),d=this.getAttribute("data-show");WmsMainUI.collapseMenu(c,d)}else{var e=getEventTarget(a);if(e.getAttribute("data-zcprofileid")&&!this.getAttribute("data-pc"))return;WmsHybridSearch.handleSelection(this),$WC.$CUtil.removeElement(this.querySelector("[data-unreadcnt]"));var f=this.getAttribute("data-id");$WC.$CUtil.isChannelChid(f)&&WmsRecentChats.checkPresence(f,WmsUnreadChats.channellist)&&(WebMessanger.makeChannelRead(f),WmsRecentChats.removeFromUnreadChats(f))}WmsProfileInfo.hide()}),Gator(WmsMainUI.maincontainer,WindowHandler.chatbar).on("click","[data-zcprofileid]",function(a){WmsMainUI.handleProfileClick(this,a)}),Gator(document).on("click","[custom_message]",function(a){$WC.CustomMsgUI.handleMoreMessage(a)}),Gator(WmsMainUI.contactdetailsdiv).on("click","[data-operation]",function(){WmsMainUI.handleProfileActions(this)}),Gator(WmsMainUI.contactdetailsdiv).on("mouseout",function(a){WmsMainUI.handleProfileMouseOut(this,a)}),Gator(WmsMainUI.menuheader).on("click","[data-minimize]",function(){WmsMainUI.hideMenu()}),Gator(WmsMainUI.menuheader).on("click","[data-settings]",function(){if(this.getAttribute("data-settings")==="true"){this.setAttribute("data-settings","false");var a='<div id="wms_menu_chathistory" data-operation="wms_menu_chathistory" class="wms_menu_settingsdropdown_item"><span class="wms_menu_userstatusiconwrapper"><div class="wms_chathistory_icon"></div></span><div class="wms_menu_settingsname wms-hvalign">'+WmsResource.getRealValue("Chat_History")+"</div>"+"</div>"+'<div id="wms_menu_status" data-operation="wms_menu_status" class="wms_menu_settingsdropdown_item">'+'<span class="wms_menu_userstatusiconwrapper">'+'<div class="wms_statuschange_icon"></div>'+"</span>"+'<div class="wms_menu_settingsname wms-hvalign">'+WmsResource.getRealValue("user.status.change")+"</div>"+"</div>"+'<div id="wms_menu_settings" data-operation="wms_menu_settings" class="wms_menu_settingsdropdown_item">'+'<span class="wms_menu_userstatusiconwrapper">'+'<div class="wms_settings_icon"></div>'+"</span>"+'<div class="wms_menu_settingsname wms-hvalign">'+WmsResource.getRealValue("Settings")+"</div>"+"</div>";WebMessanger.isTazEnabled()||(a+='<div id="wms_menu_feedhistory" data-operation="wms_menu_feedhistory" class="wms_menu_settingsdropdown_item"><span class="wms_menu_userstatusiconwrapper"><div class="wms_feedhistory_icon"></div></span><div class="wms_menu_settingsname wms-hvalign">'+WmsResource.getRealValue("Feed_History")+"</div>"+"</div>"),WmsContacts.pendinginvcontactslist.length&&(a+='<div id="wms_menu_pendinginvitations" data-operation="wms_menu_pendinginvitations" class="wms_menu_settingsdropdown_item"><span class="wms_menu_userstatusiconwrapper"><div class="wms_pendinginv_icon"></div></span><div class="wms_menu_settingsname wms-hvalign">'+WmsResource.getRealValue("chat.pending.invitations")+"</div>"+"</div>"),WmsMainUI.settingsdropdown.innerHTML=a,WmsMainUI.settingsdropdown.style.display="block",this.setAttribute("class","wms_settings_close")}else this.setAttribute("data-settings","true"),WmsMainUI.settingsdropdown.style.display="none",this.setAttribute("class","wms_settings"),WmsMainUI.hideStatus();WmsMainUI.hideSettings()}),Gator(WmsMainUI.menuheader).on("click","[data-statuseditor='false']",function(){WmsMainUI.showStatusEditor()}),Gator(WmsMainUI.menuheader).on("blur","[data-statuseditor]",function(){WmsMainUI.statusmsgdiv.setAttribute("data-statuseditor","false"),$WC.$CUtil.setInnerText(WmsMainUI.statusmsgdiv,WebMessanger.unescapeHTML(WebMessanger.smsg))}),Gator(WmsMainUI.settingscontainer).on("change","input[type=checkbox]",function(a){WmsMainUI.updateSettings(a)}),Gator(WmsMainUI.usernamediv).on("click",function(){var a=0;return function(){a++,a>=3&&(WebMessanger.postDebugInfoToServer(!0),a=0),setTimeout(function(){a=0},3e3)}}()),document.getElementById("wmsglobalsearch")&&Gator(document.getElementById("wmsglobalsearch")).on("click",function(){zgssearch.toggleGlobalsearch()}),_WMSEMPTYBAR||($WC.$CUtil.addEvent(WmsMainUI.defaultchatlist,"scroll",$WC.$CUtil.debounce(WmsHybridSearch.checkScrollAndloadMoreChatlist,null,300)),$WC.$CUtil.addEvent(WmsMainUI.defaultcontactlist,"scroll",$WC.$CUtil.loadImageWithDebounce(WmsMainUI.defaultcontactlist)),$WC.$CUtil.addEvent(WmsMainUI.searchrescontactlist,"scroll",$WC.$CUtil.loadImageWithDebounce(WmsMainUI.searchrescontactlist)),$WC.$CUtil.addEvent(WmsMainUI.defaultgrouplist,"scroll",$WC.$CUtil.loadImageWithDebounce(WmsMainUI.defaultgrouplist)),$WC.$CUtil.addEvent(WmsMainUI.searchresgrouplist,"scroll",$WC.$CUtil.loadImageWithDebounce(WmsMainUI.searchresgrouplist)),$WC.$CUtil.addEvent(WmsMainUI.defaultchatlist,"scroll",$WC.$CUtil.loadImageWithDebounce(WmsMainUI.defaultchatlist)),$WC.$CUtil.addEvent(WmsMainUI.searchreschatlist,"scroll",$WC.$CUtil.loadImageWithDebounce(WmsMainUI.searchreschatlist)))}document.getElementById("wmstoolbar")&&$WC.$CUtil.removeElement(document.getElementById("wmstoolbar"));var c='<div id="wms_menubar" class="wms_menubar"><span data-menuname="chat" class="wms-menubutton wms_chatsicon" data-title="'+WmsResource.getRealValue("menuname.chats")+'" title="'+WmsResource.getRealValue("menuname.chats")+'"><span id="wms_menu_unreadchats_cnt" class="wms_menu_chat_unreadcnt"></span></span>'+'<span data-menuname="channel" class="wms-menubutton wms_groupicon" data-title="'+WmsResource.getRealValue("menuname.channelsandgroups")+'" title="'+WmsResource.getRealValue("menuname.channelsandgroups")+'"></span>'+'<span data-menuname="contact" class="wms-menubutton wms_contacticon" data-title="'+WmsResource.getRealValue("Contacts")+'" title="'+WmsResource.getRealValue("Contacts")+'"><span id="wms_menu_invitations_cnt" class="wms_menu_chat_unreadcnt"></span></span>'+"</div>",d='<span class="wms_bar_movablehint" id="wmsbarmovablehint" onclick="WmsHybridSearch.toggleUI()">'+WmsResource.getRealValue("hint.smartchat")+"</span>",e='<div class="wms-chatwindowcontainer" id="wms-chatwindowcontainer">'+d+"</div>",f='<div id="wms_menu_header" class="wms_menuheader"><span id="wms_menu_userstatusiconwrapper" class="wms_menu_userstatusiconwrapper"><img src="'+_WMSPHOTOSERVER+"/file?fs=thumb"+$WC.$CUtil.nocachefix(!0)+'"/></span><div id="wms_menu_username" class="wms_menu_username wms-truncate-ellipsis"></div><span data-minimize=true class="wms_minimizeicon wms_menu_minimize"></span><div id="wms_menu_userstatus" data-statuseditor="false" class="wms_menu_userstatus wms-truncate-ellipsis"></div><span id="wms_settings_dropdownicon" class="wms_settings" data-settings="true"></span></div>',g='<div id="wms_menu_settingsdropdown" data-settingsdropdown="true" class="wms_menu_settingsdropdown"></div>',h='<div id="wms_cstatus" data-showstatus="false" class="wmspd1" style="display:none; overflow-x: hidden;"></div>',i='<div id="wms_menu_searchcontainer" class="wms_menu_searchcontainer"><span class="wms_menu_searchicon wms_searchicon"></span><input id="wms_menu_search" type="text" class="wms_menu_searchinput" placeholder="'+WmsResource.getRealValue("search.commontitle")+'">'+"</div>",j='<div id="wms_settingscontainer" style="display:none" data-showsettings="false"><div id="wms_settings_header" class="wms_settings_header"><span id="wms_settingsnavigator" data-navigator="settings" class="wms_settingsnavigator wms_menu_floatl"></span><span class="wms_settings_menu">'+WmsResource.getRealValue("Settings")+"</span></div>"+'<div id="wms_settings_general" class="wms_settings_general"><span>'+WmsResource.getRealValue("settings.general")+"</span>"+'<div class="wms_settings_chckbx"><span data-type="custom" class="wms_settings_customcheckbox"></span><input id="wms_settings_pausechat" type="checkbox" class="wms_settings_checkbox"/><label class="wms_settings_label" for="wms_settings_pausechat">'+WmsResource.getRealValue("chat.pause")+"</label></div>"+"</div>"+'<div id="wms_settings_soundnotification" class="wms_settings_general"><span>'+WmsResource.getRealValue("notification.sound")+"</span>"+'<div class="wms_settings_chckbx"><span data-type="custom" class="{{SOUNDSETTING}}"></span><input {{SOUNDCHECK}} id="wms_settings_sound" data-setting="sound" type="checkbox" class="wms_settings_checkbox"/><label class="wms_settings_label" for="wms_settings_sound">'+WmsResource.getRealValue("notification.message.new")+"</label></div>"+"</div>"+'<div id="wms_settings_visualnotification" class="wms_settings_general"><span>'+WmsResource.getRealValue("notification.desktop")+"</span>"+'<div class="wms_settings_chckbx"><span data-type="custom" class="{{VMESSAGE}}"></span><input {{VMESSAGECHECK}} id="wms_settings_visual_msg" data-setting="vmessage" type="checkbox" class="wms_settings_checkbox"/><label class="wms_settings_label" for="wms_settings_visual_msg">'+WmsResource.getRealValue("notification.message.new")+"</label></div>"+'<div class="wms_settings_chckbx"><span data-type="custom" class="{{VUSTATUS}}"></span><input {{VUSTATUSCHECK}} id="wms_settings_visual_statuschange" data-setting="vustatus" type="checkbox" class="wms_settings_checkbox"/><label class="wms_settings_label" for="wms_settings_visual_statuschange">'+WmsResource.getRealValue("notification.status.change")+"</label></div>"+"</div>"+"</div>";j=$WC.template.replace(j,{SOUNDSETTING:WmsSettings.sound==="1"?"wms_settings_customcheckboxsel":"wms_settings_customcheckbox",VMESSAGE:WmsSettings.vmessage==="1"?"wms_settings_customcheckboxsel":"wms_settings_customcheckbox",VUSTATUS:WmsSettings.vustatus==="1"?"wms_settings_customcheckboxsel":"wms_settings_customcheckbox",SOUNDCHECK:WmsSettings.sound==="1"?"checked":"",VMESSAGECHECK:WmsSettings.vmessage==="1"?"checked":"",VUSTATUSCHECK:WmsSettings.vustatus==="1"?"checked":""});var k='<div id="wms-pasteCapture" class="wms-pastediv" contenteditable="true"></div>',l='<div id="wms_menu" class="wms-menu">'+f+g+h+i+j+'<div id="wms_menu_listcontainer" class="wms_menu_listcontainer">'+'<div data-menuname="chat" id="wms_menu_chatlist"><div id="wms_menu_chatlist_def" class="wms_menu_chatlist_def"><div id="wms_welcome_recentchatsmsg"><div class="wms-welcome-img wms-welcome-recentchatsimg wms-halign"></div><div class="wms-welcome-msg wms-halign">'+WmsResource.getRealValue("recentchats.welcomemessage",['<span data-menuredirect="contact">'+WmsResource.getRealValue("chat.contact")+"</span>",'<span data-menuredirect="channel">'+WmsResource.getRealValue("chat.channel")+"</span>"])+'</div></div></div><div id="wms_menu_chatlist_searchres" class="wms_menu_chatlist_searchres"></div></div>'+'<div data-menuname="channel" id="wms_menu_grouplist"><div id="wms_menu_grouplist_def" class="wms_menu_grouplist_def"><div class="wms-welcome-img wms-welcome-channelsimg wms-halign"></div><div class="wms-welcome-msg wms-halign">'+WmsResource.getRealValue("channels.welcomemessage",'<a class="wms_welcome_msg_href" target="blank" href="'+_WMSCHATURL+'officechat/index.do#createchannel">'+WmsResource.getRealValue("channel.create.new")+"</a>")+'</div></div><div id="wms_menu_grouplist_searchres" class="wms_menu_grouplist_searchres"></div></div>'+'<div data-menuname="contact" id="wms_menu_contactlist"><div id="wms_menu_contactlist_def" class="wms_menu_contactlist_def"><div class="wms-welcome-img wms-welcome-contactsimg wms-halign"></div><div class="wms-welcome-msg wms-halign">'+WmsResource.getRealValue("contacts.welcomemessage")+'</div></div><div id="wms_menu_contactlist_searchres" class="wms_menu_contactlist_searchres"></div></div>'+"</div></div>",m='<div class="wms-turnoffinfo" id="chatturnoffinfo" style="display: none;">'+WmsResource.getRealValue("chat.paused")+' <a style="cursor: pointer;" onclick="WebMessanger.turnOnChat()">'+WmsResource.getRealValue("chat.unpause")+"</a></div>",n='<div id="wms_incomingcall"class="wms_incomingcall"><div id="wms_caller_container" class="wms_caller_container"><img id="wms_callerimg" class="wms_caller_img"></img><span id="wms_calltype" class="wms_calltype wms-halign"></span><span id="wms_callername" class="wms_callername wms-halign"></span><div class="wms_videocall_buttons_list wms_incomingcall_buttons"><div id="wms_answercall_button"class="wms_videocall_button wms_answercall_button" call-action="acceptcall" title="'+$WC.$CUtil.getConfig("Resource").getRealValue("mediacall.incoming.accept")+'"></div>'+'<div class="wms_videocall_button wms_replymsg_button" call-action="replycall" style="display: none;"></div>'+'<div id="wms_rejectcall_button" class="wms_videocall_button wms_rejectcall_button" call-action="rejectcall" title="'+$WC.$CUtil.getConfig("Resource").getRealValue("mediacall.incoming.reject")+'"></div></div></div>'+"</div>",o='<div id="wmsglobalsearch" title="'+WmsResource.getRealValue("GS_Search_across_zoho")+'" class="wms-gssearch" style="display: block;"><span class="wms_searchicon"></span></div>',p='<div id="wmsnotificationholder" class="wms-nh"></div>',q='<div id="wmsstatusbar" class="wmsstatusbar"></div>',r='<div id="wms_contactdetails" class="wms_contactdetails"></div>',s=k+'<div id="wms-menucontainer" class="wms-menucontainer">'+l+c+"</div>";_WMSEMPTYBAR&&(s=k+'<div id="wms-menucontainer" class="wms-menucontainer" style="width:0px;"></div>',e='<div class="wms-chatwindowcontainer" id="wms-chatwindowcontainer"></div>'),s+=p,WMSUI.globalsearchenabled&&WMSUI.hidegsicon==0&&(s+=o),s+=q,s+=m,s+=n,s+=e;var t=util.createElement("div","wms-mainui","wmstoolbar");t.style.zIndex=WebMessanger.setzindex,t.innerHTML=$WC.template.replace(s),document.body.appendChild(t);var u=document.getElementById("wms_contactdetails");u&&$WC.$CUtil.removeElement(u),document.body.insertAdjacentHTML("beforeend",r),a(),b(),WmsMainUI.applyChatBarOptions(),$WC.$CUtil.getConfig("channels")=="disable"&&WmsMainUI.removeChannelMenu();if($WC.$CUtil.getConfig("customContacts")){var v=$WC.$CUtil.getConfig("customContacts"),w=WmsMainUI.menubar.querySelector('[data-menuname="contact"]');v.title&&w.setAttribute("data-title",v.title)}WmsMainUI.contactdetailsdiv.style.zIndex=isNaN(WebMessanger.setzindex)?"1":+WebMessanger.setzindex+3,!_WMSEMPTYBAR&&!WebMessanger.registerAnnonUser&&setTimeout(function(){WebMessanger.appendGlobalSearch()},1),typeof WmsUIImpl!="undefined"&&WmsUIImpl.UIReady()},WmsMainUI.applyChatBarOptions=function(){var a=WmsImplHandler.invokeSynchronously(WmsUIImpl.getChatBarOptions),b={};b.customContacts=WmsImplHandler.invokeSynchronously(WmsUIImpl.customContactsConfig),$WC.$CUtil.setConfig(a),$WC.$CUtil.setConfig(b)},WmsMainUI.handleSettings=function(a,b){var c=b.parentNode.querySelector('[data-type="custom"]');b&&a=="1"?c.setAttribute("class","wms_settings_customcheckboxsel"):c.setAttribute("class","wms_settings_customcheckbox")},WmsMainUI.showStatusEditor=function(){var a=$WC.$CUtil.getInnerText(WmsMainUI.statusmsgdiv);WmsMainUI.statusmsgdiv.innerHTML='<textarea data-editor="true" id="wms_menu_statuseditor" class="wms_menu_userstatus_textarea"></textarea>',document.getElementById("wms_menu_statuseditor").value=a,document.getElementById("wms_menu_statuseditor").focus(),Gator(WmsMainUI.menuheader).on("keydown","[data-editor='true']",function(a){if(a.keyCode===WmsConstants.KEYCODES.ENTER||a.keyCode===WmsConstants.KEYCODES.ESCAPE){WmsMainUI.statusmsgdiv.setAttribute("data-statuseditor","false");var b=a.target.value;a.keyCode===WmsConstants.KEYCODES.ESCAPE||!b?$WC.$CUtil.setInnerText(WmsMainUI.statusmsgdiv,WebMessanger.unescapeHTML(WebMessanger.smsg)):WebMessanger.smsg!==b?WMSUI.handleStatusChange(b,a):$WC.$CUtil.setInnerText(WmsMainUI.statusmsgdiv,WebMessanger.unescapeHTML(b))}}),WmsMainUI.statusmsgdiv.setAttribute("data-statuseditor","true")},WmsMainUI.updateSettings=function(a){var b=getEventTarget(a),c=b.getAttribute("id");if(c==="wms_settings_pausechat")WebMessanger.chatdeactivated?WebMessanger.turnOnChat():WebMessanger.turnOffChat();else if(c==="wms_settings_sound")WMSUI.toggleSound();else if(c==="wms_settings_visual_msg"||c==="wms_settings_visual_statuschange"){var d=b.getAttribute("data-setting");WMSUI.reqNotificationPermAndToggle(d)}},WmsMainUI.updateUserName=function(){WmsMainUI.usernamediv.setAttribute("title",WebMessanger.nname),$WC.$CUtil.setInnerText(WmsMainUI.usernamediv,WebMessanger.nname)},WmsMainUI.updateUserStatusIcon=function(){var a={0:"offline",1:"available",2:"offline",3:"busy",4:"idle"},b=WebMessanger.scode;if(b){var c=a[b];WmsMainUI.statusiconwrapper.className="wms_menu_userstatusiconwrapper wms_badge_statusicon_"+c}},WmsMainUI.updateUserStatusMsg=function(){WmsMainUI.statusmsgdiv.setAttribute("title",WebMessanger.unescapeHTML(WebMessanger.smsg)),$WC.$CUtil.setInnerText(WmsMainUI.statusmsgdiv,WebMessanger.unescapeHTML(WebMessanger.smsg))},WmsMainUI.updateContactHTML=function(a,b){var c=a.USERID,d=WmsMainUI.defaultcontactlist.querySelector('[data-id="'+c+'"]')||WmsMainUI.searchrescontactlist.querySelector('[data-id="'+c+'"]');if(d){var e=d.previousSibling,f=d.parentNode;$WC.$CUtil.removeElement(d);var g=WmsHybridSearch.generateContactHtml(a.USERID,a.DNAME,a.STATUSMSG,"",b);e?e.insertAdjacentHTML("afterend",g):f.insertAdjacentHTML("afterbegin",g)}},WmsMainUI.updateChatHTML=function(a){var b=WmsMainUI.chatlist.querySelector('[data-userid="'+a+'"]')||WmsMainUI.searchreschatlist.querySelector('[data-userid="'+a+'"]');if(b){var c=b.getAttribute("data-id"),d=WmsRecentChats.get(c),e=WmsHybridSearch.generateImageHtml(c,WmsHybridSearch.constants.CHAT,d);$WC.$CUtil.removeElement(b.firstChild),b.insertAdjacentHTML("afterbegin",e)}},WmsMainUI.toggleMenu=function(a){var b=WmsMainUI.menubar.querySelector("[data-menuname="+a+"]");b.getAttribute("data-selected")==="true"?WmsMainUI.hideMenu():WmsMainUI.showMenu(a)},WmsMainUI.hideMenu=function(){if(WmsMainUI.menubar){var a=WmsMainUI.menubar.querySelector("[data-selected=true]");a&&a.setAttribute("data-selected","false"),WmsMainUI.menu.style.display="none",WmsMainUI.settingsdropdown.style.display="none",WmsMainUI.updateUnreadChatsCount()}},WmsMainUI.removeChannelMenu=function(){if(WmsMainUI.menubar){var a=WmsMainUI.menubar.querySelector('[data-menuname="channel"]');a&&WmsMainUI.menubar.removeChild(a)}},WmsMainUI.toggleSettings=function(){var a=WmsMainUI.settingscontainer.getAttribute("data-showsettings");a==="true"?WmsMainUI.hideSettings():(WmsMainUI.menusearchcontainer.style.display="none",WmsMainUI.menulistcontainer.style.display="none",WmsMainUI.settingscontainer.style.display="block",WmsMainUI.settingscontainer.setAttribute("data-showsettings","true"))},WmsMainUI.toggleStatus=function(){var a=WmsMainUI.statuscontainer.getAttribute("data-showstatus");a==="true"?WmsMainUI.hideStatus():(WebMessanger.getAllStatusMessage(),WmsMainUI.statuscontainer.style.display="block",WmsMainUI.statuscontainer.setAttribute("data-showstatus","true"))},WmsMainUI.hideSettings=function(){WmsMainUI.menusearchcontainer.style.display="block",WmsMainUI.menulistcontainer.style.display="block",WmsMainUI.settingscontainer.style.display="none",WmsMainUI.settingscontainer.setAttribute("data-showsettings","false")},WmsMainUI.hideStatus=function(){WmsMainUI.statuscontainer.style.display="none",WmsMainUI.statuscontainer.setAttribute("data-showstatus","false"),WmsMainUI.settingsdropdownicon.setAttribute("class","wms_settings"),WmsMainUI.settingsdropdownicon.setAttribute("data-settings","true")},WmsMainUI.collapseMenu=function(a,b){if(a==="suggestions"){var c={};b==="false"?c.suggestions="suggestions_heading":c.suggestions="show_suggestions",WmsHybridSearch.populateContactListInMainUI(!0,c)}else{var d=document.getElementById("wms_menu_chatlist_"+a),e=document.getElementById("wms_menu_uccount_"+a),f="c"+a,g=b=="true"?"1":"0";WmsSettings[f]=g,WmsSettings.updateWmsSettings("bchatsettings",f,g),b=="true"?(d.previousSibling.setAttribute("data-show",!1),e.style.display="none",d.style.display="block"):(d.previousSibling.setAttribute("data-show",!0),e.childNodes.length&&(e.style.display="block"),d.style.display="none")}},WmsMainUI.showMenu=function(a){function b(a,b){var c=a.querySelector("[data-menuname="+b+"]");c.setAttribute("data-selected","true");var d=$WC.$CUtil.convertToArray(a.children);d.forEach(function(a){a!==c&&a.setAttribute("data-selected","false")})}WmsMainUI.hideSettings(),WmsMainUI.settingsdropdownicon.setAttribute("class","wms_settings"),WmsMainUI.settingsdropdownicon.setAttribute("data-settings","true"),WmsMainUI.settingsdropdown.style.display="none",WmsMainUI.resetToDefaultUI(),WmsMainUI.menu.style.display="block",b(WmsMainUI.menubar,a),b(WmsMainUI.menulistcontainer,a),a==="contact"?($WC.$CUtil.getConfig("customContacts")?WmsMainUI.searchdiv.setAttribute("placeholder",$WC.$CUtil.getConfig("customContacts").searchTitle?$WC.$CUtil.getConfig("customContacts").searchTitle:WmsResource.getRealValue("Search_Contacts")):WmsMainUI.searchdiv.setAttribute("placeholder",WmsResource.getRealValue("Search_Contacts")),setTimeout(function(){$WC.$CUtil.getConfig("customContacts")?WmsHybridSearch.populateCustomContactListInMainUI():WmsHybridSearch.populateContactListInMainUI(),$WC.$CUtil.loadOriginalImage(WmsMainUI.defaultcontactlist)},1)):a==="channel"?(WmsMainUI.searchdiv.setAttribute("placeholder",WmsResource.getRealValue("search.channelsandgroups")),setTimeout(function(){$WC.$CUtil.getConfig("isOrgUser")()&&$WC.$CUtil.getConfig("channels")!="disable"&&WmsChannels.initChannels(),WmsHybridSearch.populateGroupResultInMainUI()},1)):a==="chat"&&(WmsRecentChats.initRecentChats(),$WC.$CUtil.getConfig("isOrgUser")()&&$WC.$CUtil.getConfig("channels")!="disable"&&WmsChannels.initChannels(),!$WC.$CUtil.getConfig("isOrgUser")()||$WC.$CUtil.getConfig("channels")=="disable"?WmsMainUI.searchdiv.setAttribute("placeholder",WmsResource.getRealValue("search.contactsandchats")):WmsMainUI.searchdiv.setAttribute("placeholder",WmsResource.getRealValue("search.commontitle"))),WmsMainUI.searchdiv.value="",WmsMainUI.searchdiv.focus()},WmsMainUI.updateLoadingForPinnedChats=function(a){var b=document.getElementById("wms_menu_chatlist_def"),c=document.getElementById("wms_menu_chatlist_searchres"),d=c&&c.style.display=="block"?!0:!1,e=document.getElementById("wms_menu_chatlist_loading");if(a)!e&&!d&&(b.insertAdjacentHTML("afterend",'<div id="wms_menu_chatlist_loading" class="wms_menu_chatlist_def" style="display: block;"></div>'),b.style.display="none",WmsHybridSearch.updateLoadingStatus(document.getElementById("wms_menu_chatlist_loading"),WmsConstants.REQSTATUS.SUCCESS,"chat"),WmsHybridSearch.updateLoadingStatus(document.getElementById("wms_menu_chatlist_loading"),WmsConstants.REQSTATUS.LOADING,"chat"));else if(e){$WC.$CUtil.removeElement(e),d||(b.style.display="block");var f=b.scrollHeight>b.clientHeight;f&&WmsHybridSearch.updateLoadingStatus(WmsHybridSearch.getNode("defaultresultdiv",3),WmsConstants.REQSTATUS.LOADING,"chat")}},WmsMainUI.resetToDefaultUI=function(){WmsMainUI.searchdiv.value="",WmsMainUI.searchrescontactlist.style.display="none",WmsMainUI.searchreschatlist.style.display="none",WmsMainUI.searchresgrouplist.style.display="none",WmsMainUI.defaultcontactlist.style.display="block",WmsMainUI.defaultchatlist.style.display="block",WmsMainUI.defaultgrouplist.style.display="block",WmsHybridSearch.resetHover()},WmsMainUI.setRePopulateStatus=function(a,b){WmsMainUI._populatestatus[a]=b},WmsMainUI.decideRepopulate=function(a){return WmsMainUI._populatestatus[a]},function(){var a={};WmsMainUI.incrementUnreadCount=function(b){a[b]||(a[b]={count:0}),a[b].count||(a[b].count=0),a[b].count++},WmsMainUI.resetUnreadCount=function(b){a[b]?a[b].count=0:a[b]={count:0}},WmsMainUI.getUnreadCount=function(b){return a[b]?a[b].count||0:0},WmsMainUI.getUnreadChatsCount=function(){var b=0;for(var c in a)a[c].count&&a[c].mutestatus!==!0&&b++;return b},WmsMainUI.setUnreadCount=function(b,c){a[b]?a[b].count=c:a[b]={count:c}},WmsMainUI.resetAllUnreadCount=function(){a={}},WmsMainUI.setMuteStatus=function(b,c){a[b]?a[b].mutestatus=c:a[b]={mutestatus:c}},WmsMainUI.getMuteStatus=function(b){return a[b]&&a[b].mutestatus?!0:!1},WmsMainUI.setZuidForPrivateChat=function(b,c){a[b]?a[b].privatechatzuid=c:a[b]={privatechatzuid:c}},WmsMainUI.getZuidForPrivateChat=function(b){if(a[b]&&a[b].privatechatzuid)return a[b].privatechatzuid}}(),WmsMainUI.updateUnreadCountInUI=function(a){var b=WmsMainUI.getUnreadCount(a)||"",c=WmsMainUI.getMuteStatus(a),d=WmsMainUI.defaultchatlist&&WmsMainUI.defaultchatlist.querySelector('[data-id="'+a+'"]>[data-unreadcount]');d&&(b=b>99?"99+":b,$WC.$CUtil.setInnerText(d,b),b?d.style.display="block":d.style.display="none");if(c){var e=WmsMainUI.defaultchatlist.querySelector('[data-id="'+a+'"]');e&&e.setAttribute("data-muted","true")}},WmsMainUI.updateUnreadChatsCount=function(){if(!_WMSEMPTYBAR&&!silent){var a=WmsRecentChats.getChatIdList(WmsPinnedChats.chatlist),b=WmsRecentChats.getChatIdList(WmsUnreadChats.chatlist),c={pinnedchats:{chatlist:WmsPinnedChats.chatlist,ignorelist:[]},unreadchats:{chatlist:WmsUnreadChats.chatlist,ignorelist:a},recentchats:{chatlist:WmsRecentChats.chatlist,ignorelist:a.concat(b)}};for(var d in c){var e=document.getElementById("wms_menu_uccount_"+d),f=WmsMainUI.getUnreadCountForMenu(c[d].chatlist,c[d].ignorelist)||"";e&&($WC.$CUtil.setInnerText(e,f),f?e.parentNode.getAttribute("data-show")=="true"&&(e.style.display="block"):e.style.display="none")}var g=WmsUnreadFeeds.count+WmsMainUI.getUnreadChatsCount();g?(ChatTour.removeTourNotifier(),$WC.$CUtil.setInnerText(WmsMainUI.unreadchatcntdiv,g),WmsMainUI.unreadchatcntdiv.style.display="block"):($WC.$CUtil.setInnerText(WmsMainUI.unreadchatcntdiv,""),WmsMainUI.unreadchatcntdiv.style.display="none")}},WmsMainUI.getUnreadCountForMenu=function(a,b){var c=0;return a.forEach(function(a){WmsMainUI.getUnreadCount(a.CHATID)&&!WmsMainUI.getMuteStatus(a.CHATID)&&b.indexOf(a.CHATID)==-1&&(c+=1)}),c},WmsMainUI.updateChatInvitationCount=function(a){var b=$WC.$CUtil.getConfig("customContacts");b||(a=$WC.$CUtil.getObjectLength(WmsContacts.invitedcontactslist)),a?($WC.$CUtil.setInnerText(WmsMainUI.invitationscntdiv,a),WmsMainUI.invitationscntdiv.style.display="block"):($WC.$CUtil.setInnerText(WmsMainUI.invitationscntdiv,""),WmsMainUI.invitationscntdiv.style.display="none")},WmsMainUI.showPendingInvitations=function(){ZMSGUI.createOverlay();var a=document.createElement("div");a.id="wms_pendinginv_container",a.className="wms-hvalign",a.style.display="block",a.style.zIndex=$WC.$CUtil.getConfig("zindex");var b='<div class="wms_pendinginv_header">'+WmsResource.getRealValue("chat.pending.invitations")+'<span data-operation="close" class="wms_invitations_close"></span></div><div class="wms_pendinginv_container">';if(WmsContacts.pendinginvcontactslist.length)for(var c=0;c<WmsContacts.pendinginvcontactslist.length;c++){var d=WmsContacts.pendinginvcontactslist[c];b+='<div data-id="'+d+'" class="wms_pendinginv_content"><input data-operation="reject" type="button" value="Reject" class="wms_pendinginv_rejctbtn"><input data-operation="accept" type="button" value="Accept" class="wms_pendinginv_acptbtn"><span class="wms_pendinginv_img wms-valign-mid-block"><img src="'+WmsContacts.getUserPhoto(d)+'"></span><div class="wms_pendinginv_name wms-truncate-ellipsis wms-valign-mid-block">'+$WC.$CUtil.getContactName(d,"",!0)+"</div></div>"}else b+='<div class="wms_pendinginv_infocontent"><div class="wms_pendinginv_infotxt">'+WmsResource.getRealValue("chat.pendinginv.infotxt")+"</div></div>";b+="</div>",a.innerHTML=b,document.body.appendChild(a),Gator(a).on("click","[data-operation]",function(a){var b=getEventTarget(a),c=b.getAttribute("data-operation");c==="close"?ZMSGUI.hidependinginv():c==="reject"?(WMSUI.rejectContact(d,d,"inv"),WmsMainUI.hidePendingInvitations(b.parentNode),$WC.$CUtil.removeElementFromArray(WmsContacts.pendinginvcontactslist,d)):c==="accept"&&(WmsContacts.accept("zoho",d,$WC.$CUtil.getConfig("zuid")),WmsMainUI.hidePendingInvitations(b.parentNode),$WC.$CUtil.removeElementFromArray(WmsContacts.pendinginvcontactslist,d))})},WmsMainUI.hidePendingInvitations=function(a){WmsContacts.pendinginvcontactslist.length===1?ZMSGUI.hidependinginv():$WC.$CUtil.removeElement(a)},WmsMainUI.removeFromContactList=function(a){var b=WmsMainUI.defaultcontactlist.querySelector('[data-id="'+a+'"]'),c=WmsMainUI.searchrescontactlist.querySelector('[data-id="'+a+'"]');$WC.$CUtil.removeElement(b),$WC.$CUtil.removeElement(c)},WmsMainUI.handleProfileActions=function(a){var b=a.getAttribute("data-operation"),c=a.closest("[data-id]"),d=c.getAttribute("data-id"),e=WmsContacts.getDisplayName(d)||WmsProfileInfo.details[d].dname;if(b=="delete"){var f=WmsResource.getRealValue("chat.contact.deleteinfo",[e]),g='<div class="wms-dialog-txtcont">'+util.escapeHTML(f)+"</div>",h='<div class="wms-dialog-imgouter"><div class="wms-dialog-imginner"><div class="wms-dialog-img"></div></div></div>',i={imghtml:h,bodyhtml:g,focusbutton:1,operations:[{name:WmsResource.getRealValue("Delete"),action:function(){WmsContacts.remove("zoho",d),WmsDialog.removeModal()}},{name:WmsResource.getRealValue("Cancel"),classname:"wms-dialog-rejectbtn",action:function(){WmsDialog.removeModal()}}]};WmsDialog.showModal(i)}else if(b=="startchat")WmsHybridSearch.parseAndOpenChat(a);else if(b=="invite")d?WMSUI.inviteMember(d,e):WMSUI.inviteMember(e,e);else if(b=="accept")WmsContacts.accept("zoho",d,$WC.$CUtil.getConfig("zuid")),$WC.$CUtil.removeElementFromArray(WmsContacts.pendinginvcontactslist,d);else if(b=="contactimg"){WMSUI.imgPreview.createOverlay();var j=document.getElementById("wms-imgpreviewcontainer"),k='<div id="wms_profileinfo_img" class="wms-hvalign"><img src="'+a.src+'"></div>'+WmsProfileInfo.getHtml(d)+'<span class="wms-imgpreviewclose" data-purpose="close"></span>';k=$WC.template.replace(k,{IMGSRC:a.src}),j.insertAdjacentHTML("beforeend",k),WMSUI.imgPreview.bindevents()}WmsProfileInfo.hide()},WmsMainUI.handleProfileClick=function(a){var b=a.getAttribute("data-zcprofileid");b&&(WmsMainUI.contactdetailsdiv.style.display!==""||b!==WmsMainUI.contactdetailsdiv.getAttribute("data-id"))&&!a.closest('[data-pc="true"]')&&!a.closest('[id="wms_contactdetails"]')&&!a.closest('[data-baravatar="true"]')&&(WmsMainUI.contactdetailsdiv.removeAttribute("data-id"),WmsProfileInfo.hide(),WmsMainUI.contactdetailsdiv.setAttribute("data-id",b),WmsProfileInfo.get(a))},WmsMainUI.handleProfileMouseOut=function(a,b){var c=b.relatedTarget&&b.relatedTarget.closest('[id="wms_contactdetails"]');if(a===c)return;WmsProfileInfo.hide()},$WC.$CUtil.pubsub.subscribe("/orgcontacts/listview",function(a,b){var c;if(b.stat===WmsConstants.REQSTATUS.FAILED&&!b.callbackargs.silentload)c=b&&b.chid,Commands.hideLoadingIcon(c);else if(b&&b.callbackargs){var d=b.callbackargs.params;c=b.callbackargs.chid,d&&WmsOrgContacts.isEmptyResultReq(d.split("=")[2])&&!b.callbackargs.silentload?Commands.hideLoadingIcon(b.callbackargs.chid):c&&WindowHandler.getWinObjById(c)&&(b.callbackargs.silentload||Commands.hideLoadingIcon(c),WMSUI.atMentions.init(c,WindowHandler.getWinObjById(c).composer,b))}}),function(){var a=!1;WmsMainUI.scheduleAutoFocus=function(){a=!0},WmsMainUI.isAutoFocusScheduled=function(){return a},WmsMainUI.removeAutoFocusSchedule=function(){a=!1}}(),ie?(document.onfocusout=function(){_WMSWINFOCUS=!1},document.onfocusin=function(){_WMSWINFOCUS=!0}):(window.addEventListener("blur",function(){_WMSWINFOCUS=!1}),window.addEventListener("focus",function(){_WMSWINFOCUS=!0,WmsChannels.get_channels_onfocus&&WmsChannels.getChannels()}));var WmsProfileInfo={};WmsProfileInfo.details={},WmsProfileInfo.CONTAINER={WIDTH:283,HEIGHT:200},WmsProfileInfo.get=function(a){var b=a.getAttribute("data-zcprofileid");if(!WmsProfileInfo.isExistInCache(b)){var c="userid="+b,d=function(){var c=JSON.parse(this.response);WmsProfileInfo.update(b,c[0].objString),WmsProfileInfo.show(a)};b.indexOf("b-")===-1&&$WC.Ajax.postRequestToChat("getuserinfo.do",c,d),WmsProfileInfo.update(b)}WmsProfileInfo.show(a)},WmsProfileInfo.update=function(a,b){WmsProfileInfo.details[a]||(WmsProfileInfo.details[a]={}),a.indexOf("b-")!==-1?(WmsProfileInfo.details[a].dname=WmsContacts.contactslist[a].DNAME,WmsProfileInfo.details[a].emailid=WmsContacts.contactslist[a].STATUSMSG):b?(WmsProfileInfo.details[a].dname=a===WebMessanger.zuid?WmsResource.getRealValue("chat.you"):WebMessanger.unescapeHTML($WC.$CUtil.getContactName(a,b.fullname)),WmsProfileInfo.details[a].emailid=b.emailid,WmsProfileInfo.details[a].designation=b.designation,WmsProfileInfo.details[a].department=b.departmentname,WmsProfileInfo.details[a].mobile=b.mobile,WmsProfileInfo.details[a].extn=b.extension,WmsProfileInfo.details[a].country=b.country,WmsProfileInfo.details[a].timezone=b.timezone,WmsProfileInfo.details[a].timeoffset=b.timeoffset,WmsProfileInfo.details[a].orgid=b.orgid,WmsProfileInfo.details[a].moreinfo=b.moreinfo):WmsProfileInfo.isUserExist(a)&&(WmsProfileInfo.details[a].dname=a===WebMessanger.zuid?WmsResource.getRealValue("Me"):WmsContacts.getDisplayName(a),WmsProfileInfo.details[a].emailid=WmsContacts.getEmailId(a))},WmsProfileInfo.isExistInCache=function(a){return WmsProfileInfo.details[a]&&WmsProfileInfo.details[a].moreinfo?!0:!1},WmsProfileInfo.show=function(a){var b=a.getAttribute("data-zcprofileid");if(WmsMainUI.contactdetailsdiv.getAttribute("data-id")!==b)return;var c=document.getElementById("wms_contactdetails_container");c?(document.getElementById("wms_contactdetails_infocontainer").innerHTML=WmsProfileInfo.getBasicInfoHtml(b),document.getElementById("wms_contactdetails_addinfo").innerHTML=WmsProfileInfo.getDetailedInfoHtml(b)):WmsMainUI.contactdetailsdiv.innerHTML='<div id="wms_contactdetails_container" class="wms_contactdetails_container">'+WmsProfileInfo.generateUI(b)+"</div>";var d=document.getElementById("wms_contacthover_img"),e=document.getElementById("wms_contactdetails_loadingdiv");$WC.$CUtil.addEvent(d,"load",function(){WmsProfileInfo.setImageAspectRatio(d,d.width,d.height),d.style.display="block",d.className+=" wms-fadeIn",e&&(e.style.display="none",e.className+=" wms-fadeOut")}),WmsMainUI.contactdetailsdiv.style.display="block",util.positionElement(a,WmsMainUI.contactdetailsdiv)},WmsProfileInfo.handleDocumentClick=function(a){if(silent)return;var b=getEventTarget(a),c=b.getAttribute("data-zcprofileid");if(b.closest('[id="wms_contactdetails"]')||WmsMainUI.contactdetailsdiv&&c===WmsMainUI.contactdetailsdiv.getAttribute("data-id"))return;WmsMainUI.contactdetailsdiv&&(WmsMainUI.contactdetailsdiv.removeAttribute("data-id"),WmsProfileInfo.hide())},WmsProfileInfo.setImageAspectRatio=function(a,b,c){var d=c/WmsProfileInfo.CONTAINER.HEIGHT>=b/WmsProfileInfo.CONTAINER.WIDTH;d?(a.style.width="auto",a.style.height="100%"):(a.style.width="100%",a.style.height="auto"),WmsProfileInfo.setImagePosition(a,b,c)},WmsProfileInfo.setImagePosition=function(a,b,c){var d=WmsProfileInfo.CONTAINER.WIDTH,e=WmsProfileInfo.CONTAINER.HEIGHT,f=WmsProfileInfo.getAspectRatioFit(a.width,a.height,d,e,!0);b>d&&c>e-40&&(a.style.width=f.width+"px",a.style.height=f.height+"px"),b<d&&c<e-40&&(a.style=""),b>d&&c<e-40&&(a.style.width=f.width+"px",a.style.height=f.height+"px"),b<d&&c>e-40&&(a.style="",a.style.width=f.width+"px",a.style.height=f.height+"px"),WmsProfileInfo.populateBlurBgImage(a,"",f)},WmsProfileInfo.getAspectRatioFit=function(a,b,c,d,e){var f=[c/a,d/b];return f=Math.min(f[0],f[1]),!e&&f>1?{width:a,height:b}:{width:a*f,height:b*f,ratio:f}},WmsProfileInfo.populateBlurBgImage=function(a,b,c){var d=WmsProfileInfo.CONTAINER.WIDTH-c.width,e=WmsProfileInfo.CONTAINER.HEIGHT-c.height;if(d==0&&e==0)return;var f=document.getElementById("wms_contacthoverblurimg"),g=c.width/c.ratio,h=c.height/c.ratio;if(d>0&&f){var i=d/10;f.getContext("2d").drawImage(a,0,0,i,h,0,0,d/2,WmsProfileInfo.CONTAINER.WIDTH),f.getContext("2d").drawImage(a,d/2,0,c.width,WmsProfileInfo.CONTAINER.HEIGHT),f.getContext("2d").drawImage(a,g-i,0,i,h,c.width+d/2,0,d/2,WmsProfileInfo.CONTAINER.HEIGHT)}else if(e>0&&f){var j=e/10;f.getContext("2d").drawImage(a,0,0,g,j,0,0,WmsProfileInfo.CONTAINER.WIDTH,e/2),f.getContext("2d").drawImage(a,0,e/2,WmsProfileInfo.CONTAINER.WIDTH,c.height),f.getContext("2d").drawImage(a,0,h-j,g,j,0,c.height+e/2,WmsProfileInfo.CONTAINER.WIDTH,e/2)}},WmsProfileInfo.hide=function(){$WC.$CUtil.removeElement(WmsMainUI.contactdetailsdiv.firstChild),WmsMainUI.contactdetailsdiv.style.display="none",WmsMainUI.contactdetailsdiv.style.top="",WmsMainUI.contactdetailsdiv.style.left=""},WmsProfileInfo.generateUI=function(a){var b='<div id="wms_contactdetails_imgcontainer"><div id="wms_contactdetails_img" class="wms_contactdetails_img">'+WmsProfileInfo.generateImageHTML(a)+'<span id="wms_contactdetails_loadingdiv" class="wms-hvalign wms_loading_div"></span>'+"</div>"+'<div class="wms_contactdetails_infowrapper">'+'<div id="wms_contactdetails_info" class="wms_contactdetails_info">'+WmsProfileInfo.getBasicInfoHtml(a)+"</div>"+'<div id="wms_contactdetails_addinfo" class="wms_contactdetails_addinfocontainer">'+WmsProfileInfo.getDetailedInfoHtml(a)+"</div>";return!$WC.$CUtil.getConfig("customContacts")&&!$WC.$CUtil.getConfig("profileinfo")&&(b+='<div id="wms_contact_operations">'+WmsProfileInfo.getContactOperationsHtml(a)+"</div>"),b+="</div></div>",b},WmsProfileInfo.generateImageHTML=function(a){return a.indexOf("b-")!==-1&&WmsContacts.contactslist[a]?'<canvas width="'+WmsProfileInfo.CONTAINER.WIDTH+'" height="'+WmsProfileInfo.CONTAINER.HEIGHT+'" id="wms_contacthoverblurimg" imgsrc="'+WmsContacts.contactslist[a].PHOTO+'" class="wms_profileinfo_blur"></canvas><img id="wms_contacthover_img" class="wms-hvalign wms_contacthover_img" data-userid="'+a+'" data-operation="contactimg" src="'+WmsContacts.contactslist[a].PHOTO+'" style="display:none;">':'<canvas width="'+WmsProfileInfo.CONTAINER.WIDTH+'" height="'+WmsProfileInfo.CONTAINER.HEIGHT+'" id="wms_contacthoverblurimg" imgsrc="'+_WMSPHOTOSERVER+"/file?ID="+a+'&exp=6000&t=user&fs=original" class="wms_profileinfo_blur"></canvas><img id="wms_contacthover_img" class="wms-hvalign wms_contacthover_img" data-userid="'+a+'" data-operation="contactimg" src="'+_WMSPHOTOSERVER+"/file?ID="+a+'&exp=6000&t=user&fs=original" style="display:none;">'},WmsProfileInfo.getBasicInfoHtml=function(a){var b='<div id="wms_contactdetails_infocontainer" class="wms_contactdetails_infocontainer"><div title="{{DNAME}}" class=" wms_contactdetails_name wms-truncate-ellipsis">{{DNAME}}</div>';a.indexOf("b-")!==-1?b+='<span class="wms_contactdetails_status wms_boticon"></span>':b+='<span class="wms_contactdetails_status '+WmsBadgeImage.getStatusClass(a,!0)+'"></span>',b+='<div id="wms_contactdetails_id" class="wms_contactdetails_id">{{EMAILID}}</div>',a!=WebMessanger.zuid&&!$WC.$CUtil.getConfig("customContacts")&&!$WC.$CUtil.getConfig("profileinfo")&&(b+='<div class="wms_contactdetails_startchat" data-type="'+WmsHybridSearch.constants.CONTACT+'" data-id="{{USERID}}" data-operation="startchat"></div>'),b+="</div>";if($WC.$CUtil.getConfig("customContacts")&&!WmsProfileInfo.isUserExist(a)){var c=WmsImplHandler.invokeSynchronously($WC.$CUtil.getConfig("customContacts").customContactsInfo,a),d=$WC.$CUtil.getConfig("customContacts").getStatusClass,e="";return c&&c.statusClass?e=c.statusClass:d&&(e=WmsImplHandler.invokeSynchronously(d,a)),$WC.template.replace(b,{USERID:a,DNAME:c&&c.name?c.name:"",EMAILID:c&&c.mailId?c.mailId:"",STATUS:e})}return $WC.template.replace(b,{USERID:a,DNAME:WmsProfileInfo.details[a].dname?WmsProfileInfo.details[a].dname:"",EMAILID:WmsProfileInfo.details[a].emailid?WmsProfileInfo.details[a].emailid:"",STATUS:WmsBadgeImage.getStatusClass(a,!0)})},WmsProfileInfo.getDetailedInfoHtml=function(a){var b=$WC.$CUtil.getConfig("profileinfo");if(typeof b=="function"){var c=WmsImplHandler.invokeSynchronously(b,a);if(c)return c}var d='<div class="wms_contactdetails_addinfo">';if(a.indexOf("b-")!==-1)d+='<div><div class="wms_custombot_info">'+WmsResource.getRealValue("bot.custom.info")+"</div><span>/api/v1/bots/"+WmsContacts.contactslist[a].UNIQUENAME+"/message</span></div>";else if(WmsProfileInfo.isPeopleInfoAvailable(a))d+=' <div><span class="wms_contactdetails_moreinfo">{{DESIGNATION}}</span><div class="wms_contactdetails_deptinfo">{{DEPARTMENTNAME}}</div></div><div class="wms_contactdetails_contactinfo">'+(WmsProfileInfo.details[a].mobile?'<span class="wms_contactdetails_mob">'+WmsResource.getRealValue("contact.profileinfo.mobile")+": </span><span>{{MOBILE}}</span>":"")+(WmsProfileInfo.details[a].extn?'<span class="wms_contactdetails_extn">'+WmsResource.getRealValue("contact.profileinfo.extn")+": </span><span>{{EXTENSION}}</span>":"")+"</div>";else if(WmsProfileInfo.isUserExist(a)||WmsProfileInfo.details[a])if(WmsProfileInfo.details[a].timezone){var e=WmsProfileInfo.details[a].country,f=MyDate.getOtherZoneTime(WmsProfileInfo.details[a].timezone,WmsProfileInfo.details[a].timeoffset);d+='<div><span class="wms_contactdetails_moreinfo wms_contactdetails_mob">'+WmsResource.getRealValue("contact.profileinfo.localtime")+': </span><span>{{LOCALTIME}}</span></div><div class="wms_contactdetails_contactinfo"><span class="wms_contactdetails_mob">'+WmsResource.getRealValue("contact.profileinfo.country")+": </span><span>{{COUNTRY}}</span></div>"}else d+="";return d+="</div>",$WC.template.replace(d,{DESIGNATION:WmsProfileInfo.details[a].designation||"",DEPARTMENTNAME:WmsProfileInfo.details[a].department||"",MOBILE:WmsProfileInfo.details[a].mobile||"",EXTENSION:WmsProfileInfo.details[a].extn||"",LOCALTIME:f||"",COUNTRY:e||""})},WmsProfileInfo.getContactOperationsHtml=function(a){var b="";return a==WebMessanger.zuid||a.indexOf("b-")!==-1?b+="":WmsContacts.status(a)==WmsConstants.CONTACTSTATUS.REMOVE||!WmsContacts.get(a)?b+='<div data-operation="invite" data-id="'+a+'" class="wms-halign wms_contactdetails_delete"><span>'+WmsResource.getRealValue("contact.profileinfo.invite")+"</span></div>":WmsContacts.status(a)==WmsConstants.CONTACTSTATUS.REQACC||WmsContacts.status(a)==WmsConstants.CONTACTSTATUS.NOCHAT||!WmsContacts.get(a)?b+='<div data-operation="accept" data-id="'+a+'" class="wms-halign wms_contactdetails_delete"><span>'+WmsResource.getRealValue("contact.profileinfo.accept")+"</span></div>":WmsContacts.status(a)==WmsConstants.CONTACTSTATUS.UNAPRD||!WmsContacts.get(a)?b+='<div data-operation="invite" data-id="'+a+'" class="wms_contactdetails_reinvite"><span>'+WmsResource.getRealValue("contact.profileinfo.reinvite")+'</span></div><div data-operation="delete" data-id="'+a+'" class="wms_contactdetails_delete"><span>'+WmsResource.getRealValue("contact.profileinfo.delete")+"</span></div>":WmsContacts.status(a)!=WmsConstants.CONTACTSTATUS.REQACC&&WmsContacts.status(a)!=WmsConstants.CONTACTSTATUS.UNAPRD&&WmsContacts.status(a)!=WmsConstants.CONTACTSTATUS.REMOVE&&WmsContacts.get(a)&&(b+='<div data-operation="delete" data-id="'+a+'" class="wms-halign wms_contactdetails_delete"><span>'+WmsResource.getRealValue("contact.profileinfo.delete")+"</span></div>"),b},WmsProfileInfo.isPeopleInfoAvailable=function(a){return WmsProfileInfo.details[a]&&WmsProfileInfo.details[a].moreinfo?!0:!1},WmsProfileInfo.isUserExist=function(a){return WmsContacts.contactslist[a]||WmsOrgContacts.contactslist[a]},WmsProfileInfo.handleEscape=function(a){typeof WmsMainUI!="undefined"&&WmsMainUI.contactdetailsdiv&&WmsMainUI.contactdetailsdiv.hasChildNodes()&&(WmsProfileInfo.hide(),WindowHandler.lastViewed!==-1?WindowHandler.exist[WindowHandler.lastViewed].composer.focus():WmsMainUI.searchdiv.focus(),a.stopPropagation())},WmsProfileInfo.getHtml=function(a){var b='<div class="wms_profileinfo"><div class="wms_profileinfo_details"><span>{{DNAME}}</span>';return WmsProfileInfo.isPeopleInfoAvailable(a)&&(WmsProfileInfo.details[a].designation&&(b+='<span class="wms_profileinfo_divider">|</span><span>{{DESIGNATION}}</span>'),WmsProfileInfo.details[a].department&&(b+='<span class="wms_profileinfo_divider">|</span><span>{{DEPARTMENT}}</span>'),WmsProfileInfo.details[a].mobile&&(b+='<span class="wms_profileinfo_divider">|</span><span class="wms_profileinfo_mob"></span><span>{{MOB}}</span>'),WmsProfileInfo.details[a].extn&&(b+='<span class="wms_profileinfo_divider">|</span><span class="wms_profileinfo_extn"></span><span>{{EXTN}}</span>')),b+='</div><div class="wms_profileinfo_wrapper" data-userid="'+a+'">'+'<span style="{{DOWNLOADICON}}" title="'+WmsResource.getRealValue("chat.download")+'"><a target="_blank" class="wms_profileinfo_dwnld" href={{IMGSRC}} download="photo"></a></span>'+'<span class="wms_profileinfo_chat" data-purpose="startchat" data-id="'+a+'" data-type="'+WmsHybridSearch.constants.CONTACT+'" title="'+WmsResource.getRealValue("chat.msg.direct")+'"></span>'+"</div>"+"</div>",$WC.template.replace(b,{DNAME:WmsProfileInfo.details[a].dname||"",DESIGNATION:WmsProfileInfo.details[a].designation,DEPARTMENT:WmsProfileInfo.details[a].department,MOB:WmsProfileInfo.details[a].mobile,EXTN:WmsProfileInfo.details[a].extn})};var myMsgObj={};myMsgObj.chid="-1",myMsgObj.sender="",myMsgObj.nickname="j",myMsgObj.msg="",myMsgObj.uname="",WMSUI.triggers=["@",":","+","-","/"],WMSUI.curtrigger="",WMSUI.hidegsicon=!1,WMSUI.showminhint=!0,WMSUI.errormsgtimer=null,WMSUI.loadedimg={},WMSUI.isLoadedImg=function(a){return WMSUI.loadedimg[a]===!0},WMSUI.loadImages=function(a){var b=a.getBoundingClientRect().top,c=a.querySelectorAll("img[originalsrc]");for(var d=0;d<c.length;d++){var e=c[d],f=e.parentNode.getBoundingClientRect().top,g=f+e.parentNode.offsetHeight;(f>b||g>b)&&WMSUI.loadOriginalImgSrc(e)}},WMSUI.loadOriginalImgSrc=function(a){var b=a.getAttribute("originalsrc");a.removeAttribute("originalsrc"),a.nextSibling!==null&&$WC.$CUtil.removeElement(a.nextSibling);var c=a.cloneNode();c.removeAttribute("src"),c.src=b,c.className="",a.parentNode.insertBefore(c,a.nextSibling),c.onload=function(){this.style.display="",$WC.$CUtil.removeElement(a),WMSUI.loadedimg[b]=!0},c.onerror=function(){a.setAttribute("originalsrc",b),this.style.display="none"}},WMSUI.handleMessageFailure=function(a,b){var c=a.querySelector('[data-msgid="'+b+'"]');c.setAttribute("data-msgfailure","true")},WMSUI.getStype=function(a){if((a&WmsContacts.userstatus.MOB_LOGIN)===WmsContacts.userstatus.MOB_LOGIN)return WmsContacts.userstatus.MOB_LOGIN;if((a&WmsContacts.userstatus.WEB_LOGIN)===WmsContacts.userstatus.WEB_LOGIN)return WmsContacts.userstatus.WEB_LOGIN},WMSUI.generateUI=function(){var a='<span id="wms_cw_videoinfo" class="wms_cw_videoinfo" data-videoinfo=true onclick="WindowHandler.exist[{{winindex}}].toggleVideoDropdown( event )"><div id="wms_videoinfo_dropdown" class="wms_videoinfo_dropdown" data-videodropdown=true><div class="wms_cw_toolbar_actionitem" data-audioicon=true onclick="WindowHandler.exist[{{winindex}}].handleAudioVideoChat( event )" style="display: none;">'+WmsResource.getRealValue("chat.audio.call")+"</div>"+'<div class="wms_cw_toolbar_actionitem" data-videoicon=true onclick="WindowHandler.exist[{{winindex}}].handleAudioVideoChat( event )" style="display: none;">'+WmsResource.getRealValue("chat.video.call")+"</div>"+"</div>"+"</span>"+'<span class="wms_cw_minimizeicon" data-minimizeicon="true" onclick="WindowHandler.exist[{{winindex}}].minimizeAndPropagate()" title="'+WmsResource.getRealValue("chat.minimize")+'"></span>'+'<span class="wms_cw_enlargeicon" data-enlargeicon="true" onclick="WindowHandler.exist[{{winindex}}].toggleEnlargeWindow()" title="'+WmsResource.getRealValue("chat.enlarge")+'"></span>'+'<span class="wms_cw_closeicon" onclick="WindowHandler.exist[{{winindex}}].closeAndPropagate(event)" title="'+WmsResource.getRealValue("Close")+'"></span>',b='<div class="wms_cw_header" data-header=true onclick="WindowHandler.exist[\'{{winindex}}\'].focus(event)"><div class="wms_cw_header_avatar" data-zcprofileid="{{userid}}" data-avatar="true"></div><div class="wms_cw_header_main wms-truncate-ellipsis" data-titlecontainer="true" onclick="WindowHandler.exist[\'{{winindex}}\'].editChatTitle()" data-main="true"><div><div data-title="true" class="wms_cw_header_name"></div><span data-edittitleicon="true" class="wms_cw_settitle" onclick="WindowHandler.exist[\'{{winindex}}\'].editChatTitle()"></span><span data-channelrestricted=false class="wms_cw_channellock" title="'+WmsResource.getRealValue("channel.inviteonly")+'"></span></span>'+"</div>"+'<div class="wms_cw_statusmsg" data-statusmsg="true" title="Offline">Offline</div>'+"</div>"+'<div class="wms_cw_header_actions" data-actions="true">'+a+"</div>"+"</div>",c='<div id="{{chid}}" class="wms_chatwindow wms_bubbletheme"><div data-main=true class="wms_cw" >'+b+'<div class="wms_mediacall_space" data-videospace=true video-action="maximize">'+'<span class="wms_callstatus_text wms-halign"></span>'+'<div class="wms_mediacall_container">'+'<div class="wms_outgoing_call_text wms-halign"></div>'+'<div class="wms_remotevideo_container"><video class="wms_remotestream" videochataction="switchvideo"></video><div class="wms_remoteuserimg wms-hvalign"><img></img></div><div class="wms_mediaoff_notify"></div></div>'+'<div class="wms_localvideo_container" video-action="switchvideo" title="'+$WC.$CUtil.getConfig("Resource").getRealValue("mediacall.switchvideo")+'"><video class="wms_localstream" autoplay="autoplay"></video><div class="wms_localuserimg"><img></img></div></div>'+"</div>"+'<div class="wms_videocall_button wms_settings_button" video-action="devicesettings" title="'+$WC.$CUtil.getConfig("Resource").getRealValue("mediacall.devicesettings")+'"></div>'+'<div class="wms_videocall_button wms_minimize_button" video-action="minimize" title="'+$WC.$CUtil.getConfig("Resource").getRealValue("minimize")+'"></div>'+'<div class="wms_videocall_button wms_fullscreen_button" video-action="togglefullscreen" title="'+$WC.$CUtil.getConfig("Resource").getRealValue("mediacall.fullscreen")+'"></div>'+'<div class="wms_mediacall_timer"></div>'+'<div class="wms_videocall_buttons_list">'+'<div class="wms_videocall_button wms_togglemic_button" video-action="togglemic" title="'+$WC.$CUtil.getConfig("Resource").getRealValue("mediacall.mic.off")+'"></div>'+'<div class="wms_videocall_button wms_endcall_button" video-action="endcall" title="'+$WC.$CUtil.getConfig("Resource").getRealValue("mediacall.end")+'"></div>'+'<div class="wms_videocall_button wms_togglevideo_button" video-action="togglecam" title="'+$WC.$CUtil.getConfig("Resource").getRealValue("mediacall.cam.off")+'"></div>'+"</div>"+"</div>"+"<div>"+'<div data-errormsg=true class="wms_cw_errormsg wms-halign"></div>'+'<div data-progressbar=true class="wms-loadingmn"></div>'+'<div data-datecomp="true" class="wms_datehint wms-halign"></div>'+"</div>"+'<div data-ctrlcomp="true" class="wms_cw_main_parent" onmouseup="WindowHandler.exist[{{winindex}}].checkSelectionAndFocus( event )">'+'<div class="wms_cw_main" id="ctrlcomp" data-msgdisp="true"></div>'+"</div>"+'<div data-dragcomp="true" class="wms_cw_drag" style="display:none">'+"<span>"+WmsResource.getRealValue("chat.file.drop")+"</span>"+"</div>"+'<div data-members=true class="wms_cw_memberlist_wrapper">'+"</div>"+'<div class="wms_cw_toolbar" data-toolbar=true onclick="WindowHandler.exist[{{winindex}}].checkAndMinimize(event)">'+'<span class="wms_cw_typingstatus wms-truncate-ellipsis" data-typingstatusnode=true data-typingstatus=false></span>'+'<button class="wms_cw_toolbar_actionbutton" data-action=true onclick="WindowHandler.exist[{{winindex}}].toggleActions(event)">'+WmsResource.getRealValue("Actions")+"</button>"+'<div class="wms_cw_toolbar_actionlist" data-actionlist=true>'+"</div>"+"</div>"+'<div class="wms-smileycontainer" data-smileycontainer=true></div>'+'<div class="wms_cw_footer" data-footer=true onclick="WindowHandler.exist[{{winindex}}].checkAndMinimize( event )">'+'<div class="wms_editorreply" data-editorreply=true></div>'+'<div id="wms-autocomplete" class="wms-autocomplete" data-autocomplete=true style="display:none"></div>'+'<div data-footercont=true class="wms_cw_footer_cont">'+'<div data-attachment=true class="wms_cw_footer_att">';return c+='<form type="html5" name="uploads{{chid}}" enctype="multipart/form-data" class="wms_cw_actualfile" chid="{{chid}}" id="formsend" title="'+WmsResource.getRealValue("share.file")+'">'+'<input name="file1" id="wms-file" type="file" multiple onChange="WMSUI.submitFile(document.getElementsByName(\'uploads{{chid}}\')[0],\'{{chid}}\');" size="30"/>'+"</form>",c+='</div><div id="wms-wrapperdiv" class="wms-wrapperdiv"><div id="wms-editorscrolldiv" class="wms-invisiblediv wms_cw_footer_editor"></div><div id="wms-invisiblediv" class="wms-invisiblediv wms_cw_footer_editor" data-invisiblediv=true></div><textarea onscroll="WMSUI.handleSync(this)" class="wms_cw_footer_editor" data-composer=true chid={{chid}} onkeydown="return WMSUI.handleEvent(event,this,\'{{chid}}\')" onkeyup="WMSUI.handleStatus(event,this,\'{{chid}}\');WindowHandler.makeNormalWinById(\'{{chid}}\')" onclick="WindowHandler.exist[\'{{winindex}}\'].focus();WindowHandler.exist[\'{{winindex}}\'].checkAndToggleGroupMembers()" ondblclick="WindowHandler.exist[{{winindex}}].textAreaMinimize()" onblur="WindowHandler.exist  [{{winindex}}].blurChat();"></textarea></div><div id="wms-smileyinvoker" class="wms-smileyinvoker wms-valign-mid-block" onclick="WindowHandler.exist[{{winindex}}].toggleSmiley(\'{{winindex}}\')"></div></div></div>',c+='<div class="wms-resendoverlay" data-resendoverlay="true"><div class="wms-resendmsgoptsdiv wms-hvalign"><div data-operation="wms-resend" class="wms-resendmsgopts"><span>'+WmsResource.getRealValue("chat.msg.resend")+"</span>"+"</div>"+'<div data-operation="wms-resendall" class="wms-resendmsgopts">'+"<span></span>"+"</div>"+'<div data-operation="wms-resenddel" class="wms-resendmsgopts">'+"<span>"+WmsResource.getRealValue("Delete")+"</span>"+"</div>"+'<span data-operation="wms-resendcancel" class="wms-resendcloseicon"></span>'+"</div>"+"</div>"+"</div>"+'<div class="wms_cw_bar " data-bar=true onclick="WindowHandler.exist[{{winindex}}].maximize()">'+'<div class="wms_cw_bar_photo" data-baravatar=true /></div>'+'<span class="wms_cw_bar_msgcount" data-barmsgcount=true></span>'+'<span class="wms_cw_bar_typing_indicator wms_cw_bar_typing_online" data-typingsymbol="true"></span>'+'<span class="wms_cw_bar_name wms-truncate-ellipsis" data-bartitle=true>{{title}}</span>'+'<span class="wms_minimized_close wms_cw_opr_close" onclick="WindowHandler.exist[{{winindex}}].closeAndPropagate(event)"></span>'+"</div>"+"</div>",c},WMSUI.handleSync=function(a){var b=a.parentNode.querySelector('[id="wms-invisiblediv"]');b.scrollTop=a.scrollTop},WMSUI.isBarVisible=function(){return getComputedStyle(WmsMainUI.maincontainer).display=="block"},WMSUI.handleKeyMovement=function(a,b,c){var d=a.getElementsByClassName(c),e=null;b===40?e=d[0].nextSibling||a.firstChild:b===38&&(e=d[0].previousSibling||a.lastChild),d[0]&&$WC.$CUtil.removeClass(d[0],c),$WC.$CUtil.addClass(e,c)},WMSUI.createNewChatWindow=function(a){function b(b,c,d,e){if($WC.$CUtil.isChannelChid(e))return WmsChannels.getChannelName(e)||d;if(d)return d;if(c===2)return WmsContacts.getDisplayName(b)||a.dname;if(c>2)return WmsResource.getRealValue("Group_Chat")}function c(a,b){return b<=2?WmsContacts.status(a):""}function d(a,b){return b<=2?WmsContacts.getStatusType(a):""}function e(a,b){return b<=2?WmsContacts.getStatusMsg(a):""}function f(b,c){return c<=2?typeof b=="string"?(b=b.split(","),b[0]===WebMessanger.zuid?b[1]:b[0]):b&&b[0]?b[0].uname:a.sender:""}!a.sender&&a.users&&a.users[0]&&(a.sender=a.users[0].uname);var g=b(a.sender,a.pcount,a.title,a.chid),h=a.chid,i=a.pcount,j=a.sender,k=a.recipants?f(a.recipants,i):f(a.users,i),l=c(j,i),m=d(j,i),n=e(j,i),o=a.ctype,p=a.salesiqchat||!1,q=WmsSessionStorage.getChatInfo(h,"state");q=q===null||p===!1?"min":q;var r=WmsSessionStorage.getChatInfo(h,"text"),s=a.attached==="1"?!0:!1,t=a.prd,u=a.addinfo,v=WMSUI.showminhint,w=a.context?JSON.parse(a.context).weburl:"",x=a.entityid,y={addinfo:u,recipant:k,divId:h,title:g,scode:l,stype:m,smsg:n,ctype:o,winstate:q,composertext:r,historystorage:a.history,entityweburl:w,entityid:x,lastmsgtime:+a.time,attached:s,pcount:i,prdcode:t,mutedinterval:a.mutedinterval,showminimizehint:v,salesiqchat:p};Factory.createDialog(WMSUI.generateUI(),y)},WMSUI.isVideoEnabled=function(){try{return WMSTP.isVideoEnabled()}catch(a){}},WMSUI.isAudioEnabled=function(){try{return WMSTP.isAudioEnabled()}catch(a){}},WMSUI.rejectContact=function(a,b){try{WmsContacts.reject("zoho",b,WebMessanger.uname)}catch(c){}},WMSUI.addContact=function(a,b){try{WmsContacts.add("zoho",b,WebMessanger.uname)}catch(c){}},WMSUI.setServiceStatus=function(a){WebMessanger.isServiceStatus()===!1&&(WmsMainUI.servicestatusdiv.innerHTML=a)},WMSUI.populateMainBar=function(){typeof WMSUI.smartchatenabled=="undefined"&&(WMSUI.smartchatenabled=!0),wmsnotifyowner=new $WC.NotificationOwner("chat",!0),WmsMainUI.populate();return},WMSUI.populate=function(){var a=document.createDocumentFragment(),b=document.createElement("DIV");b.onclick=function(){WMSUI.annShowAnimate("wmsannmsg")},b.id="annmsgstrip",b.className="zread_strip";var c=document.createElement("DIV");c.id="wmsannmsg",c.style.display="none",c.className="zread_olymn",c.onclick=function(a){var b=getSource(a);b&&b.tagName!=="A"?WMSUI.hideAnnMsg(a):typeof a.stopPropagation=="function"?a.stopPropagation():a.cancelBubble=!0},c.style.zIndex=WebMessanger.setzindex,b.style.zIndex=WebMessanger.setzindex,b.appendChild(c),a.appendChild(b),document.body.appendChild(a),c.innerHTML='<span id="annmsg"></span><div id="hideinfo" class="zchdr_arw"></div><a id="clearannmsg" style="text-decoration:underline; float:right; font-size: 11px; margin: 2px 25px 0px 0px">Do not show again</a>',addEvent(document.getElementById("hideinfo"),"click",WMSUI.hideAnnMsg),addEvent(document.getElementById("clearannmsg"),"click",WMSUI.clearBannerAndUpdate)},WMSUI.clearBannerAndUpdate=function(){WMSUI.clearAnnBanner(),WmsSettings.updateWmsSettings("bchatsettings","disann");var a=document.location.hostname.split("."),b=a[a.length-2]+"."+a[a.length-1];Cookie.setCustomCookie(b,wmsUserConfig.infomsgid,"true","")},WMSUI.clearAnnBanner=function(){var a=document.getElementById("annmsgstrip");a&&(a.style.display="none")},WMSUI.addIndocClickcallbackQue=function(a,b,c,d){ie&&(WMSUI.handleDocumentClick(d),WMSKeyHandler.skipeventlistener=!0);var e={};e.htmlObj=b,e.cbfunction=c,WMSUI.docClickcallbackQue[a]=e},WMSUI.handleDocumentClick=function(a){try{var b=WMSUI.getEventSrc(a),c=WMSUI.docClickcallbackQue;for(var d in c){var e=c[d],f=e.cbfunction(b.id);f||delete WMSUI.docClickcallbackQue[d]}}catch(g){}},WMSUI.deleteParticipant=function(a,b,c){if(WMSUI.showErrorIfPermDenied(a))return;var d=WindowHandler.getWinObjById(a).title,e=WmsResource.getRealValue("chat.member.deleteinfo",[c,d]),f='<div class="wms-dialog-txtcont">'+util.escapeHTML(e)+"</div>",g='<div class="wms-dialog-imgouter"><div class="wms-dialog-imginner"><div class="wms-dialog-img"></div></div></div>',h={imghtml:g,bodyhtml:f,focusbutton:1,operations:[{name:WmsResource.getRealValue("Delete"),action:function(){WebMessanger.deleteMember(a,b),WmsDialog.removeModal()}},{name:WmsResource.getRealValue("Cancel"),classname:"wms-dialog-rejectbtn",action:function(){WmsDialog.removeModal()}}]};WmsDialog.showModal(h)},WMSUI.startMeeting=function(a){try{a==undefined&&(a=WMSUI.currentId);var b=WmsContacts.getEmailId(a),c=wmsmeetingurl+"/login/MeetNow.jsp?participants="+b+"&source=chatbar";window.open(c)}catch(d){}},WMSUI.makeVideoCall=function(a,b,c,d){if(WMSUI.isVideoEnabled()&&WmsSettings.getAdminSetting("isMediacallAllowed")){a==undefined&&(a=WMSUI.currentId),VideoCallReceiver.setNewWindow(b);if(WebMessanger.orgid=="456089"&&!b){if(!c){var e=WebMessanger.ucmap[a];c=WindowHandler.getWinObjById(e)}c&&(c.iscallongoing=!0),WmsAVChat.startCall(a,WmsAVChat.CALL_TYPE_VIDEO,WmsAVChat.CALL_MODE_OUTGOING,c,d)}else WMSTP.handleNewVideo(getZuid(),a)}},WMSUI.startVideoChat=function(a){var b="api";WMSUI.makeVideoCall(a,"",b)},WMSUI.makeAudioCall=function(a,b,c,d){if(WMSUI.isAudioEnabled()&&WmsSettings.getAdminSetting("isMediacallAllowed")){a==undefined&&(a=WMSUI.currentId),VideoCallReceiver.setNewWindow(b);if(WebMessanger.orgid=="456089"&&!b){if(!c){var e=WebMessanger.ucmap[a];c=WindowHandler.getWinObjById(e)}c&&(c.iscallongoing=!0),WmsAVChat.startCall(a,WmsAVChat.CALL_TYPE_VOICE,WmsAVChat.CALL_MODE_OUTGOING,c,d)}else WMSTP.handleNewAudioWHivi(getZuid(),a)}},WMSUI.startAudioChat=function(a){var b="api";WMSUI.makeAudioCall(a,"",b)},WMSUI.mailopen=function(a,b,c){var d=parseInt(b*screen.width/100),e=parseInt(c*screen.height/100),f=(screen.width-d)/2,g=(screen.height-e)/2;return window.open(a,(new Date).getTime(),"height="+e+", width="+d+",status=yes,toolbar=no,top="+g+", left="+f+", menubar=no,location=no,scrollbars=yes,resizable=yes")},WMSUI.sendmail=function(){var a=WmsContacts.getEmailId(WMSUI.currentId);WMSUI.mailopen(_WMSMAILURL+"mail/compose.do?mode=compose&tp=zb&ct="+a,80,77)},WMSUI.getNickName=function(){return WebMessanger.getNickName().trim()!=""?WebMessanger.getNickName():WebMessanger.uname},WMSUI.regenerateStatus=function(){WebMessanger.getAllStatusMessage()},WMSUI.clearCustomStatus=function(){WmsMainUI.statuscontainer.style.display="none",WebMessanger.clearCustomStatus(),WebMessanger.scode="1",WebMessanger.smsg="Available"},WMSUI.updateStatus=function(a,b){WebMessanger.scode=a,WebMessanger.smsg=b,WebMessanger.registerAnnonUser||setTimeout(function(){WMSUI.regenerateStatus()},500)},WMSUI.initI18NUserStatus=function(){WMSUI.i18Nuserstatus={},WMSUI.i18Nuserstatus.Available=WMSUI.i18N("Available","Available"),WMSUI.i18Nuserstatus.Invisible=WMSUI.i18N("Invisible","Invisible"),WMSUI.i18Nuserstatus.Busy=WMSUI.i18N("Busy","Busy"),WMSUI.i18Nuserstatus.Idle=WMSUI.i18N("Idle","Idle")},WMSUI.geti18NUserStatus=function(a,b){var c={};return b=b.trim(),WMSUI.i18Nuserstatus==null&&WMSUI.initI18NUserStatus(),b==WMSUI.i18Nuserstatus.Available||b.length==0?(b="Available",a=1):b==WMSUI.i18Nuserstatus.Busy?(b="Busy",a=3):b==WMSUI.i18Nuserstatus.Idle?(b="Idle",a=4):b==WMSUI.i18Nuserstatus.Invisible&&(b="Invisible",a=2),c.scode=a,c.smsg=b,c},WMSUI.setStatus=function(a,b,c){try{var d=WMSUI.geti18NUserStatus(a,b);b=d.smsg,c&&(b=unescape(b),b=WebMessanger.unescapeHTML(b));if(WebMessanger.smsg!=b||WebMessanger.scode!=a)WebMessanger.scode=a,WebMessanger.smsg=b,WmsMainUI.statuscontainer.style.display="none",WmsMainUI.statuscontainer.setAttribute("data-showstatus","false"),WebMessanger.setStatus(a,b);$WC.$CUtil.removeClass(WmsMainUI.settingsdropdownicon,"wms_settings_close"),$WC.$CUtil.addClass(WmsMainUI.settingsdropdownicon,"wms_settings"),WmsMainUI.settingsdropdownicon.setAttribute("data-settings","true")}catch(e){}return!1},WMSUI.inviteMember=function(a,b){var c=b?WmsResource.getRealValue("chat.contact.addinfo",[b]):WmsResource.getRealValue("chat.contact.inviteinfo"),d='<div class="wms-dialog-txtcont">'+util.escapeHTML(c)+"</div>",e='<div class="wms-dialog-imgouter"><div class="wms-dialog-imginner"><div class="wms-dialog-img"></div></div></div>',f={imghtml:e,bodyhtml:d,focusbutton:1,operations:[{name:WmsResource.getRealValue("chat.contact.add"),action:function(){WmsContacts.add("zoho",a,WebMessanger.uname),WmsDialog.removeModal()}},{name:WmsResource.getRealValue("Cancel"),classname:"wms-dialog-rejectbtn",action:function(){WmsDialog.removeModal()}}]},g=$WC.$CUtil.getConfig("inviteaction");typeof g=="function"?WmsImplHandler.invoke(g,a):WmsDialog.showModal(f)},WMSUI.getEventSrc=function(a){var b;return a||(a=window.event),a.target?b=a.target:a.srcElement&&(b=a.srcElement),b.nodeType==3&&(b=b.parentNode),b},WMSUI.handleStatusChange=function(a,b){b||(b=window.event);var c=window.event?b.keyCode:b.which;if(c==13){mz&&b.preventDefault(),ie&&(b.cancelBubble=!0,b.returnValue=!1);var d=a.trim();WebMessanger.smsg!=d&&WMSUI.setStatus(WebMessanger.scode,d,!1)}else c==27&&(mz&&b.preventDefault(),ie&&(b.cancelBubble=!0,b.returnValue=!1))},WMSUI.populteCustomStatus=function(a){if(a==null)return;var b=a.length;if(b<=0)return;var c=document.createDocumentFragment(),d=document.createDocumentFragment(),e=document.createDocumentFragment(),f=function(a,b,c){c=c==="Available"||c==="Busy"||c==="Invisible"?WMSUI.i18Nuserstatus[c]:c;var d=document.createElement("p");d.className="wms-stp",$WC.$CUtil.addEvent(d,"mouseover",function(){this.className="wms-stp wms-stp-hover"}),$WC.$CUtil.addEvent(d,"mouseout",function(){this.className="wms-stp"}),$WC.$CUtil.addEvent(d,"click",function(){WMSUI.setStatus(b,this.getAttribute("data-smsg"))});var e;b==1?e="available":b==3?e="busy":e="offline",d.innerHTML='<span data-staticon class="wms_cstatusicon wms-statusicon-'+e+'"></span><span data-statmsg class="wms-stat wms-truncate-ellipsis" title="'+util.escapeHTML(c)+'"></span>',a.appendChild(d),d.setAttribute("data-smsg",c),d.querySelector("[data-staticon]").className="wms_cstatusicon wms-statusicon-"+e,$WC.$CUtil.setInnerText(d.querySelector("[data-statmsg]"),c)};for(var g=0;g<b;g++){var h=WebMessanger.unescapeHTML(a[g].STATUSMSG);(WMSUI.i18Nuserstatus==null||WMSUI.i18Nuserstatus==undefined)&&WMSUI.initI18NUserStatus(),(a[g].SYSTEM!=1||h=="Available")&&f(c,1,h),(a[g].SYSTEM!=1||h=="Busy")&&f(d,3,h),a[g].SYSTEM==1&&h=="Invisible"&&f(e,2,h)}var i=document.createElement("p");i.innerHTML='<p class="wms-stp" onclick="WMSUI.clearCustomStatus();" onmouseover="this.className=\'wms-stp wms-stp-hover\';" onmouseout="this.className=\'wms-stp\';" ><img src="https://img.zohostatic.com/ichat/v282_https/images/spacer.gif"/><span class="wms-stat" style="padding-left:22px;">'+WmsResource.getRealValue("Clear_status_message")+"</span></p>";var j=WmsMainUI.statuscontainer;j.innerHTML="",j.appendChild(c),j.appendChild(d),j.appendChild(e),j.appendChild(i)},WMSUI.updateInvitations=function(a){for(var b=0;b<a.length;b++){var c=a[b],d=WmsContacts.get(c);if(d==null)continue;var e={};e.zuid=d.USERID,e.dname=d.DNAME,e.uname=d.USERID,e.email=d.EMAILID,WmsHybridSearch.showInvite(e)}};var naKeyCodes=new Array("33","34","36","37","39","45","144","145","16","17","18","91");WMSUI.handleStatus=function(a,b,c,d){a.keyCode!==27&&WmsSessionStorage.setChatInfo({chid:c,text:b.value});var e=WindowHandler.getWinObjById(c);if(e.salesiqchat)return typeof WmsUIImpl!="undefined"&&WmsImplHandler.invoke(WmsUIImpl.handleKeyMovement,a,c),!0;if(a.keyCode==27||a.keyCode==37||a.keyCode==39||a.keyCode==38||a.keyCode==40||a.keyCode==13)return;var f=b.selectionStart,g=b.value,h=e.invisiblediv,i=e.autocompletediv;g==""&&(h.innerHTML="",b.removeAttribute("data-command"),i.style.display="none"),g=g.substring(0,f);var j=0,k=h.innerHTML,l=Message.getMsgCategory(k),m=l==="command"?Commands.getAllowedTriggers(b):Message.getCurtriggers(l),n=WindowHandler.getWinObjById(c);for(var o=0;o<m.length;o++){var p=g.lastIndexOf(" "+m[o])+1;p==0&&(p=g.lastIndexOf("\n"+m[o])+1),p===0&&g.indexOf(m[o])!==0&&(p=-1),p!==-1&&p>=j&&(j=p,WMSUI.curtrigger=m[o])}if(WMSUI.curtrigger==="-"&&g.indexOf("/")!=-1)return Commands.show(c,!0),!0;if(WMSUI.curtrigger===WmsConstants.TRIGGERS.ATMENTION&&n.ctype!=="5"||WMSUI.curtrigger===WmsConstants.TRIGGERS.ADDMEM&&n.ctype!=="10"||WMSUI.curtrigger===WmsConstants.TRIGGERS.DELMEM&&n.ctype!=="10")WMSUI.atMentions.init(c,b);else if(WMSUI.curtrigger===WmsConstants.TRIGGERS.SMILEY)WMSUI.autoComplete.init(c,b);else if(WMSUI.curtrigger===WmsConstants.TRIGGERS.SLASH&&g.startsWith(WmsConstants.TRIGGERS.SLASH))return Commands.show(c),!0;if(a.keyCode>=112&&a.keyCode<=123)return!0;for(o=0;o<naKeyCodes.length;o++)if(a.keyCode==naKeyCodes[o])return!0;typeof d=="undefined"&&b.getAttribute("data-command")==null&&Self.status.active(c)},WMSUI.showErrorIfPermDenied=function(a){var b=WindowHandler.getWinObjById(a);return b&&b.permdenied?(alert(WmsResource.getRealValue("Permission_Denied_You_are_no_longer_member_of_this_chat")),!0):!1},WMSUI.handleEvent=function(a,b,c){var d=WindowHandler.getWinObjById(c);if(d.salesiqchat)return!0;try{try{if(a.keyCode==13&&a.shiftKey)return!0}catch(e){}if(a.keyCode>=112&&a.keyCode<=123)return!0;if(a.keyCode==27)try{return ChatBlink.stopRepeat(),WMSUI.handleChatWindowEscape(a,c)?!1:(WindowHandler.closeWinById(c),WMSKeyHandler.cancelEvent(a),!1)}catch(f){}if(a.keyCode==9&&!a.ctrlKey&&!a.shiftKey)return WindowHandler.moveFocus(c),!1;if(a.keyCode==9&&a.shiftKey)return WindowHandler.moveFocus(c,!0),!1;var g=document.getElementById(c);if(a.keyCode==86&&(a.ctrlKey||a.metaKey)&&g.ctype!="5"&&navigator.userAgent.indexOf("Firefox")!=-1){var h=a.target,i=h.selectionStart,j=h.value.substring(0,i),k=h.value.substring(i),l=document.getElementById("wms-pasteCapture");l.focus(),l.innerHTML="",setTimeout(function(){var a;if(l.childNodes[0]&&l.childNodes[0].nodeName=="IMG"){var b=l.childNodes[0].getAttribute("src");if(b.match(/^data:image/)){var c=atob(b.split(",")[1]),d=b.split(",")[0].split(":")[1].split(";")[0],e=new ArrayBuffer(c.length),f=new Uint8Array(e);for(a=0;a<c.length;a++)f[a]=c.charCodeAt(a);var g=new Blob([f],{type:d});WmsFileUpload.init(h.getAttribute("chid"),[g]),document.getElementById("wms-fileupldcmt").focus()}}else if(l.childNodes){var i=l.querySelectorAll("br");for(a=0;a<i.length;a++)i[a].parentNode.replaceChild(document.createTextNode("\n"),i[a]);j+=$WC.$CUtil.getInnerText(l),h.value=j+k,util.moveCaretPosition(h,j.length,j.length)}},10),a.stopPropagation()}var m=d.autocompletediv,n=d.invisiblediv,o=d.atmentions;Message.trim(b.value)==""&&(n.innerHTML="",WMSUI.curtrigger="");if(a.keyCode==13){var p=!0;if(m.style.display=="block"&&WMSUI.triggers.indexOf(WMSUI.curtrigger)!==-1){a.preventDefault();return}mz&&a.preventDefault();var q=b.value;if(d.isDoubleEnter())d.setLastEnterKeyPressTime(-1),q="---";else{if(Message.trim(b.value)=="")return d.setLastEnterKeyPressTime((new Date).getTime()),b.value="",!1;d.setLastEnterKeyPressTime(-1)}o&&(q=WebMessanger.unescapeHTML(WMSUI.atMentions.formatAtMentions(q,o,c,!0)));if(Message.getMsgCategory(n.innerHTML)==="addmem")p=WMSUI.confirmAndAddMember(c,q);else if(Message.getMsgCategory(n.innerHTML)==="delmem"){var r=WindowHandler.getWinObjById(c).atmentions,s=r.split(",");WebMessanger.deleteMember(c,s),p=WMSUI.handleMemberModificationCommand(c,r,q,!1)}else if(Message.getMsgCategory(n.innerHTML)==="command"){var t=b.value.substring(0,b.value.indexOf(" "));p=Commands.handle(t,b,c)}else{var u=d.getReplyMessageId();p=Message.send(c,q,null,null,null,null,u),m.style.display=="block"&&(m.style.display="none")}d=WindowHandler.getWinObjById(c),d.showAddUserPrompt(),d.atmentions="",WmsSessionStorage.setChatInfo({chid:c,atmentions:d.atmentions});var v=WindowHandler.getWinObjById(c).ctrlcomp;return v.scrollTop=v.scrollHeight-v.clientHeight,p&&(b.value="",n.innerHTML="",b.removeAttribute("data-command")),!1}}catch(w){}},WMSUI.confirmAndAddMember=function(a,b,c){var d=WindowHandler.getWinObjById(a),e=c,f,g=[],h=[],i=d.atmentions||c;d.atmentions&&(e=d.atmentions.slice(0,-1).split(",")),e.length===1?(g.push(WmsContacts.get(e[0],!0).DNAME),f=WmsResource.getRealValue("chat.addmembersconfirm",[g])):(e.forEach(function(a){g.push(WmsContacts.get(a,!0).DNAME)}),g=g.join(", "),f=WmsResource.getRealValue("chat.addmembersconfirm",[g]));if(d.ctype=="8")WMSUI.inviteToChannel(a,e),WMSUI.handleMemberModificationCommand(a,i,b,!1);else{var j='<div class="wms-dialog-txtcont">'+util.escapeHTML(f)+"</div>",k='<div class="wms-dialog-imgouter"><div class="wms-dialog-imginner"><div class="wms-dialog-img"></div></div></div>',l={imghtml:k,bodyhtml:j,focusbutton:1,operations:[{name:WmsResource.getRealValue("Add"),action:function(){WMSUI.addMem(a,e),WmsDialog.removeModal(),WMSUI.handleMemberModificationCommand(a,i,b,!1)}},{name:WmsResource.getRealValue("chat.new"),action:function(){var c=WindowHandler.getWinObjById(a).partinfo;for(var d in c)e.push(d),h.push({zuid:d,dname:$WC.$CUtil.getContactName(d)||c[d].dname});var f=WmsHybridSearch.createChatTitle(h);WmsMainUI.scheduleAutoFocus(),WmsDialog.removeModal(),WMSUI.handleMemberModificationCommand(a,i,b,!0,e,f)}}]};WmsDialog.showModal(l,a)}return!0},WMSUI.handleMemberModificationCommand=function(a,b,c,d,e,f){$WC.$CUtil.isArray(b)||(b=b.split(","));var g="";for(var h=0;h<b.length-1;h++){var i=$WC.$CUtil.getContactName(b[h]);WMSUI.curtrigger==="+"?g+="{addchatmember:"+b[h]+":1:"+i+":addchatmember} ":WMSUI.curtrigger==="-"&&(g+="{deletechatmember:"+b[h]+":1:"+i+":deletechatmember} ")}return g=g.trim(),d?c&&c.trim()===g?WebMessanger.openUserChat(e.join(","),"true",f):WebMessanger.openUserChat(e.join(","),"true",f,c):c&&c.trim()!==g&&Message.send(a,c),!0},WMSUI.inviteToChannel=function(a,b){WebMessanger.inviteToChannel(a,b)},WMSUI.addMem=function(a,b){var c="";b.forEach(function(a){if(a){var b=WmsContacts.get(a,!0).EMAILID;c+=b.concat(",")}}),WebMessanger.addMember(a,c,b)},WMSUI.removeNewLine=function(a,b,c){WmsSessionStorage.setChatInfo({chid:c,text:b.value}),a.keyCode==13&&Message.trim(b.value)==""&&(b.value="");return},WMSUI.send=function(a,b){var c=Message.trim(a.value),d=a.value;if(c==""||c=="&nbsp;"||c=="<br>")return;Message.autofill(d);var e=a.className.replace(/wms[p]{0,1}editor/i,"");return d="<span class='"+e+"'>"+d+"</span>",Message.send(b,d),!1},WMSUI.disableShowHide=function(){WMSUI.enablehide=!1},WMSUI.i18N=function(a,b){return WmsResource.getRealValue(a)?WmsResource.getRealValue(a):b},WMSUI.init=function(){typeof WMSUI.hidden=="undefined"&&(WMSUI.hidden=!1),WMSUI.docClickcallbackQue={},WMSUI.i18Nuserstatus=null,WMSUI.scode=1;try{WmsSound.init(),WmsMediaPlayer.initSupportedAudioFormats(),WmsMediaPlayer.initSupportedVideoFormats(),WmsMediaPlayer.bindFullScreenEvent(),WmsUIImpl.openChatWindowDropUp=function(a,b,c){var d=WindowHandler.getWinObjById(b),e=d.autocompletediv,f=d.listcommon;c=c||{},f.showUI(a,c.defaultselect,c.sethtml,null,!0),e.style.display="block"},$WC.Functions.isTempResponse=function(a){var b=a.closest('[class^="wms-msg"]');return b?b.querySelectorAll('[class="wms-cmdvisiblediv"]').length>0:!1},$WC.Functions.init(),$WC.Functions.showResponse=function(a,b){var c=WindowHandler.getWinObjById(b),d=[];a.sender=WebMessanger.zuid,a.meta||(a.meta={}),a.meta.isTempResponse=!0;if(!a.msg)return;d.push(a),c.updateMessage(d)},$WC.Functions.showErrorResponse=function(a,b){var c=WindowHandler.getWinObjById(b),d=[];a.sender=WebMessanger.zuid,a.time=(new Date).getTime(),d.push(a),c.updateMessage(d)}}catch(a){}WMSUI.enablehide=typeof WMSUI.enablehide=="undefined"&&!0,WMSUI.populate(),WMSUI.inviteObj=[],$WC.template.setResource(WmsResource);var b=isNaN(WebMessanger.setzindex)?WebMessanger.setzindex:+WebMessanger.setzindex+1;$WC.$CUtil.setConfig({WMSCONT:_WMSCONT,CHATCONT:_CHATCONT,PUREJS:!0,Resource:WmsResource,AjaxDispatcher:WebMessanger.wmsAjaxDispatcher,zuid:WebMessanger.zuid,zindex:b,photoserver:_WMSPHOTOSERVER,isOrgUser:WebMessanger.isOrgUser,isRegistered:WebMessanger.isRegistered,SystemApiHandler:WebMessanger.systemApiHandler,LOCATION_INFO:{}}),$WC.$CUtil.checkAndUpdateLocationPermissionStatus();var c=document.createElement("style");c.type="text/css",c.innerHTML="#wmstoolbar *::-webkit-scrollbar, #zchhis *::-webkit-scrollbar{ height:8px; width:8px } #wmstoolbar *::-webkit-scrollbar-thumb, #zchhis *::-webkit-scrollbar-thumb{ background-color: #dcdcdc }",navigator.userAgent.indexOf("Mac")!==-1&&(c.innerHTML="#wmstoolbar *::-webkit-scrollbar, #zchhis *::-webkit-scrollbar{ height:5px; width: 5px } #wmstoolbar *::-webkit-scrollbar-thumb, #zchhis *::-webkit-scrollbar-thumb{ background-color: #dcdcdc }"),document.body.appendChild(c)},WMSUI.reminderClose=function(a,b){WMSUI.removeNotificationHolder("reminder"+a,b),WebMessanger.clearReminder(a)},WMSUI.removeNotificationHolder=function(a){WmsSound.stop(),ChatBlink.stopRepeat();var b=WindowHandler.getObjectInObject(WmsMainUI.notificationholder,a,"DIV");b.style.display="none",WmsMainUI.notificationholder.removeChild(b)},WMSUI.reminderSubmit=function(a,b,c){c.submit(),WMSUI.reminderClose(a,!0)},WMSUI.showRemainder=function(a){if(_WMSCALENDARSERVER=="")return;var b=a.ALRM,c=a.LOC,d=a.SD!=undefined&&a.SD!=""?a.SD:MyDate.formatDTTime(a.ST),e='<img src="https://img.zohostatic.com/ichat/v282_https/images/spacer.gif" class="wms-cb" onMouseOver="this.className=\'wms-cbh\'" onMouseOut="this.className=\'wms-cb\'" title="'+WmsResource.getRealValue("Close")+'" onclick="WMSUI.reminderClose(\''+b+'\',false);" ><span class="wms-ri"></span><b class="wms-mo">'+a.SUM+'</b><span class="wms-ms">',f;c.length>0?f='<span class="wms-hd">'+WmsResource.getRealValue("Location")+"</span><span>:</span><b>"+c+"</b>":f='<span class="wms-hd"></span>',WMSUI.initWmsIframe();var g='<span class="wms-ms"><span class="wms-hd"> '+WmsResource.getRealValue("Time")+"</span><b><span>:</span>"+d+' </span><form name="form'+b+'" target="wmsiframe" action="'+_WMSCALENDARSERVER+'/ApiAct.do" method="post"><div class="wms-bo"><select name="remt" id="remindtime"><option value="300000" > 5 '+WmsResource.getRealValue("min")+' </option><option value="600000" >10 '+WmsResource.getRealValue("min")+' </option><option value="900000" > 15 '+WmsResource.getRealValue("min")+' </option><option value="1200000" > 20 '+WmsResource.getRealValue("min")+' </option></select><input type="hidden" name="view" value="snzrem"><input type="hidden" name="aid" value="'+a.ALRM+'"><input type="button" class="wms-bn" value="'+WmsResource.getRealValue("Snooze")+'" onclick="WMSUI.reminderSubmit(\''+b+"','"+a.ALRM+'\', this.form)" /><input type="button" class="wms-bc" onclick="WMSUI.reminderClose(\''+b+'\',true);" value="'+WmsResource.getRealValue("Cancel")+'" /></div></form></span>',h=document.createElement("DIV");h.className="wms-rd",h.id="reminder"+b,h.innerHTML=e+f+g,WmsMainUI.notificationholder.appendChild(h)},WMSUI.initWmsIframe=function(){var a=document.getElementById("wmsiframe");if(a==undefined){var b='<IFRAME name="wmsiframe" style="display:none" id="wmsiframe" src="/'+_WMSCONT+'/html/blank.html"></IFRAME>',c=document.createElement("DIV");c.innerHTML=b,c.style.display="none",document.body.appendChild(c)}},WMSUI.createLiveSupport=function(a){var b=document.createElement("DIV");b.className="wms-rdls";var c=a.chid,d="";a.cinfo!=""&&(d="- "+a.cinfo);var e='<img src="https://img.zohostatic.com/ichat/v282_https/images/spacer.gif" class="wms-cb" onMouseOver="this.className=\'wms-cbh\'" onMouseOut="this.className=\'wms-cb\'" title="'+WmsResource.getRealValue("Close")+'"  onclick="WMSUI.removeNotificationHolder(\''+c+'\',false);" ><span class="wms-lsi"></span><b class="wms-mo" >'+a.title+'</b><span class="wms-ms">'+a.guname+" "+d+" "+MyDate.formatTime((new Date).getTime())+'</span><form name="form'+c+'" onsubmit="return WMSUI.acceptLiveSupport(\''+c+"','"+a.guid+"','"+a.a+"','"+a.g+'\');"><div id="txtholder" class="wms-bo wms-ntinfo"><input type="submit" class="wms-bn" value="'+WmsResource.getRealValue("Accept")+'" /><input type="button" class="wms-bc" onclick="WMSUI.removeNotificationHolder(\''+c+'\',true);" value="'+WmsResource.getRealValue("Skip")+'" /></form></div>';b.id=c,b.innerHTML=e,WMSUI.notificationholder.appendChild(b),WmsSound.playTune("support",6e4)},WMSUI.acceptLiveSupport=function(a,b,c,d){return WMSZohoApi.acceptLiveSupport(a,b,c,d),WMSUI.removeNotificationHolder(a,!0),!1},WMSUI.removeLiveSupport=function(a){WMSUI.removeNotificationHolder(a,!0)},WMSUI.missedLiveSupport=function(a){var b=WindowHandler.getObjectInObject(WMSUI.notificationholder,a,"DIV");b.className="wms-rdm",WindowHandler.getObjectInObject(b,"txtholder","DIV").innerHTML=WmsResource.getRealValue("Visitor_left_the_session"),WmsSound.stop()},WMSUI.endLiveSupport=function(a){a.sender="CT_INF_MSG",a.msg="<div class='upfilediv'><p><em> "+WmsResource.getRealValue("Support_session_sucessfully_ended")+" </em></p></div>",Message.formatAndDisplay(a)},WMSUI.attachSession=function(a){if(WMSUI.handleChatExist(a))return;WmsMainUI.scheduleAutoFocus(),WebMessanger.attachSession(a)},WMSUI.continueChat=function(a){if(WMSUI.handleChatExist(a))return;WmsMainUI.scheduleAutoFocus(),WebMessanger.continueChat(a),ZMSGUI.hidechathis()},WMSUI.handleChatExist=function(a){return Chat.isExists(a)&&WindowHandler.getWinObjById(a).titleGlow(),!1},WMSUI.handleChatWindowEscape=function(a,b){var c=WindowHandler.getWinObjById(b),d=c.autocompletediv,e=c.invisiblediv;return WmsMainUI.contactdetailsdiv.firstChild?(WmsProfileInfo.handleEscape(a),!0):d.style.display!="none"?(c.listcommon.showUI(""),d.style.display="none",c.footernode.style.borderRadius="5px",a.stopPropagation(),!0):c.composer.value?(c.composer.value="",e.innerHTML="",a.stopPropagation(),!0):c.editorreplydiv.style.display&&c.editorreplydiv.style.display!="none"?(c.closeReplyPreview(),a.stopPropagation(),!0):!1},WMSUI.handleDocumentEscape=function(a){WmsProfileInfo.handleEscape(a),ZMSGUI.removeOverlay();var b=document.getElementById("zfdshis"),c=document.getElementById("zfdsunread"),d=document.getElementById("zchhis"),e=document.getElementById("wms-hysearch"),f=document.getElementById("wms-custmmsgcontainer"),g=document.getElementById("wms-dialog"),h=document.getElementById("wms_pendinginv_container"),i=getEventTarget(a),j=i.getAttribute("chid"),k=document.getElementById(j);if(!$WC.$Win.handleEscape()){if(b!=null&&b.style.display=="block"){try{ZMSGUI.hidehis()}catch(l){}return!0}if(c!=null&&c.style.display=="block"){try{ZMSGUI.hideunread()}catch(l){}return!0}if(d!=null)return ZMSGUI.hidechathis(),!0;if(h!=null&&h.style.display=="block")return ZMSGUI.hidependinginv(),!0;if(f!=null)return ZMSGUI.hidecustmmsg(),!0;if(e!==null)return WmsHybridSearch.hideUI(),!0;if(g!==null)return WmsDialog.removeModal(),!0;k!=null&&WMSUI.handleChatWindowEscape(a,j)}},WMSUI.addMember=function(a,b,c){var d=WindowHandler.getWinObjById(b),e=d.addmemberinputnode,f=d.addmemberhiddeninputnode;f.value=f.value.substring(0,f.value.lastIndexOf(",")+1)+c+",",e.focus(),e.value=e.value.substring(0,e.value.lastIndexOf(",")+1)+a+",",e.scrollLeft=e.scrollWidth,d.addmemberlistnode.style.display="none",d.addmembericonnode.className="wms-addmember-enable"},WMSUI.showFileLimitAlert=function(){alert(WmsResource.getRealValue("You_have_exceeded_the_maximum_allowed_file_size_of_10MB"))},WMSUI.isFileLimitExceeded=function(a){var b=WindowHandler.getObjectInObject(a,"wms-file","input");return b.files&&b.files[0].size>1e7?(this.showFileLimitAlert(),!0):!1},WMSUI.submitFile=function(a){var b=a.getAttribute("chid");if(WMSUI.showErrorIfPermDenied(b))return;var c=WindowHandler.getObjectInObject(a,"wms-file","input").files;if(WmsFileUpload.isFileSizeExceeded(c)||!c.length)return a.reset(),!1;WmsFileUpload.init(b,c)},WMSUI.iframeUpload=function(a){var b=WindowHandler.getWinObjById(a),c=b.getInnerObject("formsend","form");if(isNaN(a)){var d=document.createElement("input");d.name="type",d.value=8,d.type="hidden",c.appendChild(d)}var e=c.sid,f=c.sender;e.value=WebMessanger.getSid(),f.value=WebMessanger.getUserName();var g=document.createElement("input");g.name=_CHATCFPARAMNAME,g.value=Cookie.getCustomCookie(_CHATCFTOKEN),g.type="hidden",c.appendChild(g),c.submit(),document.getElementById("actiondiv").style.display="none",document.getElementById("formsend").className="wms-rigp",c.reset(),WMSUI.imgPreview.removeOverlay()},WMSUI.sendFile=function(a,b,c){return this.isFileLimitExceeded(a)?(a.reset(),!1):b!="user"?!1:(a.type.value="im",a.userList.value=c,a.submit(),a.reset(),!1)},WMSUI.sendMail=function(a){var b=WmsContacts.contactslist[a]&&WmsContacts.contactslist[a].EMAILID;try{var c=Collaboration.handleComposeMail(b)}catch(d){c=!1}if(c==1)return;if(b==undefined||b==null)return;var e=parseInt(80*screen.width/100),f=parseInt(77*screen.height/100),g=(screen.width-e)/2,h=(screen.height-f)/2;window.open(""+_WMSMAILURL+"mail/compose.do?mode=compose&tp=zb&ct="+b,(new Date).getTime(),"height="+f+", width="+e+",status=yes,toolbar=no,top="+h+", left="+g+", menubar=no,location=no,scrollbars=yes,resizable=yes")},WMSUI.reinviteContByEmail=function(a){var b=WmsContacts.get(a),c=b.DNAME,d=b.EMAILID;WmsContacts.reinvite("zoho",d,c,WebMessanger.uname)},WMSUI.showBanner=function(a){if(WebMessanger.disablenetworkdownbanner||WebMessanger.isReuseSession())return;var b='<span id="wmsbannertext" class="wmsbannertext">'+WmsResource.getRealValue("connectionerror.netfail")+'</span><span id="recntime"></span><span class="wms-retrybutton" onclick="'+a+'()" title="'+WmsResource.getRealValue("Try_Now")+'"></span>',c=document.createElement("DIV");c.className="wms-statesmsg",c.id="wms-netdownbanner",c.style.zIndex=WebMessanger.setzindex<=9999?9999:WebMessanger.setzindex,c.innerHTML=b;if(this.isBannerShown("wms-netdownbanner")){var d=document.getElementById("wms-netdownbanner");d.parentNode.removeChild(d)}document.body.appendChild(c)},WMSUI.showInfoMsg=function(a){WMSUI.showErrorMsg(a,"info")},WMSUI.showErrorMsg=function(a,b){var c="<span>"+a+'</span><span onclick="WMSUI.hideErrorMsg()" class="wms_cw_opr_close wms-errormsgcls"></span>',d=document.createElement("DIV");d.className="wms-errormsg",b==="info"&&(d.className="wms-errormsg wms-infomsg"),d.id="wms-errormsg",d.style.zIndex=WebMessanger.setzindex<=9999?9999:WebMessanger.setzindex,d.innerHTML=c,WMSUI.hideErrorMsg(),document.body.appendChild(d),WMSUI.errormsgtimer=setTimeout(function(){WMSUI.hideErrorMsg()},1e4)},WMSUI.hideErrorMsg=function(){if(this.isBannerShown("wms-errormsg")){clearTimeout(WMSUI.errormsgtimer);var a=document.getElementById("wms-errormsg");a.parentNode.removeChild(a)}},WMSUI.updateTextInBanner=function(a){var b,c;if(a>60){var d=Math.floor(a/60);b=a%60,b<10&&(b="0"+b),c=d+":"+b}else b=a<10?"0"+a:a,c=b;this.isBannerShown("wms-netdownbanner")&&(a===0?document.getElementById("recntime").innerHTML=WmsResource.getRealValue("connectionerror.reconnect"):document.getElementById("recntime").innerHTML=WmsResource.getRealValue("connectionerror.reconnecttime",""+c))};var wmsCountDownTimer;WMSUI.showCountDownInBanner=function(a,b){function c(){WMSUI.updateTextInBanner(a);if(a===0){clearTimeout(wmsCountDownTimer),b();return}a--,wmsCountDownTimer=setTimeout(c,1e3)}clearTimeout(wmsCountDownTimer),c()},WMSUI.isBannerShown=function(a){return document.getElementById(a)!=null?!0:!1},WMSUI.hideBanner=function(){clearTimeout(wmsCountDownTimer);if(this.isBannerShown("wms-netdownbanner")){var a=document.getElementById("wms-netdownbanner");a.parentNode.removeChild(a)}},WMSUI.runIdleTimer=function(){if(WebMessanger.registerAnnonUser)return;clearTimeout(WMSUI.idletimer),WMSUI.idletimer=setTimeout(function(){WMSUI.handleDocumentIdle()},9e5)},WMSUI.handleDocumentIdle=function(){if(WebMessanger.registerAnnonUser)return;if(WebMessanger.scode==2)return;!WebMessanger.isIdle&&!WebMessanger.offline&&WebMessanger.setIdle()},WMSUI.checkDocumentActive=function(){ie?(document.attachEvent("onkeydown",WMSUI.handleDocumentActive),document.attachEvent("onclick",WMSUI.handleDocumentActive),document.attachEvent("onkeypress",WMSUI.handleDocumentActive),document.attachEvent("onmouseout",WMSUI.handleDocumentActive),document.attachEvent("onmouseenter",WMSUI.handleDocumentActive)):(document.addEventListener("keydown",WMSUI.handleDocumentActive,!0),document.addEventListener("keypress",WMSUI.handleDocumentActive,!0),document.addEventListener("mouseout",WMSUI.handleDocumentActive,!0),document.addEventListener("mouseenter",WMSUI.handleDocumentActive,!0),document.addEventListener("click",WMSUI.handleDocumentActive,!0))},WMSUI.handleDocumentActive=util.throttle(function(){if(WebMessanger.registerAnnonUser)return;clearTimeout(WMSUI.idletimer),WMSUI.idletimer=setTimeout(function(){WMSUI.handleDocumentIdle()},9e5),WebMessanger.isIdle&&!WebMessanger.offline&&WebMessanger.setActive()},null,1e4),WMSUI.toggleSound=function(){WmsSettings.sound==1?WmsSettings.updateWmsSettings("bchatsettings","sound",0):WmsSettings.updateWmsSettings("bchatsettings","sound",1)},WMSUI.reqNotificationPermAndToggle=function(a){$WC.DesktopNotification.requestPermission(),WmsSettings[a]==1?$WC.Ajax.postRequestToChat("updbsettings.do",a+"=0"):$WC.Ajax.postRequestToChat("updbsettings.do",a+"=1")},WMSUI.checkAndNotifyStatus=function(a,b){if(_WMSWINFOCUS||WmsSettings.vustatus==0||Message.isLocalUser(a.zuid))return;var c=+a.scode;c===2&&(c=0);if(c===0&&b>0||c>0&&b===0){var d=c?WmsResource.getRealValue("Available"):WmsResource.getRealValue("Offline");WMSUI.desktopNotify(d,"status",a)}},WMSUI.checkAndNotifyMsg=function(a){if(_WMSWINFOCUS||WmsSettings.vmessage==0||Message.isLocalUser(a.zuid))return;var b=a.msg;a.mod=="att"?b=WmsResource.getRealValue("chat.file.share"):a.mod=="contact"?b=WmsResource.getRealValue("chat.contact.share"):a.mod=="location"?b=WmsResource.getRealValue("chat.location.share"):a.mod=="event"&&(b=WmsResource.getRealValue("chat.event.share")),WMSUI.desktopNotify(b,"message",a)},WMSUI.desktopNotify=function(a,b,c){function d(a){var b=function(b,c){a=$WC.Matcher.replace(b,a,function(a,b,d){var e=Message.getDnameFromMetaDataFormat(d);return c+""+e})};return b("atmention_for_transcript","@"),b("addmember_for_transcript","+"),b("deletemember_for_transcript","-"),a}function e(a,b,c){return typeof c=="undefined"?"":$WC.Matcher.replace("removehtmltag",c,e)}if(WebMessanger.scode==="3")return;a=Message.isMentionMsg(a)||Message.isAddMsg(a)||Message.isDeleteMsg(a)?d(a):a,a=$WC.Matcher.replace("removehtmltag",a,e);var f=c.sender||c.zuid,g="";f.indexOf("b-")===-1?g=_WMSPHOTOSERVER+"/file?ID="+f+"&t=user&height=50&width=50":g=WmsContacts.contactslist[c.sender].PHOTO,$WC.DesktopNotification.show({title:WebMessanger.unescapeHTML(WMSUI.getNotificationTitle(c)),body:WebMessanger.unescapeHTML(a),icon:g,checkownership:c.a?!1:wmsnotifyowner,duration:"5000",id:b})},WMSUI.getNotificationTitle=function(a){var b=$WC.$CUtil.getContactName(a.zuid,a.dname);if(a.chid){var c=WindowHandler.getWinObjById(a.chid);if(c.isZohoGroupChat()||c.partcount>2||b!==c.getTitle()){var d=c.getTitle().startsWith("@")?" ":" @";return b+d+c.getTitle()}}return b},WMSUI.RestartTimers=function(){WMSUI.runIdleTimer()},WMSUI.processAnnMsg=function(a,b){if(WebMessanger.silentOverriddenForAnnouncement===!1&&silent)return;var c=document.getElementById("wmsannmsg"),d=document.getElementById("annmsgstrip");b=b||"warn",c.style.display="none",d.style.display="none",c.className="zread_olymn",d.className="zread_strip";if(a===""||WMSUI.isAnnBlocked())return;if(typeof WmsUIImpl!="undefined"&&WmsUIImpl.handleAnnouncement&&WmsUIImpl.handleAnnouncement(a,b))return;$WC.$CUtil.addClass(d,"wmsann"+b+"_strip"),$WC.$CUtil.addClass(c,"wmsann"+b+"_bg"),d.style.display="block",document.getElementById("annmsg").innerHTML=a,WMSUI.annShowAnimate("wmsannmsg")},WMSUI.isAnnBlocked=function(){var a=WmsSettings.disann,b=wmsUserConfig.infomsgid;return Cookie.getCustomCookie(b)?!0:a&&(a[WebMessanger.prd]||a.All)&&b?a[WebMessanger.prd]===b||a.All===b:!1},WMSUI.showAnnMsg=function(){var a=document.getElementById("showinfo");a.setAttribute("class","zread_olymn1"),WMSUI.annHideAnimate("showinfo")},WMSUI.annHideAnimate=function(a){a=document.getElementById(a);var b=setInterval(function(){var c=a.offsetTop;a.style.top=c-1+"px",-c>=a.offsetHeight&&(clearInterval(b),a.style.display="none",a.style.top="0px")},8)},WMSUI.annShowAnimate=function(a){a=document.getElementById(a),a.style.display="block";var b=-a.offsetHeight;a.style.top=b+"px";var c=setInterval(function(){a.style.top=(b+=1)+"px",b>=3&&clearInterval(c)},8)},WMSUI.hideAnnMsg=function(a){typeof a.stopPropagation=="function"?a.stopPropagation():a.cancelBubble=!0,WMSUI.annHideAnimate("wmsannmsg")},WMSUI.showTicketAnnouncement=function(a){var b=document.getElementById("wmsiamann");b||(b=document.createElement("div"),b.id="wmsiamann",b.className="wmsiamann",WmsMainUI.maincontainer.appendChild(b)),b.innerHTML=a},WMSUI.closeTicketAnnouncement=function(){var a=document.getElementById("wmsiamann");a&&a.parentNode.removeChild(a)},WMSUI.selectGS=function(){},WMSUI.unselectGS=function(){},WMSUI.populateDeactivatedChatUI=function(){WmsMainUI.maincontainer&&WmsMainUI.maincontainer.parentNode.removeChild(WmsMainUI.maincontainer),WmsGroups.lastupdatetime=null,WmsChatCache.removeAll(),WmsMainUI.populate(),WmsMainUI.hideMenu(),WmsMainUI.menucontainer.style.display="none",wmsnotifyowner&&wmsnotifyowner.clearOwnerSync(),document.getElementById("chatturnoffinfo").style.display="block";if(WebMessanger.chatdisabled===!0){var a=WmsSettings.adminsettings.licenseduser===!1?"unlicensed":"nonappaccount";document.getElementById("chatturnoffinfo").innerHTML=WmsResource.getRealValue("chat.disabled."+a)+"</div>"}else WebMessanger.allprdchatdeactivated===!0&&(document.getElementById("chatturnoffinfo").innerHTML=WmsResource.getRealValue("chat.disabled.all")+' <a style="cursor:pointer;" onclick="WebMessanger.turnOnChat()">'+WmsResource.getRealValue("chat.disabled.here")+"</a></div>")},WMSUI.populateEmptyBar=function(){WmsMainUI.maincontainer&&WmsMainUI.maincontainer.parentNode.removeChild(WmsMainUI.maincontainer),WMSUI.enablehide=!1,WMSUI.smartchatenabled=!1,WmsGroups.lastupdatetime=null,WmsChatCache.removeAll(),WMSUI.populateMainBar()},WMSUI.showLoadingIcon=function(a,b,c){var d=document.createElement("div");d.setAttribute("data-loading","true"),d.className="wms-loadingicon";var e='<img src="https://img.zohostatic.com/ichat/v282_https/images/loading1.gif">';return c&&(e=WmsResource.getRealValue("Loading")+" "+e),d.innerHTML=e,b==="append"?a.appendChild(d):b==="prepend"?a.insertBefore(d,a.firstChild):b==="insert"?(a.parentNode.replaceChild(d,a),d):a.appendChild(d)};var ZMSG_CURRPAGE=1,ZMSG_MSGPERPAGE=10,ZMSG_NEW=!1,ZMSG_HIS=!1,ZMSG_NOTIFY=!1,ZMSG_SEARCH=!1,ZMSG_SEARCHURL="",ZMSG_MSGCNT=0,ZMSG_NEWMSGCNT=0,ZMSG_MSGNO=2048,ZMSG_DATAOBJ={},ZMSG_UNREAD=!1,ZMSG_CHATCOUNT=15,ZMSG_SEARCHVALUE="",ZMSG_CHATPGNO=1,ZMSG_CHATS=0,ZMSG_CHATTOTALOBJ=0,ZMSG_chhis=null,ZMSG_USERID="",ZMSG_NO_MORE_CHATS=!1,ZMSG_translistloader,ZMSG_transmoreloader,ZMSG_MSGOBJ=[];ZMSGUI.generateNewUI=function(){var a='<div class="wmsouterdiv wmscomstl"><table cellpadding="0" cellspacing="0" width="100%" class="wmsoutertbl"><thead><th><img src="https://img.zohostatic.com/ichat/v282_https/images/spacer.gif" class="wmscloseicon" title="'+WmsResource.getRealValue("Close")+'" onClick="ZMSGUI.hidenew();" /><span class="wmsheading wmscomstl">'+WmsResource.getRealValue("Zoho_Feeds")+' (<label id="zfdscnt">0</label> '+WmsResource.getRealValue("New")+')<font style="font-weight:normal"> (<a href="javascript:;" onClick="ZMSGUI.launchHistory();">'+WmsResource.getRealValue("Feed_History")+"</a>)</font></span></th></thead>"+'<tbody><tr><td><div class="wmsflowingdiv wmscomstl" id="zfdsnew_cont" onclick="ZMSGUI.shownew();"></div></td></tr></tbody>'+"</table>"+"</div>";return a},ZMSGUI.showFeedSearchCategory=function(a){var b=a.querySelector('[id="zmsgsearch"]');b.style.display==="none"||b.style.display===""?(a.style.borderBottomRightRadius="0px",a.style.borderBottomLeftRadius="0px",b.style.display="block"):(a.style.borderRadius="5px",b.style.display="none")},ZMSGUI.selectFeedSearchCategory=function(a){var b=getEventTarget(a),c=b.parentNode.previousSibling;if(c.id==="wms-selfeedcat"){var d=$WC.$CUtil.getInnerText(b);$WC.$CUtil.setInnerText(c,d)}},ZMSGUI.generateHistoryUI=function(){return'<div id="wms-feedsheader" class="wms-feedsheader"><span class="wms-feedhiscontent wms-valign-mid-block">'+WmsResource.getRealValue("Feed_History")+"</span>"+'<span class="wms-feedsclose" onclick="ZMSGUI.hidehis();"></span>'+"</div>"+'<div class="wms-feedsearch">'+'<form onsubmit="return ZMSGUI.searchHis();">'+'<div class="wms-feedsearchcat" onclick="ZMSGUI.showFeedSearchCategory(this)">'+'<span id="wms-selfeedcat">'+WmsResource.getRealValue("All")+"</span>"+'<ul class="wms-feedhisselct" id="zmsgsearch" onclick="ZMSGUI.selectFeedSearchCategory(event)">'+'<li value="all">'+WmsResource.getRealValue("All")+"</li>"+'<li value="searchstr">'+WmsResource.getRealValue("Message")+"</li>"+'<li value="sender">'+WmsResource.getRealValue("Sender")+"</li>"+"</ul>"+"</div>"+'<input id="zmsgsearchtxt" type="text" placeholder="'+WmsResource.getRealValue("feeds.search")+'"  class="wmsoptiontext wms-feedsearchtxt">'+'<input type="button" value="'+WmsResource.getRealValue("Go")+'" class="wmsbtn wms-feedsearchbtn" onclick="ZMSGUI.searchHis();">'+"</form>"+"</div>"+'<div onclick="ZMSGUI.showhis();" id="zfdshis_cont" class="wms-feedhiscont">'+"</div>"+'<div class="wms-feedhisnav" id="zmsghisnav">'+"</div>"+"</div>"},ZMSGUI.fillNavigation=function(a){var b="",c=1,d=ZMSG_CURRPAGE-1,e=ZMSG_CURRPAGE+1,f=a%ZMSG_MSGPERPAGE!=0?(a-a%ZMSG_MSGPERPAGE)/ZMSG_MSGPERPAGE+1:(a-a%ZMSG_MSGPERPAGE)/ZMSG_MSGPERPAGE,g=ZMSG_CURRPAGE*ZMSG_MSGPERPAGE>a?a:ZMSG_CURRPAGE*ZMSG_MSGPERPAGE;ZMSG_CURRPAGE<=1?b='<input class="wmsleftashtext" type="button" value="'+WmsResource.getRealValue("First")+'">':b='<input class="wmsleftashtext" type="button" onclick="ZMSGUI.gotoPage('+c+');" value="'+WmsResource.getRealValue("First")+'"><input type="button" onclick="ZMSGUI.gotoPage('+d+');" value="'+WmsResource.getRealValue("Previous")+'" class="wmsleftashtext">',ZMSG_CURRPAGE*ZMSG_MSGPERPAGE>=a?b+='<input type="button" value="'+WmsResource.getRealValue("Last")+'" class="wmsrightashtext" style="margin-right: 10px;">':b+='<input type="button" value="'+WmsResource.getRealValue("Last")+'" class="wmsrightashtext" onclick="ZMSGUI.gotoPage('+f+');" style="margin-right: 10px;"><input type="button" value="'+WmsResource.getRealValue("Next")+'" class="wmsrightashtext" onclick="ZMSGUI.gotoPage('+e+' );">',b+='<span class="wms-hvalign">'+WmsResource.getRealValue("feeds.count.show",[(ZMSG_CURRPAGE-1)*ZMSG_MSGPERPAGE+1,g,a])+"</span>",document.getElementById("zmsghisnav").innerHTML=b},ZMSGUI.getHisNav=function(){if(ZMSG_SEARCH)var a=ZMSG_SEARCHURL;$WC.Ajax.requestToChat("zmsgcount.do",a)},ZMSGUI.NewMsgUIobj=function(a,b){if(a==null)return;var c=document.createElement("div");c.className="wmscurv";try{a.ATTACHMENTS=JSON.parse(a.ATTACHMENTS)}catch(d){a.ATTACHMENTS=null}ZMSG_DATAOBJ[b]=a,a=ZMSGUI.formatMSG(a);var e='<b class="wmsrtop"><b class="wmsr1"></b><b class="wmsr2"></b><b class="wmsr3"></b><b class="wmsr4"></b></b><div class="wmsinnerdiv"><p class="wmspline">'+a.STATUS+""+a.MSG+'</p><span class="wmsashtxtright">('+a.TIME+")</span>";return ZMSGUI.trim(a.URL)!=""&&ZMSGUI.trim(a.URLSTRING)!=""?e+='<a href="'+a.URL+'" target="_blank" onClick="javascript:return ZMSGUI.openfeed('+b+",'new');\">"+a.URLSTRING+"</a>":ZMSGUI.trim(a.URL)!=""?e+='<a href="'+a.URL+'" target="_blank" onClick="javascript:return ZMSGUI.openfeed('+b+",'new');\">"+a.URL+"</a>":ZMSGUI.trim(a.URLSTRING)!=""&&(e+=a.URLSTRING),e+='</div><b class="wmsrbottom"><b class="wmsr4"></b><b class="wmsr3"></b><b class="wmsr2"></b><b class="wmsr1"></b></b>',c.innerHTML=e,c},ZMSGUI.HisMsgUIobj=function(a,b){if(a==null)return;try{a.ATTACHMENTS=JSON.parse(a.ATTACHMENTS)}catch(c){a.ATTACHMENTS=null}ZMSG_DATAOBJ[b]=a,a=ZMSGUI.formatMSG(a);var d='<div class="wms-feedhiswrapper"><div class="wms-feedhisrow"><div class="wms-feedmsgwrapper"><span class="wms-feedmsgtime">'+a.TIME+"</span>";return b<WmsUnreadFeeds.count?d+='<span class="wms-feedmsg" style="font-weight:bold">'+a.MSG+"</span>":d+='<span class="wms-feedmsg">'+a.MSG+"</span>",d+="</div>",ZMSGUI.trim(a.URL)!=""&&ZMSGUI.trim(a.URLSTRING)!=""?d+='<div class="wms-feedurl"><a href="'+a.URL+'" target="_blank" onClick="return ZMSGUI.openfeed('+b+",'history');\">"+a.URLSTRING+"</a></div>":ZMSGUI.trim(a.URL)!=""?d+='<div class="wms-feedurl"><a href="'+a.URL+'" target="_blank" onClick="return ZMSGUI.openfeed('+b+",'history');\">"+a.URL+"</a></div>":ZMSGUI.trim(a.URLSTRING)!=""&&(d+='<div class="wms-feedurl">'+a.URLSTRING+"</div>"),d+="</div></div>",d},ZMSGUI.openfeed=function(a,b){var c=ZMSG_DATAOBJ[a];try{b=="push"&&ZMSG_MSGCNT==1&&ZMSGUI.hidenew()}catch(d){}try{return Collaboration.openURL(c.URL,c.URLSTRING,c.ATTACHMENTS,c.PRODID)}catch(d){return!0}},ZMSGUI.formatMSG=function(a){var b="",c;try{b=a.SENDER;if(b!=null&&b!=""){try{c=a.DNAME}catch(d){}isNaN(b)?c=c!=undefined&&c!=""?c:b:c=$WC.$CUtil.getContactName(b,c)}}catch(d){}if(a.PARAMS!="")a.MSG=c!=undefined&&c!=""?WmsResource.getRealData(a.MSG,a.PARAMS)+"<span id='wmsfeedsender' class='wmsfeedsender'><span> - </span><a href='javascript:;' onClick='WebMessanger.chat(\""+b+"\");'>"+$WC.$CUtil.safeHTML(c)+"</a></span>":WmsResource.getRealData(a.MSG,a.PARAMS);else{var e=new RegExp(b+" ","i");a.MSG=a.MSG.search(e)==0?a.MSG.replace(e,""):a.MSG,a.MSG=c!=undefined&&c!=""?WmsResource.getRealData(a.MSG)+"<span id='wmsfeedsender' class='wmsfeedsender'><span> - </span><a href='javascript:;' onClick='WebMessanger.chat(\""+b+"\");'>"+$WC.$CUtil.safeHTML(c)+"</a></span>":WmsResource.getRealData(a.MSG)}return a.TIME=MyDate.formatDTTime(a.TIME),a.STATUS=ZMSGUI.getStatus(a.STATUS,a.SENDER),a},ZMSGUI.pushMsgUIobj=function(a){if(a==null)return;ZMSG_DATAOBJ[ZMSG_MSGNO]=a,a=ZMSGUI.formatMSG(a);var b='<div class="wmscurv"><b class="wmsrtop"><b class="wmsr1"></b><b class="wmsr2"></b><b class="wmsr3"></b><b class="wmsr4"></b></b><div class="wmsinnerdiv"><p class="wmspline">'+a.STATUS+""+a.MSG+'</p><span class="wmsashtxtright">('+a.TIME+")</span>";return ZMSGUI.trim(a.URL)!=""&&ZMSGUI.trim(a.URLSTRING)!=""?b+='<a href="'+a.URL+'" target="_blank" onClick="javascript:return ZMSGUI.openfeed('+ZMSG_MSGNO+",'push');\">"+a.URLSTRING+"</a>":ZMSGUI.trim(a.URL)!=""?b+='<a href="'+a.URL+'" target="_blank" onClick="javascript:return ZMSGUI.openfeed('+ZMSG_MSGNO+",'push');\">"+a.URL+"</a>":ZMSGUI.trim(a.URLSTRING)!=""&&(b+=a.URLSTRING),b+='</div><b class="wmsrbottom"><b class="wmsr4"></b><b class="wmsr3"></b><b class="wmsr2"></b><b class="wmsr1"></b></b></div>',b},ZMSGUI.getStatus=function(a,b){var c='<img src="https://img.zohostatic.com/ichat/v282_https/images/spacer.gif" class="wmsinfoicon" title="'+WmsResource.getRealValue("Zoho_Info")+'"/>';if(ZMSGUI.trim(b)=="")return c;try{switch(a){case"1":c='<img src="https://img.zohostatic.com/ichat/v282_https/images/spacer.gif" class="wmszeticon" onClick="WebMessanger.chat(\''+b+'\');" title="'+b+" - "+WmsResource.getRealValue("Online")+'"/>';break;case"0":c='<img src="https://img.zohostatic.com/ichat/v282_https/images/spacer.gif" class="wmsofficon" onClick="WebMessanger.chat(\''+b+'\');" title="'+b+" - "+WmsResource.getRealValue("Offline")+'"/>';break;case"2":c='<img src="https://img.zohostatic.com/ichat/v282_https/images/spacer.gif" class="wmsinfoicon" title="'+WmsResource.getRealValue("Zoho_Info")+'"/>';break;default:c='<img src="https://img.zohostatic.com/ichat/v282_https/images/spacer.gif" class="wmsinfoicon" title="'+WmsResource.getRealValue("Zoho_Info")+'"/>'}}catch(d){}return c},ZMSGUI.launchNew=function(){ZMSG_NEW||(ozfdsnew=document.createElement("div"),ozfdsnew.style.display="none",ozfdsnew.className="wmsoutercurv wmscomstl",ozfdsnew.id="zfdsnew",document.body.appendChild(ozfdsnew)),ozfdsnew.innerHTML=ZMSGUI.generateNewUI(),ZMSGUI.createOverlay(),ozfdsnewcont=document.getElementById("zfdsnew_cont"),ZMSG_NEW=!0,ZMSGUI.refreshNew()},ZMSGUI.launchNewswap=function(){ozfdsnewswap=document.createElement("div"),ozfdsnewswap.style.display="none",ozfdsnewswap.id="zfdsnewswap",document.body.appendChild(ozfdsnewswap)},ZMSGUI.fillNew=function(a){if(a==null)return;var b=a.ZohoMessages;if(b==null)return;var c=b.length;if(c<=0)return;ozfdsnewcont.innerHTML="";for(var d=0;d<c;d++)ozfdsnewcont.appendChild(ZMSGUI.NewMsgUIobj(b[d],d));ZMSG_MSGCNT=c,document.getElementById("zfdscnt").innerHTML=ZMSG_MSGCNT,ZMSGUI.shownew()},ZMSGUI.refreshNew=function(){$WC.Ajax.requestToChat("unreadzmsg.do","pageno=1&limit=0")},ZMSGUI.launchHistory=function(){try{if(ZohoFeedImpl.handleFeedHistoryUI())return}catch(a){}document.getElementById("zchhis")!=null&&ZMSGUI.hidechathis();try{ZMSGUI.hidenew()}catch(a){}ZMSG_CURRPAGE=1,ZMSG_HIS||(ozfdshis=document.createElement("div"),ozfdshis.style.display="none",ozfdshis.className="wms-feedshis wms-hvalign",ozfdshis.id="zfdshis",document.body.appendChild(ozfdshis)),ozfdshis.innerHTML=ZMSGUI.generateHistoryUI(),ZMSGUI.createOverlay(),ZMSG_HIS=!0,ZMSG_SEARCH=!1,ZMSG_SEARCHURL="",document.getElementById("zmsgsearch").selectedIndex=0,document.getElementById("zmsgsearchtxt").value="",ZMSGUI.refreshHis()},ZMSGUI.fillHistory=function(a){var b=document.getElementById("zfdshis_cont");b.innerHTML="",ZMSG_SEARCH&&(b.innerHTML="",document.getElementById("zmsghisnav").innerHTML="");if(a==null){b.innerHTML='<div class="wmsfdsempty">'+WmsResource.getRealValue("No_feeds_found")+"</div>";if(ZMSG_SEARCH){var c=document.getElementById("zmsgsearchtxt").value;b.innerHTML='<div class="wmsfdsempty">'+WmsResource.getRealValue("No_results_match_for_your_search")+' "'+c+'"</div>'}ZMSGUI.showhis();return}var d=a.ZohoMessages;if(typeof d=="undefined"){b.innerHTML='<div class="wmsfdsempty">'+WmsResource.getRealValue("No_feeds_found")+"</div>",ZMSG_SEARCH&&(c=document.getElementById("zmsgsearchtxt").value,b.innerHTML='<div class="wmsfdsempty">'+WmsResource.getRealValue("No_results_match_for_your_search")+' "'+c+'"</div>'),ZMSGUI.showhis();return}var e=d.length;if(e<=0){b.innerHTML='<div class="wmsfdsempty">'+WmsResource.getRealValue("No_feeds_found")+"</div>",ZMSG_SEARCH&&(c=document.getElementById("zmsgsearchtxt").value,b.innerHTML='<div class="wmsfdsempty">'+WmsResource.getRealValue("No_results_match_for_your_search")+' "'+c+'"</div>'),ZMSGUI.showhis();return}ZMSGUI.getHisNav();for(var f=0;f<e;f++)b.insertAdjacentHTML("beforeend",ZMSGUI.HisMsgUIobj(d[f],f));ZMSGUI.showhis()},ZMSGUI.refreshHis=function(){var a="pageno="+ZMSG_CURRPAGE+"&limit="+ZMSG_MSGPERPAGE;ZMSG_SEARCH&&(a+="&"+ZMSG_SEARCHURL);var b=function(a){WebMessanger.callClearNotification();if(WmsUnreadFeeds.count&&a==="NODATA"){var b={ZohoMessages:ZMSG_MSGOBJ};ZMSGUI.fillHistory(b),ZMSG_MSGOBJ=[]}else ZMSGUI.fillHistory(a.tableToRowList)};$WC.Ajax.requestToChat("zmsg.do",a,b)},ZMSGUI.clearSearch=function(){ZMSG_SEARCH=!1,ZMSG_SEARCHURL="",ZMSG_CURRPAGE=1,document.getElementById("zmsgsearch").selectedIndex=0,document.getElementById("zmsgsearchtxt").value="",ZMSGUI.refreshHis()},ZMSGUI.searchHis=function(){ZMSG_CURRPAGE=1;var a="pageno="+ZMSG_CURRPAGE+"&limit="+ZMSG_MSGPERPAGE,b=document.getElementById("wms-selfeedcat").innerHTML,c=document.getElementById("zmsgsearchtxt").value;if(ZMSGUI.trim(c)=="")return ZMSG_SEARCH=!1,ZMSG_SEARCHURL="",$WC.Ajax.requestToChat("zmsg.do",a),!1;var d=encodeURIComponent(c),e="";switch(b){case"Message":e=e+"searchstr="+d;break;case"category":e=e+"category="+d;break;case"Sender":e=e+"sender="+d;break;case"All":e=e+"searchstr="+d,e=e+"&category="+d,e=e+"&sender="+d}return ZMSG_SEARCH=!0,ZMSG_SEARCHURL=e,$WC.Ajax.requestToChat("zmsg.do",ZMSG_SEARCHURL),!1},ZMSGUI.viewTranscript=function(a,b,c){function e(){var b=this.responseText;ZMSGUI.updateTranscript(a,b)}var d="chid="+a+"&tzoffset="+_TZOFFSET+"&makeread="+b+"&partial="+c+"&lang="+WebMessanger.language+"&ccode="+WebMessanger.countrycode+"&view=unread&displayid="+a;WebMessanger.getDateFormat()!=undefined&&(d+="&dateformat="+encodeURIComponent(WebMessanger.getDateFormat())),$WC.Ajax.requestToChat("viewwmstranscript.do",d,e)},ZMSGUI.updateTranscript=function(a,b){try{b=HtmlTag.cure(b)}catch(c){}b=Smiley.replace(b),b=Message.replaceAttURL(b),ozfdsunreaddata.innerHTML=b,ozfdsunreaddata.scrollTop=ozfdsunreaddata.scrollHeight-ozfdsunreaddata.clientHeight,ozfdsunreadreply.onclick=function(){util.checkSessionConfig("CHAT")?WebMessanger.join(a):confirm(WmsResource.getRealValue("chat.paused")+" "+WmsResource.getRealValue("chat.unpause"))&&WebMessanger.turnOnChat(),ZMSGUI.hideunread()},document.getElementById("offcont"+a).className="sel"},ZMSGUI.gotoPage=function(a){ZMSG_CURRPAGE=a,ZMSGUI.refreshHis()},ZMSGUI.add=function(a){try{ozfdsnot.style.display=="none"&&ozfdsnew.style.display=="none"&&ozfdshis.style.display=="none"&&(ZMSG_DATAOBJ=Object())}catch(b){}ozfdsnewswap.innerHTML=ZMSGUI.pushMsgUIobj(a)+ozfdsnewswap.innerHTML,ZMSG_NEWMSGCNT++,ZMSGUI.notify()},ZMSGUI.deleteEmbedFeedUI=function(){try{ozfdsnot.style.display=="block"&&(ozfdsnot.style.display="none")}catch(a){}},ZMSGUI.zoomnotify=function(a){a.style.display="none";try{ZMSGUI.hidehis()}catch(b){}ozfdsnewcont.innerHTML=ozfdsnewswap.innerHTML+ozfdsnewcont.innerHTML,ZMSG_MSGCNT+=ZMSG_NEWMSGCNT,document.getElementById("zfdscnt").innerHTML=ZMSG_MSGCNT,ozfdsnewswap.innerHTML="",ZMSG_NEWMSGCNT=0,ZMSGUI.shownew()},ZMSGUI.notify=function(){try{if(ZohoFeedImpl.handleUnreadFeedUI())return}catch(a){}ZMSG_NOTIFY||(ozfdsnot=document.createElement("div"),ozfdsnot.style.position="absolute",ozfdsnot.style.zIndex=30,ozfdsnot.style.right="3px",ozfdsnot.style.bottom="-35px",ie?ozfdsnot.onclick=function(){ZMSGUI.zoomnotify(this)}:ozfdsnot.setAttribute("onclick","ZMSGUI.zoomnotify(this)"),document.body.appendChild(ozfdsnot)),ZMSG_MSGNO++,ZMSG_NOTIFY=!0;var b="https://img.zohostatic.com/ichat/v282_https/images/"+(WebMessanger.getRebrand()!=""?"rebrand/"+WebMessanger.getRebrand()+"/":"")+"feed_blink.gif?nocache="+ZMSG_MSGNO;ozfdsnot.innerHTML='<div class="wmsfeedNotiDiv"><div style="float:left;width:26px;margin:4px;"><img src="'+b+'" width="26" height="25" align=""></div><div style="margin-top:3px;"><b>'+WmsResource.getRealValue("Feeds")+'</b><br><span class="wmsfCnt">'+ZMSG_NEWMSGCNT+" "+WmsResource.getRealValue("New")+"</span></div></div>";if(ozfdsnot.style.display!="block"){ozfdsnot.style.bottom="-35px",ozfdsnot.style.display="block";try{ozfdsnot.style.zIndex=$WC.$CUtil.getConfig("zindex")}catch(a){}ZMSGUI.scrollnotify(0)}},ZMSGUI.scrollnotify=function(a){var b=+ozfdsnot.style.bottom.replace("px","");ozfdsnot.style.bottom=b+a+"px",b<0&&setTimeout(function(){ZMSGUI.scrollnotify(3)},50)},ZMSGUI.shownew=function(){WmsImplHandler.invoke(WmsUIImpl.handleUnreadFeeds);var a=document.getElementById("zfdsnew");try{a.style.zIndex=$WC.$CUtil.getConfig("zindex")}catch(b){}a.style.display="block",ZMSGUI.changeposozfdsnew?ZMSGUI.changeposition(a,ZMSGUI.ozfdsnewleft,ZMSGUI.ozfdsnewtop):ZMSGUI.center(a)},ZMSGUI.hidenew=function(){ZMSGUI.removeOverlay(),ozfdsnewcont.innerHTML="",document.getElementById("zfdscnt").innerHTML=0,ZMSG_MSGCNT=0,ozfdsnew.style.display="none"},ZMSGUI.showhis=function(){WmsImplHandler.invoke(WmsUIImpl.handleFeedHistory);var a=document.getElementById("zfdshis");try{a.style.zIndex=$WC.$CUtil.getConfig("zindex")}catch(b){}a.style.display="block"},ZMSGUI.hidehis=function(){ZMSGUI.removeOverlay(),document.getElementById("zfdshis").style.display="none"},ZMSGUI.init=function(){setTimeout(function(){ZMSGUI.launchNew()},1e3),setTimeout(function(){ZMSGUI.launchNewswap()},1010),ZMSGUI.changeposozfdshis=!1,ZMSGUI.changeposozfdsnew=!1},ZMSGUI.centerPosition=function(a){var b="";a.id=="zchhis"?b=ZMSG_chhis:a.id=="zfdshis"?b=document.getElementById("zfdshis"):a.id=="zfdsunread"&&(b=document.getElementById("zfdsunread")),ie?addEvent(window,"scroll",function(){ZMSGUI.center(b)}):document.addEventListener("scroll",function(){ZMSGUI.center(b)},!1)},ZMSGUI.center=function(a){var b="800px",c="600px";b=window.innerWidth!=null?window.innerWidth:document.documentElement!=null?document.documentElement.clientWidth||document.body.clientWidth:null,c=window.innerHeight!=null?window.innerHeight:document.documentElement!=null?document.documentElement.clientHeight||document.body.clientHeight:null;var d=a.offsetWidth,e=a.offsetHeight,f=parseInt(b/2)-parseInt(d/2),g=parseInt(c/2)-parseInt(e/2),h=document.body.scrollTop||document.documentElement.scrollTop;g+=h,a.style.left=f+"px",a.style.top=g+"px"},ZMSGUI.trim=function(a){while(a.substring(0,1)==" "||a.substring(0,1)=="\n")a=a.substring(1,a.length);while(a.substring(a.length-1,a.length)==" "||a.substring(a.length-1,a.length)=="\n")a=a.substring(0,a.length-1);return a},ZMSGUI.positionFeedHistory=function(a,b){ZMSGUI.changeposozfdshis=!0,ZMSGUI.ozfdshisleft=a,ZMSGUI.ozfdshistop=b},ZMSGUI.positionUnreadFeeds=function(a,b){ZMSGUI.changeposozfdsnew=!0,ZMSGUI.ozfdsnewleft=a,ZMSGUI.ozfdsnewtop=b},ZMSGUI.changeposition=function(a,b,c){try{a.style.left=b,a.style.top=c}catch(d){}},ZMSGUI.generateUnreadUI=function(){var a='<div class="wmsouterdiv wmscomstl"><table cellpadding="0" cellspacing="0" width="100%" class="wmsoutertbl"><thead><th><img src="https://img.zohostatic.com/ichat/v282_https/images/spacer.gif" class="wmscloseicon" onClick="ZMSGUI.hideunread();" title="'+WmsResource.getRealValue("Close")+'" /><span class="wmsheading wmscomstl" onclick="ZMSGUI.showunread();">'+WmsResource.getRealValue("Unread_Chat")+" </span></th></thead>"+'<tbody><tr><td class="wms-font">'+'<div class="offline-chat"><span>'+WmsResource.getRealValue("Name")+"</span><span>"+WmsResource.getRealValue("Date")+"</span></div>"+'<ul class="unread-chat" onclick="ZMSGUI.showunread();" id="zfdsunread_cont" > </ul>'+'<div class="offline-chatdivder" ></div>'+'<div class="offline-chatvisible" id="zfdsunread_data" ></div>'+'<div class="offline-chatFooter">'+'<input class="wmsbtnunread" type="button" value="'+WmsResource.getRealValue("Reply")+'"  id="zfdsunreadreply" /><input class="wmsbtnunread" style="margin-right:5px;" type="button" value="'+WmsResource.getRealValue("Mark_all_read")+'" onClick="WebMessanger.markAllRead()" /><input class="wmsbtnunread"  onClick="ZMSGUI.hideunread();" type="button" value="'+WmsResource.getRealValue("Close")+'" />'+"</div>"+"</td></tr></tbody>"+"</table>"+"</div>";return a},ZMSGUI.showunread=function(){try{zfdsunread.style.zIndex=$WC.$CUtil.getConfig("zindex"),zfdsunread.style.display="block",ZMSGUI.center(zfdsunread)}catch(a){}},ZMSGUI.hideunread=function(){var a=WmsMainUI.defaultchatlist.firstChild;a&&a.getAttribute("data-id")==="wms_menu_feedsnotify"&&$WC.$CUtil.removeElement(a)},ZMSGUI.getOfflineMessage=function(){return $WC.Ajax.requestToChat("getunreadchats.do","pno=1&lim=20&force=true"),!0},ZMSGUI.fillunreadChat=function(a){try{ZMSGUI.unreadChat();var b=a.ChatTranscript,c="";for(var d=0;d<b.length;d++){var e=b[d],f='<li><a id="offcont'+e.CHATID+'" onclick="ZMSGUI.displayChat(this,\''+e.CHATID+'\');"  href="javascript:;" ><label>'+e.TITLE+"</label><span>"+MyDate.formatDTTime(e.LMTIME)+"</span></a></li>";c+=f}ozfdsunreadcont.innerHTML=c,ZMSGUI.createOverlay(),ZMSGUI.showunread()}catch(g){}},ZMSGUI.displayChat=function(a,b){try{a.className="sel",ZMSGUI.viewTranscript(b,!0,!0)}catch(c){}},ZMSGUI.unreadChat=function(){try{ZMSGUI.hideunread()}catch(a){}ZMSG_UNREAD||(zfdsunread=document.createElement("div"),zfdsunread.style.display="none",zfdsunread.className="wmsofflinecurv wmscomstl wmsborderbox",zfdsunread.id="zfdsunread",document.body.appendChild(zfdsunread)),zfdsunread.innerHTML=ZMSGUI.generateUnreadUI(),ozfdsunreadcont=document.getElementById("zfdsunread_cont"),ozfdsunreaddata=document.getElementById("zfdsunread_data"),ozfdsunreadreply=document.getElementById("zfdsunreadreply"),ZMSG_UNREAD=!0,ZMSGUI.centerPosition(zfdsunread)},ZMSGUI.markAllRead=function(){try{var a=ozfdsunreadcont.getElementsByTagName("LI");for(var b=0;b<a.length;b++)a[b].getElementsByTagName("A")[0].className="sel"}catch(c){}},ZMSGUI.showChatHistory=function(a){if(document.getElementById("zchhis")!=null)return;document.getElementById("zfdshis")!=null&&ZMSGUI.hidehis(),a&&(ZMSG_USERID=a),$WC.$CUtil.removeElement(WmsMainUI.contactdetailsdiv),ZMSGUI.createOverlay(),ZMSG_chhis=document.getElementById("zchhis"),ZMSG_chhis=document.createElement("div"),ZMSG_chhis.style.width="780px",ZMSG_chhis.id="zchhis",ZMSG_chhis.style.zIndex=$WC.$CUtil.getConfig("zindex"),ZMSG_chhis.className="wms-hvalign",ZMSG_CHATPGNO=1,ZMSG_NO_MORE_CHATS=!1,document.body.appendChild(ZMSG_chhis);var b=document.createElement("div");b.id="wms_contactdetails",b.className="wms_contactdetails",document.body.appendChild(b),WmsMainUI.contactdetailsdiv=b,WmsMainUI.contactdetailsdiv.style.zIndex=WebMessanger.setzindex+1,Gator(WmsMainUI.contactdetailsdiv).on("click","[data-operation]",function(){WmsMainUI.handleProfileActions(this)}),Gator(WmsMainUI.contactdetailsdiv).on("mouseout",function(a){WmsMainUI.handleProfileMouseOut(this,a)});var c='<div class="wmsouterdiv wmscomstl"><table cellpadding="0" cellspacing="0" width="100%" class="wmsoutertbl"><thead><th>';ZMSG_USERID?c+='<div id="wms-recentchattitle" class="wms-recentchattitle"><img src="https://img.zohostatic.com/ichat/v282_https/images/spacer.gif" class="wmscloseicon" onClick="ZMSGUI.hidechathis();" title="'+WmsResource.getRealValue("Close")+'" /><span class="wmsheading wmscomstl">{{RECENTCHATTITLE}}':c+='<div id="wms-histitle" class="wms-histitle"><img src="https://img.zohostatic.com/ichat/v282_https/images/spacer.gif" class="wmscloseicon" onClick="ZMSGUI.hidechathis();" title="'+WmsResource.getRealValue("Close")+'" /><span class="wmsheading wmscomstl">'+WmsResource.getRealValue("Chat_History"),c+='</span></div><div id="wms-hismultisel" class="wms-hisdel"><input type="checkbox" onclick="ZMSGUI.checkCheckBox(this);" id="wmschhisselectcheckbox" style="margin: 7px 0 0px 6px;"><button onClick="ZMSGUI.selectedChatIds()" class="wms-chdel">'+WmsResource.getRealValue("Delete")+'</button><button onClick="ZMSGUI.handleDelCancel()" class="wms-chcan">'+WmsResource.getRealValue("Cancel")+"</button></div></th></thead>"+'<tbody><tr><td ><div style="width:100%;height:39px; position:relative; display:inline-block;"><div class="wms-histrymn"><input id="zchathistorytxt" type="text" class="wms-bdrrhtn" placeholder="'+WmsResource.getRealValue("chat.history.search")+'" onkeyup="ZMSGUI.searchChatHistory()" onkeydown="ZMSGUI.handleEvent(event)" autocomplete="off"/><img src="https://img.zohostatic.com/ichat/v282_https/images/spacer.gif" class="wms-zmsgsearchico"></div><div class="wms-toprhtprt"  id="wmschatcontinue" ><div><a class="wmscontinuechatlink" href="javascript:;">'+WmsResource.getRealValue("Continue_Chat")+'</a></div></td></tr><tr><td><div class="wmsoffflowingdiv wmscomstl"  style="height:540px; overflow: hidden; padding-top:0" id="zchhis_cont"><div id="chathistorywin" class="wmsoffflowingdiv wmscomstl wmschatwin" style="height:537px" ><div class="wms-titlenamemn" style="display:none"><div onClick="ZMSGUI.getDropDown(event)" class="wmsselecthstry"><a href="javascript:;"><input type="checkbox" class="wmsselecthstryinput"  id="wmschhisselectcheckbox"  onclick="ZMSGUI.checkCheckBox(this);"/><img src="https://img.zohostatic.com/ichat/v282_https/images/spacer.gif" class="wmshistory_arrow" align="absmiddle"/></a></div><div onClick="ZMSGUI.selectedChatIds()" class="wmsdelete_btn"><a href="javascript:;">'+WmsResource.getRealValue("Delete")+'</a></div><div class="wmshistory_drpdwnmain" id="wmschhisdeletedropdown" style="display:none;*z-index:9999;"><a id="read" onclick="ZMSGUI.selectChatDelete(this.id)" href="javascript:;">'+WmsResource.getRealValue("Read")+'</a><a id="unread" onclick="ZMSGUI.selectChatDelete(this.id)" href="javascript:;">'+WmsResource.getRealValue("Unread")+'</a></div></div><div id="translist" style="clear:both"></div></div><div id="wmschtranscontainer" style="width: 439px;overflow: auto;height: 100%;"><div style="margin-top:55%;text-align:center;color: #BCBCBC;font-size: 14px;">'+WmsResource.getRealValue("chat.trans.select")+"</div></div></div></div></td></tr></tbody>"+"</table>"+"</div>",c=$WC.template.replace(c,{RECENTCHATTITLE:WebMessanger.unescapeHTML(WmsResource.getRealValue("recent.chats.user",[WmsContacts.getDisplayName(ZMSG_USERID)]))}),ZMSG_chhis.innerHTML=c,WebMessanger.getChatTranscript(),ZMSGUI.setChhisFocus(),$WC.$CUtil.addEvent(document.getElementById("chathistorywin"),"scroll",$WC.$CUtil.debounce(function(){if(ZMSG_NO_MORE_CHATS===!0)return;var a=document.getElementById("chathistorywin");a.scrollTop+a.clientHeight>Math.floor(a.scrollHeight*.75)&&ZMSGUI.getNextPage()},null,250)),ZMSG_transContent=document.getElementById("translist"),ZMSG_translistloader=ZMSGUI.showLoadingPage(ZMSG_transContent,!0),$WC.$CUtil.addEvent(document.getElementById("wmschatcontinue"),"click",function(){var a=ZMSG_transContent.getElementsByClassName("wms-readdiv-select");if(a&&a.length===1){var b=a[0].getAttribute("cid");WMSUI.continueChat(b)}})},ZMSGUI.showLoadingPage=function(a,b){var c=document.createElement("div");c.className="wms-transloading wms-zmsginfo",c.innerHTML=WmsResource.getRealValue("chat.loading")+'<img src="https://img.zohostatic.com/ichat/v282_https/images/loading1.gif">';if(b){$WC.$CUtil.addClass(c,"wms-zmsg-lmiddle");while(a.lastChild)a.removeChild(a.lastChild)}return a.appendChild(c)},ZMSGUI.createOverlay=function(){document.getElementById("wms-overlay")==null&&(ZMSG_ol=document.createElement("div"),ZMSG_ol.id="wms-overlay",ZMSG_ol.className="wms-overlay",ZMSG_ol.onclick=WMSUI.handleDocumentEscape,ZMSG_ol.style.zIndex=$WC.$CUtil.getConfig("zindex"),document.body.insertBefore(ZMSG_ol,document.getElementById("wmstoolbar").nextSibling))},ZMSGUI.removeOverlay=function(){var a=document.getElementById("wms-overlay");a&&a.parentNode.removeChild(a)},ZMSGUI.handleEvent=function(a){a||(a=window.event);var b=window.event?a.keyCode:a.which;b==40||b==38?ZMSGUI.checkChatHistory()&&(mz&&a.preventDefault(),ie&&(a.cancelBubble=!0,a.returnValue=!1),ZMSGUI.handleKeyEvent(b)):b==27&&ZMSG_chhis&&(ZMSGUI.hidechathis(),WMSKeyHandler.cancelEvent(a))},ZMSGUI.setChhisFocus=function(){var a=document.getElementById("zchathistorytxt");a.focus()},ZMSGUI.checkCheckBox=function(a){a.className="wmsselecthstryinput",a.checked?ZMSGUI.selectChatDelete("all"):ZMSGUI.selectChatDelete("none")},ZMSGUI.hidechathis=function(){ZMSG_chhis&&(document.body.removeChild(ZMSG_chhis),ZMSGUI.removeOverlay(),ZMSG_chhis=null,ZMSG_SEARCHVALUE="",ZMSG_USERID="")},ZMSGUI.hidecustmmsg=function(){var a=document.getElementById("wms-custmmsgcontainer");a&&(document.body.removeChild(a),ZMSGUI.removeOverlay())},ZMSGUI.hidependinginv=function(){var a=document.getElementById("wms_pendinginv_container");a&&(document.body.removeChild(a),ZMSGUI.removeOverlay())},ZMSGUI.populate=function(a){var b=a,c=0;if(b)while(c<b.length)b[c]&&b[c].lastmsginfo&&(b[c].LASTMSGINFO=JSON.parse(b[c].lastmsginfo),b[c].LASTMSGINFO.msg=typeof Message!="undefined"?Message.formatLastMsgInfo(b[c].LASTMSGINFO.msg):b[c].LASTMSGINFO.msg),b[c]&&b[c].recipants&&(b[c].PARTICIPANTS=JSON.parse(b[c].recipants)),c++;var d=ZMSG_CHATCOUNT,e=ZMSG_SEARCHVALUE,f,g="<div valign='middle' style='margin-top: 223px;margin-left: 30px;margin-right: 30px;' class='wms-zmsginfo wms-zmsg-lmiddle' >"+WmsResource.getRealValue("Chat_History_archives_all_your_chat_transcripts.You_can_search_history_for_past_chats")+"</div>";e!=""&&(g='<div valign="middle" class="wms-zmsginfo wms-zmsg-lmiddle">'+WmsResource.getRealValue("No_results_match_for_your_search")+"</div>");var h=ZMSG_chhis.getElementsByTagName("INPUT");for(var i in h){if(h[i]==undefined)continue;if(h[i].id=="wmschhisselectcheckbox"){f=h[i];break}}f&&f.checked&&(f.checked=!1),ZMSG_translistloader&&(ZMSG_translistloader.parentNode.removeChild(ZMSG_translistloader),ZMSG_translistloader=null);if(b)for(i=0;i<b.length;i++){if(i==d)continue;var j=b[i];ZMSG_CHATTOTALOBJ=i+1;var k="",l="trans_"+j.chatid,m=typeof j.isunread!="undefined"&&j.isunread!==-1;if(m){k="wms-unreaddiv";var n="javascript:ZMSGUI.handleEvents(event,'"+j.chatid+"',this,true);"}else k="wms-readdiv",n="javascript:ZMSGUI.handleEvents(event,'"+j.chatid+"',this);";j.TITLE=WebMessanger.unescapeHTML(j.title),j.ADDINFO=j.addinfo,j.PARTICIPANTSCOUNT=j.pcount,j.PARTICIPANTS=j.PARTICIPANTS||[];var o='<div  id="'+l+'" lmtime="'+j.lmtime+'" tid="'+j.ctime+'" cid="'+j.chatid+'" class="'+k+'" purpose="chattrans"  onclick="'+n+'" onmouseover=ZMSGUI.showchhisDelete(this); onmouseout=ZMSGUI.hidechhisDelete(this) ><input type="checkbox" id="input_'+j.chatid+'" onclick="ZMSGUI.selectMainChkbox()"/>IMAGES<div id="namedivCID" class="wms-namediv">'+util.escapeHTML(j.title)+'</div><span class="wms-chhis-date">TRANSTIME</span><div class="wms-lastmsginfo">LASTMSGINFO</div></div>';o=o.replace(/LASTMSGINFO/g,WmsHybridSearch.createLastMsgInfoHtml(j)),o=o.replace(/IMAGES/g,WmsHybridSearch.createImageCollageHtml(j));try{o=o.replace(/TRANSTIME/g,MyDate.formatDateWithWords(j.lmtime))}catch(p){}i>0?g+=o:g=o}else ZMSG_transContent.hasChildNodes()&&(ZMSG_NO_MORE_CHATS=!0,document.getElementById("wms-chtransnomore")===null&&(g='<div id="wms-chtransnomore" style="text-align: center;margin: 21px;">'+WmsResource.getRealValue("No more chats")+"</div>"));ZMSG_transmoreloader&&ZMSG_transmoreloader.parentNode&&ZMSG_transmoreloader.parentNode.removeChild(ZMSG_transmoreloader),ZMSG_CHATPGNO===1?ZMSG_transContent.innerHTML=g:ZMSG_transContent.innerHTML+=g,b&&b.length>=15&&(ZMSG_transmoreloader=ZMSGUI.showLoadingPage(ZMSG_transContent,!1))},ZMSGUI.selectMainChkbox=function(){var a,b=0,c=ZMSG_transContent.getElementsByTagName("INPUT");for(var d in c){if(c[d]==undefined)continue;c[d].type=="checkbox"&&c[d].checked&&b++}var e=ZMSG_chhis.getElementsByTagName("INPUT");for(d=0;d<e.length;d++){if(e[d]==undefined)continue;if(e[d].id=="wmschhisselectcheckbox"){a=e[d];break}}b>=1?(a.checked=!0,b==ZMSG_CHATTOTALOBJ?a.className="wmschhischeckboxopacityhigh":a.className="wmschhischeckboxopacitylow",document.getElementById("wms-histitle")&&(document.getElementById("wms-histitle").style.opacity="0"),document.getElementById("wms-recentchattitle")&&(document.getElementById("wms-recentchattitle").style.opacity="0"),document.getElementById("wms-hismultisel").style.opacity="1",document.getElementById("wms-hismultisel").style.visibility="visible"):(a.checked=!1,ZMSGUI.hideDeleteMenu())},ZMSGUI.resetTranscriptUI=function(){document.getElementById("wmschtranscontainer").innerHTML='<div style="margin-top:55%;text-align:center;color: #BCBCBC;font-size: 14px;">'+WmsResource.getRealValue("chat.trans.select")+"</div>",document.getElementById("wmschatcontinue").style.display="none"},ZMSGUI.handleDelCancel=function(){ZMSGUI.hideDeleteMenu(),ZMSGUI.selectChatDelete("none")},ZMSGUI.hideDeleteMenu=function(){document.getElementById("wms-histitle")&&(document.getElementById("wms-histitle").style.opacity="1"),document.getElementById("wms-recentchattitle")&&(document.getElementById("wms-recentchattitle").style.opacity="1"),document.getElementById("wms-hismultisel").style.opacity="0",document.getElementById("wms-hismultisel").style.visibility="hidden"},ZMSGUI.showchhisDelete=function(a){a.getElementsByTagName("input")[0].style.visibility="visible"},ZMSGUI.hidechhisDelete=function(a){var b=a.getElementsByTagName("input")[0];b.checked||(b.style.visibility="hidden")},ZMSGUI.chathistoryTime=function(a){var b=new Date(Number(a)),c=b.getDate(),d=MyDate.getTMonth(b.getMonth()),e=b.getFullYear(),f="";return f+=c+"&nbsp;",f+=WmsResource.getRealValue(d)+"&nbsp;",f+=e+"&nbsp;",f},ZMSGUI.handleEvents=function(a,b,c,d){var e=getSource(a);e.id!="transdel"&&e.type!="checkbox"&&ZMSGUI.selectChat(b,c,d)},ZMSGUI.selectChat=function(a,b){try{document.getElementById("wmschatcontinue").style.display="block";var c=b.parentNode.getElementsByClassName("wms-readdiv-select");c.length!==0&&(c[0].className="wms-readdiv"),b.className="wms-readdiv-select",ZMSGUI.viewChatTranscript(a,document.getElementById("wmschtranscontainer"))}catch(d){}},ZMSGUI.viewChatTranscript=function(a,b){b.innerHTML="";var c=document.createElement("div");c.id="wmschshtransmsg",c.setAttribute("data-chid",a),c.setAttribute("data-fromchat",!0),c.className="wmsoffflowingdiv wmscomstl",b.appendChild(c);var d=document.createElement("div");d.style="display:none",d.setAttribute("data-latestchunk","true"),c.appendChild(d),Message.loadSpecificTranscript(a,c,d),Message.addEventListenersForTranscript(c,a),Gator(c).on("click","[data-zcprofileid]",function(){WmsMainUI.handleProfileClick(this)})},ZMSGUI.deleteChat=function(a){confirm(WmsResource.getRealValue("Are_you_sure_you_wish_to_delete_this_chat"))&&WebMessanger.deleteChat(a)},ZMSGUI.handleDeleteChat=function(){WebMessanger.getChatTranscript()},ZMSGUI.searchChatHistory=$WC.$CUtil.debounce(function(){var a=document.getElementById("zchathistorytxt");if(a.value&&a.value.length>=3&&ZMSG_SEARCHVALUE!==a.value)return ZMSG_SEARCHVALUE=a.value,ZMSG_CHATPGNO=1,ZMSG_NO_MORE_CHATS=!1,ZMSG_APPEND_CONTENT=!1,ZMSG_translistloader=ZMSGUI.showLoadingPage(ZMSG_transContent,!0),ZMSGUI.resetTranscriptUI(),WebMessanger.getChatTranscript(),ZMSGUI.setChhisFocus(),!1},null,300),ZMSGUI.getNextPage=function(){ZMSG_CHATPGNO+=1;var a=ZMSG_transContent.lastChild&&ZMSG_transContent.lastChild.previousSibling,b=a&&parseInt(a.getAttribute("lmtime"))-1;WebMessanger.getChatTranscript(b)},ZMSGUI.getPrevPage=function(){ZMSG_CHATPGNO!=1&&(ZMSG_CHATPGNO-=1,WebMessanger.getChatTranscript())},ZMSGUI.requestChatCount=function(){WebMessanger.getChatCount()},ZMSGUI.showChatCount=function(a){ZMSG_CHATS=a.count,document.getElementById("wmstrans_total").innerHTML='<label class="wmsmidtxtwd" purpose="histbtmdiv" style="margin:0px 0px 0px -2px">'+ZMSG_CHATS+"</label>"},ZMSGUI.selectChatDelete=function(a){var b=ZMSG_transContent,c=b.getElementsByTagName("input");for(e in c)c[e].checked=!1,c[e].style&&(c[e].style.visibility="hidden");if(c.length==0){var d="<div valign='middle' class='cntemptymsg' style='margin-top:50%' >"+Resource.getRealValue("No_Chat_History_available")+"</div>";b.innerHTML(d);return}if(a=="all")for(var e in c)c[e].checked="true",c[e].style&&(c[e].style.visibility="visible");else if(a=="read"){var f=!1,g,h=0,i=ZMSG_chhis.getElementsByTagName("INPUT");for(e in c){var j=c[e].parentNode;if(j==null||j==undefined)continue;if(j.className=="wms-readdiv"||j.className=="wms-readdiv-select")c[e].checked=!0,f=!0,h+=1}for(e in i)if(i[e].id=="wmschhisselectcheckbox"){g=i[e];break}f==1&&(g.checked=!0,h==ZMSG_CHATTOTALOBJ?g.className="wmschhischeckboxopacityhigh":g.className="wmschhischeckboxopacitylow"),f==0&&g.checked&&(g.checked=!1)}else if(a=="unread"){f=!1,g;var k=0;i=ZMSG_chhis.getElementsByTagName("INPUT");for(e in c){var l=c[e].parentNode;if(l==null||l==undefined)continue;l.className=="wms-unreaddiv"&&(c[e].checked=!0,f=!0,k+=1)}for(e in i)if(i[e].id=="wmschhisselectcheckbox"){g=i[e];break}f==1&&(g.checked=!0,k==ZMSG_CHATTOTALOBJ?g.style.opacity=1:g.style.opacity=.5),f==0&&g.checked&&(g.checked=!1)}var m=document.getElementById("wmschhisdeletedropdown");WMSUI.addIndocClickcallbackQue("wmschhisdeletedropdown",m,function(a){a!="selectchats"&&(m.style.display="none")})},ZMSGUI.selectedChatIds=function(){var a={};ZMSG_selectedids=new Array;var b=ZMSG_transContent,c=b.getElementsByTagName("input");for(var d=0;d<c.length;d++)if(c[d].checked){a[d]=c[d].id;if(a[d]==null||a[d]==undefined)continue;a[d]=a[d].replace(/input_/g,""),ZMSG_selectedids.push(a[d])}if(ZMSG_selectedids.length==1){confirm(WmsResource.getRealValue("Are_you_sure_want_to_delete_a_chat"))&&WebMessanger.deleteSelectedChats(ZMSG_selectedids);var e=document.getElementById("trans_"+ZMSG_selectedids);e.parentNode.removeChild(e)}else{if(!(ZMSG_selectedids.length>1)){alert(WmsResource.getRealValue("please_select_a_chat"));return}confirm(WmsResource.getRealValue("Are_you_sure_want_to_delete_the_chats"))&&WebMessanger.deleteSelectedChats(ZMSG_selectedids);for(var f in ZMSG_selectedids)e=document.getElementById("trans_"+ZMSG_selectedids[f]),e.parentNode.removeChild(e)}ZMSGUI.resetTranscriptUI(),ZMSGUI.hideDeleteMenu()},ZMSGUI.isUnreadChat=function(a,b){try{for(var c=0;c<a.length;c++){var d=a[c];if(d.CT_ID==b)return!0}}catch(e){}return!1},ZMSGUI.getDropDown=function(a){var b="";if(getSource(a).type=="checkbox")return;var c=ZMSG_chhis.getElementsByTagName("div");for(var d in c){if(c[d]==undefined||c[d]==null)continue;if(c[d].id=="wmschhisdeletedropdown"){b=c[d];break}}util.toggle(b),WMSUI.addIndocClickcallbackQue("wmschhisdeletedropdown",b,function(a){a!="selectchats"&&(b.style.display="none")})},ZMSGUI.clearAllUnreadChats=function(){zfdsunread.style.display=="block"?ZMSGUI.markAllRead():ZMSG_chhis.style.display=="block"&&ZMSGUI.UpdateAllUnreadChatsInHistory()},ZMSGUI.UpdateUnreadChatInHistory=function(a){var b=ZMSG_chhis.getElementsByTagName("div");for(var c=0;c<b.length;c++){if(b[c].id==undefined||b[c].id==null)continue;if(b[c].id=="trans_"+a){b[c].className="wms-readdiv";break}}},ZMSGUI.UpdateAllUnreadChatsInHistory=function(){try{var a=ZMSG_chhis.getElementsByTagName("DIV");for(var b=0;b<a.length;b++)a[b].id.indexOf("trans_")!=-1&&(a[b].className="wms-readdiv")}catch(c){}},ZMSGUI.deleteFeed=function(){try{var a=document.getElementById("zfdshis");a.style.display=="block"&&ZMSGUI.refreshHis()}catch(b){}},ZMSGUI.handleKeyEvent=util.throttle(function(a){function c(a,b){var c=a.getAttribute("cid"),d=!1;a.className==="wms-unreaddiv"&&(d=!0),a.className="wms-readdiv-select",b&&ZMSGUI.selectChat(c,a,d)}var b=ZMSG_transContent.getElementsByClassName("wms-readdiv-select");if(b.length===1){b=Array.prototype.slice.call(b)[0];if(a==40){if(!b.nextSibling||!b.nextSibling.getAttribute("cid")){c(b,!1);return}c(b.nextSibling,!0)}else if(a==38){if(!b.previousSibling){c(b,!1);return}c(b.previousSibling,!0)}b.className="wms-readdiv"}else c(ZMSG_transContent.firstChild,!0)},null,200),ZMSGUI.checkChatHistory=function(){return ZMSG_chhis!=undefined?!0:!1},WmsResource.init=function(){this.MessageObject={},typeof $WC!="undefined"&&$WC.template&&$WC.template.setResource(WmsResource)},WmsResource.getRealValue=function(a,b){try{var c="";return this.MessageObject[""+a]==undefined||this.MessageObject[""+a]==null?c=a:c=this.MessageObject[a],c&&(c=c.replace(/_/g," ")),b==null?c||"":(c=WmsResource.replaceParams(c,b),c)}catch(d){setTimeout(function(){throw d},1)}try{return a.replace(/_/g," ")}catch(d){return""}},WmsResource.getRealData=function(a,b){try{var c=a.trim();return c=c.replace(/ /g,"_"),c=c.replace(/\.$/,""),WmsResource.getRealValue(c,b)}catch(d){return a}},WmsResource.getTrimmedValue=function(a,b){var c=WmsResource.getRealValue(a,b);return c=c.replace(/\s/g,"&nbsp;"),c},WmsResource.replaceParams=function(a,b){b instanceof Array||(b=b.split(","));for(var c=0;c<b.length;c++){var d=b[c],e=new RegExp("\\$"+(c+1),"g");a=a.replace(e,d)}return a},WmsResource.init(),WmsContacts.userstatus=function(){},WmsContacts.userstatus.ONLINE=1,WmsContacts.userstatus.OFFLINE=0,WmsContacts.userstatus.FEEDINFO=2,WmsContacts.userstatus.BUSY=3,WmsContacts.userstatus.IDLE=4,WmsContacts.userstatus.WEB_LOGIN=1,WmsContacts.userstatus.MOB_LOGIN=3,WmsContacts.defaultstatusmsg=["Offline","Available","","Busy","Idle"],WmsContacts.invitedcontactslist=[],WmsContacts.pendinginvcontactslist=[],WmsContacts.contactslist={},WmsContacts.zohocontacts={},WmsContacts.updatempscontactlist=function(a){var b=new Array;for(var c in a){var d={},e=a[c].scode,f=a[c].smsg,g=a[c].uname;WmsContacts.contactslist.hasOwnProperty(g)===!1&&(WmsContacts.contactslist[g]={}),d.STATUS=e,WmsContacts.contactslist[g].STATUS=e,d.STATUSMSG=f!=undefined?f:"",WmsContacts.contactslist[g].STATUSMSG=f!=undefined?f:"",d.OWNERID=WmsContacts.getMPLoginName(a[c].uname),WmsContacts.contactslist[g].OWNERID=d.OWNERID,d.USERID=a[c].uname,WmsContacts.contactslist[g].USERID=d.USERID,a[c].dname!=undefined&&a[c].dname!=""&&(d.DNAME=a[c].dname,WmsContacts.contactslist[g].DNAME=d.DNAME),d.EMAILID=WmsContacts.getMPDispName(g),WmsContacts.contactslist[g].EMAILID=d.EMAILID,d.PROTOCOL=a[c].protocol,WmsContacts.contactslist[g].PROTOCOL=d.PROTOCOL,b.push(d)}WmsImplHandler.invoke(WmsContactImpl.handleBulkPresence,d.PROTOCOL,b),WmsContacts.lastupdatetime=(new Date).getTime(),WmsImplHandler.invoke(WmsContactImpl.handleAddressBook)},WmsContacts.removefromobj=function(a,b,c){a!="zoho"&&(b=c+"|"+b),WmsContacts.contactslist[b]=null,WmsContacts.lastupdatetime=(new Date).getTime()},WmsContacts.updateStatus=function(a){try{var b=a.zuid;if(WmsContacts.contactslist[b]==undefined||WmsContacts.zohocontacts[b]==undefined)WmsContacts.contactslist[b]={},WmsContacts.contactslist[b].OWNERID=$WC.$CUtil.getConfig("zuid"),WmsContacts.contactslist[b].USERID=b,WmsContacts.contactslist[b].DNAME=a.dname,WmsContacts.contactslist[b].EMAILID=a.email,WmsContacts.zohocontacts[b]={},WmsContacts.zohocontacts[b].OWNERID=$WC.$CUtil.getConfig("zuid"),WmsContacts.zohocontacts[b].USERID=b,WmsContacts.zohocontacts[b].DNAME=a.dname,WmsContacts.zohocontacts[b].EMAILID=a.email;WmsContacts.contactslist[b].STATUS=a.scode,WmsContacts.contactslist[b].STYPE=a.st,WmsContacts.contactslist[b].STATUSMSG=a.smsg,WmsContacts.zohocontacts[b].STATUS=a.scode,WmsContacts.zohocontacts[b].STYPE=a.st,WmsContacts.zohocontacts[b].STATUSMSG=a.smsg}catch(c){}},WmsContacts.updateFromMDParent=function(a){var b=new Array;try{for(var c in a){var d=a[c].STATUS;d==-3&&b.push(c)}}catch(e){}b.length>0&&(WmsImplHandler.invoke(WmsContactImpl.handleInvitations,b),WMSUI.updateInvitations(b))},WmsContacts.updateContacts=function(a){try{for(var b in a){var c=a[b],d=$WC.$CUtil.splitWmsFormattedString(a[b].s,6,!0),e={};e.zuid=b,e.scode=d[0],e.email=d[1],e.st=d[2],e.uc=d[3],e.dname=d[5][1]||e.email,e.smsg=d[5][0]||WmsContacts.defaultstatusmsg[e.scode],e.scode==WmsConstants.CONTACTSTATUS.REQACC&&WmsContacts.invitedcontactslist.indexOf(b)===-1&&WmsContacts.pendinginvcontactslist.indexOf(b)===-1?(WmsContacts.invitedcontactslist.push(b),WmsContacts.pendinginvcontactslist.push(b)):e.scode==WmsConstants.CONTACTSTATUS.NOCHAT&&WmsContacts.pendinginvcontactslist.indexOf(b)===-1&&WmsContacts.pendinginvcontactslist.push(b),WmsContacts.isMPUser(e.zuid)?WmsContacts.isMP&&(WmsContacts.contactslist[b]={},WmsContacts.contactslist[b].STATUS=e.scode,WmsContacts.contactslist[b].STYPE=e.st,WmsContacts.contactslist[b].STATUSMSG=e.smsg,WmsContacts.contactslist[b].UC=e.uc,WmsContacts.contactslist[b].OWNERID=$WC.$CUtil.getConfig("zuid"),WmsContacts.contactslist[b].USERID=b,WmsContacts.contactslist[b].PROTOCOL=c.protocol,WmsContacts.contactslist[b].PHOTO=c.photo,e.dname!=undefined?WmsContacts.contactslist[b].DNAME=e.dname:WmsContacts.contactslist[b].DNAME=b.substring(b.indexOf("|")+1,b.lastIndexOf("|")),e.email?WmsContacts.contactslist[b].EMAILID=e.email:WmsContacts.contactslist[b].EMAILID=b.substring(b.indexOf("|")+1,b.lastIndexOf("|"))):WmsContacts.updatezohocontacts(e)}WmsContacts.lastupdatetime=(new Date).getTime()}catch(f){}WmsContacts.invitedcontactslist.length&&typeof WmsContactImpl!="undefined"&&WmsImplHandler.invoke(WmsContactImpl.handleInvitations,WmsContacts.invitedcontactslist)},WmsContacts.updateBotContacts=function(a){for(var b in a){var c={ISBOT:!0,EMAILID:$WC.$CUtil.getConfig("Resource").getRealValue("chatbot.smsg"),STATUSMSG:$WC.$CUtil.getConfig("Resource").getRealValue("chatbot.smsg"),TYPE:"",PROTOCOL:"zoho",SCODE:1,UC:a[b].info.uc,ZUID:""};c.DNAME=a[b].name;var d=a[b].status;if(d){var e=Math.round(Math.random()*(d.length-1));c.STATUSMSG=d[e],c.EMAILID=d[e]}c.UNIQUENAME=a[b].uniquename||a[b].info.uniquename,c.PHOTO=a[b].photo||a[b].photoid,c.CHID=a[b].chid,c.USERID=a[b].id,c.PERMISSION=a[b].info&&a[b].info.permission,c.PHOTO?c.PHOTO="/_chat/botimg/"+c.PHOTO+"/photo.do":c.CHID.endsWith("B1")?c.PHOTO="https://img.zohostatic.com/ichat/v282_https/images/bot-custom.png":c.PHOTO="https://img.zohostatic.com/ichat/v282_https/images/bot-default.png",WmsContacts.contactslist[b]=c}},WmsContacts.updateBotActions=function(a,b){var c=WmsContacts.contactslist[a];$WC.$CUtil.isEmpty(c)||(c.actionhandles=b)},WmsContacts.copyContacts=function(a){var b=new Array;try{for(var c in a){var d=a[c],e=d.USERID;d.STATUS==-3&&b.push(c),WmsContacts.isMPUser(e)?WmsContacts.isMP&&(WmsContacts.contactslist[e]={},WmsContacts.contactslist[e].STATUS=d.STATUS,WmsContacts.contactslist[e].STATUSMSG=d.STATUSMSG,WmsContacts.contactslist[e].OWNERID=$WC.$CUtil.getConfig("zuid"),WmsContacts.contactslist[e].USERID=d.USERID,WmsContacts.contactslist[e].DNAME=d.DNAME,WmsContacts.contactslist[e].EMAILID=d.EMAILID,WmsContacts.contactslist[e].PROTOCOL=d.PROTOCOL,WmsContacts.contactslist[e].PHOTO="",d.PHOTO!=""&&d.PHOTO!=undefined?WmsContacts.contactslist[e].PHOTO=d.PHOTO:WmsContacts.contactslist[e].PHOTO=""):WmsContacts.copyZohoContacts(d)}WmsContacts.lastupdatetime=(new Date).getTime()}catch(f){}b.length>0&&(WmsImplHandler.invoke(WmsContactImpl.handleInvitations,b),WMSUI.updateInvitations(b))},WmsContacts.copyZohoContacts=function(a){try{var b=a.USERID,c={};c.STATUS=a.STATUS,c.STYPE=a.st,c.STATUSMSG=a.STATUSMSG,c.OWNERID=$WC.$CUtil.getConfig("zuid"),c.USERID=a.USERID,c.DNAME=a.DNAME,c.EMAILID=a.EMAILID,a.PHOTO!=""&&a.PHOTO!=undefined?c.PHOTO=a.PHOTO:c.PHOTO="",WmsContacts.zohocontacts[b]=c,WmsContacts.contactslist[b]=c}catch(d){}},WmsContacts.updatezohocontacts=function(a){try{if(a.scode==WmsConstants.CONTACTSTATUS.DELETE)return;var b=a.zuid,c={};c.STATUS=a.scode,c.STYPE=a.st,c.STATUSMSG=a.smsg,c.OWNERID=$WC.$CUtil.getConfig("zuid"),c.USERID=a.zuid,c.DNAME=a.dname,c.EMAILID=a.email,c.PHOTO="",c.UC=a.uc,WmsContacts.zohocontacts[b]=c,WmsContacts.contactslist[b]=c,WmsContacts.lastupdatetime=(new Date).getTime()}catch(d){}},WmsContacts.removeList=function(a){var b=a+"|",c=WmsContacts.getcontacts();for(var d in c){if(d.indexOf(b)!=0)continue;WmsContacts.contactslist[d]=null,delete WmsContacts.contactslist[d]}},WmsContacts.addinobj=function(a,b,c){a!="zoho"&&(b=c+"|"+b),WmsContacts.contactslist[b]={},WmsContacts.contactslist[b].STATUS="0",WmsContacts.contactslist[b].STATUSMSG=null,WmsContacts.contactslist[b].OWNERID=null,WmsContacts.contactslist[b].USERID=b,WmsContacts.lastupdatetime=(new Date).getTime()},WmsContacts.updatecontactlist=function(a){if(a==null)return;var b=a.Contact;if(b==null)return;var c=b.length;if(c<=0)return;for(var d=0;d<c;d++){var e=b[d].USERID;WmsContacts.contactslist[e]={},WmsContacts.contactslist[e].STATUS=b[d].STATUS,WmsContacts.contactslist[e].STATUSMSG=b[d].STATUSMSG,WmsContacts.contactslist[e].OWNERID=b[d].OWNERID,WmsContacts.contactslist[e].USERID=b[d].USERID,WmsContacts.contactslist[e].CON_ID=b[d].CON_ID,WmsContacts.zohocontacts[e]={},WmsContacts.zohocontacts[e].STATUS=b[d].STATUS,WmsContacts.zohocontacts[e].STATUSMSG=b[d].STATUSMSG,WmsContacts.zohocontacts[e].OWNERID=b[d].OWNERID,WmsContacts.zohocontacts[e].USERID=b[d].USERID,WmsContacts.zohocontacts[e].CON_ID=b[d].CON_ID;try{WmsContacts.contactslist[e].DNAME=b[d].DNAME,WmsContacts.zohocontacts[e].DNAME=b[d].DNAME,WmsContacts.contactslist[e].EMAILID=b[d].EMAILID,WmsContacts.zohocontacts[e].EMAILID=b[d].EMAILID,WmsContacts.contactslist[e].PHOTO=b[d].PHOTO,WmsContacts.zohocontacts[e].PHOTO=b[d].PHOTO}catch(f){}}WmsContacts.lastupdatetime=(new Date).getTime(),WmsImplHandler.invoke(WmsContactImpl.handleAddressBook)},WmsContacts.deletecontact=function(a){delete WmsContacts.zohocontacts[a],delete WmsContacts.contactslist[a]},WmsContacts.enableMP=function(){WmsContacts.isMP=!0},WmsContacts.isInitialised=function(){return WmsContacts.initialized},WmsContacts.init=function(a){WmsContacts.contactslist={},WmsContacts.zohocontacts={},WmsContacts.lastupdatetime=0,WmsContacts.initialized=!1,(_WMSCONFIG&WMSSessionConfig.MP)==WMSSessionConfig.MP&&WmsContacts.enableMP(),typeof WmsContacts.isMP=="undefined"&&(WmsContacts.isMP=!1),a!=undefined&&(WmsContacts.copyContacts(a),WmsContacts.initialized=!0),WmsContacts.isMP&&(WmsMPAccounts.init(),WmsMPAccounts.loginstartup(),setTimeout(function(){WmsMPAccounts.getandlogin()},2e3))},WmsContacts.getcontacts=function(){return WmsContacts.contactslist},WmsContacts.isonline=function(a){return WmsContacts.contactslist[a]?WmsContacts.contactslist[a].status!=="0":!1},WmsContacts.getZohoContacts=function(){return WmsContacts.zohocontacts},WmsContacts.getStatusMsg=function(a){if(WmsContacts.contactslist[a])return WmsContacts.status(a)==WmsConstants.CONTACTSTATUS.UNAPRD?$WC.$CUtil.getConfig("Resource").getRealValue("Invited"):WmsContacts.contactslist[a].STATUSMSG},WmsContacts.getStatusType=function(a){if(WmsContacts.contactslist[a])return WmsContacts.contactslist[a].STYPE},WmsContacts.status=function(a){return WmsContacts.contactslist[a]?WmsContacts.contactslist[a].STATUS:!1},WmsContacts.getStatusClassName=function(a,b,c){var d={0:"offline",1:"available",3:"busy",4:"idle"};b=b||WmsContacts.status(a),c=c||WmsContacts.getStatusType(a);var e="";return b?(e=d[b]||"",c==WmsContacts.userstatus.MOB_LOGIN&&(e+="_mobile")):a&&a.indexOf("b-")!==-1&&(e+="bot"),e},WmsContacts.add=function(a,b,c){var d,e;if(b.trim()==0)return;a=="zoho"?(d="addcontact.do",e="ulist="+encodeURIComponent(b)):(d="mpcontact.do",e="zohoid="+WebMessanger.getUserName()+"&mploginid="+c+"&contactid="+b+"&opr=addcon"),$WC.Ajax.postRequestToChat(d,e),a!="zoho"&&WmsImplHandler.invoke(WmsContactImpl.handleMPAdd,a,b,c)},WmsContacts.reinvite=function(a,b,c,d){if(b.trim()==0)return;var e="emailid="+b;$WC.Ajax.postRequest("reinvitebyemailid.sas",e),WmsContacts.addinobj(a,c,d),a!="zoho"&&WmsImplHandler.invoke(WmsContactImpl.handleMPAdd,a,c,d)},WmsContacts.updatepresence=function(a,b,c,d){WmsContacts.contactslist[a]={},WmsContacts.contactslist[a].STATUS=b,WmsContacts.contactslist[a].STATUSMSG=c,WmsContacts.contactslist[a].OWNERID=d,WmsContacts.contactslist[a].USERID=a,WmsContacts.lastupdatetime=(new Date).getTime()},WmsContacts.rename=function(a,b,c){WmsContacts.contactslist[a].DNAME=b,WmsContacts.zohocontacts[a].DNAME=b;var d="";try{WmsContacts.getEmailId(a)!=undefined&&(d=WmsContacts.getEmailId(a))}catch(e){}var f="userid="+a+"&email="+encodeURIComponent(d)+"&dname="+encodeURIComponent(b);$WC.Ajax.postRequestToChat("rencont.do",f,"",c)},WmsContacts.renamecontId=function(a,b,c){WmsContacts.contactslist[b].DNAME=c,WmsContacts.zohocontacts[b].DNAME=c;var d="contid="+a+"&dname="+encodeURIComponent(c);$WC.Ajax.postRequestToChat("rencontid.do",d)},WmsContacts.remove=function(a,b,c){var d,e;a=="zoho"?(d="deletecontact.do",e="emailid="+encodeURIComponent(WmsContacts.getEmailId(b))+"&userid="+b):(d="mpcontact.do",e="zohoid="+WebMessanger.getUserName()+"&mploginid="+c+"&contactid="+b+"&opr=removecon"),$WC.Ajax.postRequestToChat(d,e),WmsContacts.removefromobj(a,b,c),a!="zoho"&&WmsImplHandler.invoke(WmsContactImpl.handleMPDelete,a,b,c)},WmsContacts.get=function(a,b){if(WmsContacts.contactslist&&WmsContacts.contactslist[a])return WmsContacts.contactslist[a];if(b&&WmsOrgContacts.contactslist&&WmsOrgContacts.contactslist[a])return WmsOrgContacts.contactslist[a]},WmsContacts.getDisplayName=function(a){try{return WmsContacts.contactslist[a]?WmsContacts.contactslist[a].DNAME:WmsOrgContacts.contactslist[a]?WmsOrgContacts.contactslist[a].DNAME:null}catch(b){return null}},WmsContacts.updateUserStatus=function(a,b,c,d){if(WmsContacts.contactslist[a]&&WmsContacts.contactslist[a].STATUS>=0&&WmsContacts.contactslist[a].STATUS<=4){if(WmsContacts.contactslist[a].STATUS!==b||WmsContacts.contactslist[a].STYPE!==c||WmsContacts.contactslist[a].STATUSMSG!==d)WmsContacts.contactslist[a].STATUS=b,WmsContacts.contactslist[a].STYPE=c,WmsContacts.contactslist[a].STATUSMSG=d,WmsHybridSearch.updatePresence(a),WmsMainUI.updateChatHTML(a)}else WmsOrgContacts.contactslist[a]&&(WmsOrgContacts.contactslist[a].STATUS!==b||WmsOrgContacts.contactslist[a].STYPE!==c||WmsOrgContacts.contactslist[a].STATUSMSG!==d)&&(WmsOrgContacts.contactslist[a].STATUS=b,WmsOrgContacts.contactslist[a].STYPE=c,WmsOrgContacts.contactslist[a].STATUSMSG=d,WmsMainUI.updateChatHTML(a))},WmsContacts.handleInviteOperation=function(a){var b=a.getAttribute("data-operation"),c=a.getAttribute("data-id"),d=a.getAttribute("data-dname");c===null&&d===null&&(c=a.parentNode.getAttribute("data-id"),d=a.parentNode.getAttribute("data-dname")),b==="accept"?(WmsContacts.accept("zoho",c,$WC.$CUtil.getConfig("zuid")),$WC.$CUtil.removeElementFromArray(WmsContacts.pendinginvcontactslist,c)):b==="reject"?WmsContacts.remindMeLater(c):b==="addcontact"&&(c?WMSUI.inviteMember(c,d):(WMSUI.inviteMember(d,d),WmsMainUI.resetToDefaultUI())),document.getElementById("wms-hysearch")&&WmsHybridSearch.populateFrequentContactsInSmartChat();if(typeof WmsMainUI!="undefined"){var e={};e.suggestions="show_suggestions",WmsHybridSearch.populateContactListInMainUI(!0,e)}},WmsContacts.accept=function(a,b,c){var d,e;if(b.trim()==0)return;a=="zoho"?(d="approvecontact.do",e="status=accept&userid="+b):(d="mpcontact.do",e="zohoid="+WebMessanger.getUserName()+"&mploginid="+c+"&contactid="+b+"&opr=acceptcon"),$WC.Ajax.postRequestToChat(d,e),a!="zoho"&&WmsImplHandler.invoke(WmsContactImpl.handleMPAccept,a,b,c)},WmsContacts.reject=function(a,b,c){var d,e;if(b.trim()==0)return;a=="zoho"?(d="approvecontact.do",e="status=reject&userid="+b):(d="mpcontact.do",e="zohoid="+WebMessanger.getUserName()+"&mploginid="+c+"&contactid="+b+"&opr=rejectcon"),$WC.Ajax.postRequestToChat(d,e),a!="zoho"&&WmsImplHandler.invoke(WmsContactImpl.handleMPReject,a,b,c)},WmsContacts.remindMeLater=function(a){var b="approvecontact.do",c="status=remindmelater&userid="+a;$WC.Ajax.postRequestToChat(b,c)},WmsContacts.isMPUser=function(a){return a.indexOf("|")!=-1},WmsContacts.getMPName=function(a){if(!WmsContacts.isMPUser(a))return"zoho";var b=a.indexOf("@")+1;return a.substring(b,a.indexOf(".",b))},WmsContacts.getEmailId=function(a){return WmsContacts.contactslist[a]?WmsContacts.contactslist[a].EMAILID:WmsOrgContacts.contactslist[a]?WmsOrgContacts.contactslist[a].EMAILID:null},WmsContacts.getMPDispName=function(a){try{return WmsContacts.isMPUser(a)?a.indexOf("|")!=a.lastIndexOf("|")?a.substring(a.indexOf("|")+1,a.lastIndexOf("|")):a.substring(a.indexOf("|")+1,a.length):a}catch(b){return null}},WmsContacts.getMPLoginName=function(a){return WmsContacts.isMPUser(a)?a.substring(0,a.indexOf("|")):a},WmsContacts.verifyUserStatus=function(a){var b=!1;for(var c=0;c<a.length;c++){var d=a[c],e=d.uname,f=d.scode,g=d.zuid;if(g.trim().length==0)continue;try{var h=WmsContacts.status(e);h!==!1&&f!=h&&h>=0&&WebMessanger.verifyUserStatus(d.zuid,WmsContacts.contactslist[e].STATUS)}catch(i){}}b&&WMSUI.updateContacts(!1)},WmsContacts.updateAddressBook=function(a){try{var b=new Array;for(var c in a){var d={},e=a[c].scode!=undefined?a[c].scode:0,f=a[c].smsg==undefined?"":a[c].smsg,g=a[c].uname;WmsContacts.contactslist.hasOwnProperty(g)===!1&&(WmsContacts.contactslist[g]={},d.STATUS=e,WmsContacts.contactslist[g].STATUS=e,d.STATUSMSG=f,WmsContacts.contactslist[g].STATUSMSG=f),d.OWNERID=WmsContacts.getMPLoginName(a[c].uname),WmsContacts.contactslist[g].OWNERID=d.OWNERID,d.USERID=a[c].uname,WmsContacts.contactslist[g].USERID=d.USERID,a[c].dname!=undefined&&a[c].dname!=""&&(d.DNAME=a[c].dname,WmsContacts.contactslist[g].DNAME=d.DNAME),d.EMAILID=WmsContacts.getMPDispName(g),WmsContacts.contactslist[g].EMAILID=d.EMAILID,d.PROTOCOL=a[c].protocol,WmsContacts.contactslist[g].PROTOCOL=d.PROTOCOL,b.push(d)}WmsImplHandler.invoke(WmsContactImpl.handleBulkPresence,d.PROTOCOL,b),WmsContacts.lastupdatetime=(new Date).getTime(),WmsImplHandler.invoke(WmsContactImpl.handleAddressBook)}catch(h){}},WmsContacts.updatempscontactinfo=function(a){try{for(var b in a){var c=a[b],d=c.uname;c.dname!=undefined&&(WmsContacts.contactslist[d].DNAME=c.dname),c.photo!=undefined&&(WmsContacts.contactslist[d].PHOTO=c.photo)}}catch(e){}},WmsMPAccounts.accountstatus=function(){},WmsMPAccounts.accountstatus.LOGGEDIN=1,WmsMPAccounts.accountstatus.LOGGEDOUT=0,WmsMPAccounts.accountstatus.LOGINERROR=-1,WmsMPAccounts.add=function(a,b,c,d,e){var f="username="+a+"&password="+b+"&startup="+d+"&protocol="+e+"&status="+c;$WC.Ajax.postRequest("/addmps.do",f)},WmsMPAccounts.del=function(a){$WC.Ajax.postRequestToChat("delmps.do","username="+a),setTimeout(function(){WmsMPAccounts.get()},2e3)},WmsMPAccounts.get=function(){$WC.Ajax.requestToChat("getmps.do")},WmsMPAccounts.getandlogin=function(){$WC.Ajax.requestToChat("getmps.do","autologin=true")},WmsMPAccounts.login=function(a,b,c,d){var e="username="+a+"&password="+b+"&protocol="+c+"&mailnotification=false";$WC.Ajax.postRequestToChat("mpslogin.do",e),d&&(WmsMPAccounts.add(a,b,1,1,c),setTimeout(function(){WmsMPAccounts.get()},2e3))},WmsMPAccounts.loginstartup=function(){$WC.Ajax.requestToChat("mpsautologin.do")},WmsMPAccounts.logout=function(a){$WC.Ajax.postRequestToChat("mpslogout.do","?username="+a)},WmsMPAccounts.logoutall=function(){$WC.Ajax.postRequestToChat("mpslogoutall.do")},WmsMPAccounts.init=function(){WmsMPAccounts.accounts={}},WmsMPAccounts.updateobj=function(a,b,c,d,e,f){var g=a+d;try{WmsMPAccounts.accounts[g].LOGINID.trim()}catch(h){WmsMPAccounts.accounts[g]={}}WmsMPAccounts.accounts[g].LOGINID=a,WmsMPAccounts.accounts[g].STATUS=b,WmsMPAccounts.accounts[g].STATUSMSG=c,WmsMPAccounts.accounts[g].PROTOCOL=d,WmsMPAccounts.accounts[g].MOREINFO==undefined&&(WmsMPAccounts.accounts[g].MOREINFO={}),WmsMPAccounts.accounts[g].MOREINFO.MAILNOTIFICATION=f,WmsMPAccounts.accounts[g].UENTERID=e!=""?e:a,WmsMPAccounts.accounts[g].LASTLOGINTIME=(new Date).getTime()},WmsMPAccounts.getaccounts=function(){return WmsMPAccounts.accounts},WmsMPAccounts.updateaccountslist=function(a){var b=new Array;try{var c=a.MPSAccounts,d=c.length;for(var e=0;e<d;e++)b[e]=c[e].USERNAME}catch(f){}WmsImplHandler.invoke(WmsContactImpl.handleGetAccounts,b)},WmsMPAccounts.removefromobj=function(a){WmsMPAccounts.accounts.splice(a,1)},WmsContacts.getBotPhoto=function(a){var b=WmsContacts.get(a);return b&&b.ISBOT?b.PHOTO:"https://img.zohostatic.com/ichat/v282_https/images/bot-default.png"},WmsContacts.getUserPhoto=function(a,b){var c=WmsContacts.get(a);if($WC.$CUtil.isEmptyString(a)||a=="null"||WmsContacts.isAnnonUser(a))return"https://img.zohostatic.com/ichat/v282_https/images/bar/contactphoto.gif";if(c&&c.ISBOT)return WmsContacts.getBotPhoto(a);var d=b||"50";return $WC.$CUtil.getConfig("photoserver")+"/file?ID="+a+"&t=user&height="+d+"&width="+d+"&exp=360000"},WmsContacts.getGroupLogo=function(a){return $WC.$CUtil.getConfig("photoserver")+"/file?ID="+a+"&t=group&height=50&width=50"},WmsContacts.getMPUserPhoto=function(a){var b=WmsContacts.contactslist[a].PHOTO;return b!=undefined&&b!=""?_WMSCHATURL+"mpimg.do?url="+b:"https://img.zohostatic.com/ichat/v282_https/images/bar/contactphoto.gif"},WmsContacts.getSortedContacts=function(a,b,c,d){var e=[];c=c||WmsContacts.contactslist;for(var f in c)c[f][a]&&e.push(c[f]);return a==="UC"?e.sort($WC.$CUtil.sortBy(a,b,function(a){return parseInt(a,10)})):e.sort($WC.$CUtil.sortBy(a,b,function(a){return a.toLowerCase()})),e.slice(0,d)},WmsContacts.isInvitedContact=function(a){var b=WmsContacts.get(a);return b&&b.STATUS==WmsConstants.CONTACTSTATUS.REQACC?!0:!1},WmsContacts.isInvitationPending=function(a){var b=WmsContacts.get(a);return b&&b.STATUS==WmsConstants.CONTACTSTATUS.NOCHAT?!0:!1},WmsContacts.removeInvitations=function(){WmsContacts.invitedcontactslist=[],WmsContacts.pendinginvcontactslist=[]},WmsContacts.isAnnonUser=function(a){return a&&a.charAt(0)==="$"},WmsContacts.lastfetchedtime=0,Factory.createDialog=function(a,b){var c=new ChatWindow;WindowHandler.exist.push(c);var d=WindowHandler.exist.length-1;c.setIndex(d);var e=c.create(a,b);return e},Factory.removeDialog=function(a){try{WindowHandler.exist[a]="empty",WindowHandler.rearrange()}catch(b){}},Factory.destroyDialog=function(a,b){Factory.removeDialog(a,b),WindowHandler.reopenRemovedChat()},WindowHandler.deleteParticipantsByID=function(a,b){var c=WindowHandler.getWinObjById(a);c&&(c.deleteParticipants(b),c.checkAndPopulateGroupMembers())},WindowHandler.addParticipantsByID=function(a,b){var c=WindowHandler.getWinObjById(a);c&&(c.addParticipants(b,!0),c.checkAndPopulateGroupMembers())},WindowHandler.checkAndHighlightChat=function(a){var b=WindowHandler.getWinObjById(a),c=WmsRecentChats.getChatIdList(WmsUnreadChats.chatlist);b&&c.indexOf(a)!=-1&&b.highlight()},WindowHandler.init=function(){this.count=0,this.exist=[],this.removed=[],this.lastViewed=-1,this.openedChats={},this.prevtime=null,this.cwsize=323,this.enlargedsize=455},WindowHandler.init(),WindowHandler.getMaxWin=function(){var a=0;WebMessanger.isServiceStatus()===!1&&(a=document.getElementById("wmsstatusbar").offsetWidth),WMSUI.globalsearchenabled&&document.getElementById("wmsglobalsearch")&&(a+=document.getElementById("wmsglobalsearch").offsetWidth);var b=document.getElementById("wmstoolbar").offsetWidth,c=WindowHandler.exist.find(function(a){if(a!=="empty"&&a.isEnlarged)return!0}),d=c?this.enlargedsize-this.cwsize:0,e=(b-(a+document.getElementById("wms-menucontainer").offsetWidth+d))/this.cwsize;return e<1&&(e=1),typeof WebMessanger.forceMaxWin!="undefined"&&(e=WebMessanger.forceMaxWin),parseInt(e,10)},WindowHandler.reopenRemovedChat=function(){try{var a=WindowHandler.removed.pop();a!=null&&(WmsSessionStorage.setChatInfo({chid:a,removed:"false"}),WebMessanger.join(a,!0))}catch(b){}},WindowHandler.getChatCount=function(){return this.count},WindowHandler.getPreChatTime=function(a){var b=WindowHandler.getWinObjById(a);if(b!=null)return b.prechattime},WindowHandler.setPreChatTime=function(a,b){var c=WindowHandler.getWinObjById(a);c!=null&&(c.prechattime=b)},WindowHandler.removeExcessChat=function(a,b){function c(b){var c=WindowHandler.exist[b];return c!="empty"&&c!=null&&!c.detached&&document.getElementById(c.getObjId())!=null&&(c.getObjId()!=a&&e==null&&document.activeElement!=c.composer&&!c.iscallongoing&&(c.composer.value?f=c:e=c),d++),e}var d=0,e=null,f=null,g;if(b)for(g=WindowHandler.exist.length;g>=0;g--)e=c(g);else for(g=0;g<WindowHandler.exist.length;g++)e=c(g);d>this.getMaxWin()?(e==null&&(e=f),WindowHandler.removed.push(e.getObjId()),WmsSessionStorage.setChatInfo({chid:e.getObjId(),removed:"true"}),e.win.style.display="none",$WC.$CUtil.removeElement(e.win),WmsChatCache.remove(e.getObjId()),Factory.removeDialog(e.winIndex,!1),WindowHandler.count--):WindowHandler.rearrange()},WindowHandler.sendBotSuggestions=function(a,b){var c=a.getAttribute("chid"),d=WindowHandler.getWinObjById(c);Message.send(c,b),d.listcommon.showUI(""),d.autocompletediv.style.display="none",d.footernode.style.borderRadius="5px"},WindowHandler.onResize=function(){if(document.getElementById("wms-menucontainer")){var a=$WC.$CUtil.getObjectLength(WindowHandler.openedChats),b=WindowHandler.getMaxWin();if(a>b){var c=a-b;for(var d=0;d<c;d++)WindowHandler.removeExcessChat(null,!0)}else if(b>a&&WindowHandler.removed.length>0){var e=b-a;for(d=0;d<e;d++)WindowHandler.reopenRemovedChat()}}},$WC.$CUtil.addEvent(window,"resize",WindowHandler.onResize),WindowHandler.getObjectInObject=function(a,b,c){var d=a.getElementsByTagName(c);for(var e=0;e<d.length;e++)if(d[e].id==b)return d[e];return null},WindowHandler.getBarObject=function(a,b){return WindowHandler.getObjectInObject(this.chatbar,a,b)},WindowHandler.moveFocus=function(a,b,c){var d=0,e=0,f={},g={},h={};for(var i=WindowHandler.exist.length;i>0;i--){var j=WindowHandler.exist[i];if(j!="empty"&&j!=null&&j.win!=null&&j.win!=undefined&&!j.isMinimized()){g=j;break}}for(var k=0;k<WindowHandler.exist.length;k++){var l=WindowHandler.exist[k];if(l!="empty"&&l!=null&&l.win!=null&&l.win!=undefined&&!l.detached&&!l.isMinimized()){d==0&&(f=l),d++;if(l.getObjId()==a){e=a;continue}if(e!=0){try{b?$WC.$CUtil.getObjectLength(h)?(h.selectChat(),h.focus()):WmsMainUI.menu.style.display==="block"?(WmsMainUI.searchdiv.focus(),WindowHandler.lastViewed=-1):(g.selectChat(),g.focus()):(l.selectChat(),l.focus())}catch(k){}return!1}h=l}}return b?(h.selectChat(),h.focus()):c&&g.getObjId&&e==g.getObjId()&&f!=g?(f.selectChat(),f.focus()):e&&WmsMainUI.menu.style.display==="block"?(WmsMainUI.searchdiv.focus(),WindowHandler.lastViewed=-1):d&&(b?(g.selectChat(),g.focus()):(f.selectChat(),f.focus())),!1},WindowHandler.rearrange=function(){WindowHandler.openedChats={};for(var a=0;a<WindowHandler.exist.length;a++)try{var b=WindowHandler.exist[a];if(b!="empty"&&b!=null&&b.win!=null&&b.win!=undefined){var c=b.isMinimized()?"min":"max";WmsSessionStorage.setChatInfo({chid:b.getObjId(),state:c}),WindowHandler.openedChats[b.getObjId()]=c}}catch(a){}},WindowHandler.makeNormalWinById=function(a){try{var b=WindowHandler.getWinObjById(a);b.makeNormal(!0)}catch(c){}},WindowHandler.highlightByWinId=function(a){try{var b=WindowHandler.getWinObjById(a);b.highlight()}catch(c){}},WindowHandler.getWinObjById=function(a){a=""+a;for(var b=0;b<WindowHandler.exist.length;b++){var c=WindowHandler.exist[b];if(c!="empty"&&c!=null&&c.getObjId()==a)return c}return null},WindowHandler.removeWinById=function(a){try{var b=WindowHandler.getWinObjById(a);b.close(!0)}catch(c){}},WindowHandler.closeWinById=function(a){try{var b=WindowHandler.getWinObjById(a);b.closeAndPropagate()}catch(c){}},WindowHandler.updateUserStatus=function(a,b,c,d){try{for(var e=0;e<WindowHandler.exist.length;e++){var f=WindowHandler.exist[e];if(f!="empty"&&f!=null){var g=a;f.updatePartinfo(g,b,c,d),f.partcount===2&&f.partinfo[g]!==undefined?(f.updateUserStatus(b,c,d),b==0?f.updateOfflineMessage(g):b!=0&&f.offlinemessage&&f.updateOnlineMessage(g)):f.partcount>2&&f.partinfo[g]!==undefined&&f.populateParticipants()}}}catch(e){}},WindowHandler.hideAllChats=function(){for(var a=0;a<WindowHandler.exist.length;a++)try{WindowHandler.exist[a].hide()}catch(b){}},WindowHandler.setTitle=function(a,b){WindowHandler.getWinObjById(a).setTitle(b)},WindowHandler.updateChatTitle=function(a,b){WindowHandler.getWinObjById(a).updateChatTitle(b)},WindowHandler.updateStatus=function(a,b,c,d){WindowHandler.getWinObjById(a).updateUserStatus(b,c,d)},WindowHandler.blurChatById=function(a){try{WindowHandler.getWinObjById(a).blurChat()}catch(b){}},WindowHandler.focusChatById=function(a){WindowHandler.getWinObjById(a).focus()},WindowHandler.changeActive=function(){WMSUI.handleDocumentActive()},WindowHandler.showProgress=function(a,b,c){var d=WindowHandler.getWinObjById(a);d!=null&&d.salesiqchat==0&&d.showProgress(b,c,WmsDragDrop.nooffiles)},WindowHandler.clearProgress=function(a){var b=WindowHandler.getWinObjById(a);b!=null&&b.clearProgress()},WindowHandler.isMultiProtocolChat=function(a){var b=WindowHandler.getWinObjById(a);return b!=null?b.isMultiProtocolChat():!1},WindowHandler.restoreChats=function(){var a=WmsSessionStorage.getItem("wms_openchats");if(a===null)return;WindowHandler.removed=[];for(var b=0;b<a.length;b++){var c=a[b].chid;a[b].removed==="true"?WindowHandler.removed.push(c):a[b].salesiqchat==="true"?typeof WmsUIImpl!="undefined"&&WmsImplHandler.invoke(WmsUIImpl.restoreChat,c):WebMessanger.join(c,!0)}},WindowHandler.syncChatWindowTranscripts=function(){function c(a,b){setTimeout(function(){var b=WindowHandler.getWinObjById(a),c=b.msgdisp,d=c.querySelectorAll("[data-transerror],[data-loading]"),e=c.querySelectorAll(".wms-msgfrag:not([data-notack]):not([data-transerror])");if(e){var f=e[e.length-1];if(f){d.length&&!d[d.length-1].nextSibling&&$WC.$CUtil.removeElement(d[d.length-1]);var g=document.createElement("div");g.setAttribute("data-prevtime",f.getAttribute("data-msgtime")),g.setAttribute("data-scrollbehaviour","bottom"),g.style="display:none",c.appendChild(g),Message.loadSpecificTranscript(a,c,g)}}},b)}var a=this.openedChats,b=0;for(var d in a)WindowHandler.getWinObjById(d).makeNormal(),b+=500,c(d,b)},WindowHandler.resetAllTypingStatus=function(){for(var a=0;a<WindowHandler.exist.length;a++)if(WindowHandler.exist[a]!=="empty"){WindowHandler.exist[a].typingstatusnode.innerHTML="",WindowHandler.exist[a].typingindicatornode.style.display="none";var b=WindowHandler.exist[a].msgdisp.querySelector("[data-typingstatus]");b&&$WC.$CUtil.removeElement(b)}},WindowHandler.updateChannelProperties=function(){for(var a=0;a<WindowHandler.exist.length;a++){var b=WindowHandler.exist[a];b!=="empty"&&b.ctype==8&&(WmsChannels.get(b.objId)&&(WmsChannels.isUserHasPermission(b.objId,WmsConstants.USERPERMISSIONS.SEND_MESSAGE)==0&&b.disableComposerOptions(WmsResource.getRealValue("channels.announcementonly")),WmsChannels.isUserHasPermission(b.objId,WmsConstants.USERPERMISSIONS.ADD_MEMBER)==1&&(b.addmembernode.style.display="block"),b.showRestrictedChannelIcon(),WmsChannels.get(b.objId).leave_allowed==0&&(b.leavechannelnode.style.display="none")),b.updateChannelImage())}},WindowHandler.shrinkEnlargedWindows=function(){for(var a=0;a<WindowHandler.exist.length;a++)WindowHandler.exist[a]!=="empty"&&WindowHandler.exist[a].shrinkEnlargedWindow()},WindowHandler.hideAllActions=function(){for(var a=0;a<WindowHandler.exist.length;a++)WindowHandler.exist[a]!=="empty"&&(WindowHandler.exist[a].hideActions(),WMSUI.autoComplete.hideUI(WindowHandler.exist[a].objId))},Message.currentmsg=0,Message.msglist={},Message.types={TEXTMSG:"TEXTMSG",INFOMSG:"INFOMSG",IMGATT:"IMGATT",FILEATT:"FILEATT",LOADMORE:"LOADMORE",LOADMOREBUTTON:"LOADMOREBUTTON",TRANSERR:"TRANSERR",AUDIOATT:"AUDIOATT",VIDEOATT:"VIDEOATT",LOCATT:"LOCATT",CONTACTATT:"CONTACTATT",EVENTATT:"EVENTATT",CUSTOMMSG:"CUSTOMMSG",VIDEOLINK:"VIDEOLINK",AUDIOLINK:"AUDIOLINK",IMGLINK:"IMGLINK",BOTMSG:"BOTMSG",REPLYMSG:"REPLYMSG",TEMPMSG:"TEMPMSG",HRMSG:"HRMSG",DELETEDMSG:"DELETEDMSG"},Message.getMsgCategory=function(a){return/span class="wms-commandtext">[/](?:.+?)<\/span>/.test(a)?"command":/span class="wms-atmtntext">[@](?:.+?)<\/span>/.test(a)?"atmentions":/span class="wms-atmtntext">[+](?:.+?)<\/span>/.test(a)?"addmem":/span class="wms-atmtntext">[-](?:.+?)<\/span>/.test(a)?"delmem":"msg"},Message.getCurtriggers=function(a){return a=="atmentions"?["@",":"]:a=="addmem"?["+",":"]:a=="delmem"?["-",":"]:WMSUI.triggers},Message.metaInfo={},Message.PREV_SENDER={};var myMsgObj={};Message.send=function(a,b,c,d,e,f,g){var h=WindowHandler.getWinObjById(a);if(WMSUI.showErrorIfPermDenied(a))return;if(WebMessanger.offline==1)return h.updateInfoMessage(WmsResource.getRealValue("Unable_to_send_message")),!1;if(b.length>4e3)return h.updateInfoMessage(WmsResource.getRealValue("You_cannot_send_message_over_4000_characters_long")),!1;var i=(new Date).getTime();b=Smiley.replaceTextToEnglishCodes(b),WebMessanger.sendFormattedMessage(a,b,i,c,d,e,f,g),b=$WC.$CUtil.safeHTML(b),b=$WC.Markdown.apply(b),b=Message.trim(b);if(g){var j=h.msgdisp.querySelector('[data-msgid="'+g+'"]'),k=h.constructReplyMessageObject(j,b,i);h.closeReplyPreview()}else k={sender:WebMessanger.zuid,msg:b,time:i,notack:!0};return!d&&!Commands.isCommandMsg(b)&&h.updateMessage(k),h.removePromptMsg(),Self.isIdle[a]=!0,!0},Message.isLocalUser=function(a){return a==myMsgObj.sender?!0:!1},Message.isSameBrowser=function(a){return a==WebMessanger.getSid()?!0:!1},Message.isSentFromApi=function(a){return a&&a.api?!0:!1},Message.isCustomMsg=function(a){return a.meta!=undefined&&a.meta.formattedmsg!=undefined||a.meta!==undefined&&a.meta.usermessagedetails!==undefined&&(a.meta.usermessagedetails.msg_title||a.meta.usermessagedetails.custom_message||a.meta.usermessagedetails.thumbnail_url||a.meta.usermessagedetails.thumbnail_id||a.meta.usermessagedetails.thumbnail_preview_url||a.meta.usermessagedetails.thumbnail_preview_id||a.meta.usermessagedetails.custom_sender_name||a.meta.usermessagedetails.buttons)&&!a.meta.bm&&(!a.meta.usermessagedetails.custom_sender_id||a.meta.usermessagedetails.custom_sender_id.indexOf("b-")===-1||a.meta.usermessagedetails.themeid)},Message.isReplyMsg=function(a){return a.meta!=undefined&&a.meta.opr_replydetails!=undefined},Message.isBotMsg=function(a){return a.meta!==undefined&&a.meta.ms==1&&a.meta.bm||a.sender&&a.sender.indexOf("b-")!==-1||a.meta!==undefined&&a.meta.usermessagedetails&&a.meta.usermessagedetails.custom_sender_id&&a.meta.usermessagedetails.custom_sender_id.indexOf("b-")!==-1},Message.isMsgFromBot=function(a){var b=Message.getMessageType(a);return a&&a.meta&&a.meta.message_source&&(a.meta.message_source.type==="bot"||a.meta.message_source.type==="command")||b===Message.types.BOTMSG||b===Message.types.CUSTOMMSG},Message.isDelayMsg=function(a){return a.meta!==undefined&&a.meta.ms==1&&a.meta.config&&a.meta.config.d},Message.isHidingMsg=function(a){return a.meta!==undefined&&a.meta.ms==1&&a.meta.config&&a.meta.config.h},Message.isMetaMsg=function(a){return a.meta!==undefined},Message.isTempMsg=function(a){return a.meta!==undefined&&a.meta.isTempResponse},Message.constructImageMsgObject=function(a){var b={};return b.msg={},b.msg.dim={},b.msg.comment="",b.msg.size="",b.msg.sender=a.sender,b.msg.time=a.time,b.msg.fName="",b.msg.content="",b.meta=a.meta,a.meta.linkdetails.mimetype.indexOf("image/")!==-1?(b.msg.dim.height="",b.msg.dim.width="",b.msg.url=a.meta.linkdetails.url):(b.msg.dim.height=a.meta.linkdetails.height,b.msg.dim.width=a.meta.linkdetails.width,b.msg.url=a.meta.linkdetails.imgurl),b},Message.replaceAudioUrl=function(a){return a=$WC.Matcher.replacer($WC.Matcher.getRegexToGetAttrValueInHtmlTag("iframe","width"),null,a,function(a,b,c,d,e,f){return b+"100%"+f}),a=$WC.Matcher.replacer($WC.Matcher.getRegexToGetAttrValueInHtmlTag("iframe","height"),null,a,function(a,b,c,d,e,f){return b+"100%"+f}),a},Message.replaceVideoUrl=function(a){return a=$WC.Matcher.replacer($WC.Matcher.getRegexToGetAttrValueInHtmlTag("iframe","src"),null,a,function(a,b,c,d,e,f){var g=e+(e.indexOf("?")===-1?"?":"&")+"autoplay=true";return b+g+f}),a},Message.furlVideoElement=function(a){var b=a.querySelectorAll("[data-playable=true]"),c;for(var d=0;d<b.length;d++)c=b[d].getAttribute("thumbnailimg"),b[d].innerHTML='<div id="wms-urlvideo-play" class="wms-urlvideo-play wms-hvalign"></div>'+c},Message.formatCustomMsg=function(a,b){ZMSGUI.createOverlay();var c=Message.metaInfo[b],d=c.usermessagedetails,e=c.formattedmsg,f="",g="",h="",i='<span class="wms-imgpreviewclose"><img src="https://img.zohostatic.com/ichat/v282_https/images/spacer.gif" class="wms-imgpreviewcls"></span>',j='<div class="wms-custmmsgtitle">',k=d&&d.msg_title?'<div class="wms-custmmsgvline wms-truncate-ellipsis">{{msgtitle}}</div>':"",l=d&&(d.thumbnail_url||d.thumbnail_id)?'<div class="wms-custmmsgthumbnail"><img src="{{thumbnailurl}}" class="wms-custmmsgimg"></div>':"",m='<div class="wms-custmmsgpadding">{{custommsg}}</div></div>',n=e?e.length:0,o="";d&&d.thumbnail_url?o=d.thumbnail_url:d&&d.thumbnail_id&&(o="/"+_CHATCONT+"/v1/images/"+d.thumbnail_id);for(var p=0;p<n;p++){var q=e[p],r=q.data,s=q.type,t=q.title;if(s==="text")f=t?'<div class="wms-custmmsgtitle"><span class="wms-custmmsgtitvline wms-truncate-ellipsis">'+util.escapeHTML(t)+"</span>":'<div class="wms-custmmsgtitle">',f+='<div class="wms-custmmsgcnt">'+util.escapeHTML(r)+"</div></div>";else if(s==="list"){g=t?'<div class="wms-custmmsgtitle"><span class="wms-custmmsgtitvline wms-truncate-ellipsis">'+util.escapeHTML(t)+"</span>":'<div class="wms-custmmsgtitle">',g+='<ul class="wms-custmmsglist">';var u=r?r.length:0;for(var v=0;v<u;v++)g+="<li>"+util.escapeHTML(r[v])+"</li>";g+="</ul></div>"}else if(s==="table"){h=t?'<div class="wms-custmmsgtitle"><span class="wms-custmmsgtitvline wms-truncate-ellipsis">'+util.escapeHTML(t)+"</span>":'<div class="wms-custmmsgtitle">',h+='<div class="wms-custmtablediv"><div class="wms-custmtable"><div class="wms-custmrow">';var w=r.headers.length;for(var x=0;x<w;x++)h+='<div class="wms-custmcel">'+util.escapeHTML(r.headers[x])+"</div>";h+="</div>";var y=r.rows?r.rows.length:0;for(var z=0;z<y;z++){h+='<div class="wms-custmrow">',u=r.rows[z].length;for(var A=0;A<u;A++)h+='<div class="wms-custmcel">'+util.escapeHTML(r.rows[z][A])+"</div>";h+="</div>"}h+="</div></div>"}}j+=k+l+m+f+g+h+'</div></div><span class="wms-imgpreviewclose"><img src="https://img.zohostatic.com/ichat/v282_https/images/spacer.gif" class="wms-imgpreviewcls"></span>',j=$WC.template.replace(j,{msgtitle:d?d.msg_title:"",thumbnailurl:o,custommsg:a});var B=document.createElement("div");B.id="wms-custmmsgcontainer",B.className="wms-custmmsg wms-hvalign",B.style.zIndex=$WC.$CUtil.getConfig("zindex"),document.body.appendChild(B),document.getElementById("wms-custmmsgcontainer").innerHTML=j,document.getElementById("wms-overlay").innerHTML=i},Message.resend=function(a,b,c){var d=a.getAttribute("data-chid"),e=[],f=[];c?f=a.querySelectorAll("[data-msgfailure]"):f.push(b);for(var g=f.length-1;g>=0;g--)e.push(Message.getMsgFromDom(d,f[g].getAttribute("data-msgid")||f[g].parentNode.querySelector("[data-msgid]").getAttribute("data-msgid"),!1,!1)),Message.removeFailedMessages(f[g]);Message.sendmsg(d,e)},Message.removeFailedMessages=function(a){var b=a.previousSibling,c=a.nextSibling;b&&b.className==="wms-msgtime"&&(b=b.previousSibling),c&&c.className==="wms-msgtime"&&(c=c.nextSibling);if(b&&b.getAttribute("data-senderzuid")&&(!c||c&&c.getAttribute("data-senderzuid"))){var d=a.previousSibling;d.previousSibling.className==="wms-msgdate"&&$WC.$CUtil.removeElement(d.previousSibling),$WC.$CUtil.removeElement(a.previousSibling)}a.nextSibling&&a.nextSibling.className==="wms-msgtime"&&$WC.$CUtil.removeElement(a.nextSibling),$WC.$CUtil.removeElement(a)},Message.sendmsg=function(a,b){var c=b.pop();Message.send(a,c,b)},Message.getTextMsgFromDom=function(a,b){var c="";for(var d=0;d<a.length;d++)if(a[d].nodeName==="#text"||a[d].nodeName==="A")c+=b?$WC.$CUtil.safeHTML($WC.$CUtil.getInnerText(a[d])):$WC.$CUtil.getInnerText(a[d]);else if(a[d].nodeName==="SPAN"){var e=a[d].outerHTML;c+=WMSUI.atMentions.replaceAtMentionsForHtml(e,b)}else if(a[d].nodeName==="EM"){var f=a[d].outerHTML;c+=Smiley.replaceSmileyForHtml(f)}else a[d].nodeName==="BLOCKQUOTE"?c+=b?$WC.Markdown.apply("!"+Message.getTextMsgFromDom(a[d].childNodes,b)):"!"+Message.getTextMsgFromDom(a[d].childNodes,b):a[d].nodeName==="CODE"?c+=b?$WC.Markdown.apply("`"+Message.getTextMsgFromDom(a[d].childNodes,b)+"`"):"`"+Message.getTextMsgFromDom(a[d].childNodes,b)+"`":a[d].nodeName==="PRE"?c+=b?$WC.Markdown.apply("```"+Message.getTextMsgFromDom(a[d].childNodes,b)+"```"):"```"+Message.getTextMsgFromDom(a[d].childNodes,b)+"```":a[d].nodeName==="STRONG"?c+=b?$WC.Markdown.apply("*"+Message.getTextMsgFromDom(a[d].childNodes,b)+"*"):"*"+Message.getTextMsgFromDom(a[d].childNodes,b)+"*":a[d].nodeName==="STRIKE"?c+=b?$WC.Markdown.apply("~"+Message.getTextMsgFromDom(a[d].childNodes,b)+"~"):"~"+Message.getTextMsgFromDom(a[d].childNodes,b)+"~":a[d].nodeName==="I"?c+=b?$WC.Markdown.apply("_"+Message.getTextMsgFromDom(a[d].childNodes,b)+"_"):"_"+Message.getTextMsgFromDom(a[d].childNodes,b)+"_":a[d].nodeName==="H1"?c+=b?$WC.Markdown.apply("# "+Message.getTextMsgFromDom(a[d].childNodes,b)):"# "+Message.getTextMsgFromDom(a[d].childNodes,b):a[d].nodeName==="H2"?c+=b?$WC.Markdown.apply("## "+Message.getTextMsgFromDom(a[d].childNodes,b)):"## "+Message.getTextMsgFromDom(a[d].childNodes,b):a[d].nodeName==="H3"?c+=b?$WC.Markdown.apply("### "+Message.getTextMsgFromDom(a[d].childNodes,b)):"### "+Message.getTextMsgFromDom(a[d].childNodes,b):a[d].nodeName==="H4"?c+=b?$WC.Markdown.apply("#### "+Message.getTextMsgFromDom(a[d].childNodes,b)):"#### "+Message.getTextMsgFromDom(a[d].childNodes,b):a[d].nodeName==="H5"?c+=b?$WC.Markdown.apply("##### "+Message.getTextMsgFromDom(a[d].childNodes,b)):"##### "+Message.getTextMsgFromDom(a[d].childNodes,b):a[d].nodeName==="H6"?c+=b?$WC.Markdown.apply("###### "+Message.getTextMsgFromDom(a[d].childNodes,b)):"###### "+Message.getTextMsgFromDom(a[d].childNodes,b):a[d].nodeName==="BR"?c+="\n":a[d].nodeName==="HR"&&(c+="---");return c},Message.getMsgFromDom=function(a,b,c,d){var e=WindowHandler.getWinObjById(a).msgdisp,f=c?'.wms-msgfrag [data-msgid="'+b+'"]':'[data-msgid="'+b+'"]',g=e.querySelector(f),h=g.getAttribute("data-type");g=g&&g.firstChild;var i=g.childNodes;if(h==Message.types.TEXTMSG||h==Message.types.BOTMSG)return Message.getTextMsgFromDom(i,d);if(h==Message.types.IMGATT){var j=g.querySelector("img[data-previewable]");return{messagetype:h,fName:j.getAttribute("data-fname"),fileurl:j.src.split("/").pop(),isv1:j.getAttribute("data-isv1")}}if(h==Message.types.REPLYMSG)return Message.getMsgFromDom(a,b,!0,d);if(h==Message.types.FILEATT){var k=g.querySelector(".wms-filedesc a");return{messagetype:h,fName:$WC.$CUtil.getInnerText(k)}}if(h==Message.types.LOCATT)return k=g.querySelector(".wms-locmsgimg a"),{messagetype:h,name:$WC.$CUtil.getInnerText(k)};if(h==Message.types.CONTACTATT)return k=g.querySelector(".wms-contactmsgimg span"),{messagetype:h,name:$WC.$CUtil.getInnerText(k.firstChild)};if(h==Message.types.EVENTATT)return k=g.querySelector(".wms-evntmsgname"),{messagetype:h,name:$WC.$CUtil.getInnerText(k)};if(h==Message.types.AUDIOATT)return k=g.querySelector(".wms-audioinfo a"),{messagetype:h,fName:$WC.$CUtil.getInnerText(k)};if(h==Message.types.VIDEOATT)return k=g.querySelector("#wms-videofilefrwrd"),{messagetype:h,fName:k.getAttribute("data-fname")};if(h==Message.types.CUSTOMMSG)return k=g.querySelector(".zcdesc"),k?{messagetype:h,desc:$WC.$CUtil.getInnerText(k)}:Message.getTextMsgFromDom(i,d);if(h==Message.types.VIDEOLINK||h==Message.types.AUDIOLINK)return k=g.querySelector("a"),{messagetype:h,desc:$WC.$CUtil.getInnerText(k)};if(h==Message.types.IMGLINK)return k=g.querySelector("img"),{messagetype:h,desc:k.src};if(h==Message.types.HRMSG)return Message.getTextMsgFromDom([g],d)},Message.isMentionMsg=function(a){return $WC.Matcher.check("atmention",a)},Message.isAddMsg=function(a){return $WC.Matcher.check("addmember",a)},Message.isDeleteMsg=function(a){return $WC.Matcher.check("deletemember",a)},Message.formatLastMsgInfo=function(a){var b=a;if(Message.isMentionMsg(a)||Message.isAddMsg(a)||Message.isDeleteMsg(a)){var c=!0;b=WMSUI.atMentions.format(a,c)}else typeof a=="string"&&a.indexOf("<hr>")!==-1&&(b=a.replace("<hr>","---"));return b},Message.getDnameFromMetaDataFormat=function(a){var b=$WC.$CUtil.getContactName(a.split(":")[1]);return a.split(":")[1]===WebMessanger.zuid?b=WebMessanger.getNickName():b||(b=a.split(":")[3]),b=util.escapeHTML(b)},Message.constructMessageFragment=function(){function a(a,b,c,d,e){var f="",g="",h='<div class="{{classname}}" data-senderzuid="{{senderzuid}}"><img class="wms_cw_userphoto" data-zcprofileid="{{senderzuid}}" src="'+WmsContacts.getUserPhoto(a)+'"><span class="wms-profileinfo" data-zcprofileid="{{senderzuid}}">{{sendername}}</span></div>';if(d||a&&c!==a){d?(f=d,g=b,Message.isLocalUser(a)?e?h='<div class="{{classname}}" data-senderzuid="{{senderzuid}}"><img class="wms_cw_userphoto" src="'+e+'"><span class="wms-profileinfo" data-senderzuid="{{senderzuid}}" title="{{customsendername}}">{{sendername}}</span></div>':h='<div class="{{classname}}" data-senderzuid="{{senderzuid}}"><img class="wms_cw_userphoto" src="'+WmsContacts.getUserPhoto(a)+'"><span class="wms-profileinfo">{{sendername}}</span></div>':e?h='<div class="{{classname}}" data-senderzuid="{{senderzuid}}"><img class="wms_cw_userphoto" data-zcprofileid="{{senderzuid}}" src="'+e+'"><span class="wms-profileinfo" data-zcprofileid="{{senderzuid}}" data-senderzuid="{{senderzuid}}" title="{{customsendername}}">{{sendername}}</span></div>':h='<div class="{{classname}}" data-senderzuid="{{senderzuid}}" title="{{customsendername}}">{{sendername}}</div>'):Message.isLocalUser(a)?f=WmsResource.getRealValue("chat.you"):f=$WC.$CUtil.getContactName(a,b);var i="wms-msgsender";return!d&&Message.isLocalUser(a)&&(i+=" wms-msgsenderhl"),$WC.template.replace(h,{sendername:WebMessanger.unescapeHTML(f),senderzuid:a,customsendername:g,classname:i})}return""}function b(a,b){return Message.isBotMsg(a)&&Message.isCustomMsg(a)?(Message.metaInfo[b]=a.meta,'<a data-custommsg="true" >'+Message.formatLinks(a.msg)+"</a>"):(a=Message.isMentionMsg(a)||Message.isAddMsg(a)||Message.isDeleteMsg(a)?WMSUI.atMentions.format(a):a,a=Message.format(a),a=Smiley.replace(a),a)}function c(a,b){var c="",d="",e="",f="",g="",h="",i={},j="wms-imgmsgcontainer",k=240,l=130,m,n,o,p,q=a.url||a.fileurl,r=a.content||a.contenttype;if(a.meta&&a.meta.linkdetails.mimetype.indexOf("image/")!==-1)e=a.meta.linkdetails.url,a=a.msg,j="wms-imgmetamsgcontainer",n=k,m=l;else{a.meta&&a.meta.linkdetails.mimetype.indexOf("text/")!==-1?(d='<div class="wms-iconseperator"><div class="wms-urlinfoouterdiv"><div class="wms-urlinfo"><a href="{{urllink}}" target="_blank" class="wms-urlinfolink">{{urltitlelink}}</a></div><div class="wms-urlinfo"><a href="{{urlauthorurl}}" target="_blank" class="wms-urlinfoauthor">{{urlauthor}}</a></div><div class="wms-urlinfo"><a href="{{urlproviderurl}}" target="_blank" class="wms-urlsiteinfo">{{urlprovider}}</a></div></div>',e=a.meta.linkdetails.imgurl,i=a.meta.linkdetails,a=a.msg,f=i.imgurl,g=i.providerurl,j="wms-imgmetamsgcontainer"):(e=a.constructeddownloadurl||a.url,h=a["img-data"]?"data:image/jpeg;base64,"+a["img-data"]:"",d='<div class="wms-msg wms-imgwrapper">');if(a.dim){var s=a.dim.height/a.dim.width;n=a.dim.width,a.dim.width>=k&&(n=k),m=Math.ceil(n*s),n<k&&(n=k),m<l&&(m=l),p=a.dim.width,o=a.dim.height}else n=229,m=l,o=l,p=k,e=a.constructeddownloadurl||a.url}var t="";if(a.comment){t=$WC.$CUtil.safeHTML(WebMessanger.unescapeHTML(a.comment));var u=Smiley.replace(t);c=$WC.template.replace('<div class="wms-msgcomment">{{comment}}</div>',{comment:u},"InSecureHTML"),j+=" wms-imgmsgcontainer-withcomment"}var v='src="{{originalsrc}}"';!WMSUI.isLoadedImg(e)&&h&&(v='class="wms-imgbluroverlay" originalsrc="{{originalsrc}}" src="{{src}}"');var w=d+'<div class="{{classname}}" data-previewable="true">'+"<img "+v+'src="{{originalsrc}}" data-fname="{{filename}}" data-fsize="{{size}}" data-fsender="{{sender}}" data-fdate="{{date}}" data-ftime="{{time}}" data-fheight="{{actualheight}}" data-fwidth="{{actualwidth}}" data-fcomment="{{comment}}" data-fcontent="{{content}}" data-furl="{{url}}" data-dname="{{dname}}" data-previewable="true" data-filefrwrd={{filefrwrdsupport}} data-isv1={{isv1}}>'+"</div>"+c+"</div>";return $WC.template.replace(w,{originalsrc:e,src:h,classname:j,size:a.size||"",sender:a.sender,date:MyDate.formatDate(a.time),time:MyDate.formatTime(a.time),actualheight:o,actualwidth:p,height:m,width:n,filename:a.fName,comment:t,content:r,url:q,dname:b,linkurl:f,urllink:i.url,urltitlelink:i.title,urlauthorurl:i.authorurl,urlproviderurl:g,urlauthor:i.authorname,urlprovider:i.providername,filefrwrdsupport:a.isFileForwardSupported?!0:!1,isv1:a.isv1?!0:!1,$download:"chat.download",$forward:"chat.forward",$preview:"chat.preview"})}function d(a,b){return a!=="-1"&&b&&MyDate.formatDate(a)!==MyDate.formatDate(b)?$WC.template.replace("<div class='wms-msgdate' data-msgtime={{msgtime}}><span>{{date}}</span></div>",{date:MyDate.formatDateWithWords(a),msgtime:a}):""}function e(a){return a?$WC.template.replace("<div class='wms-msgtime' title='{{date}}'>{{msgtime}} </div>",{msgtime:MyDate.formatTime(a),date:MyDate.formatDate(a)}):""}function f(a){var b="",c="";if(a.comment){c=$WC.$CUtil.safeHTML(WebMessanger.unescapeHTML(a.comment));var d=Smiley.replace(c);b="<div class='wms-msgcomment'>{{comment}}</div>",b=$WC.template.replace(b,{comment:d},"InSecureHTML")}var e='<div class="wms-filemsgcontainer"><div class="wms-filemsgimg"></div><div class="wms-filedesc wms-truncate-ellipsis" ><a href={{src}} download="{{filename}}" title="{{filename}}">{{filename}}</a><div class="wms-filesize">{{filesize}}</div></div><a class="wms-filedownloadwrapper" href="{{src}}" download="{{filename}}"><span class="wms-filedownload" title="{{filesize}}"></span></a>';return e+="</div>",e+=b,$WC.template.replace(e,{src:a.constructeddownloadurl||a.url,filename:a.fName,type:a.content||a.contenttype,filesize:a.size||"",url:a.url||a.fileurl,comment:c,isv1:a.isv1?!0:!1})}function g(a,b){var c='<div class="wms-msginfo" data-infotype="{{infotype}}" title="{{time}}">{{msg}}</div>';return $WC.template.replace(c,{msg:Message.getInfoMsgString(a),time:MyDate.formatDTTime(b),infotype:a.type?a.type:"msginfo",zuid:a.opruser?a.opruser.zuid:""},"InSecureHTML")}function h(a,b,c,d){var e=a?' data-prevtime="'+a+'"':" ";return e+=b?' data-nexttime="'+b+'"':" ",e+=c?' data-mentionmsgid="'+c+'"':" ",e+=d?' data-latestchunk="'+d+'"':" ",'<div class="wms-msgfrag wms-transerror" data-transerror="true"'+e+">"+WmsResource.getRealValue("transcript.error")+' <span class="wms-transretry" data-retry="true">'+WmsResource.getRealValue("transcript.retry")+"</span></div>"}function i(a){var b="",c="";if(a.comment){c=$WC.$CUtil.safeHTML(WebMessanger.unescapeHTML(a.comment));var d=Smiley.replace(c);b="<div class='wms-msgcomment'>{{comment}}</div>",b=$WC.template.replace(b,{comment:d},"InSecureHTML")}var e='<div class="wms-audiofilecontainer"><div data-media="true" id="wms-audioplayer" class="wms-audioplayerdiv" source="{{filesrc}}"><div class="wms-audioplayer wms-valign-mid-block" id="wms-mediaplaypause" data-attr="play"><div id="wms-audioplay" data-operation="play" class="wms-audioplay wms-hvalign"></div><div id="wms-audiopause" data-operation="pause" class="wms-audiopause wms-hvalign"></div></div><div class="wms-audioinfo wms-truncate-ellipsis wms-valign-mid-block"><a href="{{filesrc}}" title="{{filename}}">{{filename}}</a><div><div id="wms-audioremtime" data-operation="remtime"></div><a href="{{filesrc}}" download><span id="wms-audioplayerdwnld" class="wms-audioplayerdwnld" data-operation="mediadwnld" title="{{filesize}}"/></span></a><span class="wms-audiofilefrwrd" data-fsrc="{{filesrc}}" data-fcontent="{{type}}" data-furl="{{url}}" data-fname="{{filename}}" data-fcomment="{{comment}}" data-filefrwrd="true" title="'+WmsResource.getRealValue("chat.forward")+'"></span></div></div></div></div></div>'+b,f=a.content||a.contenttype,g=a.url||a.fileurl,h=a.meta?a.meta.linkdetails.url:_WMSCHATURL+"download.sas?mime="+f+"&url="+g+"&fName="+a.fName;return $WC.template.replace(e,{filesrc:h,filename:a.fName||h,filesize:a.size||"",duration:"",url:g,type:f,comment:c})}function j(a){var b="",c="";if(a.comment){c=$WC.$CUtil.safeHTML(WebMessanger.unescapeHTML(a.comment));var d=Smiley.replace(c);b="<div class='wms-msgcomment'>{{comment}}</div>",b=$WC.template.replace(b,{comment:d},"InSecureHTML")}var e='<div id="wms-videoplayer" data-media="true" class="wms-videoplayer" style="position:relative" source={{filesrc}}><div id="wms-mediaplaypause" data-attr="play" source={{filesrc}} class="wms-videoplayarea"><div id="wms-videoscreenplaypause" class="wms-hvalign wms-videoscreen-playpause"><div data-operation="play" id="wms-videoscreen-play"></div><div id="wms-videoscreen-pause" data-operation="pause" style="display:none"></div></div><video id="wms-video" style="width:100%; height:inherit;" src=""></video></div><div id="wms-videoinfo" class="wms-videoinfo" source={{filesrc}}><span id="wms-videoplay" data-operation="play" class="wms-valign-mid-block"></span><span id="wms-videopause" data-operation="pause" class="wms-valign-mid-block" style="display:none"></span><span id="wms-videocurtime" data-operation="curtime" class="wms-videocurtime  wms-valign-mid-block">00:00</span><span id="wms-videoduration" data-operation="duration" class="wms-videoduration  wms-valign-mid-block"></span><span id="wms-videofullscreen" data-operation="fullscreen"></span><a href="{{filesrc}}" download><span id="wms-videoplayerdwnld" data-operation="mediadwnld" title="{{filesize}}"/></span></a><span id="wms-videofilefrwrd" data-fsrc="{{filesrc}}" data-fcontent="{{type}}" data-furl="{{url}}" data-fname="{{filename}}" data-fcomment="{{comment}}" data-filefrwrd="true" title="'+WmsResource.getRealValue("chat.forward")+'"></span></div></div>'+b,f=a.content||a.contenttype,g=a.url||a.fileurl,h=a.meta?a.meta.linkdetails.url:_WMSCHATURL+"download.sas?mime="+f+"&url="+g+"&fName="+a.fName;return $WC.template.replace(e,{filesrc:h,filename:a.fName||h,filesize:a.size||"",duration:"",url:g,type:f,comment:c})}function k(a){var b="<div class='wms-filemsgcontainer wms-locmsgimg'><div><a href='"+window.location.protocol+"//maps.google.com/?q={{latitude}},{{longitude}}' target='_blank'>{{locname}}</a><div id='wms-locationinfo'><span title='{{loc}}' class='wms-truncate-ellipsis wms-filetype'>{{loc}}</span></div></div></div>";return $WC.template.replace(b,{latitude:a.lat,longitude:a.lng,locname:a.name,loc:a.loc||""})}function l(a){var b="<div class='wms-filemsgcontainer wms-contactmsgimg'><span>{{contactname}}<div id='wms-contactinfo'><span class='wms-truncate-ellipsis wms-filetype'>{{contactno}}</span></div></div>",c="";return a.extras&&(c=a.extras[0].value),$WC.template.replace(b,{contactname:a.name,contactno:c})}function m(a){var b="<div class='wms-evntmsgcontainer'><div class='wms-evntmsgdiv'><div class='wms-evntmsgmon'>{{eventmonth}}</div><div class='wms-evntmsgdate'>{{eventdate}}<div class='wms-evntmsgtime'>&#64;{{eventstarttime}}</div></div></div><div class='wms-evntmsginfo'><span class='wms-evntmsgname'>{{eventname}}</span><div class='wms-evntmsgduration'>{{eventtime}}</div></div></div>",c=MyDate.formatDTTime(a.startdate)+" "+WmsResource.getRealValue("chat.event.to")+" "+MyDate.formatDTTime(a.enddate),d=c.split(" "),e=d[1],f=d[0]+" "+WmsResource.getRealValue("chat.event.th"),g=d[3]+d[4];return $WC.template.replace(b,{eventmonth:e,eventdate:f,eventstarttime:g,eventname:a.name,eventtime:c})}function n(a,b){if(a&&a.meta){var c;if(a.meta.formattedmsg||a.meta.btnindexvsdetails||a.msg.length>200){a.meta.usermessagedetails||(a.meta.usermessagedetails={}),a.meta.usermessagedetails.themeid=a.meta.usermessagedetails.themeid||1;var d=$WC.CMsgUtil.convertMsgObj(a);c=$WC.CustomMsgUI.getCustomMessageContent(d)}else c=Message.getDisplayContent(a.msg);if(b.indexOf("command")!==-1||a.isTempResponse)c+='<div class="wms-cmdvisiblediv"><span class="wms-cmdvisible"></span>'+WmsResource.getRealValue("chat.command.visibility")+"<div data-chid="+a.chid+" data-msgid="+a.time+' data-purpose="shareresponseclick_onmsg" class="wms_cmdvisible_share">'+WmsResource.getRealValue("chat.command.share")+"</div></div>";return c}Message.metaInfo[b]=a.meta;var e="",f="",g='<div class="wms-cmdvisiblediv"><span class="wms-cmdvisible"></span>'+WmsResource.getRealValue("chat.command.visibility")+"<div data-chid="+a.chid+" data-msgid="+a.time+' data-purpose="shareresponseclick_onmsg" class="wms_cmdvisible_share">'+WmsResource.getRealValue("chat.command.share")+"</div></div>";a.meta.usermessagedetails&&(a.meta.usermessagedetails.thumbnail_preview_url||a.meta.usermessagedetails.thumbnail_preview_id)&&(e='<div class="wms-imgmsgcontainer wms-customimg" data-previewable="true"><img src="{{thumbnailpreviewurl}}" data-previewable="true" class="wms-hvalign" data-customimg="true"></div>'),a.meta.usermessagedetails&&a.meta.usermessagedetails.thumbnail_preview_url?f=a.meta.usermessagedetails.thumbnail_preview_url:a.meta.usermessagedetails&&(f="/"+_CHATCONT+"/v1/images/"+a.meta.usermessagedetails.thumbnail_preview_id);var h='<a data-custommsg="true" >{{msg}}</a>'+e;return b.indexOf("command")!==-1&&(h+=g),$WC.template.replace(h,{msg:Message.formatLinks(a.msg),thumbnailpreviewurl:f},"InSecureHTML")}function o(a){var c='<div class="wms-mediaurl">'+b(a.msg)+"</div>",d=a.meta.linkdetails,e="<div class='wms-urlinfoouterdiv'><div class='wms-urlinfo'><img src=\"{{urlproviderurl}}/favicon.ico\"><a href='{{urlproviderurl}}' target='_blank'>{{urlprovider}}</a></div><div class='wms-urlinfolink'><a href='{{urllink}}' target='_blank'>{{urltitlelink}}</a></div></div><div class='wms-media'  data-playable='true' thumbnailimg='{{videoimg}}' iframe='{{iframe}}'>{{thumbnailimg}}</div>",f='<p class="wms-videowrapper">'+Message.replaceVideoUrl(d.html)+"</p>",g="<div id='wms-urlvideo-play' class='wms-urlvideo-play wms-hvalign'></div><img src='"+d.thumbnailurl+"' />",h='<img src="'+d.thumbnailurl+'" />';return c+=$WC.template.replace(e,{thumbnailimg:g,videoimg:h,thumbnailurl:d.thumbnailurl,iframe:f,urllink:d.url,urltitlelink:d.title,urlauthorurl:d.authorurl,urlproviderurl:d.providerurl,urlauthor:d.authorname,urlprovider:d.providername},"InSecureHTML"),c}function p(a){var c='<div class="wms-mediaurl">'+b(a.msg)+"</div>",d=a.meta.linkdetails,e="<div class='wms-urlinfoouterdiv'><div class='wms-urlinfo'><img src=\"{{urlproviderurl}}/favicon.ico\"><a href='{{urlproviderurl}}' target='_blank'>{{urlprovider}}</a></div><div class='wms-urlinfolink'><a href='{{urllink}}' target='_blank'>{{urltitlelink}}</a></div></div><div class='wms-media' data-playable='true' iframe='{{iframe}}'>{{audioframe}}</div>",f=Message.replaceAudioUrl(d.html);return c+=$WC.template.replace(e,{thumbnailurl:d.thumbnailurl,iframe:d.html,audioframe:f,urllink:d.url,urltitlelink:d.title,urlauthorurl:d.authorurl,urlproviderurl:d.providerurl,urlauthor:d.authorname,urlprovider:d.providername},"InSecureHTML"),c}function q(a){var d='<div class="wms-imglink">'+b(a.msg)+"</div>",e=Message.constructImageMsgObject(a);return d+=c(e,a.dname),d}var r;return Message.constructReplyMessageFragment=r=function(a,c){function d(a,b){var c,d,e,f=Message.getMessageType(a);if(f===Message.types.IMGATT||f===Message.types.FILEATT)b?(c=a,d=c.contenttype,e=c.fileurl):(c=a.msg,d=c.content,e=c.url),c.constructeddownloadurl=c.isv1?"/"+_CHATCONT+"/v1/attachments/"+encodeURIComponent(e):_WMSCHATURL+"download.sas?mime="+encodeURIComponent(d)+"&url="+encodeURIComponent(e)+"&fName="+encodeURIComponent(c.fName),c.isFileForwardSupported=!0}var e=a.meta.opr_replydetails,f=e.msg||e;if(typeof f=="object")for(var g in f.addinfo)f[g]=f.addinfo[g];var h=$WC.$CUtil.getContactName(e.sender)||e.sendername;delete a.meta,d(a),d(e,!0);var i;if(Message.getMessageType(f)===Message.types.IMGATT)i='<div class="wms-replyimg"><img src="{{replyimgurl}}"/><span class="imgtext wms-truncate-ellipsis">{{fname}}</span></div>';else if(Message.getMessageType(f)===Message.types.FILEATT)i='<span class="imgtext wms-truncate-ellipsis">{{fname}}</span>';else if(Message.getMessageType(f)===Message.types.AUDIOATT)i='<span class="imgtext wms-truncate-ellipsis">{{fname}}</span>';else if(Message.getMessageType(f)===Message.types.VIDEOATT)i='<span class="imgtext wms-truncate-ellipsis">{{fname}}</span>';else if(Message.getMessageType(f)===Message.types.LOCATT)i="<div class='wms-filemsgcontainer wms-locmsgimg'><div><span>{{locname}}</span></div></div>";else if(Message.getMessageType(f)===Message.types.CONTACTATT)i="<div class='wms-filemsgcontainer wms-contactmsgimg'><span>{{contactname}}</span></div>";else if(Message.getMessageType(f)===Message.types.EVENTATT)i='<div class="wms-evntmsgcontainer"><span class="wms_calicon"></span><span>{{eventname}}</span></div>';else if(Message.getMessageType(f)===Message.types.CUSTOMMSG||Message.getMessageType(f)===Message.types.BOTMSG||Message.getMessageType(f)===Message.types.VIDEOLINK||Message.getMessageType(f)===Message.types.AUDIOLINK||Message.getMessageType(f)===Message.types.IMGLINK)i='<div class="wms-replytext">{{desc}}</div>';else try{i='<div class="wms-replytext">'+b(f)+"</div>"}catch(j){i="=========FORMAT TO BE SUPPORTED========"}var k="";if(!c){var l=a.sender+"_"+a.time;k=Message.constructMessageFragment(a.sender,a.dname,a.time,a.msg,Message.getMessageType(a),a.sender,a.time,l,!0)}var m="";c&&(m='<div class="wms_cw_replyclose"></div>');var n='<div class="wms-replymsgwrapper"><div class="wms-replymsg"  data-replymsgtime="{{replymsgtime}}" data-replysenderzuid="{{senderzuid}}"><div class="wms-replymsgheader"><span class="wms-replymsgicon"></span><span class="wms-replymsgsender wms-truncate-ellipsis" title="{{sendername}}">{{sendername}}</span><span class="wms-replymsgtime wms-truncate-ellipsis" title="{{dateinwords}} {{formattedtime}}">{{dateinwords}} {{formattedtime}}</span>'+m+"</div>"+"<div>"+i+"</div>"+"</div>"+k+"</div>";return $WC.template.replace(n,{replymsgtime:e.msgtime,sendername:h,senderzuid:e.sender,dateinwords:MyDate.formatDateWithWords(e.msgtime),formattedtime:MyDate.formatTime(e.msgtime),replyimgurl:f.constructeddownloadurl,locname:f.name,contactname:f.name,eventname:f.name,fname:f.fName,desc:f.desc})},function(s,t,u,v,w,x,y,z,A,B,C,D){var E,F,G,H="",I=C?'data-msgackid="'+C+'"':"",J=D?'data-notack="true"':"";if(w===Message.types.LOADMORE)return'<div style="display:none" data-loadmore="true"></div>';if(w===Message.types.LOADMOREBUTTON)return'<div style="display:block" class="wms-loadmorebutton" data-loadmorebutton="true" data-prevtime="'+y+'"><a>'+WmsResource.getRealValue("chat.loadinbetween")+"</a></div>";if(w===Message.types.TRANSERR)return h(v.prevtime,v.nexttime,v.mentionmsgid,v.latestchunk);if(A)E="",F="",G="";else{E=d(u,y),E&&(x=""),F=a(s,t,x);if(w!==Message.types.INFOMSG){w===Message.types.DELETEDMSG&&(u=v.origin_time);if(!B||MyDate.formatTime(u)!==MyDate.formatTime(B))H=e(u)}G="wms-msgfrag",!Message.isMsgFromBot(v)&&Message.isLocalUser(s)&&(G+=" wms-msgsenderhl")}var K="";if(w===Message.types.IMGATT)v.time=u,v.sender=s,K+=c(v,t),v.meta&&(F="",E="",G="",u="");else if(w===Message.types.FILEATT)K+='<div class="wms-msg">'+f(v)+"</div></div>";else if(w===Message.types.INFOMSG)v.opruser={zuid:s,nname:t},K+=g(v,u),F="",G="wms-msginfofrag";else if(w===Message.types.AUDIOATT)K+='<div class="wms-msg wms-audioattmsg">'+i(v)+"</div></div>",v.meta&&(F="",E="",G="");else if(w===Message.types.VIDEOATT)K+='<div class="wms-msg">'+j(v)+"</div></div>",v.meta&&(F="",E="",G="");else if(w===Message.types.LOCATT)K+="<div class='wms-msg'>"+k(v)+"</div></div>";else if(w===Message.types.CONTACTATT)K+="<div class='wms-msg'>"+l(v)+"</div></div>";else if(w===Message.types.EVENTATT)K+="<div class='wms-msg'>"+m(v)+"</div></div>";else if(w===Message.types.CUSTOMMSG){var L=v.meta.usermessagedetails,M=L&&L.custom_sender_name?L.custom_sender_name:t,N="https://img.zohostatic.com/ichat/v282_https/images/bar/customimg-default.png";L&&(L.custom_sender_id&&L.custom_sender_id.startsWith("b-")?WmsContacts.contactslist[v.meta.usermessagedetails.custom_sender_id]&&WmsContacts.contactslist[v.meta.usermessagedetails.custom_sender_id].ISBOT&&(N=WmsContacts.contactslist[v.meta.usermessagedetails.custom_sender_id].PHOTO):L.custom_sender_imageid?N=_WMSCHATURL+"v1/images/"+L.custom_sender_imageid:L.custom_sender_imageurl&&(N=L.custom_sender_imageurl));if(v.sender&&v.sender.indexOf("command")!==-1){var O=Commands.getById(v.sender.replace(/command/,"")).name;M=O}F=a(s,t,x,M,N);var P=v&&v.meta&&!(v.meta.formattedmsg||v.meta.btnindexvsdetails||v.msg.length>200)?"wms_custmmsg":"";K+='<div class="wms-msg '+P+'">'+n(v,z)+"</div></div>"}else if(w===Message.types.BOTMSG){M,N;var Q="";v.meta&&v.meta.usermessagedetails&&(M=v.meta.usermessagedetails.custom_sender_name?v.meta.usermessagedetails.custom_sender_name:v.title,N=v.meta.usermessagedetails.custom_sender_imageurl?v.meta.usermessagedetails.custom_sender_imageurl:"https://img.zohostatic.com/ichat/v282_https/images/bar/customimg-default.png"),WmsContacts.contactslist[v.sender]&&WmsContacts.contactslist[v.sender].ISBOT?(N=WmsContacts.contactslist[v.sender].PHOTO,M=WmsContacts.contactslist[v.sender].DNAME):v.meta&&v.meta.usermessagedetails&&v.meta.usermessagedetails.custom_sender_id&&v.meta.usermessagedetails.custom_sender_id.indexOf("b-")!==-1?WmsContacts.contactslist[v.meta.usermessagedetails.custom_sender_id]&&WmsContacts.contactslist[v.meta.usermessagedetails.custom_sender_id].ISBOT&&(N=WmsContacts.contactslist[v.meta.usermessagedetails.custom_sender_id].PHOTO,s=v.meta.usermessagedetails.custom_sender_id):v.sender&&v.sender.startsWith("b-")&&(N=WmsContacts.getUserPhoto(v.sender));if(v.meta){var R=$WC.CMsgUtil.convertMsgObj(v);$WC.CustomMsg.storeMsgObj(R)}F=a(s,t,x,M,N);if(v.meta&&v.meta.isTempResponse||v.isTempResponse)Q='<div class="wms-cmdvisiblediv"><span class="wms-cmdvisible"></span>'+WmsResource.getRealValue("chat.command.visibility")+"<div data-chid="+v.chid+" data-msgid="+v.time+' data-purpose="shareresponseclick_onmsg" class="wms_cmdvisible_share">'+WmsResource.getRealValue("chat.command.share")+"</div></div>";K+="<div class='wms-msg wms-txtmsg'>"+b(v.msg,z)+Q+"</div>"}else if(w===Message.types.VIDEOLINK)K+="<div class='wms-msg wms-videomsg'>"+o(v)+"</div>";else if(w===Message.types.AUDIOLINK)K+="<div class='wms-msg'>"+p(v)+"</div>";else if(w===Message.types.IMGLINK)K+="<div class='wms-msg'>"+q(v)+"</div>";else if(w===Message.types.REPLYMSG)K+='<div class="wms-msg">'+r(v)+"</div>";else if(w===Message.types.TEMPMSG)K+='<div class="wms-msg">'+b(v.msg,z)+'<div class="wms-cmdvisiblediv"><span class="wms-cmdvisible"></span>'+WmsResource.getRealValue("chat.command.visibility")+"<div data-chid="+v.chid+" data-msgid="+v.time+' data-purpose="shareresponseclick_onmsg" class="wms_cmdvisible_share">'+WmsResource.getRealValue("chat.command.share")+"</div></div></div>";else if(w===Message.types.HRMSG)G+=" wms-hrmsg",K=v,H="";else if(w===Message.types.DELETEDMSG)v.isNextMsgDeleted?(Message.incrementDeletedMsgCount(v.time),H=""):K+=Message.getDeletedMsgInfo(v.time);else{if(v.meta){var S=$WC.CMsgUtil.convertMsgObj(v);$WC.CustomMsg.storeMsgObj(S),v=v.msg}K+="<div class='wms-msg wms-txtmsg'>",K+=b(v,z)+"</div>"}return $WC.template.replace('{{datefragment}}{{senderfragment}}<div class="{{classname}}" data-msgid={{msgid}} {{msgackattribute}} data-type="{{msgtype}}" data-sendername="{{sendername}}" data-msgtime={{msgtime}} {{notackattr}}>{{messagefragment}}</div>{{timefragment}}',{classname:G,datefragment:E,msgtime:u,senderfragment:F,messagefragment:K,timefragment:H,msgid:z,msgackattribute:I,msgtype:w,sendername:t,notackattr:J},"InSecureHTML")}}(),Message.constructAndInsertChatContent=function(a,b,c,d){function f(){return a.find(function(a){if(a.msgid==i)return!0})}var e=b.querySelectorAll("[data-notack]:not([data-msgfailure])");for(var g=0;g<e.length;g++){var h=e[g],i=h.getAttribute("data-msgtime"),j=f();j&&(h.setAttribute("data-msgtime",j.time),h.setAttribute("data-msgid",j.sender+"_"+j.time),h.removeAttribute("data-notack"),a.splice(a.indexOf(j),1))}var k=Message.constructChatContent(a,b,c),l=Message.getScrollHeight(b),m=Message.getScrollTop(b),n=a[a.length-1],o=b.querySelector(".wms-msgdate");if(o){var p=o.getAttribute("data-msgtime"),q=n&&n.time;MyDate.isSameDay(p,q)&&$WC.$CUtil.removeElement(o)}var r=b.querySelector(".wms-msgsender");if(r){var s=r.getAttribute("data-senderzuid"),t=n&&Message.getMessageType(n)==="INFOMSG"?"":n&&n.sender;MyDate.isSameDay(p,q)&&t===s&&$WC.$CUtil.removeElement(r)}d.insertAdjacentHTML("afterend",k),d===d.parentNode.firstChild&&Message.restoreScrollPosition(b,l,m),d.getAttribute("data-scrollbehaviour")==="bottom"&&Message.scrollDisplay(b)},Message.constructAndAppendChatContent=function(a,b,c){var d=Message.constructChatContent(a,b,c);b.insertAdjacentHTML("beforeend",d)},Message.getMessageType=function(a){if(a.messagetype)return a.messagetype;if(a.mode==="more")return Message.types.LOADMORE;if(a.mode==="morebutton")return Message.types.LOADMOREBUTTON;if(Message.isReplyMsg(a))return Message.types.REPLYMSG;if(typeof a.msg!="object"&&!a.mod){if(Message.isCustomMsg(a))return Message.types.CUSTOMMSG;if(Message.isBotMsg(a))return Message.types.BOTMSG;if(a.meta!==undefined&&a.meta.linkdetails!==undefined){if(a.meta.linkdetails.mimetype==="text/html")return a.meta.linkdetails.linktype==="video"&&a.meta.linkdetails.html?Message.types.VIDEOLINK:a.meta.linkdetails.linktype==="audio"&&a.meta.linkdetails.html?Message.types.AUDIOLINK:a.meta.linkdetails.linktype==="image"?Message.types.IMGLINK:Message.types.TEXTMSG;return a.meta.linkdetails.mimetype&&a.meta.linkdetails.mimetype.indexOf("image/")!==-1?Message.types.IMGLINK:Message.types.TEXTMSG}return Message.isTempMsg(a)?Message.types.TEMPMSG:a.msg==="<hr>"?Message.types.HRMSG:a.mtype===""+CT_DELETED_MSG?Message.types.DELETEDMSG:Message.types.TEXTMSG}if(a.mtype==="16")return Message.types.INFOMSG;if(a.mod==="location"||a.mode==="att"&&a.msg.__module&&a.msg.__module==="location")return Message.types.LOCATT;if(a.mod==="contact"||a.mode==="att"&&a.msg.__module&&a.msg.__module==="contact")return Message.types.CONTACTATT;if(a.mod==="event"||a.mode==="att"&&a.msg.__module&&a.msg.__module==="event")return Message.types.EVENTATT;if(a.mod==="att"||a.mode==="att"){var b;return a.addinfo&&a.addinfo.contenttype?b=a.addinfo.contenttype:b=a.msg&&a.msg.content,a.msg&&a.msg.content&&a.msg.content.indexOf("image")!==-1&&a.msg.dim&&a.msg.dim.height&&a.msg.dim.width||b&&b.indexOf("image")!==-1?Message.types.IMGATT:b&&b.indexOf("audio")!==-1&&WmsMediaPlayer.isSupportedAudioFormat(b)?Message.types.AUDIOATT:b&&b.indexOf("video")!==-1&&WmsMediaPlayer.isSupportedVideoFormat(b)?Message.types.VIDEOATT:Message.types.FILEATT}},function(){function d(){a=1,c=[]}var a=1,b="",c=[];Message.incrementDeletedMsgCount=function(b){a===1&&c.push(b),a++},Message.getDeletedMsgInfo=function(e){c.push(e),c.sort();var f,g="",h="",i=a===1?WmsResource.getRealValue("chat.info.deletemsg"):WmsResource.getRealValue("chat.info.deletemsgs",[a]);return c.length===1||MyDate.formatTime(c[0])===MyDate.formatTime(c[1])?(g=MyDate.formatTime(c[0])+", "+MyDate.formatDateWithWords(c[0]),f=WmsResource.getRealValue("chat.deletemsg.title",[g])):(MyDate.formatDateWithWords(c[0])===MyDate.formatDateWithWords(c[1])?g=MyDate.formatTime(c[0]):g=MyDate.formatTime(c[0])+", "+MyDate.formatDateWithWords(c[0]),h=MyDate.formatTime(c[1])+", "+MyDate.formatDateWithWords(c[1]),f=WmsResource.getRealValue("chat.deletemsgs.title",[g,h])),b="<div class='wms-msg wms-txtmsg wms-delmsg' title=\""+f+'">'+i+"</div>",d(),b}}(),Message.constructChatContent=function(a,b,c){var d="",e,f,g;if(a.previoussender)e=a.previoussender;else{var h=b.querySelectorAll("[data-senderzuid]"),i=h[h.length-1];e=i&&i.getAttribute("data-senderzuid")}if(a.previoustime)f=a.previoustime;else{var j=b.querySelectorAll("[data-msgtime]"),k=j[j.length-1];f=k&&k.getAttribute("data-msgtime")}for(var l=0;l<a.length;l++){var m=Message.getMessageType(a[l]),n=a[l].meta?a[l]:a[l].msg,o,p=null,q=WindowHandler.getWinObjById(c);q&&(o=q.ctype);if(o==undefined||o&&o!="5")m===Message.types.IMGATT||m===Message.types.FILEATT?(a[l].salesiqchat?n.downloadurl=WmsUIImpl.customContactsConfig().getAttachmentUrl(n.url):n.isv1local?n.constructeddownloadurl=n.url:n.constructeddownloadurl=n.isv1?"/"+_CHATCONT+"/v1/attachments/"+encodeURIComponent(n.url):_WMSCHATURL+"download.sas?mime="+encodeURIComponent(n.content)+"&url="+encodeURIComponent(n.url)+"&fName="+encodeURIComponent(n.fName),n.constructeddownloadurl=a[l].salesiqchat?n.downloadurl:n.constructeddownloadurl,n.isFileForwardSupported=!0):m===Message.types.INFOMSG&&(n.chid=c);a[l].sender||(m===Message.types.IMGATT||m===Message.types.FILEATT)&&a[l].msg&&a[l].msg.sender&&(a[l].sender=a[l].msg.sender),!a[l].time&&a[l].msgtime&&(a[l].time=a[l].msgtime);if(MyDate.formatTime(a[l].time)===MyDate.formatTime(f)){var r=b&&b.querySelector('[data-msgid][data-msgtime="'+f+'"]');r&&r.nextSibling&&r.nextSibling.className=="wms-msgtime"&&$WC.$CUtil.removeElement(r.nextSibling)}a[l+1]&&(p=a[l+1].time),a[l+1]&&a[l+1].mtype===""+CT_DELETED_MSG&&(a[l].isNextMsgDeleted=!0,p=a[l+1].origin_time),g=a[l].sender+"_"+a[l].time;var s=a[l].msgackid,t=a[l].notack;Message.isHidingMsg(a[l])&&Message.setTimeToHideMsg(b,a[l],g);if(m===Message.types.REPLYMSG||m===Message.types.BOTMSG||m===Message.types.CUSTOMMSG||m===Message.types.VIDEOLINK||m===Message.types.AUDIOLINK||m===Message.types.IMGLINK||m===Message.types.TEMPMSG||m===Message.types.DELETEDMSG)n=a[l];a[l].chid=c,d+=Message.constructMessageFragment(a[l].sender,a[l].dname,a[l].time,n,m,e,f,g,null,p,s,t),e=m!==Message.types.INFOMSG&&m!==Message.types.BOTMSG?a[l].sender:"",f=m===Message.types.DELETEDMSG?a[l].origin_time:a[l].time}return d},Message.setTimeToHideMsg=function(a,b,c){var d=a.getAttribute("data-chid"),e=WindowHandler.getWinObjById(d);clearTimeout(e.msghidetimer);var f=parseInt(b.meta.config.h);e.msghidetimer=setTimeout(function(){Message.hideMsg(a,c)},f)},Message.hideMsg=function(a,b){var c=a.querySelector('[data-msgid="'+b+'"]').parentNode;c.previousSibling.previousSibling.querySelector(".wms-msgdate")&&$WC.$CUtil.removeElement(c.previousSibling.previousSibling),$WC.$CUtil.removeElement(c.previousSibling),$WC.$CUtil.removeElement(c)},Message.addEventListenersForTranscript=function(a,b){var c=Message.getScrollableParent(a);Message.glowBubble=function(a,b){var c=b.querySelector('.wms-msgfrag[data-msgtime="'+a+'"]');return b.setAttribute("data-glowtime",a),c?($WC.$CUtil.isScrolledIntoView(c,b)?($WC.$CUtil.addClass(c.firstChild,"wms-bubbleglow"),b.removeAttribute("data-glowtime")):c.scrollIntoView({behavior:"smooth",block:"center"}),!0):!1},Gator(a).on("mouseover","[data-type]",$WC.$CUtil.debounce(function(){if(this.querySelector("[data-options]")===null&&this.getAttribute("data-type")!=="INFOMSG"&&this.getAttribute("data-type")!=="DELETEDMSG"){var a=this.firstChild;this.getAttribute("data-type")==="REPLYMSG"&&(a=this.querySelector("[data-type]").firstChild),a.insertAdjacentHTML("afterbegin",'<div class="wms-valign-mid-block" data-options="hide"></div>')}},null,50)),Gator(a).on("mouseout","[data-type]",$WC.$CUtil.debounce(function(a){var b=a.relatedTarget;if(b&&!b.closest("[data-type]")&&this.querySelector("[data-msgoperations]")===null){var c=this.querySelector("[data-options]");$WC.$CUtil.removeElement(c)}},null,100)),$WC.$CUtil.addEvent(a,"click",function(d){var e=getEventTarget(d),f=a.getAttribute("data-chid");if(e.getAttribute("data-retry")==="true"||e.parentNode.getAttribute("data-loadmorebutton")==="true"){var g=e.parentNode;Message.loadSpecificTranscript(f,a,g)}else if(e.getAttribute("data-previewable")==="true")e.tagName==="IMG"?WMSUI.imgPreview.init(a,e):WMSUI.imgPreview.init(a,e.firstChild);else if(e.getAttribute("data-custommsg")==="true"){var h=e.parentNode.getAttribute("data-msgid"),i=e.querySelectorAll("br");for(var j=0;j<i.length;j++)i[j].parentNode.replaceChild(document.createTextNode("\n"),i[j]);Message.formatCustomMsg($WC.$CUtil.getInnerText(e),h)}else if(e.parentNode.getAttribute("data-playable")==="true"){var k=e.parentNode.getAttribute("iframe");e.parentNode.innerHTML=k}else if(e.getAttribute("data-filefrwrd")==="true")WmsFileForward.init(e);else if(e.parentNode.getAttribute("data-media")==="true"||e.parentNode.parentNode.getAttribute("data-media")==="true"||e.parentNode.parentNode.parentNode.getAttribute("data-media")==="true"){var l=e.parentNode.getAttribute("data-media")==="true"?e.parentNode:e.parentNode.parentNode;e.parentNode.parentNode.parentNode.getAttribute("data-media")==="true"&&(l=e.parentNode.parentNode.parentNode);if(a.getAttribute("data-msgdisp")==="true")var m="chatwindow";else a.id==="wmschshtransmsg"&&(m="chathistory");WmsMediaPlayer.init(d,m,l,f)}else if(e.getAttribute("data-msgfailure")==="true"){var n=WindowHandler.getWinObjById(f);n.clickedfailurenode=e,n.createChatwindowOverlay()}else if(e.getAttribute("data-infocallbtn")){var o=e.getAttribute("data-infocallbtn"),p=e.getAttribute("data-calleezuid"),q=WindowHandler.getWinObjById(f);o==="triggerAudioCall"?WMSUI.makeAudioCall(p,WebMessanger.ismediacallnewwindow,q):o==="triggerVideoCall"&&WMSUI.makeVideoCall(p,WebMessanger.ismediacallnewwindow,q)}else if(e.getAttribute("data-purpose")==="shareresponseclick_onmsg"){var r={msgid:e.getAttribute("data-msgid")},s={"X-XHR-exception":"true","X-ZCSRF-TOKEN":$WC.$CUtil.getCSRF(),"Content-Type":"application/json"};$WC.Ajax.postRequestToChat("v1/chats/"+f+"/shareintegrationresponse",r,null,null,null,null,s)}else if(e.closest("[data-replymsgtime]")){var t=e.closest("[data-replymsgtime]"),u=t.getAttribute("data-replymsgtime");if(!Message.glowBubble(u,c)){var v=t.getAttribute("data-replysenderzuid"),w=f+"|"+v+"|"+u,x=document.createElement("div");x.setAttribute("data-mentionmsgid",w),x.style="display:none";var y,z=a.querySelectorAll("[data-prevtime]");if(z.length)for(j=0;j<z.length;j++){var A=z[j].getAttribute("data-prevtime");isNaN(A)?(A=A.split("|")[2],+u>+A&&(y=z[j].parentNode.insertBefore(x,z[j].nextSibling))):+u>+A&&(y=z[j].parentNode.insertBefore(x,z[j].nextSibling))}if(!y){var B=a.querySelector("[data-loadmore],[data-transerror]");a.replaceChild(x,B),y=x}Message.loadSpecificTranscript(f,a,y)}}else if(e.getAttribute("data-options")){Message.hideOptions();var C="";n=WindowHandler.getWinObjById(f);var D=e.getBoundingClientRect(),E=n.ctrlcomp.getBoundingClientRect();D.x+D.width+115>E.x+E.width&&(C='style="left: auto; right: 38px;" data-align="left"');var F=e.closest('[data-type="TEXTMSG"]')?'<div data-msgopr="copy" class="wms_msgoption wms_copyaction">'+WmsResource.getRealValue("message.actions.copy")+"</div>":"";k='<div id="wms_msgoptionsdiv" data-msgoperations="true"'+C+'class="wms_msgoptionsdiv wms-valign-mid-block">'+'<div data-msgopr="reply" class="wms_msgoption wms_replyaction">'+WmsResource.getRealValue("message.actions.reply")+"</div>"+F+"</div>",e.insertAdjacentHTML("beforeend",k),e.setAttribute("data-options","show");var G=e.querySelector("[data-msgoperations]"),H=G.getBoundingClientRect();H.y+H.height>E.y+E.height?(G.style.bottom="0",$WC.$CUtil.removeClass(G,"wms-valign-mid-block"),$WC.$CUtil.addClass(G,"wms_msgoptions_pointer")):E.y>H.y&&(G.style.top="0",$WC.$CUtil.removeClass(G,"wms-valign-mid-block"),$WC.$CUtil.addClass(G,"wms_msgoptions_pointer_top")),WMSUI.addIndocClickcallbackQue("msgoptions",e,function(){Message.hideOptions(e)}),d.stopPropagation()}else if(e.closest("[data-msgoperations]")){var I=e.getAttribute("data-msgopr");if(I==="reply"){var J=e.closest("[data-msgid]");n=WindowHandler.getWinObjById(f),n&&n.showReplyPreview(J)}else if(I==="copy"){var K=e.closest('[data-type="TEXTMSG"]'),L=K.firstChild,M=Message.getTextMsgFromDom(L.childNodes),N='<textarea id="wms_copyhidden" style="display:block;">'+M+"</textarea>";e.insertAdjacentHTML("afterend",N),n=WindowHandler.getWinObjById(f),document.getElementById("wms_copyhidden").select(),document.execCommand("copy"),n.showInfoMsg(WmsResource.getRealValue("message.info.copied"))}Message.hideOptions(e)}else if(e.getAttribute("data-operation")==="addmem"){var O=e.getAttribute("data-id").split(",");n=WindowHandler.getWinObjById(f),WMSUI.confirmAndAddMember(f,null,O),n.removePromptMsg()}}),Gator(a).on("click",".zcmsg_bx",function(a){if(document.getElementById("zcwindows")===null){var b=document.createElement("div");b.id="zcwindows",b.className="zcoverlay",b.style.zIndex=WebMessanger.setzindex,document.body.appendChild(b),Gator(b).on("click","[purpose='custom_image_preview']",function(a){$WC.CustomMsgUI.handleCustomBoxClick(this,a)})}a.target.closest("[custombuttonclick_onmsg]")===null&&(document.activeElement.blur(),$WC.CustomMsgUI.handleCustomBoxClick(this,a))}),Gator(a).on("dblclick",".wms-msgfrag",function(b){var c=getEventTarget(b);if(c.closest(".wms-msg")===null){var d=a.getAttribute("data-chid"),e=WindowHandler.getWinObjById(d);e&&e.showReplyPreview(c)}}),$WC.$CUtil.addEvent(c,"scroll",function(c){var d=getEventTarget(c);clearTimeout(this.scrolltimer),this.scrolltimer=setTimeout(function(){WMSUI.loadImages(d)},_WMSORIGINALIMG_LOAD_TIMEOUT);if(d.scrollHeight>d.clientHeight&&d.scrollTop<400&&d.getAttribute("data-glowtime")===null){var e=d.querySelector("[data-loadmore]");e&&(e.nextSibling.getAttribute("data-msgtime")&&e.setAttribute("data-nexttime",e.nextSibling.getAttribute("data-msgtime")),Message.loadSpecificTranscript(b,d,e))}}),$WC.$CUtil.addEvent(c,"scroll",$WC.$CUtil.debounce(function(){var a=c.getAttribute("data-glowtime");if(a){var b=c.querySelector('.wms-msgfrag[data-msgtime="'+a+'"]');b&&($WC.$CUtil.addClass(b.firstChild,"wms-bubbleglow"),c.removeAttribute("data-glowtime"))}},this,70));var d=util.getCssAnimEndListener();$WC.$CUtil.addEvent(c,d,function(a){if(a.animationName==="wms-bubbleglow"){var b=getEventTarget(a);$WC.$CUtil.removeClass(b,"wms-bubbleglow")}})},Message.hideOptions=function(a){var b=a&&a.closest&&a.closest("[data-options]")||document.querySelector('[data-options="show"]');if(!b)return;$WC.$CUtil.removeElement(b)},Message.loadSpecificTranscript=function(a,b,c){var d=!1,e,f,g;if(c.getAttribute("data-mentionmsgid")){var h=c.getAttribute("data-mentionmsgid");e=h,d=!0;var i=16}else if(c.getAttribute("data-prevtime"))e=c.getAttribute("data-prevtime"),f=+e+1;else if(c.getAttribute("data-nexttime"))e=c.getAttribute("data-nexttime"),g=+e;else if(c.getAttribute("data-latestchunk")){e="latestchunk";var j=!0}b.getAttribute("data-fromchat")==="true"&&(d=!0),!g&&c.nextSibling&&c.nextSibling.getAttribute("data-msgtime")&&(g=+c.nextSibling.getAttribute("data-msgtime"));var k=c===c.parentNode.lastChild?!0:!1,l=WMSUI.showLoadingIcon(c,"insert");l.setAttribute("data-marker",e),(c.getAttribute("data-scrollbehaviour")||k)&&l.setAttribute("data-scrollbehaviour",c.getAttribute("data-scrollbehaviour")||"bottom");var m=b;b.getAttribute("data-ctrlcomp")==="true"&&(m=b.querySelector("[data-msgdisp]"));var n=WindowHandler.getWinObjById(a);WebMessanger.getTranscript({chid:a,fromtime:f,totime:g,lineslimit:i||50,partial:j,type:"insert",mentionmsgid:h,salesiqchat:n&&n.salesiqchat||!1},m,d)},Message.formatAndDisplay=function(a){var b=a.chid;a.time||(a.time=Date.now()),WindowHandler.getWinObjById(b).updateMessage(a)},Message.replaceAttURL=function(a){return a=a.replace(/images\/icon\/dwn-arrow.gif/g,"https://img.zohostatic.com/ichat/v282_https/images/dwn-arrow.gif"),a=a.replace(/\/download.sas.mime/g,_WMSCHATURL+"download.sas?mime"),a},Message.getScrollableParent=function(a){return a.getAttribute("data-msgdisp")?a.parentNode:a},Message.getScrollHeight=function(a){return Message.getScrollableParent(a).scrollHeight},Message.getScrollTop=function(a){return Message.getScrollableParent(a).scrollTop},Message.restoreScrollPosition=function(a,b,c){a.getAttribute("data-msgdisp")&&(a=a.parentNode);var d=b-c,e=a.scrollHeight-d;a.scrollTop=e},Message.scrollDisplay=function(a){a=Message.getScrollableParent(a),a.scrollTop=a.scrollHeight},Message.trim=function(a){return a=a.replace(/<p>|<\/p>/gi,""),a=a.replace(/<a/gi,"<a target='_blank'"),a=a.replace(/\n/gi,"<br>"),a=a.replace(/^\s*$/gi,""),a=a.replace(/^(<br>)*$/gi,""),a=a.replace(/(<br>)*$/gi,""),a},Message.format=function(a){try{var b=a.split(" "),c=[],d=/([a-z0-9]([a-z0-9_\-.+]*)@([a-z0-9_\-.]*)(\.[a-z]{2,3}(\.[a-z]{2}){0,2}))/gi;for(var e=0;e<b.length;e++){var f=Message.formatLinks(b[e]);b[e]===f&&(f=f.replace(d,"<a href='mailto:$1'>$1</a>")),c.push(f)}a=c.join(" ")}catch(g){}return a},Message.formatLinks=function(){function a(a){var b=a;a.indexOf("http://")!==0&&a.indexOf("https://")!==0&&(b="http://"+a);var c=document.createElement("a");c.href=b;var d=c.href.toLowerCase();return d===b.toLowerCase()||d===a.toLowerCase()+"/"||d===b.toLowerCase()+"/"?a:decodeURI(c.href)}function b(b,c,d){d=a(d);var e=d;return d.indexOf("http://")!==0&&d.indexOf("https://")!==0&&(e="http://"+d),c+"<a href='"+e+"' target='_blank' rel='noopener'>"+d+"</a>"}return function(a){a=" "+a;var c=/([^(href|src)="'])(((http(s){0,1}:\/\/))([^ <\n]*))/gi,d=/([^(href|src|//)"'=])((www\.)([^ <\n]*))/gi,e=/(^| )(([\w\d-]+\.)+(com|org|net|int|edu|gov|mil|info|biz))(?=( |$))/gi,f=/(^| )(([\w\d-]+\.)+((?!js|cp)[a-z]){2})(?=( |$))/gi;return a=a.replace(c,b),a=a.replace(d,b),a=a.replace(f,b),a=a.replace(e,b),a.trim()}}(),Message.getDisplayContent=function(a){return a=Smiley.replace(a),a=Message.trim(a),a=Message.format(a),a},Message.autofill=function(a,b){try{Message.msglist[b]==undefined&&(Message.msglist[b]=new Array),Message.msglist[b][Message.msglist[b].length]=a,Message.currentmsg=-1,Message.msglist[b].length>60&&(Message.msglist[b]=Message.msglist[b].splice(20,60))}catch(c){}},Message.getInfoMsgString=function(a){var b=a.mode,c=a.msg,d=WindowHandler.getWinObjById(a.chid),e;switch(b){case"GUEST ENTERED":c=WmsResource.getRealValue("Guest")+" "+a.nname+" "+WmsResource.getRealValue("entered_the_chat");break;case"USER ADDED":var f=new Array,g=a.userslist,h=a.opruser;if(g[h.zuid]){c=WmsResource.getRealValue("chat.member.joined",'<span class="wms-profileinfo" data-zcprofileid='+h.zuid+">"+$WC.$CUtil.getContactName(h.zuid,h.nname,!0)+"</span>");break}for(var i in g)f.push('<span class="wms-profileinfo"  data-zcprofileid='+i+">"+$WC.$CUtil.getContactName(i,g[i],!0)+"</span>");e=d&&d.addinfotemplate?d.addinfotemplate:"chat.member.add",c=WmsResource.getRealValue(e,['<span class="wms-profileinfo" data-zcprofileid='+h.zuid+">"+$WC.$CUtil.getContactName(h.zuid,h.nname,!0)+"</span>",f.join(", ")]);break;case"GUEST LEFT":c=WmsResource.getRealValue("Guest")+" "+a.nname+" "+WmsResource.getRealValue("left_the_chat");break;case"USER DELETED":f=new Array,g=a.userslist,h=a.opruser;if(g[h.zuid]){c=WmsResource.getRealValue("chat.member.left",'<span class="wms-profileinfo" data-zcprofileid='+h.zuid+">"+$WC.$CUtil.getContactName(h.zuid,h.nname,!0)+"</span>");break}for(i in g)f.push('<span class="wms-profileinfo"  data-zcprofileid='+i+">"+$WC.$CUtil.getContactName(i,g[i],!0)+"</span>");e=d&&d.deleteinfotemplate?d.deleteinfotemplate:"chat.member.delete",c=WmsResource.getRealValue(e,['<span class="wms-profileinfo" data-zcprofileid='+h.zuid+">"+$WC.$CUtil.getContactName(h.zuid,h.nname,!0)+"</span>",f.join(", ")]);break;case"GUEST ACCESS":h=a.opruser,c=$WC.$CUtil.getContactName(h.zuid,h.nname,!0)+" "+WmsResource.getRealValue("turned")+" "+(a.access=="on"?WmsResource.getRealValue("on"):WmsResource.getRealValue("off"))+" "+WmsResource.getRealValue("guest_access");break;case"TITLE CHANGE":h=a.opruser,e=d&&d.titleinfotemplate?d.titleinfotemplate:"chat.rename",a.title?c=WmsResource.getRealValue(e,['<span class="wms-profileinfo" data-zcprofileid='+h.zuid+">"+$WC.$CUtil.getContactName(h.zuid,h.nname,!0)+"</span>",a.title]):c=WmsResource.getRealValue("chat.title.clear",['<span class="wms-profileinfo" data-zcprofileid='+h.zuid+">"+$WC.$CUtil.getContactName(h.zuid,h.nname,!0)+"</span>"]);break;case"CALL STARTED":c=WmsResource.getRealValue("chat.call.start");break;case"CALL ENDED":c=WmsResource.getRealValue("chat.call.end");break;case"BROADCAST STARTED":h=a.opruser,c=WmsResource.getRealValue("chat.broadcast.live",[$WC.$CUtil.getContactName(h.zuid,h.nname,!0)]);break;case"BROADCAST STOPPED":c=WmsResource.getRealValue("chat.broadcast.stop");break;case"CALLNOTIFICATION":c=Message.getCallNotificationMessage(a)}return c},Message.getCallNotificationMessage=function(a){var b=a.msg.type,c=Message.isLocalUser(a.opruser.zuid),d=a.msg.event,e="",f=function(a,b,c){return c==="audio"?'<div class="wms_callbutton_wrapper"><span data-infocallbtn="triggerAudioCall" class="wms_audiocall" data-calleezuid="'+a+'"></span> <span data-infocallbtn="triggerAudioCall" class="wms_callinfo" data-calleezuid="'+a+'">'+(b?WmsResource.getRealValue("info.call.again"):WmsResource.getRealValue("info.call.back"))+"</span></div>":'<div class="wms_callbutton_wrapper"><span data-infocallbtn="triggerVideoCall" class="wms_videocall" data-calleezuid="'+a+'"></span> <span data-infocallbtn="triggerVideoCall" class="wms_callinfo" data-calleezuid="'+a+'">'+(b?WmsResource.getRealValue("info.call.again"):WmsResource.getRealValue("info.call.back"))+"</span></div>"};switch(d){case"completed":var g=a.msg.duration.split(":"),h=parseInt(g[0]),i=parseInt(g[1]),j=parseInt(g[2]),k=g[0]!=="00"?" "+h+" "+(h>1?"hrs":"hr"):"",l=g[1]!=="00"?" "+i+" "+(i>1?"mins":"min"):"",m=g[2]!=="00"?" "+j+" "+(j>1?"secs":"sec"):"";e='<span class="inftxt"><span class="wms_infotext">'+WmsResource.getRealValue("info.call.completed",[WmsResource.getRealValue("info.call."+b)])+'</span> <span class="wms_callduration">'+(k+l+m)+"</span>"+f(c?a.msg.calleduser.zuid:a.opruser.zuid,!0,b)+"</span>";break;case"cancelled":e=c?'<span class="inftxt"><span class="wms_infotext">'+WmsResource.getRealValue("info.call.cancelled.caller",[WmsResource.getRealValue("info.call."+b)])+"</span>"+f(a.msg.calleduser.zuid,c,b)+"</span>":'<span class="inftxt"><span class="wms_infotext">'+WmsResource.getRealValue("info.call.cancelled.callee",['<span class="wms-profileinfo" data-zcprofileid='+a.opruser.zuid+">"+$WC.$CUtil.getContactName(a.opruser.zuid,a.opruser.nname,!0)+"</span>",WmsResource.getRealValue("info.call."+b)])+"</span>"+f(a.opruser.zuid,c,b)+"</span>";break;case"noresponse":case"busy_on_another_call":e=c?'<span class="inftxt"><span class="wms_infotext">'+WmsResource.getRealValue("info.call.noresponse.caller",['<span class="wms-profileinfo" data-zcprofileid='+a.msg.calleduser.zuid+">"+$WC.$CUtil.getContactName(a.msg.calleduser.zuid,a.msg.calleduser.nname,!0)+"</span>",WmsResource.getRealValue("info.call."+b)])+"</span>"+f(a.msg.calleduser.zuid,c,b)+"</span>":'<span class="inftxt"><span class="wms_infotext">'+WmsResource.getRealValue("info.call.noresponse.callee",[WmsResource.getRealValue("info.call."+b)])+"</span>"+f(a.opruser.zuid,c,b)+"</span>";break;case"rejected":e=c?'<span class="inftxt"><span class="wms_infotext">'+WmsResource.getRealValue("info.call.rejected.caller",['<span class="wms-profileinfo" data-zcprofileid='+a.msg.calleduser.zuid+">"+$WC.$CUtil.getContactName(a.msg.calleduser.zuid,a.msg.calleduser.nname,!0)+"</span>",WmsResource.getRealValue("info.call."+b+"call")])+"</span>"+f(a.msg.calleduser.zuid,c,b)+"</span>":'<span class="inftxt"><span class="wms_infotext">'+WmsResource.getRealValue("info.call.rejected.callee",[WmsResource.getRealValue("info.call."+b),'<span class="wms-profileinfo" data-zcprofileid='+a.opruser.zuid+">"+$WC.$CUtil.getContactName(a.opruser.zuid,a.opruser.nname,!0)+"</span>"])+"</span>"+f(a.opruser.zuid,c,b)+"</span>"}return e},Message.decodehtml=function(a){var b=a.replace(/&lt;/g,"<");return b=b.replace(/&gt;/g,">"),b},Chat.isExists=function(a){var b=document.getElementById(a);return b!=null?!0:!1},MyDate.getTMonth=function(a){var b=new Array("Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec");return WmsResource.getTrimmedValue(b[a])},MyDate.getTDay=function(a){var b=new Array("Sun","Mon","Tue","Wed","Thu","Fri","Sat");return WmsResource.getTrimmedValue(b[a])},MyDate.formatTime=function(a){var b=new Date(Number(a)),c=b.getHours(),d=b.getMinutes(),e="",f=c>12?c-12:c==0?"12":c;return e+=f<10?"0"+f:f,e+=(d<10?":0":":")+d,e+=c>=12?" "+WmsResource.getTrimmedValue("PM"):" "+WmsResource.getTrimmedValue("AM"),e},MyDate.formatDTTime=function(a){var b=new Date(Number(a)),c=b.getHours(),d=b.getMinutes(),e="";e+=MyDate.formatDate(a);var f=c>12?c-12:c==0?"12":c;return e+=f<10?"0"+f:f,e+=(d<10?":0":":")+d,e+=c>=12?" "+WmsResource.getTrimmedValue("PM"):" "+WmsResource.getTrimmedValue("AM"),e},MyDate.formatFirstMsgTime=function(a){var b=new Date(Number(a)),c=b.getDate(),d=MyDate.getTMonth(b.getMonth()),e=MyDate.getTDay(b.getDay()),f=b.getHours(),g=b.getMinutes(),h="";WebMessanger.getDateFormat()!=undefined?h+=MyDate.formatDate(a):(h+=e+", ",h+=c+" ",h+=d+", ");var i=f>12?f-12:f==0?"12":f;return h+=i<10?"0"+i:i,h+=(g<10?":0":":")+g,h+=f>=12?" "+WmsResource.getTrimmedValue("PM"):" "+WmsResource.getTrimmedValue("AM"),h},MyDate.formatDate=function(a){var b=new Date(Number(a)),c="",d=WebMessanger.getDateFormat();if(d==undefined){var e=b.getDate(),f=MyDate.getTMonth(b.getMonth());return c+=e+" ",c+=f+" ",c+=b.getFullYear()+" ",c}var g=b.getDate(),h=b.getMonth()+1,i=b.getFullYear();d=d.replace(/dd/,g<10?"0"+g:g),d=d.replace(/MM/,h<10?"0"+h:h),d=d.replace(/yyyy/,i);var j=(""+i).substr(2,4);return d=d.replace(/yy/,j<10?"0"+j:j),c=d+" ",c},MyDate.isSameDay=function(a,b){return MyDate.formatDate(a)===MyDate.formatDate(b)},MyDate.formatDateWithWords=function(a){var b=new Date(Number(a)),c=new Date;return MyDate.isSameDay(b,c)?WmsResource.getRealValue("chat.today"):(c.setDate(c.getDate()-1),MyDate.isSameDay(b,c)?WmsResource.getRealValue("chat.yesterday"):MyDate.formatDate(a))},MyDate.getOtherZoneTime=function(a,b){var c=new Date,d=c.getTime()+c.getTimezoneOffset()*6e4,e=MyDate.formatTime(d+parseInt(b));return e+" ( "+a+" )"};var ChatBlink=function(){function e(){b==1&&(b=!1,h(a),clearTimeout(c))}function f(c){c&&(e(),a=i(),h(Message.decodehtml(c)),d=i(),h(a),b=!0,g())}function g(){if(!Self.Idle){e();return}var b=a,f=i();d!==f&&(a=f,b=d),h(b),c=setTimeout(g,1500)}function h(a){a&&(document.title=a)}function i(){if(document.title)return document.title}var a,b,c,d;return{start:f,stopRepeat:e}}();document.onclick=function(){Self.Idle=!1},$WC.$CUtil.addEvent(window,"focus",function(){ChatBlink.stopRepeat()});var wmsuserstatus={};Self.init=function(){Self.isIdle={},Self.prevIdleStatus={},Self.prevTypingTime={},Self.Timer={},setInterval(function(){Self.status.chkstatus()},1e4),Self.Idle=!0},Self.status={init:function(a){Self.isIdle[a]=!0,Self.Idle=!0,Self.prevIdleStatus[a]=!0},chkstatus:function(){try{var a={};for(var b in wmsuserstatus){var c=wmsuserstatus[b];if(c!=null&&typeof c!="undefined"&&typeof c!="function"){var d=0;for(d in c);if(d==0)continue;if((new Date).getTime()-Self.prevTypingTime[b]<14e3){a[b]=c;continue}Self.status.getmsg(b)!=""&&Self.status.send(b,NFY_USER_ENTERED),Self.prevIdleStatus[b]=Self.isIdle[b],Self.isIdle[b]=!0,Self.Idle=!0}}wmsuserstatus=a}catch(e){}},isEnabled:function(){return WebMessanger.scode==WMS_INVISIBLE?!1:!0},send:function(a,b){try{if(util.indexOf(WebMessanger.liveChats,a)===-1)return}catch(c){}b==NFY_USER_ENTERED&&(wmsuserstatus[a]={});if(Self.status.isEnabled()){var d="userid="+WebMessanger.getUserName()+"&chid="+a+"&status="+b+"&dname="+encodeURIComponent(WebMessanger.getNickName())+"&sid="+encodeURIComponent(WebMessanger.getSid());$WC.Ajax.postRequest("sendstatus"+dext,d)}},idle:function(a){var b={};b[(new Date).getTime()]=NFY_USER_IDLE,Self.prevIdleStatus[a]=Self.isIdle[a],Self.isIdle[a]=!0,Self.Idle=!0,wmsuserstatus[a]=b},update:function(a){var b=""+a.chid,c=b+"."+a.sender;clearTimeout(Self.Timer[c]),delete Self.Timer[c];if(a.sender==WebMessanger.getUserName()||a.sender==WebMessanger.getZuid())return;var d=document.getElementById(b);if(d!=null){var e=WindowHandler.getWinObjById(b).typingstatusnode;e.title="";var f=WindowHandler.getWinObjById(b).typingindicatornode;a.msg!=""?f.style.display="inline-block":f.style.display="none"}},check:function(a){var b={};b[(new Date).getTime()]=NFY_USER_TYPING,Self.isIdle[a]!=Self.prevIdleStatus[a]&&(Self.status.getmsg(a)!=""?(WindowHandler.makeNormalWinById(a),ChatBlink.stopRepeat(),Self.status.send(a,NFY_USER_TYPING),Self.prevTypingTime[a]=(new Date).getTime()):(Self.prevIdleStatus[a]=Self.isIdle[a],Self.Idle=!0,Self.isIdle[a]=!0,b[(new Date).getTime()]=NFY_USER_IDLE)),wmsuserstatus[a]=b},active:function(a){Self.prevIdleStatus[a]=Self.isIdle[a],Self.isIdle[a]=!1,Self.Idle=!1;if(a==undefined)return;Self.status.check(a)},clear:function(a,b){var c=a+"."+b;delete Self.Timer[c],Self.prevTypingTime[a]={};var d=document.getElementById(a);d!=null&&(WindowHandler.getWinObjById(a).typingindicatornode.style.display="none")},getmsg:function(a){try{var b=document.getElementById(a);if(b!=null){var c=WindowHandler.getWinObjById(a).composer;return c.value}if(document.getElementById("editor")!=null)return document.getElementById("editor").value}catch(d){}return""}},Self.init(),Smiley.init=function(){this.defaultsmiley_lookup={},this.extrasmileycode_lookup={},this.defaultsmiley_lookup[":)"]="smile",this.defaultsmiley_lookup[":D"]="happy",this.defaultsmiley_lookup["B-)"]="cool",this.defaultsmiley_lookup[":xs"]="love",this.defaultsmiley_lookup[":-?"]="thinking",this.defaultsmiley_lookup["*-:)"]="idea",this.defaultsmiley_lookup[";)"]="wink",this.defaultsmiley_lookup[":-P"]="razz",this.defaultsmiley_lookup["-_-"]="relaxed",this.defaultsmiley_lookup["(a)"]="peace",this.defaultsmiley_lookup[":("]="sad",this.defaultsmiley_lookup["D:"]="anxious",this.defaultsmiley_lookup[":-s"]="worry",this.defaultsmiley_lookup["-.-"]="stressed-out",this.defaultsmiley_lookup["X-("]="angry",this.defaultsmiley_lookup["(=_=)"]="tired",this.defaultsmiley_lookup["|-)"]="sleepy",this.defaultsmiley_lookup["?D"]="doubt",this.defaultsmiley_lookup[":o"]="surprise",this.defaultsmiley_lookup["(6.6)"]="faint",this.defaultsmiley_lookup["(({..}))"]="headache",this.defaultsmiley_lookup["+o("]="sick",this.defaultsmiley_lookup[":/"]="smirk",this.defaultsmiley_lookup[":-#"]="keep-quiet",this.defaultsmiley_lookup[":-{}"]="feeling-cold",this.defaultsmiley_lookup["(y)"]="thumbsup",this.defaultsmiley_lookup["(n)"]="thumbsdown",this.defaultsmiley_lookup[":v:"]="victory",this.defaultsmiley_lookup["C(_)"]="coffee-cup",this.extrasmiley_lookup={":-)":"smile",":^)":"smile",":]":"smile",":-(":"sad",":(":"sad",":[":"sad",":-D":"happy",":))":"happy",":-))":"happy",":-@":"angry",":@":"angry",":P":"razz",":-p":"razz",":p":"razz",";-)":"wink",":-/":"smirk",":-o":"surprise",":O":"surprise",":-O":"surprise",":s":"worry",":-S":"worry",":S":"worry","I-)":"sleepy",":-X":"keep-quiet","(A)":"peace","O-)":"peace","O:)":"peace","O:-)":"peace",":+1:":"thumbsup","(Y)":"thumbsup",":x-":"thumbsup",":-1:":"thumbsdown","(N)":"thumbsdown"},this.extrasmiley_codes=["smile","happy","joy","grinning","cool","love","curious","awe","thinking","search","idea","wink","razz","relaxed","peace","blush","yummy","yuck","sad","upset","anxious","worry","stressed-out","angry","tensed","tired","bored","sleepy","jealous","evil","facepalm","doubt","surprise","faint","headache","sick","injured","neutral","smirk","keep-quiet","feeling-warm","feeling-cold","thumbsup","thumbsdown","namaste","super","victory","yoyo","raising-hand","clap","bye-bye","fist","biceps","birthday","champagne","chicken","christmas-tree","coffee-cup","eid-mubarak","fireworks","food","gift-box","kaaba","new-year","party","peanuts","santa-hat","fire","fire-extinguisher","first-aid-box","medicine","poop","gold-medal","silver-medal","bronze-medal","refugee-olympic-team","archery","badminton","baseball","basketball","boxing","canoeing","chess","cricket","discus-throw","diving","equestrian","fencing","flag","foosball","football","golf","hammer-throw","high-jump","hockey","hurdles","javelin-throw","judo","long-jump","pole-vault","running","rhythmic-gymnastics","shooting","shotput-throw","snooker","table-tennis","target","tennis","volleyball","weightlifting","wrestling","badminton-player","basketball-player","batsman","batter","bowler","break-boy","break-girl","chess-player","football-player","female-tennis-player","female-TT-player","female-volleyball-player","golfer","gymnast","hockey-player","karate","man-dancing","man-cycling","man-running","man-swimming","male-TT-player","male-volleyball-player","male-tennis-player","pitcher","singing","snooker-player","woman-dancing","woman-cycling","woman-running","woman-swimming","yoga","bicycle","sports-bike","cruiser-bike","motor-scooter","car","taxi","bus","train","police-car","ambulance","fire-engine","aeroplane","passenger-ship"],this.extrasmiley_codes.forEach(function(a){Smiley.extrasmileycode_lookup[":"+a+":"]=WmsResource.getRealValue("smiley."+a)}),this.smileyinitialized=!0},Smiley.hide=function(a){if(a.firstChild){var b=a.parentNode.getElementsByClassName("wms-smileyinvoker");a.firstChild.style.display="none",$WC.$CUtil.removeClass(b[0],"wms-smileyinvoker-sel")}},Smiley.toggle=function(a,b){this.smileyinitialized!==!0&&Smiley.init();var c=a.parentNode.getElementsByClassName("wms-smileyinvoker");a.hasChildNodes()?a.firstChild.style.display==="none"?(a.firstChild.style.display="block",b==undefined?$WC.$CUtil.addClass(c[0],"wms-smileyinvoker-sel"):$WC.$CUtil.addClass(WindowHandler.exist[b].smileyinvoker,"wms-smileyinvoker-sel")):Smiley.hide(a):(a.appendChild(Smiley.generateUI(b)),b==undefined?$WC.$CUtil.addClass(c[0],"wms-smileyinvoker-sel"):$WC.$CUtil.addClass(WindowHandler.exist[b].smileyinvoker,"wms-smileyinvoker-sel"))},Smiley.updateSmiley=function(a,b,c){var d=null,e=null;if(document.getElementById("wms-fileupldwin")){var f=getEventTarget(c),g=f.closest('[data-type="file"]');d=g.getElementsByClassName("wms-fileupldcmt")[0],e=g.querySelector("[data-smileycontainer]")}else WindowHandler.exist[a]&&(d=WindowHandler.exist[a].composer,e=WindowHandler.exist[a].smileycontainer);if(d!=null){var h=d.selectionStart,i=d.value;i=i.substring(0,h),i===""||i.endsWith(" ")||i.endsWith("\n")?d.value=i+b+" "+d.value.substring(h):d.value=i+" "+b+" "+d.value.substring(h),util.moveCaretPosition(d,h+b.length+1,h+b.length+1)}Smiley.hide(e)},Smiley.generateUI=function(a){var b=document.createElement("div");b.id="smilies",b.className="wmssmileycon";var c='<div id="smileylist" class="wmssmileylist"><table border="0" cellspacing="0" cellpadding="3" id="smileytable" align="center">',d=0;for(var e in this.extrasmileycode_lookup)d%6==0&&(c+='<tr id="smileytr">'),c=c+'<td id="smileytd" align="center" onclick="Smiley.updateSmiley( '+a+",':"+this.extrasmileycode_lookup[e]+':\', event )"><div id="smileydiv" class="wmssmils wmssmil-'+e.replace(/:/g,"")+'" title="'+WmsResource.getRealValue("smiley."+e.replace(/:/g,""))+'"  ></div></td>',d%6==5&&(c+="</tr>"),d++;return c+="</table></div>",b.innerHTML=c,b},Smiley.replaceTextToEnglishCodes=function(a){function d(a){for(var b in Smiley.extrasmileycode_lookup)if(Smiley.extrasmileycode_lookup[b]==a.replace(/:/g,""))return b}if(!Smiley.smileycode_regex){var b="";for(var c in Smiley.extrasmileycode_lookup)b!==""?b+="|:"+Smiley.extrasmileycode_lookup[c]+":":b=":"+Smiley.extrasmileycode_lookup[c]+":";Smiley.smileycode_regex=new RegExp("("+b+")","g")}return a.replace(Smiley.smileycode_regex,d)},Smiley.replace=function(a){function g(a,b){a=a.replace(b,"");var c=Smiley.smiley_lookup[a];for(var d in Smiley.extrasmileycode_lookup)d==a&&(c=d.replace(/:/g,""));return b+"<em title="+WmsResource.getRealValue("smiley."+c)+" class='wmssmils wmssmil-"+c+"'></em>"}this.smileyinitialized!==!0&&Smiley.init();if(!Smiley.smiley_regex){Smiley.smiley_lookup={};for(var b in Smiley.defaultsmiley_lookup)Smiley.smiley_lookup[b]=Smiley.defaultsmiley_lookup[b];for(var c in Smiley.extrasmiley_lookup)Smiley.smiley_lookup[c]=Smiley.extrasmiley_lookup[c];for(var d in Smiley.extrasmileycode_lookup)Smiley.smiley_lookup[d]=Smiley.extrasmileycode_lookup[d];var e="";for(var f in Smiley.smiley_lookup)e!==""?e+="|"+f:e=f;e=e.replace(/\|-\)/g,"\\|-)"),e=e.replace(/[[\]()*+.?^]/g,function(a){return"\\"+a}),e="("+e+")",Smiley.smiley_regex=new RegExp("([ >\n]|^)"+e+"(?=[ <\n]|$)","g")}return a=a.replace(/:(.*?):/g,function(a){for(var b in Smiley.extrasmileycode_lookup)if(b==a.replace(/!/g,""))return b;return a}),typeof a=="string"?a.replace(Smiley.smiley_regex,g):a},Smiley.replaceSmileyForHtml=function(a){var b=/<em title="(.*?)" (?:.*?)><\/em>/g;return $WC.Matcher.replacer(b,null,a,function(a,b){for(var c in Smiley.smiley_lookup)if(b===Smiley.smiley_lookup[c])return c})},Cookie.get=function(a){if(WebMessanger.getPrd()==undefined)return;a=WebMessanger.getPrd()+a;var b=document.cookie.indexOf(a),c=document.cookie.length,d=null;if(b!=-1){var e=a.length,f=b+e;d=document.cookie.substr(f+1,c),d.indexOf(";")!=-1&&(d=d.substring(0,d.indexOf(";")))}return decodeURIComponent(d)},Cookie.set=function(a,b,c){if(typeof b=="undefined"||typeof a=="undefined"||WebMessanger.getPrd()==undefined)return;a=WebMessanger.getPrd()+a;var d=new Date;if(c==null||c=="")c=2592e6;return d.setTime(d.getTime()+c),document.cookie=a+"= "+encodeURIComponent(b)+";expires= "+d.toGMTString()+";path= /",!0},Cookie.set_withdomain=function(a,b,c){if(typeof b=="undefined"||typeof a=="undefined"||WebMessanger.getPrd()==undefined)return;a=WebMessanger.getPrd()+a;var d=new Date;if(c==null||c=="")c=2592e6;return d.setTime(d.getTime()+c),document.cookie=a+"= "+b+";domain="+document.domain+";expires= "+d.toGMTString()+";path= /",!0},Cookie.setCustomCookie=function(a,b,c,d){if(typeof c=="undefined"||typeof b=="undefined")return;var e=new Date;if(d===null||d==="")d=2592e6;return e.setTime(e.getTime()+d),document.cookie=b+"= "+c+";domain="+a+";expires= "+e.toGMTString()+";path= /",!0},Cookie.getCustomCookie=function(a){var b=document.cookie.split("; ");for(var c=0;c<b.length;c++){var d=b[c],e=d.split("="),f=e[0];if(f===a)return e[1]}return""},Cookie.remove=function(a){var b=Cookie.get(a);if(b){a=WebMessanger.getPrd()+a;var c=new Date;document.cookie=a+"=;expires= "+c.toGMTString()+"; path= /"}return b},Cookie.setItem=Cookie.set,Cookie.getItem=Cookie.get,Cookie.removeItem=Cookie.remove,WMSZohoApi.acceptLiveSupport=function(a,b,c,d){if(_WMSCHATURL!=""){var e;e=document.createElement("script"),e.setAttribute("type","text/javascript");var f="?chid="+a+"&guid="+b+"&a="+c+"&g="+d;silent||(f=f+"&sid="+encodeURIComponent(WebMessanger.getSid())),e.setAttribute("src",_WMSCHATURL+"acccsupport.ext"+f),document.body.appendChild(e)}},WmsGroups.init=function(){WmsGroups.grouplist={},WmsGroups.decodedgrouplist={},WmsGroups.lastupdatetime=0,WmsGroups.interval=18e5},WmsGroups.getZohoGroups=function(){return WmsGroups.grouplist},WmsGroups.fetchzohogroups=function(){$WC.Ajax.postRequest("getgroups.sas")},WmsGroups.updategrouplist=function(a){for(var b in a){var c=a[b];WmsGroups.grouplist[b]={ID:b,NAME:c.NAME,OWNER:c.OWNER,MODERATOR:c.MODERATOR,DESC:c.DESC},WmsGroups.decodedgrouplist[b]={ID:b,NAME:ClientDecoder.getDecodedValue(c.NAME),OWNER:c.OWNER,MODERATOR:c.MODERATOR,DESC:ClientDecoder.getDecodedValue(c.DESC)}}WmsGroups.lastupdatetime=(new Date).getTime(),$WC.$CUtil.pubsub.publish("/groups/updateui"),WmsGroupImpl.handleGetGroups()},WmsGroups.updategroupUI=function(){for(var a=0;a<WindowHandler.exist.length;a++)if(WindowHandler.exist[a]!=="empty"&&(WindowHandler.exist[a].partcount>2||WindowHandler.exist[a].isZohoGroupChat())&&WindowHandler.exist[a].membersdispnode.style.display==="block"){var b=WindowHandler.exist[a].getGroupID(),c=WmsGroups.grouplist[b];if(c&&(parseInt(c.OWNER)||parseInt(c.MODERATOR))){var d=WindowHandler.exist[a].membersdispnode.querySelectorAll('[data-memdel="true"]');for(var e=0;e<d.length;e++)d[e].className="wms-delmemshow"}}},WmsGroups.fetchingStatus=function(){if(WmsGroups.lastupdatetime==undefined||WmsGroups.lastupdatetime==null||WmsGroups.lastupdatetime==0)return!0;if(WmsGroups.lastupdatetime>0){var a=(new Date).getTime();if(a-WmsGroups.lastupdatetime>WmsGroups.interval)return!0}return!1},WMSKeyHandler.init=function(){ie?document.attachEvent("onkeydown",WMSKeyHandler.handle):document.addEventListener("keydown",WMSKeyHandler.handle),ie?document.attachEvent("onclick",WMSKeyHandler.onclick):document.addEventListener("click",WMSKeyHandler.onclick),WMSKeyHandler.skipeventlistener=!1},WMSKeyHandler.onclick=function(a){if(WMSKeyHandler.skipeventlistener===!0){WMSKeyHandler.skipeventlistener=!1;return}WmsProfileInfo.handleDocumentClick(a),WMSUI.handleDocumentClick(a)},WMSKeyHandler.handle=function(a){a||(a=window.event);var b=window.event?a.keyCode:a.which;if(WMSUI.imgPreview.handleKeyMovement(a)||ChatTour.handleKeyMovement(a)){a.stopImmediatePropagation();return}b==27&&WMSKeyHandler.escapee(a)&&WMSKeyHandler.cancelEvent(a),WebMessanger.allprdchatdeactivated===!1&&WebMessanger.chatdeactivated===!1&&WebMessanger.smartchatshortcutdisabled===!1&&WMSUI.smartchatenabled===!0&&b==32&&a.ctrlKey===!0&&a.metaKey===!1&&(WmsHybridSearch.toggleUI(),WMSKeyHandler.cancelEvent(a)),ZMSGUI.handleEvent(a)},WMSKeyHandler.escapee=function(a){return WMSUI.handleDocumentEscape(a)},WMSKeyHandler.cancelEvent=function(a){ie?(a.cancelBubble=!0,a.returnValue=!1):(a.preventDefault(),a.stopPropagation())},WMSKeyHandler.preventHandlingTabUpDownEnter=function(a){(a.keyCode===WmsConstants.KEYCODES.DOWN||a.keyCode===WmsConstants.KEYCODES.UP||a.keyCode===WmsConstants.KEYCODES.ENTER||a.keyCode===WmsConstants.KEYCODES.TAB)&&a.preventDefault()},WMSKeyHandler.init(),WMSSessionConfig.CHAT=1,WMSSessionConfig.CHAT_PRESENCE=2,WMSSessionConfig.PRESENCE_PERSONAL=4,WMSSessionConfig.PRESENCE_ORG=8,WMSSessionConfig.LOADBALANCED=16,WMSSessionConfig.MP=32,WMSSessionConfig.CROSS_PRD=64,WMSSessionConfig.MULTI_DISPATCH=128,WMSSessionConfig.REUSE_SESSION=256;var _SOUND_PLAYER;WmsSound.getTune={},WmsSound.players={},WmsSound.loadfiles=function(a){WmsSound.getTune={notify:"https://media.zohostatic.com/ichat/v282_https/sound/notify."+a,newchat:"https://media.zohostatic.com/ichat/v282_https/sound/newchatmsg2."+a,chatmsg:"https://media.zohostatic.com/ichat/v282_https/sound/tik."+a,support:"https://media.zohostatic.com/ichat/v282_https/sound/notifysupport."+a}},WmsSound.init=function(){(new Audio).canPlayType("audio/wav")!=""&&(new Audio).canPlayType("audio/wav")!="no"?WmsSound.loadfiles("wav"):WmsSound.loadfiles("mp3"),WmsSound.timer=null},WmsSound.checkAndPlayTune=function(a,b){(a||wmsnotifyowner.isOwner())&&WmsSound.playTune(b)},WmsSound.playTune=function(a,b){if(WmsSettings.sound==0)return;try{a=a||"notify",WmsSound.players[a]=WmsSound.players[a]||new Audio(WmsSound.getTune[a]),_SOUND_PLAYER=WmsSound.players[a],_SOUND_PLAYER.play(),b!=null&&(WmsSound.timer=setInterval(function(){_SOUND_PLAYER.play()},1400),setTimeout(function(){WmsSound.stop()},b))}catch(c){}},WmsSound.stop=function(){try{_SOUND_PLAYER.pause(),clearInterval(WmsSound.timer)}catch(a){}},WmsSound.getWinFocus=function(){return _WMSWINFOCUS},WmsSettings.bsettings={},WmsSettings.bsettings={sound:"0",soc:"1",scp:"0",vmessage:"0",vustatus:"0",disann:{},deact:"",chatenabled:!0,cpinnedchats:"1",cunreadchats:"1",crecentchats:"1",tourenabled:"0",wmstourprops:"0",primetime_onboard_count:"0",adminsettings:{}},WmsSettings.constants={ONBOARD:1},WmsSettings.populate=function(){this.sound=WmsSettings.bsettings.sound,this.soc=WmsSettings.bsettings.soc,this.scp=WmsSettings.bsettings.scp,this.vmessage=WmsSettings.bsettings.vmessage,this.vustatus=WmsSettings.bsettings.vustatus,this.disann=WmsSettings.bsettings.disann,this.deact=WmsSettings.bsettings.deact&&WmsSettings.bsettings.deact.split(","),this.chatenabled=WmsSettings.bsettings.chatenabled,this.cpinnedchats=WmsSettings.bsettings.cpinnedchats,this.cunreadchats=WmsSettings.bsettings.cunreadchats,this.crecentchats=WmsSettings.bsettings.crecentchats,this.primetime_onboard_count=WmsSettings.bsettings.primetime_onboard_count,WmsSettings.adminsettings={isChannelAllowed:!0,isMediacallAllowed:!0,isDisableHistoryAllowed:!0,cliqaccess:!0};for(var a in WmsSettings.bsettings.adminsettings)WmsSettings.adminsettings[a]=WmsSettings.bsettings.adminsettings[a];typeof WmsSettings.adminsettings.orgPolicies=="object"&&(WmsSettings.adminsettings.orgPolicies.chat_with_non_org_users==="false"&&$WC.$CUtil.setConfig({other_orguser_chat:"disable"}),WmsSettings.adminsettings.orgPolicies.allow_turn_off_chat_history==="false"&&(WmsSettings.adminsettings.isDisableHistoryAllowed=WmsSettings.adminsettings.orgPolicies.allow_turn_off_chat_history)),WmsSettings.adminsettings.isChannelAllowed===!1&&$WC.$CUtil.setConfig({channels:"disable"}),wmsUserConfig.infomsg&&WMSUI.processAnnMsg(wmsUserConfig.infomsg,wmsUserConfig.infomsgtype),$WC.$CUtil.getBrowserName()==="ie"&&!$WC.$CUtil.isIEVersion11()&&(silent=!0,WebMessanger.showEmptyBar());if(_WMSEMPTYBAR)WMSUI.populateEmptyBar();else if(this.chatenabled===!1){WebMessanger.isServiceStatus()===!1?(WebMessanger.showEmptyBar(),WMSUI.populateEmptyBar()):silent=!0;try{WmsUIImpl.handleUIHidden()}catch(b){}}else util.indexOf(this.deact,"ALL")!==-1||util.indexOf(this.deact,WebMessanger.prd)!==-1||WmsSettings.adminsettings.cliqaccess===!1?(util.indexOf(this.deact,"ALL")!==-1?(WebMessanger.allprdchatdeactivated=!0,WebMessanger.chatdeactivated=!1):util.indexOf(this.deact,WebMessanger.prd)!==-1&&(WebMessanger.allprdchatdeactivated=!1,WebMessanger.chatdeactivated=!0),WmsSettings.adminsettings.cliqaccess===!1&&(WebMessanger.chatdisabled=!0),silent||WMSUI.populateDeactivatedChatUI()):(WebMessanger.chatdeactivated=!1,WebMessanger.allprdchatdeactivated=!1,WmsMainUI.maincontainer&&WmsMainUI.maincontainer.parentNode&&WmsMainUI.maincontainer.parentNode.removeChild(WmsMainUI.maincontainer),silent||(WMSUI.usersdiv=null,WMSUI.groupdiv=null,WMSUI.actchatdiv=null,WMSUI.populateMainBar()))},WmsSettings.updateWmsSettings=$WC.$CUtil.debounce(function(a,b,c,d,e,f){b==="deact"?c?WebMessanger.UpdateWmsSettings(a,b,c,null,d,e,f):WebMessanger.UpdateWmsSettings(a,b,WebMessanger.prd,null,d,e,f):b==="disann"?WebMessanger.UpdateWmsSettings(a,b,wmsUserConfig.infomsgid,wmsUserConfig.infomsgprd):WebMessanger.UpdateWmsSettings(a,b,c)},null,500,!1),WmsSettings.handleUpdateWmsSettings=function(a){for(var b in a)if(b=="sound")this.sound=a[b],WmsMainUI.handleSettings(this.sound,WmsMainUI.settingscontainer.querySelector('[data-setting="sound"]'));else if(b=="vmessage")this.vmessage=a[b],WmsMainUI.handleSettings(this.vmessage,WmsMainUI.settingscontainer.querySelector('[data-setting="vmessage"]'));else if(b=="vustatus")this.vustatus=a[b],WmsMainUI.handleSettings(this.vustatus,WmsMainUI.settingscontainer.querySelector('[data-setting="vustatus"]'));else if(b=="cpinnedchats")this.cpinnedchats=a[b];else if(b=="cunreadchats")this.cunreadchats=a[b];else if(b=="crecentchats")this.crecentchats=a[b];else if(b=="primetime_onboard_count")this.primetime_onboard_count=a[b];else if(b=="scp"){this.scp=a[b];try{WMSUI.populateusrs(!1)}catch(c){}}else if(b==="disann")this.disann=a[b],WMSUI.isAnnBlocked()&&WMSUI.clearAnnBanner();else if(b==="deact"){this.deact=a[b].split(",");if(util.indexOf(this.deact,"ALL")!==-1||util.indexOf(this.deact,WebMessanger.prd)!==-1){if(WebMessanger.chatdeactivated===!1||WebMessanger.allprdchatdeactivated===!1)util.indexOf(this.deact,"ALL")!==-1?(WebMessanger.allprdchatdeactivated=!0,WebMessanger.chatdeactivated=!1):(WebMessanger.allprdchatdeactivated=!1,WebMessanger.chatdeactivated=!0),WebMessanger.turnOffChat(),WMSUI.populateDeactivatedChatUI()}else(WebMessanger.chatdeactivated===!0||WebMessanger.allprdchatdeactivated===!0)&&WebMessanger.chatdisabled===!1&&(WebMessanger.chatdeactivated=!1,WebMessanger.allprdchatdeactivated=!1,WebMessanger.turnOnChat(),wmsnotifyowner&&wmsnotifyowner.clearOwnerSync(),wmsnotifyowner=new $WC.NotificationOwner("chat",!0),WMSUI.contactsenabled=WebMessanger.disabledmenus&WebMessanger.uisettingsconst.contacts?!1:!0,WMSUI.groupsenabled=WebMessanger.disabledmenus&WebMessanger.uisettingsconst.groups?!1:!0,WMSUI.activechatenabled=WebMessanger.disabledmenus&WebMessanger.uisettingsconst.activechats?!1:!0,WMSUI.profileenabled=WebMessanger.disabledmenus&WebMessanger.uisettingsconst.settings?!1:!0,WMSUI.smartchatenabled=WebMessanger.disabledmenus&WebMessanger.uisettingsconst.smartchat?!1:!0,WmsMainUI.populate());WebMessanger.orgid=="456089"&&(WebMessanger.ismediacallnewwindow=WebMessanger.isChatPaused())}else this[b]=a[b]},WmsSettings.isTourEnabled=function(){return+WmsSettings.bsettings.tourenabled===1?!0:!1},WmsSettings.isOnboardSeen=function(){var a=+WmsSettings.bsettings.wmstourprops&WmsSettings.constants.ONBOARD;return a===WmsSettings.constants.ONBOARD?!0:!1},WmsSettings.setOnboardSeen=function(){var a=+WmsSettings.bsettings.wmstourprops|WmsSettings.constants.ONBOARD;return a},WmsSettings.getAdminSetting=function(a){return WmsSettings.adminsettings[a]},WmsSettings.handleTourSettings=function(a){WmsSettings.bsettings.wmstourprops=a,WmsSettings.isOnboardSeen()&&ChatTour.exit(!1)},WmsSettings.updateTourSettings=function(a,b){if(a===WmsSettings.constants.ONBOARD){var c=WmsSettings.setOnboardSeen();WebMessanger.updateTourSettings(c,b)}},WmsDragDrop.onDropEvent=function(a,b,c,d){b.preventDefault();if(d){var e=WmsDragDrop.dragged_file;e=e.getAttribute("data-filefrwrd")?e:e.closest("[data-msgid]").querySelector("[data-filefrwrd]");if(!e){WmsDragDrop.dragged_file="";return}WmsFileForward.init(e);var f={};f.chid=a;var g=WindowHandler.getWinObjById(a);if(g.ctype=="8")f.imagehtml=WmsHybridSearch.generateImageHtml(a,WmsHybridSearch.constants.CHANNEL);else if(g.ctype=="1"&&g.partcount>2)f.imagehtml=WmsHybridSearch.generateImageHtml(a,WmsHybridSearch.constants.GROUP,{TITLE:g.title});else{var h=g.recipant||WmsChannels.getBotId(a),i=WmsContacts.get(h);f.imagehtml=WmsHybridSearch.generateImageHtml(h,WmsHybridSearch.constants.CONTACT,i)}f.dname=g.title,f.type=g.ctype,WmsFileForward.insertSuggestion("","",f),document.getElementById("wms-fileupldcmt").focus();return}var j=b.dataTransfer.files;WmsDragDrop.nooffiles=j.length,WmsDragDrop.pos=0;var k=WindowHandler.getWinObjById(a);if(k.isMultiProtocolChat())confirm(WmsResource.getRealValue("File_transfer_is_supported_only_between_zoho_users_would_you_like_to_upload"))&&WmsDragDrop.uploadFile(a,j);else{if(k.ctype=="5")return;if(WmsFileUpload.isFileSizeExceeded(j))return!1;WmsFileUpload.checkSupport()&&j.length?WmsFileUpload.init(a,j):WmsDragDrop.uploadFile(a,j)}},WmsDragDrop.uploadFile=function(a,b){var c={onprogress:function(b){var c=Math.round(b.loaded/b.total*100);WindowHandler.showProgress(a,c,WmsDragDrop.pos)},oncomplete:function(){},success:function(){WindowHandler.showProgress(a,100,WmsDragDrop.pos),WmsDragDrop.pos<WmsDragDrop.nooffiles?(WindowHandler.showProgress(a,0,WmsDragDrop.pos),WmsDragDrop.uploadFileUsingPost(a,b[WmsDragDrop.pos],c,b),WmsDragDrop.pos++):WindowHandler.clearProgress(a)}};WmsDragDrop.uploadFileUsingPost(a,b[WmsDragDrop.pos],c,b),WmsDragDrop.pos++},WmsDragDrop.uploadFileUsingPost=function(a,b,c,d){try{if(b.size>1e7){alert(WmsResource.getRealValue("You_have_exceeded_the_maximum_allowed_file_size_of_10MB")),WindowHandler.clearProgress(a),WmsDragDrop.nooffiles>WmsDragDrop.pos+1&&(WmsDragDrop.pos++,WmsDragDrop.uploadFileUsingPost(a,d[WmsDragDrop.pos],c,d));return}var e=new XMLHttpRequest,f=["chid","username","sender","mod","sid",_CHATCFPARAMNAME],g=[a,WebMessanger.getUserName(),WebMessanger.getUserName(),"att",WebMessanger.getSid(),Cookie.getCustomCookie(_CHATCFTOKEN)];e.onreadystatechange=function(){if(e.readyState==4){var a=e.status==200?c.success:c.fail;a&&a(e.responseText)}},c.onprogress&&(e.addEventListener("progress",c.onprogress,!1),e.upload.addEventListener("progress",c.onprogress,!1)),c.oncomplete&&(e.addEventListener("load",c.oncomplete,!1),e.upload.addEventListener("load",c.oncomplete,!1));var h="/"+_CHATCONT+"/upload.do";e.open("POST",h,!0);if(typeof FormData!="undefined"){var i=new FormData;for(var j=0;j<f.length;j++)i.append(f[j],g[j]);return i.append("file1",b),e.send(i),e}var k=(new Date).getTime(),l="";l+="\r\n--"+k;var m="\r\n",n=b.fileName,o;o||(o=[]);for(var p=0;p<f.length;p++)o[o.length]=WmsDragDrop.getMultiPartParamObject(f[p],g[p]);for(p=0;p<o.length;p++){var q=o[p];m+=WmsDragDrop.getMultiPartParamStr(q.name,encodeURIComponent(q.value))+"\r\n--"+k+"\r\n"}l+=m,n=b.fileName;if(n==undefined||null)n="file1";return l+='Content-Disposition: form-data; name="file1";filename="'+n+'"'+"\r\n"+"Content-Type:"+b.type+"\r\n"+"\r\n"+b.getAsBinary(),l+="\r\n--"+k+"--",e.setRequestHeader("Content-Length",l.length),e.setRequestHeader("Content-Type","multipart/form-data; charset: UTF-8; accept-charset: UTF-8; boundary="+k),e.setRequestHeader("Connection","close"),e.sendAsBinary(l),e}catch(r){}},WmsDragDrop.getMultiPartParamStr=function(a,b){return'Content-Disposition: form-data; name="'+a+'"\r\n\r\n'+b},WmsDragDrop.getMultiPartParamObject=function(a,b){return{name:a,value:b}},WmsDragDrop.isFileSharable=function(){return WmsDragDrop.dragged_file&&!WmsDragDrop.dragged_file.getAttribute("data-filefrwrd")&&!WmsDragDrop.dragged_file.closest("[data-msgid]").querySelector("[data-filefrwrd]")?!1:!0},PubSubApi.heartBeat=function(){for(var a in this.subinfo)try{PubSubApi.resubscribe(this.subinfo[a])}catch(b){}setTimeout(function(){PubSubApi.heartBeat()},3e4)},PubSubApi.init=function(){this.subinfo={},this.psids={},this.iframeObj=document.getElementById("psconnect"),this.uname="",this.wms_samedomain="",this.prdid="",this.userid="",this.sid="",this.nname="",typeof WebMessanger=="function"?(this.uname=WebMessanger.zuid!=""?WebMessanger.zuid:WebMessanger.uname,this.wms_samedomain=_WMS_SAMEDOMAIN,this.prdid=WebMessanger.getPrd(),this.userid=WebMessanger.getUserId(),this.sid=WebMessanger.getSid(),this.nname=WebMessanger.getNickName()):typeof WmsLite=="function"&&(this.uname=WmsLite.zuid!=""?WmsLite.zuid:WmsLite.uname,this.wms_samedomain=WM_SAMED,this.prdid=getPrd(),this.userid=getUserId(),this.sid=getSid(),this.nname=getNickName());if(this.iframeObj==undefined){this.iframeObj=document.createElement("iframe"),this.iframeObj.name="wmspsconnect",this.iframeObj.id="psconnect",this.iframeObj.style.display="none",this.iframeObj.src="/"+_WMSCONT+"/psconnect.sas?wmscont="+_WMSCONT+"&samedomain="+this.wms_samedomain+"&nodomainchange="+_WMS_NODOMAINCHANGE+"&uname="+this.uname;if(typeof WebMessanger=="function"&&WebMessanger.tokenpairauth||typeof WmsLite=="function"&&WmsLite.tokenpairauth)this.iframeObj.src+="&tokenpair=true";document.body.appendChild(this.iframeObj)}setTimeout(function(){PubSubApi.heartBeat()},3e4)},PubSubApi.subscribe=function(a,b,c,d,e,f){var g="pskey="+a+"&prd="+this.prdid+"&wmsid="+this.userid+"&sid="+encodeURIComponent(this.sid)+"&config="+c+"&dname="+this.nname+"&opr=subscribe";f!=undefined&&e!=undefined&&(g=g+"&authtype="+e+"&authid="+f);var h=[a,b,c,d,e,f];this.wms_samedomain?PubSubBridge.httpPost("subscribe","/pubsubsrv/"+b+"/pubsub",g,h):PubSubBridge.httpPost("subscribe","/"+b+"/pubsub",g,h)},PubSubApi.resubscribe=function(a){var b="pskey="+a.pskey+"&prd="+this.prdid+"&wmsid="+this.userid+"&sid="+encodeURIComponent(this.sid)+"&config="+a.config+"&dname="+this.nname+"&opr=resubscribe";a.authid!=undefined&&a.authtype!=undefined&&(b=b+"&authtype="+a.authtype+"&authid="+a.authid);var c=[a.pskey];this.wms_samedomain?PubSubBridge.httpPost("resubscribe","/pubsubsrv/"+a.psuri+"/pubsub",b,c):PubSubBridge.httpPost("resubscribe","/"+a.psuri+"/pubsub",b,c)},PubSubApi.unSubscribe=function(a){if(PubSubApi.isSubscribed(a)){var b=PubSubApi.subinfo[a],c="pskey="+a+"&prd="+this.prdid+"&wmsid="+this.userid+"&sid="+encodeURIComponent(this.sid)+"&config="+b.config+"&dname="+this.nname+"&opr=unsubscribe";b.authid!=undefined&&b.authtype!=undefined&&(c=c+"&authtype="+b.authtype+"&authid="+b.authid);var d=[a];this.wms_samedomain?PubSubBridge.httpPost("unsubscribe","/pubsubsrv/"+b.psuri+"/pubsub",c,d):PubSubBridge.httpPost("unsubscribe","/"+b.psuri+"/pubsub",c,d)}},PubSubApi.getSubscribedList=function(){var a=new Array;for(var b in this.psids)a.push(b);return a},PubSubApi.isSubscribed=function(a){return this.psids[a]!=undefined},PubSubApi.getUsers=function(a){return PubSubApi.isSubscribed(a)?this.subinfo[a].getUsers():null},PubSubApi.isValidPSID=function(a,b){return this.psids[a]==b},PubSubApi.getPsid=function(a){return this.psids[a]},PubSubApi.ackSubscribe=function(a,b,c,d,e,f,g){var h=new PubSubObject(a,b,c,d,e,f);PubSubApi.subinfo[a]=h,PubSubApi.psids[a]=g},PubSubApi.ackUnSubscribe=function(a){delete PubSubApi.psids[a],delete PubSubApi.subinfo[a]},PubSubApi.ackResubscribe=function(a,b){PubSubApi.psids[a]!=b&&PubSubApi.subinfo[a].reInitUsers(),PubSubApi.psids[a]=b},PubSubApi.handleError=function(a,b){delete PubSubApi.psids[a],delete PubSubApi.subinfo[a];switch(b){case 1:break;case 2:break;case 3:}},PubSubApi.removeUsers=function(a,b,c){PubSubApi.isValidPSID(a,b)&&PubSubApi.subinfo[a].removeUsers(c)},PubSubApi.addUsers=function(a,b,c){PubSubApi.isValidPSID(a,b)&&PubSubApi.subinfo[a].addUsers(c)},PubSubBridge.onconnect=function(){PubSubImpl.onConnect()},PubSubBridge.handleHttpPost=function(a,b,c){try{if(a=="subscribe"){var d=JSON.parse(b)[0];if(d.errcode!=undefined){var e=d.errcode;PubSubApi.handleError(d.pskey,e),PubSubImpl.handleError(a,d.pskey,e)}else PubSubApi.ackSubscribe(c[0],c[1],c[2],c[3],c[4],c[5],d.psid),PubSubImpl.handleSubscribe(c[0])}else a=="unsubscribe"?(d=JSON.parse(b)[0],d.errcode!=undefined?(e=d.errcode,PubSubImpl.handleError(a,c[0],e)):(PubSubApi.ackUnSubscribe(c[0]),PubSubImpl.handleUnSubscribe(c[0]))):a=="resubscribe"&&b!=""&&(d=JSON.parse(b)[0],d.errcode!=undefined?(e=d.errcode,PubSubApi.handleError(d.pskey,e),PubSubImpl.handleError(a,d.pskey,e)):PubSubApi.ackResubscribe(c[0],d.psid))}catch(f){}};var WmsStorage=function(a){if(a==="session")if(sessionStorage){this.storage=sessionStorage;try{this.storage.setItem("storage","")}catch(b){this.storage=Cookie}}else this.storage=Cookie;else a==="local"&&(this.storage=localStorage)};WmsStorage.prototype.setItem=function(a,b){return this.storage.setItem(a,JSON.stringify(b))},WmsStorage.prototype.removeItem=function(a){return this.storage.removeItem(a)},WmsStorage.prototype.getItem=function(a){return JSON.parse(this.storage.getItem(a))},WmsStorage.prototype.setChatInfo=function(a){var b=""+a.chid,c=this.getItem("wms_openchats"),d=!1;if(c===null)this.setItem("wms_openchats",[a]);else{for(var e=0;e<c.length;e++)if(c[e].chid===b){for(var f in a)c[e][f]=a[f];d=!0}d===!1&&c.push(a),this.setItem("wms_openchats",c)}},WmsStorage.prototype.getChatInfo=function(a,b){a=""+a;var c=this.getItem("wms_openchats");if(c===null)return null;for(var d=0;d<c.length;d++)if(c[d].chid===a&&c[d][b])return c[d][b];return null},WmsStorage.prototype.removeChatState=function(a){a=""+a;var b=this.getItem("wms_openchats");for(var c=0;c<b.length;c++)if(b[c].chid===a){b.splice(c,1);break}b.length===0?this.removeItem("wms_openchats"):this.setItem("wms_openchats",b)};var WmsSessionStorage=new WmsStorage("session"),WmsLocalStorage=new WmsStorage("local");WmsChatCache=function(){var a={},b=[],c=25,d=1e5,e={insert:function(e,f){f.length>0&&f.length<=d?(util.indexOf(b,e)!==-1&&this.remove(e),b.length>=c&&this.remove(b[0]),a[e]=f,b.push(e)):this.isAvailable(e)&&this.remove(e)},get:function(b){if(a[b])return a[b]},remove:function(c){if(this.isAvailable(c))return delete a[c],b.splice(util.indexOf(b,c),1),!0},removeAll:function(){a={},b=[]},isAvailable:function(a){return this.get(a)?!0:!1}};return e}(),WmsNotification.notifyNewMessage=function(a,b,c){var d=a.sender,e=a.chid,f=WindowHandler.getWinObjById(e);if(f&&(d!==WebMessanger.zuid||f.ctype==="9")){f.highlight();if(c||wmsnotifyowner.isOwner()){var g=WMSUI.getNotificationTitle(a)+" "+WmsResource.getRealValue("Says")+"...";f.ctype==="9"&&(g=f.getTitle()+" "+WmsResource.getRealValue("Says")+"..."),WMSUI.isBarVisible()&&WebMessanger.scode!=="3"&&ChatBlink.start(g)}}WebMessanger.scode!=3&&(c||wmsnotifyowner.isOwner())&&(b==="newchat"||!WmsSound.getWinFocus())&&WmsSound.playTune(b),WMSUI.checkAndNotifyMsg(a)},WmsNotification.notifyNewCall=function(a,b,c){if(WMSUI.isBarVisible()&&WebMessanger.scode!=="3"&&wmsnotifyowner.isOwner()){var d=b==WmsAVChat.CALL_TYPE_VIDEO?"mediacall.incoming.video":"mediacall.incoming.audio",e=a?a+" "+$WC.$CUtil.getConfig("Resource").getRealValue("mediacall.calling"):$WC.$CUtil.getConfig("Resource").getRealValue(d);ChatBlink.start(e),!_WMSWINFOCUS&&WmsSettings.vmessage==1&&$WC.DesktopNotification.show({title:a||"",body:$WC.$CUtil.getConfig("Resource").getRealValue(d),icon:WmsContacts.getUserPhoto(c),checkownership:wmsnotifyowner,requireInteraction:!0,duration:WmsAVChat.AnswerCall.CLOSE_TIMEOUT,id:"call",onclick:WmsAVChat.AnswerCall.checkAndAcceptCall})}},WMSUI.imgPreview={images:[],curimgpos:-1,init:function(a,b){var c=a.querySelectorAll('img[data-previewable="true"]');WMSUI.imgPreview.getCurrentImgPosition(b,c),WMSUI.imgPreview.createOverlay(),WMSUI.imgPreview.bindevents(),WMSUI.imgPreview.getAndReplaceImageDetails(WMSUI.imgPreview.images[WMSUI.imgPreview.curimgpos])},getAndReplaceImageDetails:function(a){var b=decodeURIComponent(a.getAttribute("data-fname")),c=a.getAttribute("data-fsize"),d=a.getAttribute("data-fsender"),e=a.getAttribute("data-fdate"),f=a.getAttribute("data-ftime"),g=a.getAttribute("data-fcomment"),h=a.getAttribute("data-dname"),i=a.getAttribute("data-fcontent"),j=a.getAttribute("data-src")||a.getAttribute("data-furl"),k=a.getAttribute("data-customimg"),l=a.getAttribute("data-filefrwrd"),m=a.getAttribute("data-isv1"),n='<span id="wms-imgpreviewfdate">'+util.escapeHTML(e)+'</span> | <span id="wms-imgpreviewftime">'+util.escapeHTML(f)+"</span>";n+=c?' | <span id="wms-imgpreviewfsize">'+util.escapeHTML(c)+"</span>":"";if(Message.isLocalUser(d))var o=WmsResource.getRealValue("Me");else o=$WC.$CUtil.getContactName(d,h);var p=WMSUI.imgPreview.curimgpos+1,q=WMSUI.imgPreview.images.length,r=WMSUI.imgPreview.generateUI();r+=k?"</div>":'<div id="wms-imgpreviewfinfo" class="wms-imgpreviewfinfo"><div id="wms-imgpreviewfname" class="wms-imgpreviewfname">{{FNAME}}</div><div class="wms-imgpreviewfdetails" id="wms-imgpreviewfdetails"></div></div></div>',r+=k?"":'<div id="wms-imgpreviewsenderinfo" class="wms-imgpreviewfsenderinfo"><div style="display:table-row"><div class="wms-imgpreviewuserinfo"><img src="{{SENDERPIC}}" class="wms-imgpreviewfsenderpic"><span id="wms-imgpreviewfsender" class="wms-imgpreviewfsender">{{FSENDERNAME}}</span><div id="wms-imgpreviewcomment" class="wms-imgpreviewcomment wms-truncate-ellipsis" title="{{COMMENT}}"><span id="wms-imgpreviewfcomment" class="wms-imgpreviewfcomment"></span></div></div><div id="wms-imgpreviewstatus" class="wms-imgpreviewstatus">{{IMGSTATUS}}</div><div class="wms-imgpreviewactions"><div class="wms-imgpreviewfdownload" data-fsize="{{FSIZE}}"><a id="wms-imgpreviewfdownload" target="_blank" href="{{IMGSRC}}" download="{{FNAME}}"></a></div>',r+=b&&l?'<span class="wms-fileforwardimg" data-fcomment="{{COMMENT}}" data-fcontent="{{CONTENT}}" data-furl="{{URL}}" data-fname="{{FNAME}}" data-fsrc="{{IMGSRC}}" data-purpose="forward" data-isv1={{ISV1}} title="Forward"></span></div></div></div>':"</div></div></div>",r+='<span class="wms-imgpreviewclose" data-purpose="close"></span>',r=$WC.template.replace(r,{FNAME:b,FSIZE:c,FDATE:e,FTIME:f,COMMENT:g,$IMGSTATUS:["chat.imgpreview.status",[p,q]],FSENDERNAME:o,IMGSRC:a.src,SENDERPIC:_WMSPHOTOSERVER+"/file?ID="+d+"&t=user&width=38&height=38",CONTENT:i,URL:j,ISV1:m}),document.getElementById("wms-imgpreviewcontainer").innerHTML=r,document.getElementById("wms-imgpreviewfdetails")&&(document.getElementById("wms-imgpreviewfdetails").innerHTML=n),g&&(document.getElementById("wms-imgpreviewfsender").style.margin="0px 0px 0px 15px",document.getElementById("wms-imgpreviewcomment").style.display="block",$WC.$CUtil.setInnerTextById("wms-imgpreviewfcomment",WebMessanger.unescapeHTML(g))),q===1?(document.getElementById("wms-imgpreviewright").style.cursor="not-allowed",document.getElementById("wms-imgpreviewnext").style.display="none",document.getElementById("wms-imgpreviewprev").style.display="none",document.getElementById("wms-imgpreviewleft").style.cursor="not-allowed"):p===1?(document.getElementById("wms-imgpreviewleft").style.cursor="not-allowed",document.getElementById("wms-imgpreviewprev").style.display="none"):p===q&&(document.getElementById("wms-imgpreviewright").style.cursor="not-allowed",document.getElementById("wms-imgpreviewnext").style.display="none"),WMSUI.imgPreview.resize()},bindevents:function(){var a=document.getElementById("wms-imgpreviewcontainer");a.addEventListener("click",function(a){var b=a.target.getAttribute("data-purpose");b=="close"?WMSUI.imgPreview.removeOverlay():b=="nextimg"?WMSUI.imgPreview.next():b=="previmg"?WMSUI.imgPreview.prev():b=="forward"?(WMSUI.imgPreview.removeOverlay(),WmsFileForward.init(a.target)):b=="startchat"&&(WMSUI.imgPreview.removeOverlay(),WmsHybridSearch.parseAndOpenChat(a.target))})},cloneImgElement:function(a){var b=a.cloneNode(),c=a.getAttribute("originalsrc"),d=a.getAttribute("src"),e=a.getAttribute("style");return b.setAttribute("tempsrc",d),b.setAttribute("style","background:transparent"),c&&(b.src=c,b.onload=function(){a.src=c,a.setAttribute("class","wms-hvalign"),a.removeAttribute("style"),this.removeAttribute("originalsrc"),WMSUI.loadedimg[c]=!0},b.onerror=function(){a.src=d,a.setAttribute("style",e),a.setAttribute("class","wms-hvalign wms-blurfilter"),a.setAttribute("originalsrc",c),a.setAttribute("class","wms-hvalign wms-blurfilter")}),b.removeAttribute("class"),b.setAttribute("id","wms-imgpreview"+WMSUI.imgPreview.curimgpos),b.setAttribute("width",a.getAttribute("data-fwidth")+"px"),b.setAttribute("height",a.getAttribute("data-fheight")+"px"),b},createOverlay:function(){if(document.getElementById("wms-imgpreviewcontainer")==null){var a=document.createElement("div");a.id="wms-imgpreviewcontainer",a.className="wms-imgpreviewcontainer",a.style.zIndex=$WC.$CUtil.getConfig("zindex"),document.body.appendChild(a)}if(document.getElementById("wms-imgoverlay")==null){var b=document.createElement("div");b.id="wms-imgoverlay",b.className="wms-imgoverlay",b.style.zIndex=$WC.$CUtil.getConfig("zindex"),document.body.insertBefore(b,document.getElementById("wms-imgpreviewcontainer"))}},generateUI:function(){return'<div id="wms-imgpreviewleft" class="wms-imgpreviewleft" data-purpose="previmg"></div><div id="wms-imgpreviewright" class="wms-imgpreviewright" data-purpose="nextimg"></div><div id="wms-imgpreviewnext" data-purpose="nextimg" class="wms-imgpreviewnext wms-valign-mid-block"><span class="wms-imgnext" data-purpose="nextimg"></span></div><div id="wms-imgpreviewprev" data-purpose="previmg" class="wms-imgpreviewprev wms-valign-mid-block"><span class="wms-imgprev" data-purpose="previmg"></span></div><div id="wms-imgpreviewholder" class="wms-imgpreviewholder"><div id="wms-imgpreviewlist" class="wms-imgpreviewlist"></div>'},resize:function(){var a=document.getElementById("wms-imgpreviewnext"),b=document.getElementById("wms-imgpreviewprev");if(a&&b){if(document.getElementById("wms-imgpreview"+WMSUI.imgPreview.curimgpos))var c=document.getElementById("wms-imgpreview"+WMSUI.imgPreview.curimgpos);else c=WMSUI.imgPreview.cloneImgElement(WMSUI.imgPreview.images[WMSUI.imgPreview.curimgpos]);WMSUI.imgPreview.populateUI(c)}},getCurrentImgPosition:function(a,b){for(var c=0;c<b.length;c++)b[c+1]&&b[c+1].getAttribute("data-furl")==b[c].getAttribute("data-furl")&&b[c].src.startsWith("data:image")?a=b[c]===a?b[c+1]:a:(WMSUI.imgPreview.images.push(b[c]),b[c]===a&&(WMSUI.imgPreview.curimgpos=WMSUI.imgPreview.images.length-1))},next:function(){WMSUI.imgPreview.curimgpos+1<WMSUI.imgPreview.images.length&&(WMSUI.imgPreview.curimgpos++,WMSUI.imgPreview.getAndReplaceImageDetails(WMSUI.imgPreview.images[WMSUI.imgPreview.curimgpos]))},prev:function(){WMSUI.imgPreview.curimgpos>0&&(WMSUI.imgPreview.curimgpos--,WMSUI.imgPreview.getAndReplaceImageDetails(WMSUI.imgPreview.images[WMSUI.imgPreview.curimgpos]))},populateUI:function(a){var b=window.innerWidth,c=window.innerHeight;document.getElementById("wms-imgpreviewsenderinfo")&&(c-=document.getElementById("wms-imgpreviewsenderinfo").clientHeight),document.getElementById("wms-imgpreviewfinfo")&&(c-=document.getElementById("wms-imgpreviewfinfo").clientHeight);var d=a.width,e=a.height,f=400,g=300,h=0,i=0,j=document.getElementById("wms-imgpreviewholder");if(d>b||e>c){var k=[b/d,c/e];k=Math.min(k[0],k[1]),k<1&&(d*=k,e*=k)}f=d,g=e;var l=c/2-e/2,m=b/2-d/2;if(d<400||e<300)d<400&&(f=400),e<300&&(g=300),h=l,i=m,l=c/2-g/2,m=b/2-f/2;j.style.top=l+"px",j.style.left=m+"px",j.style.width=f+"px",j.style.height=g+"px";if(h!=0||i!=0)h-=l,i-=m;a.style.top=h+"px",a.style.left=i+"px",a.style.width=d+"px",a.style.height=e+"px",a.style.position="absolute",document.getElementById("wms-imgpreviewlist").appendChild(a)},removeOverlay:function(){var a=document.getElementById("wms-imgoverlay"),b=document.getElementById("wms-imgpreviewcontainer");a&&b&&(document.body.removeChild(a),document.body.removeChild(b)),WMSUI.imgPreview.images.length&&(WMSUI.imgPreview.images.length=0)},handleKeyMovement:function(a){if(document.getElementById("wms-imgoverlay")!==null){var b=getSource(a);if(b.nodeName=="TEXTAREA"||b.type=="text")return!0;var c=window.event?a.keyCode:a.which;return c==39?WMSUI.imgPreview.next():c==37?WMSUI.imgPreview.prev():c==27&&WMSUI.imgPreview.removeOverlay(),!0}}};var WmsFileUpload={};WmsFileUpload.files=[],WmsFileUpload.req={};var WmsFileForward={};WmsFileUpload.init=function(a,b){WmsFileUpload.files=b,WMSUI.imgPreview.createOverlay(),WmsFileUpload.showUI(a,b);var c=document.getElementById("wms-fileupldwin");WmsFileUpload.bindEvents(c,a)},WmsFileUpload.validateAndReplaceFilename=function(a,b){var c=/[`~!$%^&|\\"<>?/]/g;if(a==="check")return c.test(b)||!b;if(a==="replace")return b.replace(c,"-")},WmsFileUpload.showUI=function(a,b){var c=b.length==1?"wms-fileupldcontainer1":"wms-fileupldcontainer",d=b.length==1?"wms-fileupldcnt1 wms-fileupldpreview":"wms-fileupldpreview",e=b.length==1?"style=display:none":"",f=WmsFileUpload.generateUI();f=$WC.template.replace(f,{$SHAREINFO:["share.file.user",WebMessanger.unescapeHTML(WindowHandler.getWinObjById(a).title)],PREVIEWCLASS:c}),document.getElementById("wms-imgpreviewcontainer").innerHTML=f;var g=WmsFileUpload.fill(b);g=$WC.template.replace(g,{UPLOADCLASS:d,STYLE:e}),document.getElementById("wms-fileupldcontainer").innerHTML=g;for(var h=0;h<b.length;h++){var i=document.getElementById("wms-fileupldpreview"+h);WmsFileUpload.setPreview(i,b[h])}document.getElementById("wms-fileupldcmt").focus()},WmsFileUpload.fill=function(a){var b="",c="",d;for(var e=0;e<a.length;e++){b+=WmsFileUpload.generateFileUI(),a[0]&&a[0]instanceof File&&(d=WmsFileUpload.validateAndReplaceFilename("replace",a[e].name)),d||(d=WmsResource.getRealValue("chat.file.upload")+MyDate.formatTime(new Date));var f=d.lastIndexOf(".");f!=-1?c=d.substring(f):f=d.length,d=d.substring(0,f),b=$WC.template.replace(b,{FNAME:d,FEXTN:c,INDEX:e})}return b},WmsFileUpload.setPreview=function(a,b){if($WC.Matcher.check("imagemimetype",b.type)){var c=new FileReader;c.onload=function(b){var c='<img src="'+b.target.result+'">';a.innerHTML=c},c.readAsDataURL(b)}else $WC.$CUtil.addClass(a,"wms_fileupldbg"),a.innerHTML='<span class="wms-fileimgpreview wms-hvalign"></span>'},WmsFileUpload.generateUI=function(){return'<div id="wms-fileupldwin" class="wms-fileupldwin wms-hvalign"><div id="wms-fileupldwinheader" class="wms-fileupldwinheader">{{SHAREINFO}}<span class="wms-fileupldclose" data-purpose="cancel"></span></div><div id="wms-fileupldwinbody" class="wms-fileupldwinbody"><div id="wms-filefrwrderrormsg" class="wms-fileuploaderror"></div><div id="wms-fileupldcontainer" class="{{PREVIEWCLASS}}">FILESLIST</div><div class="wms-fileupldactions"><input type="button" data-purpose="cancel" value="Cancel" class="wms-fileupldcancel"><input type="button" id="wms-fileupload" data-purpose="upload" value="Upload" class="wms-fileupld"></div></div></div>'},WmsFileUpload.generateFileUI=function(){return WmsFileUpload.checkSupport()?'<div data-fileindex="{{INDEX}}" data-fextn="{{FEXTN}}" data-type="file" class="{{UPLOADCLASS}}"><input class="wms-fileupldfname" id="wms-fileupldfname" data-purpose="fileupload" value="{{FNAME}}"><span class="wms-fileupldcls" {{STYLE}} data-purpose="close"></span><div id="wms-fileupldpreview{{INDEX}}" class="wms-fileupldimgpreview"></div><div class="wms-smileycontainer wms-fileupldsmileycon" data-smileycontainer="true"></div><div id="wms-footer" class="wms-footer"><textarea id="wms-fileupldcmt" data-purpose="keyupload" placeholder="'+WmsResource.getRealValue("file.upload.comment")+'" class="wms-fileupldcmt"></textarea>'+'<div class="wms-filecmntcount" data-limit="1000">1000</div>'+'<div id="wms-smileyinvoker" class="wms-smileyinvoker wms-fileupldsmileyinvoker" data-purpose="smiley"></div>'+"</div>"+"</div>":'<div data-fileindex="{{INDEX}}" data-fextn="{{FEXTN}}" data-type="file" class="{{UPLOADCLASS}}"><input class="wms-fileupldfname" id="wms-fileupldfname" style="height:10%" value="{{FNAME}}" disabled><div id="wms-fileupldpreview{{INDEX}}" class="wms-fileupldimgpreview" style="height:90%"></div></div>'},WmsFileUpload.bindEvents=function(a,b){a.addEventListener("click",function(a){var c=a.target.getAttribute("data-purpose");if(c==="upload")WindowHandler.showProgress(b,0),WmsFileUpload.checkSupport()?WmsFileUpload.upload(b):WMSUI.iframeUpload(b);else if(c==="cancel")WMSUI.imgPreview.removeOverlay(),document.getElementById(b).querySelector("#formsend").reset();else if(c==="close")WmsFileUpload.removeFiles(a.target);else if(c=="smiley"){var d=a.target.parentNode.parentNode,e=d.querySelector("[data-smileycontainer]");Smiley.toggle(e)}}),a.addEventListener("keydown",function(a){var c=a.target.getAttribute("data-purpose");c=="keyupload"&&a.keyCode==13&&(a.ctrlKey||a.metaKey)&&(WindowHandler.showProgress(b,0),WmsFileUpload.upload(b),a.preventDefault())}),a.addEventListener("keyup",function(a){a.keyCode==27?a.target.value?(a.target.value="",WmsFileUpload.updateCommentCount(a.target)):(WMSUI.imgPreview.removeOverlay(),document.getElementById(b).querySelector("#formsend").reset()):WmsFileUpload.updateCommentCount(a.target)}),a.addEventListener("focusin",function(a){var b=a.target.getAttribute("data-purpose");if(b=="fileupload"){var c=this.getElementsByClassName("wms-fileupldfname");for(var d=0;d<c.length;d++)c[d].setAttribute("style","border-color: transparent");document.getElementById("wms-filefrwrderrormsg").setAttribute("style","display:none")}})},WmsFileUpload.updateCommentCount=function(a){var b=a.parentNode.querySelector("[data-limit]"),c=a.value.length,d=b.getAttribute("data-limit"),e=d-c;e<10?$WC.$CUtil.addClass(b,"wms_cntred"):$WC.$CUtil.removeClass(b,"wms_cntred"),e<0?a.value=a.value.substring(0,d):$WC.$CUtil.setInnerText(b,e)},WmsFileUpload.removeFiles=function(a){var b=a.parentNode;b.remove();var c=document.getElementById("wms-fileupldcontainer"),d=c.querySelectorAll('[data-type="file"]');d.length==1&&(c.className="wms-fileupldcontainer1",c.children[0].className="wms-fileupldcnt1 wms-fileupldpreview",d[0].querySelector('[class="wms-fileupldcls"]').setAttribute("style","display:none"))},WmsFileUpload.upload=function(a){var b=document.getElementById("wms-fileupldfname").value,c=document.getElementById("wms-fileupldcmt").value,d=WindowHandler.getWinObjById(a);if(WmsFileForward.validate(b,c)){WindowHandler.clearProgress(a);return}if(d&&d.salesiqchat){var e=document.getElementsByName("uploads"+a)[0].querySelector("input").files,f=e||WmsFileUpload.files,g=document.getElementById("wms-fileupldcontainer"),h=g.querySelectorAll('[data-type="file"]');WmsUIImpl.uploadFile(f,WmsFileUpload.getCommentsDetails(h),a),document.getElementById(a).querySelector("#formsend").reset(),WMSUI.imgPreview.removeOverlay(),d.composer.focus();return}var i=new XMLHttpRequest;WmsFileUpload.req[a]=i;var j;i.upload.addEventListener("progress",function(b){b.lengthComputable?(j=j&&j>100?100:Math.round(b.loaded/b.total*100),WindowHandler.showProgress(a,j)):WindowHandler.showProgress(a,-1)},a),i.onerror=function(){WindowHandler.showProgress(a,-1)},i.onreadystatechange=function(){if(i.readyState==4){if(i.status==200){WindowHandler.clearProgress(a);var b=WindowHandler.getWinObjById(a),c=i.opts&&i.opts.id,d=i.opts&&i.opts.comment,e=i.opts&&i.opts.replymsgid,f=document.getElementsByName("uploads"+a)[0].querySelector("input").files;if((WmsFileUpload.files.length===1||f.length===1)&&!b.msgdisp.querySelector('[data-msgackid="'+c+'"]')&&!e){var g=f[0]||WmsFileUpload.files[0],h={};h.msg={},h.msg.dim={};var j=h,k=b,l=new FileReader;l.onload=function(a){j.url=a.target.result,j.msg.url=a.target.result;if($WC.Matcher.check("imagemimetype",g.type)){var b=new Image;b.onload=function(){j.msg.dim.width=this.width,j.msg.dim.height=this.height,k.msgdisp.querySelector('[data-msgackid="'+j.msgackid+'"]')||k.updateMessage(h)},b.src=a.target.result}else k.msgdisp.querySelector('[data-msgackid="'+j.msgackid+'"]')||k.updateMessage(h)},h.zuid=WebMessanger.zuid,h.sender=WebMessanger.zuid,h.ctype=b.ctype,h.chid=a,h.mod="att",h.time=c,h.msgackid=c,h.msg.isv1local=!0,h.msg.fName=g.name,h.msg.content=g.type||"text/plain",h.msg.dim.size=g.size,h.msg.comment=d,l.readAsDataURL(g)}}else WindowHandler.showProgress(a,-1);document.getElementById(a).querySelector("#formsend").reset()}};var k="/"+_CHATCONT+"/v1/attachments";i.open("POST",k,!0),i.setRequestHeader("X-XHR-exception","true"),i.setRequestHeader("X-ZCSRF-TOKEN",$WC.$CUtil.getCSRF());var l=d&&d.getReplyMessageId(),m={};m.id=(new Date).getTime(),m.comment=document.getElementById("wms-fileupldcmt").value,l&&(m.replymsgid=d.getReplyMessageId()),i.opts=m;var n=WmsFileUpload.getFormData(a,m.id);return n&&(i.send(n),d&&d.closeReplyPreview(),WMSUI.imgPreview.removeOverlay(),WindowHandler.getWinObjById(a).composer.focus()),i},WmsFileUpload.abort=function(a){var b=WmsFileUpload.req[a];b.abort()},WmsFileUpload.checkSupport=function(){if(typeof (new XMLHttpRequest).upload!="undefined"&&typeof (new FormData)!="undefined")return!0},WmsFileUpload.getFormData=function(a,b){var c={id:a,sid:WebMessanger.getSid()};WmsFileUpload.files.length===1&&b&&(c.msgid=b);var d=WindowHandler.getWinObjById(a),e=d&&d.getReplyMessageId();e&&(c.repliedmsguid=e);if(typeof FormData!="undefined"){var f=new FormData;for(var g in c)f.append(g,c[g]);return WmsFileUpload.MapCommentsAndNames(f)}},WmsFileUpload.MapCommentsAndNames=function(a){var b=document.getElementById("wms-fileupldcontainer"),c=b.querySelectorAll('[data-type="file"]'),d=WmsFileUpload.getCommentsDetails(c).comments;a.append("comment",JSON.stringify(d));for(var e=0;e<c.length;e++){var f=parseInt(c[e].getAttribute("data-fileindex")),g=c[e].getAttribute("data-fextn"),h=c[e].querySelector('[id="wms-fileupldfname"]').value;if(WmsFileUpload.validateAndReplaceFilename("check",h))return c[e].querySelector('[id="wms-fileupldfname"]').setAttribute("style","border-color: #FF5959;"),$WC.$CUtil.setInnerTextById("wms-filefrwrderrormsg",WmsResource.getRealValue("file.name.invalid")),document.getElementById("wms-filefrwrderrormsg").setAttribute("style","display:block"),!1;$WC.$CUtil.isEmptyObject(d)?a.append("files",WmsFileUpload.files[f],h+g):a.append("files",WmsFileUpload.files[f],f+1+"_"+h+g)}return a},WmsFileUpload.getCommentsDetails=function(a){var b={};b.comments={};for(var c=0;c<a.length;c++){var d=parseInt(a[c].getAttribute("data-fileindex")),e=a[c].querySelector('[id="wms-fileupldcmt"]').value;e&&(b.comments[d+1]=e.trim())}return b},WmsFileUpload.isFileSizeExceeded=function(a){if(a){var b=0;for(var c=0;c<a.length;c++)b+=a[c].size;return b>52428800?(alert(WmsResource.getRealValue("upload.maxsize.exceed")),!0):!1}},WmsFileUpload.handlePaste=function(a){var b=a.target.getAttribute("chid"),c=[],d=WindowHandler.getWinObjById(b),e=(a.originalEvent||a).clipboardData;if(e){var f=e.items;if(f){for(var g=0;g<f.length;g++)$WC.Matcher.check("imagemimetype",f[g].type)&&f[g].getAsFile()!==null&&c.push(f[g].getAsFile());c.length!==0&&!d.restrict_file_upload&&(WmsFileUpload.init(b,c),document.getElementById("wms-fileupldcmt").focus())}}},WmsFileForward.init=function(a){WMSUI.imgPreview.createOverlay();var b=WmsFileForward.generateUI();document.getElementById("wms-imgpreviewcontainer").innerHTML=b,document.getElementById("wms-filefrwrdrecipant").focus(),WmsFileForward.fill(a),WmsFileForward.bindevents()},WmsFileForward.getSuggestionsHTML=function(){var a=WmsHybridSearch.filter("DNAME","",WmsContacts.contactslist,5,"","USERID","EMAILID"),b="",c='<img title="{{DNAME}}" data-dname="{{DNAME}}" data-type="'+WmsHybridSearch.constants.CONTACT+'" data-id="{{USERID}}" data-purpose="usersugg" src="{{WMSPHOTOSERVER}}/file?ID={{USERID}}&exp=6000&t=user&fs=thumb">';return a.forEach(function(a){b+=$WC.template.replace(c,{DNAME:a.DNAME,USERID:a.USERID,WMSPHOTOSERVER:_WMSPHOTOSERVER})}),b},WmsFileForward.generateUI=function(){return'<div id="wms-fileupldwin" class="wms-fileupldwin wms-hvalign"><div id="wms-fileupldwinheader" class="wms-fileupldwinheader">'+WmsResource.getRealValue("file.forward")+'<span class="wms-fileupldclose" data-purpose="cancel"></span>'+"</div>"+'<div id="wms-fileupldwinbody" class="wms-fileupldwinbody wms_filefrwrdwinbody">'+'<div id="wms-filefrwrderrormsg" class="wms-filefrwrderror"></div>'+"<span>"+'<div class="wms_filefrwrd_info">'+WmsResource.getRealValue("file.forward.to")+":</div>"+'<div id="wms-filefrwrdrecipant" data-type="contact" contenteditable="true" class="wms-filefrwrdrecipant" data-purpose="selectrecipant" placeholder="'+WmsResource.getRealValue("fileforward.select.recipient")+'"></div>'+'<div id="wms_filefrwrdsugg_wrapper" class="wms_filefrwrdsugg_wrapper">'+'<div class="wms_filefrwrdsugg_container">'+'<span class="wms_filefrwrdsugg_info">'+WmsResource.getRealValue("file.forward.suggestions")+"</span>"+'<div class="wms_filefrwrdsugg">'+WmsFileForward.getSuggestionsHTML()+"</div>"+"</div>"+"</div>"+'<div id="wms-selrecipant" class="wms-filefrwrdrecipant" style="display:none"></div>'+'<div id="wms-filefrwrdautocomplete" class="wms-filefrwrdautocomplete" style="display:none"></div>'+'<div id="wms-fileupldcontainer" class="wms-filefrwrdwinbody"></div>'+'<div class="wms-fileupldactions wms_filefrwrdactions">'+'<input type="button" data-purpose="cancel" value="Cancel" class="wms-fileupldcancel">'+'<input type="button" data-purpose="forwardfile" id="wms-fileforward" value="Forward" class="wms-fileupld">'+"</div>"+"</span>"+"</div>"+"</div>"},WmsFileForward.generateFileUI=function(){return WmsFileUpload.checkSupport()?'<div data-type="file" data-fextn="{{FEXTN}}" data-content="{{CONTENT}}" data-url="{{URL}}" data-isv1={{ISV1}} class="wms-filefrwrdcnt1 wms-fileupldpreview"><input class="wms-fileupldfname" id="wms-fileupldfname" data-purpose="forwardfilename" placeholder="'+WmsResource.getRealValue("file.add.name")+'" value="{{FNAME}}">'+'<div id="wms-fileupldpreview" class="wms-fileupldimgpreview"></div>'+'<div class="wms-smileycontainer wms-filefrwrdsmileycon" data-smileycontainer="true"></div>'+'<div id="wms-footer" class="wms-footer">'+'<textarea id="wms-fileupldcmt" data-purpose="keyforward" placeholder="'+WmsResource.getRealValue("file.forward.comment")+'" class="wms-fileupldcmt"></textarea>'+'<div class="wms-filecmntcount" data-limit="1000">1000</div>'+'<div id="wms-smileyinvoker" class="wms-smileyinvoker wms-fileupldsmileyinvoker" data-purpose="smiley"></div>'+"</div>"+"</div>":'<div data-type="file" data-fextn="{{FEXTN}}" data-content="{{CONTENT}}" data-url="{{URL}}" data-isv1={{ISV1}} class="wms-filefrwrdcnt1 wms-fileupldpreview"><input class="wms-fileupldfname" id="wms-fileupldfname" placeholder="'+WmsResource.getRealValue("file.add.name")+'" style="height:10%" value="{{FNAME}}">'+'<div id="wms-fileupldpreview" class="wms-fileupldimgpreview" style="height:90%"></div>'+"</div>"},WmsFileForward.populateRecipant=function(){var a=document.getElementById("wms-filefrwrdautocomplete"),b=$WC.$CUtil.getInnerText(document.getElementById("wms-filefrwrdrecipant"));if(!b){a.innerHTML="",a.style.display="none";return}a.style.display="block";var c={searchtext:b,inpresultset:WmsHybridSearch.constants.GENERICLIST,silentload:!0};WmsHybridSearch.getNextResultSet(c),$WC.$CUtil.loadOriginalImage(a),$WC.$CUtil.addEvent(a,"scroll",$WC.$CUtil.loadImageWithDebounce(a)),a.firstChild&&a.firstChild.className.indexOf("wmswms_menu_item_date")==-1&&$WC.$CUtil.addClass(a.firstChild,"wms-hysearch-result-hover")},WmsFileForward.insertSuggestion=function(a,b,c){var d=document.getElementById("wms-filefrwrdrecipant"),e=b?a:getEventTarget(a),f=e&&e.closest("[data-id]"),g=f?f.getAttribute("data-id"):c.chid,h=f?f.getAttribute("data-dname"):c.dname,i=e&&e.getAttribute("data-purpose")=="usersugg"?e:c?c.imagehtml:f.getElementsByClassName("wms_badge_imgwrapper")[0],j=i.outerHTML||i,k=f?f.getAttribute("data-type"):c.type,l=j+'<span id="wms_filefrwrd_recipient">{{DNAME}}</span><div data-purpose="delsugg" class="wms_filefrwrddel"></div>';d.innerHTML=$WC.template.replace(l,{DNAME:h}),$WC.$CUtil.loadOriginalImage(d),$WC.$CUtil.setAttribute(d,"data-type",k),$WC.$CUtil.setAttribute(d,"data-userid",g),$WC.$CUtil.setAttribute(d,"contenteditable",!1),document.getElementById("wms-filefrwrdautocomplete").style.display="none"},WmsFileForward.removeSuggestion=function(){var a=document.getElementById("wms-filefrwrdrecipant");a.innerHTML="",$WC.$CUtil.setAttribute(a,"contenteditable",!0),a.removeAttribute("data-userid"),a.removeAttribute("data-type")},WmsFileForward.bindevents=function(){var a=document.getElementById("wms-fileupldwin");a.addEventListener("click",function(b){var c=b.target.getAttribute("data-purpose");if(c=="forwardfile")WmsFileForward.createChatAndForward();else if(c=="cancel")WMSUI.imgPreview.removeOverlay();else if(c=="selectrecipant"||c=="keyforward")document.getElementById("wms-filefrwrderrormsg").setAttribute("style","display:none"),$WC.$CUtil.removeClass(document.getElementById("wms_filefrwrdsugg_wrapper"),"wms_filefrwrderr");else if(c=="smiley"){var d=a.querySelector("[data-smileycontainer]");Smiley.toggle(d)}else c=="usersugg"?WmsFileForward.insertSuggestion(b):c=="delsugg"?WmsFileForward.removeSuggestion(b):b.target.closest("[data-id]")&&WmsFileForward.insertSuggestion(b)}),a.addEventListener("keyup",function(a){var b=getEventTarget(a),c=b.getAttribute("data-purpose");c=="selectrecipant"?a.keyCode==40||a.keyCode==38?WmsFileForward.handleNavigation(a):a.keyCode==13?(b=WmsFileForward.getSelectedRecipient(),WmsFileForward.insertSuggestion(b,!0)):a.keyCode==27?WMSUI.imgPreview.removeOverlay():WmsFileForward.populateRecipant():a.keyCode==27?a.target.value?(a.target.value="",WmsFileUpload.updateCommentCount(a.target)):WMSUI.imgPreview.removeOverlay():WmsFileUpload.updateCommentCount(a.target)}),a.addEventListener("keydown",function(a){var b=a.target.getAttribute("data-purpose");b=="keyforward"?a.keyCode==13&&(a.ctrlKey||a.metaKey)&&WmsFileForward.createChatAndForward():b=="selectrecipant"&&a.keyCode==13&&a.preventDefault()}),a.addEventListener("mouseover",function(a){var b=a.target.closest("[data-id]");if(b&&b.className.indexOf("wms_menu_item")==0){var c=document.getElementById("wms-filefrwrdautocomplete").getElementsByClassName("wms-hysearch-result-hover")[0];c&&$WC.$CUtil.removeClass(c,"wms-hysearch-result-hover"),$WC.$CUtil.addClass(b,"wms-hysearch-result-hover")}})},WmsFileForward.getSelectedRecipient=function(){var a=document.getElementById("wms-filefrwrdautocomplete"),b=a.getElementsByClassName("wms-hysearch-result-hover")[0];return a.setAttribute("style","display:none"),document.getElementById("wms-fileupldcmt").focus(),b},WmsFileForward.handleNavigation=function(a){var b=document.getElementById("wms-filefrwrdautocomplete"),c=b.getElementsByClassName("wms-hysearch-result-hover")[0],d=null;a.keyCode==40?d=c.nextSibling||b.firstChild:a.keyCode==38&&(d=c.previousSibling||b.lastChild),d.className=="wms_menu_item_date"&&(d=a.keyCode==40?d.nextSibling:d.previousSibling||b.lastChild),$WC.$CUtil.bringElemToView(d,a.keyCode),$WC.$CUtil.removeClass(c,"wms-hysearch-result-hover"),$WC.$CUtil.addClass(d,"wms-hysearch-result-hover")},WmsFileForward.fill=function(a){var b="",c="",d=a.getAttribute("data-fcomment")!=="null"?a.getAttribute("data-fcomment"):"",e=a.getAttribute("data-fsrc")||a.src,f=a.getAttribute("data-fcontent"),g=a.getAttribute("data-src")||a.getAttribute("data-furl"),h=a.getAttribute("data-fname"),i=a.getAttribute("data-isv1"),j=h.lastIndexOf(".");j!=-1?c=h.substring(j):j=h.length,h=h.substring(0,j);var k=WmsFileForward.generateFileUI();k=$WC.template.replace(k,{FNAME:h,FEXTN:c,COMMENT:d,URL:g,CONTENT:f,ISV1:i}),document.getElementById("wms-fileupldcontainer").innerHTML=k;var l=document.getElementById("wms-fileupldpreview");/^image\/.+$/.test(f)?b="<img src="+e+">":(b='<span class="wms-fileimgpreview wms-hvalign"></span>',$WC.$CUtil.addClass(l,"wms_fileupldbg")),l.innerHTML=b},WmsFileForward.validate=function(a,b,c){return c&&$WC.$CUtil.isEmptyObject(c.childNodes)?($WC.$CUtil.setInnerTextById("wms-filefrwrderrormsg",WmsResource.getRealValue("fileforward.error.norecipient")),document.getElementById("wms-filefrwrderrormsg").setAttribute("style","display:block"),$WC.$CUtil.addClass(document.getElementById("wms_filefrwrdsugg_wrapper"),"wms_filefrwrderr"),!0):!1},WmsFileForward.createChatAndForward=function(){var a,b=document.getElementById("wms-filefrwrdrecipant"),c=document.getElementById("wms-fileupldcontainer").querySelector('[data-type="file"]'),d=document.getElementById("wms-fileupldfname").value;if(document.getElementById("wms-fileupldcmt"))var e=document.getElementById("wms-fileupldcmt").value.trim();if(WmsFileForward.validate(d,e,b))return;var f=b.getAttribute("data-type"),g=f==WmsHybridSearch.constants.CONTACT||f==WmsHybridSearch.constants.ORGCONTACT?"im":f==WmsHybridSearch.constants.CHANNEL?"channel":"chat",h=c.getAttribute("data-url"),i=c.getAttribute("data-fextn"),j=c.getAttribute("data-content"),k=c.getAttribute("data-isv1"),l;a="id="+b.getAttribute("data-userid"),a+="&type="+g+"&mod=att&sid="+encodeURIComponent(WebMessanger.getSid()),e&&(a+="&comment="+e);var m=function(){var a=JSON.parse(this.response);a[0].objString.ERRCODE==400&&WMSUI.showErrorMsg(WmsResource.getRealValue("chat.attachment.forward.error"))};k==="true"?(l={"X-XHR-exception":"true","X-ZCSRF-TOKEN":$WC.$CUtil.getCSRF()},$WC.Ajax.postRequestToChat("v1/attachments/"+h+"/forward",a,null,m,null,null,l)):(l={"X-XHR-exception":"true"},a+="&fname="+d+i+"&url="+h+"&mime="+j,$WC.Ajax.postRequestToChat("fileforward.do",a,null,m,null,null,l)),WMSUI.imgPreview.removeOverlay()};var WmsHybridSearch=function(){};WmsHybridSearch.constants={CHANNEL:1,CHAT:2,CONTACT:3,DEFAULTRESULT:4,EMPTY:5,FREQCONTACTS:6,GENERICLIST:7,GROUP:8,MESSAGEHINT:9,ORGCONTACT:10,TITLEHINT:11,USERLIST:12,EMPTYUSERHINT:13,EMPTYTITLEHINT:14,EMPTYMSGHINT:15,ADDCONTACT:16,USER_CHANNELLIST:17,CHANNELLIST:18,BOT:19},WmsHybridSearch.constants.modules={CONTACTMENU:1,GROUPMENU:2,CHATMENU:3,SMARTCHAT:4,FILEFWD:5},WmsHybridSearch.tempmsgdetails=[],WmsHybridSearch.hintindex=0,WmsHybridSearch.getCurrentModule=function(){var a=document.getElementById("wms-hysearch"),b=document.getElementById("wms-filefrwrdautocomplete");if(a)return WmsHybridSearch.constants.modules.SMARTCHAT;if(b)return WmsHybridSearch.constants.modules.FILEFWD;var c=document.getElementById("wms_menu_listcontainer");if(c){var d=c.querySelector("[data-selected=true]");if(d){var e=d.getAttribute("data-menuname");if(e==="contact")return WmsHybridSearch.constants.modules.CONTACTMENU;if(e==="channel")return WmsHybridSearch.constants.modules.GROUPMENU;if(e==="chat")return WmsHybridSearch.constants.modules.CHATMENU}}},WmsHybridSearch.getNode=function(a,b){var c={inputdiv:"wms_menu_search",resultcontainer:"wms_menu_contactlist",defaultresultdiv:"wms_menu_contactlist_def",searchresultdiv:"wms_menu_contactlist_searchres",inputcontainer:"wms_menu_search",loadingstatus:"wms-contact-loadstatus"},d={inputdiv:"wms_menu_search",resultcontainer:"wms_menu_grouplist",defaultresultdiv:"wms_menu_grouplist_def",searchresultdiv:"wms_menu_grouplist_searchres",inputcontainer:"wms_menu_search",loadingstatus:"wms-channel-loadstatus"},e={inputdiv:"wms_menu_search",resultcontainer:"wms_menu_chatlist",defaultresultdiv:"wms_menu_chatlist_def",searchresultdiv:"wms_menu_chatlist_searchres",recentchatdiv:"wms_menu_chatlist_def",recentchatsdiv:"wms_menu_chatlist_recentchats",inputcontainer:"wms_menu_search",loadingstatus:"wms-chat-loadstatus",recentchatswelcomemsg:"wms_welcome_recentchatsmsg"},f={mainUI:"wms-hysearch",inputcontainer:"wms-hysearch-inpcontainer",inputdiv:"wms-hysearch-actualinp",defaultresultdiv:"wms-hysearch-defrescont",freqcontactsdiv:"wms-hysearch-fcontacts",infomsgdiv:"wms-hysearch-infomsg",loadingstatus:"wms-hysearch-loadstatus",recentchatsdiv:"wms-hysearch-rchats",resultcontainer:"wms-hysearch-rescont",searchresultdiv:"wms-hysearch-searchres",thirdcolumn:"wms-hysearch-thirdcol",thirdcolumnheading:"wms-hysearch-thirdcolheading",fakeinput:"wms-fakeinput"},g={searchresultdiv:"wms-filefrwrdautocomplete",inputcontainer:"wms-filefrwrdrecipant",inputdiv:"wms-filefrwrdrecipant",loadingstatus:"wms-filefwd-loadstatus"},h;return b=b||WmsHybridSearch.getCurrentModule(),b===WmsHybridSearch.constants.modules.SMARTCHAT?h=f:b===WmsHybridSearch.constants.modules.CONTACTMENU?h=c:b===WmsHybridSearch.constants.modules.GROUPMENU?h=d:b===WmsHybridSearch.constants.modules.CHATMENU?h=e:b===WmsHybridSearch.constants.modules.FILEFWD?h=g:h=f,document.getElementById(h[a])},WmsHybridSearch.showUI=function(){$WC.$CUtil.createOverlay(WmsHybridSearch.hideUI),WmsHybridSearch.resshowntext="";var a=document.createElement("div");a.id="wms-hysearch",WmsHybridSearch.keydownlistener=$WC.$CUtil.addEvent(a,"keydown",WmsHybridSearch.handleKeyDown,!1),WmsHybridSearch.keyuplistener=$WC.$CUtil.addEvent(a,"keyup",WmsHybridSearch.handleEvent,!1),a.className="wms-hysearch wms-hvalign",a.style.zIndex=$WC.$CUtil.getConfig("zindex"),a.innerHTML=$WC.template.replace('<div class="wms-hysearch-toppart"><div class="wms-hysearch-searchiconcont"><div class="wms_searchicon wms-hysearch-searchicon"></div></div><div id="wms-hysearch-inpcontainer" class="wms-hysearch-inpcontainer"><input id="wms-hysearch-actualinp" data-selectable="true" data-selected="true" required></input><input style="width:0px;opacity:0" id="wms-fakeinput"><label id="wms-hysearch-placeholder" class="wms-hysearch-placeholder" onclick="WmsHybridSearch.focusInput()"></label></div><div class="wms-hysearch-closeicon" onclick="WmsHybridSearch.hideUI()"></div></div><div id="wms-hysearch-rescont" ><div id="wms-hysearch-defrescont" class="wms-hysearch-rescont"></div><div id="wms-hysearch-searchres" class="wms-hysearch-searchres"></div></div>',{}),document.body.appendChild(a);var b=$WC.template.replace('<div class="wms-hysearch-defres" data-selectable="true"><div class="wms-hysearch-resheading">'+$WC.$CUtil.getConfig("Resource").getRealValue("menuname.chats")+'</div><div id="wms-hysearch-rchats" data-resset="true" class="wms-hysearch-resset"></div></div>',{}),c=$WC.template.replace('<div class="wms-hysearch-defres" data-selectable="true"><div class="wms-hysearch-resheading">'+$WC.$CUtil.getConfig("Resource").getRealValue("Contacts")+'</div><div id="wms-hysearch-fcontacts" data-resset="true" class="wms-hysearch-resset"></div></div>',{}),d=$WC.template.replace('<div class="wms-hysearch-defres" data-selectable="true"><div id="wms-hysearch-thirdcolheading" style="visibility:hidden" class="wms-hysearch-resheading">'+$WC.$CUtil.getConfig("Resource").getRealValue("Contacts")+'</div><div id="wms-hysearch-thirdcol" data-resset="true" class="wms-hysearch-resset"><center><img src="https://img.zohostatic.com/ichat/v282_https/images/loading1.gif"></center></div></div>',{}),e=document.getElementById("wms-hysearch-defrescont");e.insertAdjacentHTML("beforeend",b),$WC.$CUtil.getConfig("contacts")!="disable"&&e.insertAdjacentHTML("beforeend",c),$WC.$CUtil.getConfig("isOrgUser")()&&$WC.$CUtil.getConfig("channels")!="disable"&&e.insertAdjacentHTML("beforeend",d),WmsHybridSearch.showRotationalHint(),$WC.$CUtil.addEvent(WmsHybridSearch.getNode("inputcontainer"),"click",WmsHybridSearch.focusInput),$WC.$CUtil.addEvent(WmsHybridSearch.getNode("recentchatsdiv"),"scroll",$WC.$CUtil.debounce(WmsHybridSearch.checkScrollAndloadMoreChatlist,null,300)),WmsHybridSearch.populateRecentChatsInSmartChat(),$WC.$CUtil.getConfig("contacts")!="disable"&&($WC.$CUtil.addEvent(WmsHybridSearch.getNode("freqcontactsdiv"),"scroll",$WC.$CUtil.loadImageWithDebounce(WmsHybridSearch.getNode("freqcontactsdiv"))),$WC.$CUtil.addEvent(WmsHybridSearch.getNode("freqcontactsdiv"),"click",function(b){var c=b.target.closest("[data-id]");b.target.getAttribute("data-operation")?WmsContacts.handleInviteOperation(b.target):c&&WmsHybridSearch.handleSelection(c)}),WmsHybridSearch.populateFrequentContactsInSmartChat(),setTimeout(function(){$WC.$CUtil.loadOriginalImage(WmsHybridSearch.getNode("freqcontactsdiv"))},300)),$WC.$CUtil.getConfig("isOrgUser")()&&$WC.$CUtil.getConfig("channels")!="disable"&&(WmsChannels.initChannels(),WmsHybridSearch.populateThirdColumnInSmartChat()),WmsHybridSearch.focusInput()},WmsHybridSearch.populateThirdColumnInSmartChat=function(){$WC.$CUtil.getConfig("isRegistered")()&&$WC.$CUtil.getConfig("isOrgUser")()&&$WC.$CUtil.getConfig("channels")!="disable"&&WmsHybridSearch.populateActiveChannels()},WmsHybridSearch.updateLoadingStatus=function(a,b,c,d,e){var f={chat:{},search:{}};f.search[WmsConstants.REQSTATUS.NORESULTS]=$WC.$CUtil.getConfig("Resource").getRealValue("search.noresult"),f.search[WmsConstants.REQSTATUS.FAILED]=$WC.$CUtil.getConfig("Resource").getRealValue("search.failed"),f.chat[WmsConstants.REQSTATUS.NORESULTS]=$WC.$CUtil.getConfig("Resource").getRealValue("chat.noresult"),f.chat[WmsConstants.REQSTATUS.FAILED]=$WC.$CUtil.getConfig("Resource").getRealValue("chat.retrievefailed");var g=a?a.getElementsByClassName("wms-hysearch-loadstatus")[0]:"";g&&(g.onclick=null);var h="",i="";e=e||WmsHybridSearch.getCurrentModule();var j="wms-hysearch-loadstatus";e===WmsHybridSearch.constants.modules.FILEFWD?j="wms-filefwd-loadstatus":e===WmsHybridSearch.constants.modules.CHATMENU?j="wms-chat-loadstatus":e===WmsHybridSearch.constants.modules.CONTACTMENU?j="wms-contact-loadstatus":e===WmsHybridSearch.constants.modules.GROUPMENU&&(j="wms-channel-loadstatus");if(b===WmsConstants.REQSTATUS.SUCCESS){$WC.$CUtil.removeElement(g);return}if(b===WmsConstants.REQSTATUS.NORESULTS)if(c==="chat"&&e===WmsHybridSearch.constants.modules.CHATMENU)if(!WmsRecentChats.chatlist.length){var k=WmsHybridSearch.getNode("recentchatswelcomemsg",e);$WC.$CUtil.removeElement(k),i='<div id="wms_welcome_recentchatsmsg"><div class="wms-welcome-img wms-welcome-recentchatsimg wms-halign"></div><div class="wms-welcome-msg wms-halign">'+$WC.$CUtil.getConfig("Resource").getRealValue("recentchats.welcomemessage",['<span data-menuredirect="contact">'+$WC.$CUtil.getConfig("Resource").getRealValue("chat.contact")+"</span>",'<span data-menuredirect="channel">'+$WC.$CUtil.getConfig("Resource").getRealValue("chat.channel")+"</span>"])+"</div></div></div>"}else h='<div class="wms-hysearch-infotxt wms-hvalign">'+f[c][WmsConstants.REQSTATUS.NORESULTS]+"</div>";else!g&&a&&a.id==="wms-hysearch-rchats"&&e===WmsHybridSearch.constants.modules.SMARTCHAT&&c==="chat"?(a.getElementsByClassName("wms-hysearch-infotxt")[0]&&$WC.$CUtil.removeElement(a.getElementsByClassName("wms-hysearch-infotxt")[0]),i='<span id="'+j+'" class="wms-hysearch-infotxt">'+f[c][WmsConstants.REQSTATUS.NORESULTS]+"</span>"):h='<div class="wms-hysearch-infotxt wms-hvalign">'+f[c][WmsConstants.REQSTATUS.NORESULTS]+"</div>";else if(b===WmsConstants.REQSTATUS.LOADING)h='<img class="wms-hvalign" src="https://img.zohostatic.com/ichat/v282_https/images/loading1.gif">';else if(b===WmsConstants.REQSTATUS.FAILED){if(c=="chat"&&!WmsRecentChats.chatlist.length&&e===WmsHybridSearch.constants.modules.CHATMENU){var k=WmsHybridSearch.getNode("recentchatswelcomemsg",e);$WC.$CUtil.removeElement(k)}i='<div id="'+j+'" class="wms-hysearch-loadstatus" data-retry="true" onclick="WmsHybridSearch.handleClick(this)" data-type="'+WmsConstants.REQSTATUS.FAILED+'" onmouseenter="WmsHybridSearch.changeHover(this)">'+'<div class="wms-hysearch-infotxt wms-hvalign">'+f[c][WmsConstants.REQSTATUS.FAILED]+"</div>"+"</div>"}i=i||'<div id="'+j+'" class="wms-hysearch-loadstatus wms-nonselectable" data-type="'+b+'">'+h+"</div>",g?g.outerHTML=i:a&&a.insertAdjacentHTML("beforeend",i),b===WmsConstants.REQSTATUS.FAILED&&(WmsHybridSearch.getNode("loadingstatus").onclick=d)},$WC.$CUtil.pubsub.subscribe("/chatlist/updateui",function(a,b){var c=b&&b.reqid;b.stat===WmsConstants.REQSTATUS.FAILED?WmsHybridSearch.updateManager("failureupdate",null,c):WmsHybridSearch.updateManager("update",null,c)}),$WC.$CUtil.pubsub.subscribe("/channels/updateui",function(a,b){var c=b&&b.reqid;b.stat===WmsConstants.REQSTATUS.FAILED?WmsHybridSearch.updateManager("failureupdate",null,c):WmsHybridSearch.updateManager("update",null,c),WmsHybridSearch.getCurrentModule()===WmsHybridSearch.constants.modules.SMARTCHAT&&(WmsHybridSearch.populateActiveChannels(),WmsHybridSearch.populateRecentChatsInSmartChat());var d=document.getElementById("wmstoolbar")?!0:!1;d&&!WmsHybridSearch.getSearchText()&&WmsHybridSearch.populateRecentChats(null,WmsHybridSearch.constants.modules.CHATMENU),WmsHybridSearch.populateGroupResultInMainUI(),typeof WmsMainUI!="undefined"&&WmsMainUI.updateLoadingForPinnedChats(!1)}),$WC.$CUtil.pubsub.subscribe("/orgcontacts/updateui",function(a,b){var c=b&&b.reqid;b.stat===WmsConstants.REQSTATUS.FAILED?WmsHybridSearch.updateManager("failureupdate",null,c):WmsHybridSearch.updateManager("update",null,c)}),$WC.$CUtil.pubsub.subscribe("/orgcontacts/suggestionui",function(a,b){var c={};b.stat===WmsConstants.REQSTATUS.FAILED?c.suggestions="suggestion_req_failed":c.suggestions="show_suggestions",WmsHybridSearch.populateContactListInMainUI(!0,c)}),$WC.$CUtil.pubsub.subscribe("/recentchats/updateui",function(a,b){document.getElementById("wms-hysearch")&&WmsHybridSearch.populateRecentChats(b,WmsHybridSearch.constants.modules.SMARTCHAT);var c=document.getElementById("wmstoolbar")?!0:!1;c&&WmsHybridSearch.populateRecentChats(b)}),$WC.$CUtil.pubsub.subscribe("/groups/updateui",function(){WmsHybridSearch.allowgroupsupdate&&WmsHybridSearch.populateGroups(),WmsHybridSearch.populateGroupResultInMainUI()}),WmsHybridSearch.populateSuggestionList=function(a){var b="",c='<div class="wms_menu_subheading" >'+$WC.$CUtil.getConfig("Resource").getRealValue("chat.suggestions")+"</div>";if(a){var d='<span data-retry="true">'+$WC.$CUtil.getConfig("Resource").getRealValue("suggestions.retry")+"</span>",e='<div class="wms-suggestions-failed">'+$WC.$CUtil.getConfig("Resource").getRealValue("suggestions.failed",d)+"</div>";b+=c,b+=e}else{WmsOrgContacts.checkAndUpdateContactsList();if($WC.$CUtil.getObjectLength(WmsOrgContacts.contactslist)>0){var f=WmsHybridSearch.generateContactResults(null,!0),g=f.map(function(a){return a.USERID}),h=WmsHybridSearch.generateOrgContactResults("","",g,!0);$WC.$CUtil.getObjectLength(h)>0&&(b+=c,b+=WmsHybridSearch.generateHtml(h))}}return b},WmsHybridSearch.focusInput=function(){setTimeout(function(){WmsHybridSearch.getNode("inputdiv").focus()},1)},WmsHybridSearch.hideUI=function(){$WC.$CUtil.removeEvent(document,"keydown",WmsHybridSearch.keydownlistener),$WC.$CUtil.removeEvent(document,"keyup",WmsHybridSearch.keyuplistener),$WC.$CUtil.removeOverlay(),$WC.$CUtil.removeElement(WmsHybridSearch.getNode("mainUI")),WmsHybridSearch.hintindex++},WmsHybridSearch.getChosenUsers=function(){return WmsHybridSearch.getNode("inputcontainer").querySelectorAll("[data-type='user']")},WmsHybridSearch.getChosenUsersName=function(){var a=$WC.$CUtil.convertToArray(WmsHybridSearch.getChosenUsers());return a.map(function(a){var b=$WC.$CUtil.getInnerText(a);return b.slice(1)})},WmsHybridSearch.getTitleHint=function(a){a=$WC.$CUtil.safeHTML(a);var b=WmsHybridSearch.getChosenUsersName().map(function(a){return $WC.$CUtil.safeHTML(a)}),c=b.pop(),d=b.join(", ");if(c)return b.length===0?$WC.$CUtil.getConfig("Resource").getRealValue("chat.topic.singlemember",["<span>"+a+"</span>","<span>"+c+"</span>"]):$WC.$CUtil.getConfig("Resource").getRealValue("chat.topic.multiplemember",["<span>"+a+"</span>","<span>"+d+"</span>","<span>"+c+"</span>"]);if(b.length===0)return $WC.$CUtil.getConfig("Resource").getRealValue("chat.topic.set","<span>"+a+"</span>")},WmsHybridSearch.createResultFragment=function(a,b,c,d,e,f,g,h,i,j,k){j=j||WmsHybridSearch.getCurrentModule(),f===WmsHybridSearch.constants.CHAT&&$WC.$CUtil.isChannelChid(a)&&!$WC.$CUtil.isBotChid(a)?d=WmsChannels.getChannelImageHTML(a):(f===WmsHybridSearch.constants.CONTACT&&i&&i.ISBOT&&(d=WmsBadgeImage.createUserImageHtml(a,i.PHOTO)),d=d||WmsBadgeImage.createUserImageHtml(a)),c=c||$WC.$CUtil.getConfig("Resource").getRealValue("channel.nodescription"),b=$WC.$CUtil.unescapeHTML(b);var l=e?'<span class="wms-hysearch-deschint">'+$WC.$CUtil.safeHTML(e)+"</span>":"",m=a?"data-id={{id}} ":"";m+=k?"data-oc_id={{oc_id}}":"";var n;return f===WmsHybridSearch.constants.TITLEHINT?(n='<div class="wms-hysearch-result" onclick="WmsHybridSearch.handleClick(this)" data-type="{{type}}"'+m+">"+d+'<div class="wms-hysearch-result-hint wms-truncate-ellipsis">'+WmsHybridSearch.getTitleHint(b)+"</div></div>",$WC.template.replace(n,{id:a,type:f})):f===WmsHybridSearch.constants.MESSAGEHINT?(n='<div class="wms-hysearch-result" onclick="WmsHybridSearch.handleClick(this)" data-type="{{type}}"'+m+">"+d+'<div class="wms-hysearch-result-hint wms-truncate-ellipsis">'+$WC.$CUtil.getConfig("Resource").getRealValue("hint.openchatandsendmessage","<span>"+$WC.$CUtil.safeHTML(b)+"</span>")+"</div></div>",$WC.template.replace(n,{id:a,type:f,name:b})):j===WmsHybridSearch.constants.modules.SMARTCHAT?(n='<div class="wms-hysearch-result" onclick="WmsHybridSearch.handleClick(this)" data-type="{{type}}"'+m+">"+d+'<div class="wms-hysearch-result-name wms-truncate-ellipsis">{{name}}</div><div class="wms-hysearch-result-desc wms-truncate-ellipsis">'+c+"</div>"+l+"</div>",$WC.template.replace(n,{id:a,name:b?$WC.$CUtil.unescapeHTML(b):$WC.$CUtil.unescapeHTML($WC.$CUtil.getContactName(a,b)),type:f,oc_id:k})):WmsHybridSearch.generateContactHtml(a,b,c,d,f,g,h,i)},WmsHybridSearch.generateContactHtml=function(a,b,c,d,e,f,g,h){var i="wms_menu_item",j="",k="",l="",m="",n="",o="",p="",q="",r="",s="",t="",u;f&&MyDate.formatDate(g)!==MyDate.formatDate(f)&&(j='<div class="wms_menu_item_date">'+MyDate.formatDateWithWords(f)+"</div>"),f&&(k='<span class="wms_menu_item_time" title="'+MyDate.formatDateWithWords(f)+'">'+MyDate.formatTime(f)+"</span>"),s='<div class="wms_menu_item_name wms-truncate-ellipsis" title="{{dname}}">{{dname}}</div>',!a&&h&&h.FEEDSID&&(a=h.FEEDSID,s='<div class="wms_menu_item_name" title="{{dname}}">{{dname}}</div>'),l=WmsHybridSearch.generateImageHtml(a,e,h);if(e===WmsHybridSearch.constants.CHAT){var v=WmsMainUI.getUnreadCount(a);v?m='<span style="display:block" class="wms_menu_item_count" data-unreadcount=true>'+v+"</span>":m='<span class="wms_menu_item_count" data-unreadcount=true></span>'}if(typeof WmsMainUI!="undefined")var w=WmsMainUI.getMuteStatus(a);w&&(n=' data-muted="true" '),e===WmsHybridSearch.constants.CHAT&&WmsMainUI.getZuidForPrivateChat(a)&&(o=WmsMainUI.getZuidForPrivateChat(a));if(e===WmsHybridSearch.constants.CHAT)p='<div class="wms_menu_item_msg wms-truncate-ellipsis">'+c+"</div>";else if(e===WmsHybridSearch.constants.CONTACT){if(WmsContacts.isInvitedContact(a)||WmsContacts.isInvitationPending(a))c=WmsContacts.getEmailId(a),i="wms_menu_item_invitations";p='<div class="wms_menu_item_msg wms-truncate-ellipsis" data-smsg="true" title="'+c+'">'+c+"</div>"}else p='<div class="wms_menu_item_msg wms-truncate-ellipsis" title="'+c+'">'+c+"</div>";if(e===WmsHybridSearch.constants.CONTACT||e===WmsHybridSearch.constants.ORGCONTACT)q='<div class="wms_menu_item_profile_icon wms-valign-mid-block" data-zcprofileid="'+a+'"></div>';return e===WmsHybridSearch.constants.CONTACT&&(WmsContacts.isInvitedContact(a)||WmsContacts.isInvitationPending(a))&&(r+='<div class="wms_menu_inv" data-id="{{id}}" data-dname="{{dname}}"><span data-operation="accept" title="'+$WC.$CUtil.getConfig("Resource").getRealValue("Accept")+'" class="wms_menu_invaccept">'+$WC.$CUtil.getConfig("Resource").getRealValue("Accept")+'</span><span>  |  </span><span title="'+$WC.$CUtil.getConfig("Resource").getRealValue("remind.later")+'" data-operation="reject" class="wms_menu_invreject">'+$WC.$CUtil.getConfig("Resource").getRealValue("remind.later")+"</span></div>"),t=j+'<div class="'+i+'" data-id="{{id}}" {{useridforprivatechat}} data-dname="{{dname}}" '+n+' data-type="{{type}}">'+l+s+k+p+r+m+q+"</div>",e===WmsHybridSearch.constants.CHAT&&o&&(o="data-userid="+o),u={id:a,type:e,dname:$WC.$CUtil.unescapeHTML($WC.$CUtil.getContactName(a,b)),useridforprivatechat:o},$WC.template.replace(t,u)},WmsHybridSearch.generateImageHtml=function(a,b,c,d){var e=b,f="",g="none",h;e===WmsHybridSearch.constants.CHAT&&($WC.$CUtil.isChannelChid(a)&&!$WC.$CUtil.isBotChid(a)?e=WmsHybridSearch.constants.CHANNEL:!d&&c&&c.PARTICIPANTS&&c.PARTICIPANTS.length==2&&(a=c.PARTICIPANTS[0].zuid===WebMessanger.zuid?c.PARTICIPANTS[1].zuid:c.PARTICIPANTS[0].zuid,c.PHOTO?(a="b-"+c.CHATID.split("-")[2],f='<img data-zcprofileid="'+a+'" src="'+c.PHOTO+'">'):a.indexOf("b-")!==-1&&WmsContacts.contactslist[a]?e=WmsHybridSearch.constants.BOT:e=WmsHybridSearch.constants.ORGCONTACT,WmsMainUI.setZuidForPrivateChat(c.CHATID,a)));if(e===WmsHybridSearch.constants.CONTACT||e===WmsHybridSearch.constants.ORGCONTACT||e===WmsHybridSearch.constants.BOT)e===WmsHybridSearch.constants.BOT?h=a?WmsContacts.getBotPhoto(a):"":h=a?WmsContacts.getUserPhoto(a):"",$WC.$CUtil.isImageLazyLoaded(a)?f='<img data-zcprofileid="'+a+'" src="'+h+'">':f='<div class="wms_menu_item_img wms_contacticon" data-imgid="'+a+'" data-originalsrc="'+h+'"></div>',g=WmsContacts.getStatusClassName(a);else{if(e===WmsHybridSearch.constants.CHANNEL)return WmsChannels.getChannelImageHTML(a);c&&c.FEEDSID?f='<span class="wms_badge_letter"><span class="wms_notifyicon"></span></span>':typeof c.TITLE=="string"&&c.TITLE.length&&(f='<span class="wms_badge_letter">'+WmsHybridSearch.getBadgeLetters(c.TITLE)+"</span>")}return'<span class="wms_badge_imgwrapper wms_badge_statusicon_'+g+'">'+f+"</span>"},WmsHybridSearch.createInnerSearchFragment=function(a,b,c){var d="wms-hysearch-chosentext";b==="user"&&(d+=" wms-hysearch-atmen"),b==="topic"&&(d+=" wms-hysearch-topic");var e='<span data-id="{{id}}" class="{{classname}}" onmouseenter="WmsHybridSearch.showCloseIcon(this)" onmouseleave="WmsHybridSearch.hideCloseIcon(this)" data-selectable="true" data-type={{type}}>{{name}}<span class="wms-hysearch-chosentext-closeicon" onclick="WmsHybridSearch.removeChosenText(event, this)"></span></span>';return $WC.template.replace(e,{id:c,name:a,classname:d,type:b})},WmsHybridSearch.showCloseIcon=function(a){WmsHybridSearch.resetChosenClose(),$WC.$CUtil.addClass(a,"wms-hysearch-chosentext-close")},WmsHybridSearch.hideCloseIcon=function(a){$WC.$CUtil.removeClass(a,"wms-hysearch-chosentext-close")},WmsHybridSearch.resetChosenClose=function(){var a=WmsHybridSearch.getNode("inputcontainer").getElementsByClassName("wms-hysearch-chosentext-close");if(a.length){a=$WC.$CUtil.convertToArray(a);for(var b=0;b<a.length;b++)$WC.$CUtil.removeClass(a[b],"wms-hysearch-chosentext-close")}},WmsHybridSearch.removeChosenText=function(a,b){$WC.$CUtil.removeElement(b.parentNode),WmsHybridSearch.getNextResultSet()},WmsHybridSearch.virtual_list_objs=[],WmsHybridSearch.populateContactsUsingVirtualList=function(a,b,c,d,e,f){function k(a){var b=g[a],d="",e=WmsHybridSearch.constants.modules.CONTACTMENU,f=WmsHybridSearch.getResultInfo(b._filtertype),h=b.USERID?WmsContacts.getStatusMsg(b.USERID)||b.EMAILID:"";if(b.ISBOT)d=WmsHybridSearch.createResultFragment(b.USERID,b.DNAME,$WC.$CUtil.safeHTML($WC.$CUtil.unescapeHTML(h)),b.PHOTO,f,WmsHybridSearch.constants.CONTACT,null,null,b,e);else if(b.USERID)d=WmsHybridSearch.createResultFragment(b.USERID,b.DNAME,$WC.$CUtil.safeHTML($WC.$CUtil.unescapeHTML(h)),null,f,WmsHybridSearch.constants.CONTACT,null,null,null,e);else if(b=="suggestions")d='<div class="wms_menu_subheading" data-heading="suggestions" data-show="false">'+$WC.$CUtil.getConfig("Resource").getRealValue("chat.suggestions")+"</div>";else if(b=="suggestions_heading")d='<div class="wms_menu_subheading" data-heading="suggestions" data-show="true">'+$WC.$CUtil.getConfig("Resource").getRealValue("chat.suggestions")+"</div>";else{var i='<span data-retry="true">'+$WC.$CUtil.getConfig("Resource").getRealValue("suggestions.retry")+"</span>";d='<div class="wms-suggestions-failed">'+$WC.$CUtil.getConfig("Resource").getRealValue("suggestions.failed",i)+"</div>"}var j=document.createElement("div");j.innerHTML=d;var k=j.firstChild,l;return b.USERID?WmsHybridSearch.getCurrentModule()==WmsHybridSearch.constants.modules.SMARTCHAT?l=103-c:l=77-c:l=29-c,k.className!="wms_menu_item"&&k.className!="wms-hysearch-result"&&(k=[k,l]),k}function l(a){var b=a.target?a.target.closest("[data-id]"):a;b&&WmsHybridSearch.changeHover(b)}var g=WmsHybridSearch.generateContactResults(null,!0);if($WC.$CUtil.getConfig("isOrgUser")()&&f&&f.suggestions&&g.length<10){var h=f.suggestions;if(h==="suggestion_req_failed")g.push("suggestions"),g.push("suggestions_failed");else if(h==="show_suggestions"){WmsOrgContacts.checkAndUpdateContactsList();var i=g.map(function(a){return a.USERID}),j=WmsHybridSearch.generateOrgContactResults("","",i,!0);j.length&&(g.push("suggestions"),g=g.concat(j))}else h==="suggestions_heading"&&g.push("suggestions_heading")}WmsHybridSearch.virtual_list_objs[e]&&WmsHybridSearch.virtual_list_objs[e].remove_event_listeners(),g.length&&(WmsHybridSearch.virtual_list_objs[e]=new $WC.VirtualList({w:a,h:b,itemHeight:c,totalRows:g.length,generatorFn:k,container:d,hoverFunction:l}))},WmsHybridSearch.populateFrequentContactsInSmartChat=function(){var a=WmsHybridSearch.getNode("freqcontactsdiv");$WC.$CUtil.getObjectLength(WmsContacts.contactslist)||$WC.$CUtil.getObjectLength(WmsOrgContacts.contactslist)?(a.innerHTML="",WmsHybridSearch.populateContactsUsingVirtualList(325,370,74,a,"smartchat")):a.innerHTML='<div class="wms-welcome-msg">'+WmsResource.getRealValue("contacts.welcomemessage")+"</div>"},WmsHybridSearch.populateRecentChatsInSmartChat=function(a){WmsHybridSearch.populateRecentChats(a,WmsHybridSearch.constants.modules.SMARTCHAT)},WmsHybridSearch.generatePinnedChatMenuHtml=function(){var a="",b=WmsPinnedChats.chatlist.sort($WC.$CUtil.sortBy("TITLE",!1));return b.forEach(function(b){var c=WmsHybridSearch.generateImageHtml(b.CHATID,WmsHybridSearch.constants.CHAT,b),d="",e="",f=WmsMainUI.getUnreadCount(b.CHATID);f?d='<span class="wms_cw_bar_msgcount" data-unreadcount=true style="display: block">'+f+"</span>":d='<span class="wms_cw_bar_msgcount" data-unreadcount=true></span>',WmsMainUI.getZuidForPrivateChat(b.CHATID)&&(e=" data-userid="+WmsMainUI.getZuidForPrivateChat(b.CHATID));var g='<div data-pc="true" data-type=2 data-id='+b.CHATID+e+' class="wms_menu_pinnedchats_fragment" title="{{title}}">'+c+d+"</div>",h=b.TITLE;$WC.$CUtil.isChannelChid(b.CHATID)&&(h=WmsChannels.getChannelName(b.CHATID)||h),a+=$WC.template.replace(g,{title:WebMessanger.unescapeHTML(h)})}),a},WmsHybridSearch.generateChatMenuHtml=function(a,b,c,d){var e="",f="";if(a.length>0){var g=d||"LMTIME";a.sort($WC.$CUtil.sortBy(g,!0));var h=!1,i="";b=="pinnedchats"?f=WmsHybridSearch.generatePinnedChatMenuHtml():f=WmsHybridSearch.generateRecentChatResultsHTML(a,WmsHybridSearch.constants.modules.CHATMENU,c),typeof WmsSettings!="undefined"&&WmsSettings["c"+b]=="0"&&(h=!0,i="display: none"),e='<div id="wms_menu_'+b+'" class="wms_menu_'+b+'" data-menu="'+b+'">'+'<div id="wms_menu_heading_'+b+'" class="wms_menu_subheading" data-heading='+b+" data-show="+h+">"+$WC.$CUtil.getConfig("Resource").getRealValue(b+".title")+'<span id="wms_menu_uccount_'+b+'" class="wms_menu_item_count" data-unreadcount="true"></span>'+"</div>"+'<div id="wms_menu_chatlist_'+b+'" class="wms_menu_chatlist_'+b+'" style="'+i+'">'+f+"</div>"+"</div>"}return e},WmsHybridSearch.populateUnreadChatsHtml=function(){var a=WmsRecentChats.getChatIdList(WmsPinnedChats.chatlist),b=WmsUnreadChats.chatlist.filter(function(b){return a.indexOf(b.CHATID)==-1?!0:!1});return WmsHybridSearch.generateChatMenuHtml(b,"unreadchats",!1)},WmsHybridSearch.populateRecentChats=function(a,b){var c="",d=!0;b=b||WmsHybridSearch.constants.modules.CHATMENU;var e=b===WmsHybridSearch.constants.modules.CHATMENU?"defaultresultdiv":"recentchatsdiv",f=WmsRecentChats.getChats(),g=WmsHybridSearch.getNode("recentchatsdiv",b)||WmsHybridSearch.getNode("defaultresultdiv",b);if(a===WmsConstants.REQSTATUS.FAILED||a===WmsConstants.REQSTATUS.NORESULTS)WmsHybridSearch.updateLoadingStatus(g,a,"chat",WmsRecentChats.loadPreviousChatList,b);else if(f===WmsConstants.REQSTATUS.LOADING||f===WmsConstants.REQSTATUS.NORESULTS)WmsHybridSearch.updateLoadingStatus(g,f,"chat",null,b);else if(b===WmsHybridSearch.constants.modules.CHATMENU){var h=WmsHybridSearch.generateChatMenuHtml(WmsPinnedChats.chatlist,"pinnedchats",!1),i=WmsHybridSearch.populateUnreadChatsHtml(),j=WmsHybridSearch.generateChatMenuHtml(f,"recentchats",!0);c+=i+h+j}else c+=WmsHybridSearch.generateRecentChatResultsHTML(f,b);b!==WmsHybridSearch.constants.modules.SMARTCHAT&&parseInt(WmsUnreadFeeds.count)&&(d=c?!0:!1,c=WmsHybridSearch.generateRecentChatResultsHTML(WmsUnreadFeeds.wrapObj())+c);var k=WmsHybridSearch.getNode(e,b);if(k&&c){var l=k.querySelector("[data-select]");k.innerHTML=c,$WC.$CUtil.loadOriginalImage(k);var m=l?k.querySelector('[data-id="'+l.getAttribute("data-id")+'"]'):"";m&&WmsHybridSearch.changeHover(m)}var n=WmsPinnedChats.chatlist.map(function(a){return a.CHATID});f.length&&(f=f.filter(function(a){return n.indexOf(a.CHATID)==-1?!0:!1})),c!=""&&d&&f.length>6&&WmsHybridSearch.updateLoadingStatus(WmsHybridSearch.getNode("recentchatsdiv",b),WmsConstants.REQSTATUS.LOADING,"chat",null,b),typeof WmsMainUI!="undefined"&&WmsMainUI.updateUnreadChatsCount()},WmsHybridSearch.checkScrollAndloadMoreChatlist=function(a){var b=a.target;(b.id=="wms-hysearch-rchats"||WmsSettings.crecentchats=="1")&&b.scrollTop+b.clientHeight>Math.floor(b.scrollHeight*.75)&&WmsRecentChats.loadPreviousChatList()},WmsHybridSearch.populateActiveChannels=function(){if(WmsChannels.last_fetched_time){var a=WmsChannels.getJoinedChannels($WC.$CUtil.getObjectLength(WmsChannels.list));if(a&&a.length){var b="",c;for(var d=0;d<a.length;d++)c=a[d].cd||$WC.$CUtil.getConfig("Resource").getRealValue("channel.nodescription"),b+=WmsHybridSearch.createResultFragment(a[d].chid,WmsChannels.getChannelName(a[d].chid),$WC.$CUtil.safeHTML(c),WmsChannels.getChannelImageHTML(a[d].chid),null,WmsHybridSearch.constants.CHANNEL);$WC.$CUtil.setInnerText(WmsHybridSearch.getNode("thirdcolumnheading"),$WC.$CUtil.getConfig("Resource").getRealValue("menuname.channelsandgroups")),WmsHybridSearch.getNode("thirdcolumnheading").style.visibility="visible",WmsHybridSearch.getNode("thirdcolumn").innerHTML=b}else WmsHybridSearch.getNode("thirdcolumnheading")&&$WC.$CUtil.removeElement(WmsHybridSearch.getNode("thirdcolumnheading").parentNode)}},WmsHybridSearch.populateGroups=function(){if(WmsGroups.lastupdatetime){var a=[];for(var b in WmsGroups.decodedgrouplist)WmsGroups.decodedgrouplist[b]._filtertype=WmsHybridSearch.constants.GROUP,a.push(WmsGroups.decodedgrouplist[b]);a.sort($WC.$CUtil.sortBy("NAME",!1,function(a){return a.toLowerCase()})),$WC.$CUtil.setInnerText(WmsHybridSearch.getNode("thirdcolumnheading"),$WC.$CUtil.getConfig("Resource").getRealValue("Groups")),WmsHybridSearch.getNode("thirdcolumnheading").style.visibility="visible";if(a&&a.length){var c="",d;for(var e=0;e<5&&e<a.length;e++)d=a[e].DESC||$WC.$CUtil.getConfig("Resource").getRealValue("channel.nodescription"),c+=WmsHybridSearch.createResultFragment(a[e].ID,a[e].NAME,d,null,null,WmsHybridSearch.constants.GROUP);WmsHybridSearch.getNode("thirdcolumn").innerHTML=c}else WmsHybridSearch.getNode("thirdcolumn").innerHTML='<div class="wms-hysearch-infotxt">'+$WC.$CUtil.getConfig("Resource").getRealValue("groups.none")+' <a onclick="WmsHybridSearch.hideUI();" target="_blank" href="'+WMSIAMURL+'/u/h#groups/allgroups">'+$WC.$CUtil.getConfig("Resource").getRealValue("groups.createinfo")+"</a></div>"}},WmsHybridSearch.toggleUI=$WC.$CUtil.debounce(function(){WmsHybridSearch.getNode("mainUI")===null?(typeof WmsProfileInfo!="undefined"&&WmsProfileInfo.hide(),WmsHybridSearch.showUI()):WmsHybridSearch.hideUI()},null,300,!0),WmsHybridSearch.changeHover=function(a){var b=a.getAttribute("data-type");b&&(WmsHybridSearch.resetHover(),$WC.$CUtil.setAttribute(a,"data-select",!0),$WC.$CUtil.addClass(a,"wms-hysearch-result-select"))},WmsHybridSearch.handleClick=function(a){WmsHybridSearch.handleSelection(a)},WmsHybridSearch.resetHover=function(){var a=WmsHybridSearch.getNode("resultcontainer"),b;WmsHybridSearch.getNode("searchresultdiv")&&getComputedStyle(WmsHybridSearch.getNode("searchresultdiv")).display==="block"?b=WmsHybridSearch.getNode("searchresultdiv").getElementsByClassName("wms-hysearch-result-select")[0]:b=a&&a.getElementsByClassName("wms-hysearch-result-select")[0],b&&($WC.$CUtil.removeClass(b,"wms-hysearch-result-select"),b.removeAttribute("data-select"))},WmsHybridSearch.generateSearchResults=function(a,b){function u(a,b){if(a._filtertype===b._filtertype){if(a._filtertype===WmsHybridSearch.constants.CONTACT&&b._filtertype===WmsHybridSearch.constants.CONTACT)return+b.UC- +a.UC;if(a._filtertype===WmsHybridSearch.constants.CHAT&&b._filtertype===WmsHybridSearch.constants.CHAT)return+b.LMTIME- +a.LMTIME;var c=a[t[a._filtertype]].toLowerCase(),d=b[t[b._filtertype]].toLowerCase();return c<d?-1:c>d?1:0}return s.indexOf(a._filtertype)-s.indexOf(b._filtertype)}var c=b;if(!c){var d=WmsHybridSearch.generateContactResults(a),e=d.map(function(a){return a.USERID}),f=WmsHybridSearch.generateRecentChatResults(a),g=f.map(function(a){return a.CHATID}),h=WmsHybridSearch.generateChatResults(a,!0,g),i=h.map(function(a){return a.CHATID}),j=document.getElementById("wms-fileupldwin")&&!0;c=d.concat(WmsHybridSearch.generateOrgContactResults(a,!1,e),f,h,WmsHybridSearch.generateChannelResults(a,null,j,g.concat(i)),WmsHybridSearch.generateGroupResults(a))}var k=c.filter(function(a){return a._filterweight===1?!0:!1}),l=c.filter(function(a){return a._filterweight===2?!0:!1}),m=c.filter(function(a){return a._filterweight===3?!0:!1}),n=c.filter(function(a){return a._filterweight===4?!0:!1}),o=c.filter(function(a){return a._filterweight===5?!0:!1}),p=c.filter(function(a){return a._filterweight===6?!0:!1}),q=c.filter(function(a){return a._filterweight===7?!0:!1}),r=c.filter(function(a){return a._filterweight===8?!0:!1}),s=[WmsHybridSearch.constants.CONTACT,WmsHybridSearch.constants.ORGCONTACT,WmsHybridSearch.constants.CHANNEL,WmsHybridSearch.constants.GROUP,WmsHybridSearch.constants.CHAT],t={};return t[WmsHybridSearch.constants.ORGCONTACT]="DNAME",t[WmsHybridSearch.constants.GROUP]="NAME",t[WmsHybridSearch.constants.CHANNEL]="cn",k.sort(u).concat(l.sort(u),m.sort(u),n.sort(u),o.sort(u),p.sort(u),q.sort(u),r.sort(u))},WmsHybridSearch.fetchFromServer=function(){var a=$WC.$CUtil.debounce(function(a,b,c){c=c||WmsHybridSearch.getPlainSearchText(),a===WmsHybridSearch.constants.ORGCONTACT?WmsOrgContacts.fetchFromServer(c,b):a===WmsHybridSearch.constants.CHAT?WmsChats.fetchFromServer(c,b):a===WmsHybridSearch.constants.CHANNEL&&WmsChannels.fetchFromServer(c,b)},this,300);return function(b,c,d){d=d||WmsHybridSearch.getPlainSearchText(),a(b,c,d);if(b===WmsHybridSearch.constants.ORGCONTACT)return WmsOrgContacts.isCachedRequest(d,c);if(b===WmsHybridSearch.constants.CHAT)return WmsChats.isCachedRequest(d,c);if(b===WmsHybridSearch.constants.CHANNEL)return WmsChannels.isCachedRequest(d,c)}}(),WmsHybridSearch.getResultSet=function(){var a={};return a[WmsHybridSearch.constants.ORGCONTACT]="generateOrgContactResults",a[WmsHybridSearch.constants.CHAT]="generateChatResults",a[WmsHybridSearch.constants.CHANNEL]="generateChannelResults",function(b){var c=WmsHybridSearch.getPlainSearchText();if(b==1&&document.getElementById("wms-fileupldwin"))var d=!0;if(c!==""&&b)return WmsHybridSearch[a[b]](c,!0,d)}}(),WmsHybridSearch.updateManager=function(){function d(a,b){return c[a]&&typeof c[a].seqno!="undefined"&&c[a].seqno<b.length?!0:!1}function e(a,b){return!c[a]||typeof c[a].seqno=="undefined"?!0:c[a].seqno>=b.length?!0:!1}var a=[WmsHybridSearch.constants.ORGCONTACT,WmsHybridSearch.constants.CHANNEL,WmsHybridSearch.constants.CHAT],b=[WmsHybridSearch.constants.ORGCONTACT,WmsHybridSearch.constants.CHAT],c={};return function(f,g,h,i,j){h=h||(new Date).getTime();var k=a;if(!$WC.$CUtil.getConfig("isOrgUser")()||$WC.$CUtil.getConfig("channels")=="disable")k=b;if(c[h])typeof c[h].seqno!="undefined"?(g=k[c[h].seqno],f==="update"&&d(h,k)&&c[h].seqno++):g=c[h].type;else{c[h]={},i&&(g?c[h].seqno=k.indexOf(g):(c[h].seqno=0,g=WmsHybridSearch.constants.ORGCONTACT)),c[h].type=g;if(Object.keys(c).length>50){var l=(new Date).getTime()-18e5;Object.keys(c).forEach(function(a){a<l&&delete c[a]})}}if(f==="fetch")WmsHybridSearch.fetchFromServer(g,h,j)===!1&&(j&&WmsOrgContacts.isEmptyResultReq(j.searchtext)===!1&&!j.silentload?Commands.showLoadingIcon(WindowHandler.getWinObjById(j.chid).autocompletediv,j.chid):WmsHybridSearch.updateLoadingStatus(WmsHybridSearch.getNode("searchresultdiv"),WmsConstants.REQSTATUS.LOADING,"search"));else if(f==="update"){var m=WmsHybridSearch.getResultSet(g),n;if(m&&m.length)WmsHybridSearch.updateLoadingStatus(WmsHybridSearch.getNode("searchresultdiv"),WmsConstants.REQSTATUS.SUCCESS,"search"),n=WmsHybridSearch.generateHtml(m),WmsHybridSearch.getNode("searchresultdiv").insertAdjacentHTML("beforeend",n),typeof WmsMainUI!="undefined"&&$WC.$CUtil.loadOriginalImage(WmsHybridSearch.getNode("searchresultdiv",WmsHybridSearch.getCurrentModule())),!WmsHybridSearch.getNode("searchresultdiv").getElementsByClassName("wms-hysearch-result-select").length&&WmsHybridSearch.getNode("searchresultdiv").firstChild&&WmsHybridSearch.changeHover(WmsHybridSearch.getNode("searchresultdiv").firstChild);else{var o=WmsHybridSearch.getSearchText(),p=WmsHybridSearch.getCurrentModule();$WC.Matcher.check("emailid",o,!0)&&(p===WmsHybridSearch.constants.modules.CONTACTMENU||p===WmsHybridSearch.constants.modules.SMARTCHAT)&&$WC.$CUtil.getConfig("other_orguser_chat")!="disable"&&($WC.$CUtil.removeElement(WmsHybridSearch.getNode("searchresultdiv").querySelector('[data-operation="addcontact"]')),p===WmsHybridSearch.constants.modules.CONTACTMENU?n='<div class="wms_menu_item wms_menu_addcontact" data-operation="addcontact" data-dname="{{searchtext}}" data-type="3">'+WmsHybridSearch.generateImageHtml("",WmsHybridSearch.constants.CONTACT)+'<div class="wms_menu_item_name wms-truncate-ellipsis" title="{{searchtext}}">{{searchtext}}</div><div class="wms_menu_item_msg wms-truncate-ellipsis">'+$WC.$CUtil.getConfig("Resource").getRealValue("contact.invite")+'</div><span data-addcontact="true" class="wms_menu_addicon wms-valign-mid-block"></span></div>':n='<div class="wms_hysearch_invite" data-operation="addcontact" data-email="{{searchtext}}">'+WmsHybridSearch.createResultFragment("",o,$WC.$CUtil.getConfig("Resource").getRealValue("contact.invite"),null,null,WmsHybridSearch.constants.ADDCONTACT,null,null,null,WmsHybridSearch.constants.modules.SMARTCHAT)+'<div class="wms_hysearch_addicon wms-valign-mid-block" onclick="WmsHybridSearch.handleClick(this)" data-type="'+WmsHybridSearch.constants.ADDCONTACT+'"></div></div>',n=$WC.template.replace(n,{searchtext:o}),WmsHybridSearch.getNode("searchresultdiv").insertAdjacentHTML("beforeend",n))}e(h,k)&&(WmsHybridSearch.updateLoadingStatus(WmsHybridSearch.getNode("searchresultdiv"),WmsConstants.REQSTATUS.SUCCESS,"search"),WmsHybridSearch.getNode("searchresultdiv")&&WmsHybridSearch.getNode("searchresultdiv").children.length===0&&WmsHybridSearch.getSearchText()&&WmsHybridSearch.updateLoadingStatus(WmsHybridSearch.getNode("searchresultdiv"),WmsConstants.REQSTATUS.NORESULTS,"search")),d(h,k)&&WmsHybridSearch.getNode("searchresultdiv")&&WmsHybridSearch.getNode("searchresultdiv").children.length<10&&WmsHybridSearch.updateManager("fetch",null,h)}else f==="failureupdate"&&WmsHybridSearch.getSearchText()&&(WmsHybridSearch.updateLoadingStatus(WmsHybridSearch.getNode("searchresultdiv"),WmsConstants.REQSTATUS.FAILED,"search",WmsHybridSearch.invokeRetry),WmsHybridSearch.getNode("loadingstatus").setAttribute("data-reqid",h))}}(),WmsHybridSearch.invokeRetry=function(){WmsHybridSearch.updateManager("fetch",null,WmsHybridSearch.getNode("loadingstatus").getAttribute("data-reqid"))},WmsHybridSearch.generateContactResults=function(a,b){var c,d=[],e=[],f=0;if(b){for(f=0;f<WmsContacts.invitedcontactslist.length;f++){e.push(WmsContacts.invitedcontactslist[f]);var g=WmsContacts.contactslist[WmsContacts.invitedcontactslist[f]];g&&d.push(g)}c=WmsHybridSearch.filter("DNAME","",WmsContacts.contactslist,null,e,"USERID","EMAILID")}else{var h=WmsHybridSearch.getNode("inputcontainer")&&WmsHybridSearch.getNode("inputcontainer").querySelectorAll("[data-type='user']");if(h&&h.length)for(f=0;f<h.length;f++)e.push(h[f].getAttribute("data-id"));c=WmsHybridSearch.filter("DNAME",a,WmsContacts.contactslist,10,e,"USERID","EMAILID")}return c=d.concat(c),c.map(function(a){return a._filtertype=WmsHybridSearch.constants.CONTACT,a})},WmsHybridSearch.generateOrgContactResults=function(a,b,c,d){if(!a&&!d)return[];c=c||[];if(b){var e=$WC.$CUtil.convertToArray(WmsHybridSearch.getNode("inputcontainer").querySelectorAll("[data-type='user']"));e=e.concat($WC.$CUtil.convertToArray(WmsHybridSearch.getNode("searchresultdiv").querySelectorAll("[data-type='"+WmsHybridSearch.constants.CONTACT+"'],[data-type='"+WmsHybridSearch.constants.ORGCONTACT+"']")));var f=0;if(e.length)for(f=0;f<e.length;f++)c.push(e[f].getAttribute("data-id"))}var g=WmsHybridSearch.filter("DNAME",a,WmsOrgContacts.contactslist,10,c,"USERID","EMAILID");return g.map(function(a){return a._filtertype=WmsHybridSearch.constants.ORGCONTACT,a})},WmsHybridSearch.generateGroupResults=function(a,b){var c=b?null:10,d=WmsHybridSearch.filter("NAME",a,WmsGroups.decodedgrouplist,c,null,null,null,"NAME");return d.map(function(a){return a._filtertype=WmsHybridSearch.constants.GROUP,a})},WmsHybridSearch.generateChannelResults=function(a,b,c,d){d=d||[];var e=[],f=c?null:10,g=WmsHybridSearch.getSearchText(),h;g&&(g.startsWith("@")?h="@":g.startsWith("#")&&(h="#"),g.indexOf("@")>-1&&g.indexOf("#")>-1&&(h="@#"));if(b){var i=$WC.$CUtil.convertToArray(WmsHybridSearch.getNode("searchresultdiv").querySelectorAll("[data-type='"+WmsHybridSearch.constants.CHANNEL+"'],[data-type='"+WmsHybridSearch.constants.CHAT+"']")),j=0;if(i.length)for(j=0;j<i.length;j++)d.push(i[j].getAttribute("data-id"))}if(c)e=WmsChannels.getList(a,!0);else if(h==="@")e=WmsChannels.getListByTeamName(a);else if(h==="#")e=WmsChannels.getListByChannelName(a);else if(h==="@#"){var k,l,m=a.split(/@|#/);g.startsWith("@")?(k=m[0],l=m[1]):g.startsWith("#")&&(k=m[1],l=m[0]),e=WmsChannels.getListByTeam_ChannelName(k,l),a=l!==undefined?l:""}else e=WmsChannels.getList(a);var n=WmsHybridSearch.filter("cn",a,e,f,d,"chid","_teamname","lmtime");return n.map(function(a){return a._filtertype=WmsHybridSearch.constants.CHANNEL,a})},WmsHybridSearch.generateChatResults=function(a,b,c){c=c||[];if(b){var d=$WC.$CUtil.convertToArray(WmsHybridSearch.getNode("searchresultdiv").querySelectorAll("[data-type='"+WmsHybridSearch.constants.CHAT+"']")),e=0;if(d.length)for(e=0;e<d.length;e++)c.push(d[e].getAttribute("data-id"))}var f=WmsHybridSearch.filter("TITLE",a,WmsChats.getList(),10,c,"CHATID");return f.sort($WC.$CUtil.sortBy("LMTIME",!0)),f.map(function(a){return a._filtertype=WmsHybridSearch.constants.CHAT,a})},WmsHybridSearch.generateFreqContactResults=function(){var a=WmsContacts.getSortedContacts("UC",!0,null,WmsContacts.contactslist.length),b="";if(a.length===0)b='<span class="wms-hysearch-infotxt">'+$WC.$CUtil.getConfig("Resource").getRealValue("contacts.frequent.none")+"</span>";else for(var c=0;c<a.length;c++)a[c].ISBOT?b+=WmsHybridSearch.createResultFragment(a[c].USERID,a[c].DNAME,a[c].EMAILID,null,null,WmsHybridSearch.constants.CONTACT,null,null,a[c]):b+=WmsHybridSearch.createResultFragment(a[c].USERID,a[c].DNAME,a[c].EMAILID,null,null,WmsHybridSearch.constants.CONTACT);return b},WmsHybridSearch.generateRecentChatResultsHTML=function(a,b,c){var d="",e="",f;b!==WmsHybridSearch.constants.modules.SMARTCHAT&&c&&(a=WmsRecentChats.updateWithUnreadChats(a));if(a&&a.length){if(c&&b!==WmsHybridSearch.constants.modules.SMARTCHAT){var g=WmsPinnedChats.chatlist.concat(WmsUnreadChats.chatlist),h=g.map(function(a){return a.CHATID});a=a.filter(function(a){return h.indexOf(a.CHATID)==-1?!0:!1})}f=a}else f=WmsHybridSearch.generateRecentChatResults();for(var i=0;i<f.length;i++){var j=f[i].TITLE;$WC.$CUtil.isChannelChid(f[i].CHATID)&&(j=WmsChannels.getChannelName(f[i].CHATID)||j),d+=WmsHybridSearch.createResultFragment(f[i].CHATID,j,WmsHybridSearch.createLastMsgInfoHtml(f[i]),WmsHybridSearch.createImageCollageHtml(f[i]),null,WmsHybridSearch.constants.CHAT,f[i].LMTIME,e,f[i],b),e=f[i].LMTIME}return d},WmsHybridSearch.generateRecentChatResults=function(a){var b=WmsHybridSearch.filter("TITLE",a,WmsRecentChats.getList(a),10,[],"CHATID");return b.sort($WC.$CUtil.sortBy("LMTIME",!0)),b.map(function(a){return a._filtertype=WmsHybridSearch.constants.CHAT,a})},WmsHybridSearch.getResultInfo=function(a,b){if(a===WmsHybridSearch.constants.CONTACT||a===WmsHybridSearch.constants.ORGCONTACT)return b?$WC.$CUtil.getConfig("Resource").getRealValue("topic.adduser"):WmsHybridSearch.getSearchText().startsWith("@")?$WC.$CUtil.getConfig("Resource").getRealValue("topic.addusertocreate"):$WC.$CUtil.getConfig("Resource").getRealValue("chat.user");if(a===WmsHybridSearch.constants.GROUP)return $WC.$CUtil.getConfig("Resource").getRealValue("chat.group");if(a===WmsHybridSearch.constants.CHANNEL)return $WC.$CUtil.getConfig("Resource").getRealValue("channel.join");if(a===WmsHybridSearch.constants.CHAT)return $WC.$CUtil.getConfig("Resource").getRealValue("chat.continue")},WmsHybridSearch.generateHtml=function(a,b){var c="",d,e,f=WmsHybridSearch.getNode("inputcontainer")&&WmsHybridSearch.getNode("inputcontainer").querySelector("[data-type='topic']");for(var g=0;g<a.length;g++){d=a[g],e=WmsHybridSearch.getResultInfo(d._filtertype,f);if(d._filtertype===WmsHybridSearch.constants.CONTACT)d.ISBOT?c+=WmsHybridSearch.createResultFragment(d.USERID,d.DNAME,$WC.$CUtil.safeHTML($WC.$CUtil.unescapeHTML(WmsContacts.getStatusMsg(d.USERID))),d.PHOTO,e,WmsHybridSearch.constants.CONTACT,null,null,d,b):d.id?c+=WmsHybridSearch.createResultFragment(d.id,d.name,$WC.$CUtil.safeHTML($WC.$CUtil.unescapeHTML(d.statusMsg)),d.photo,null,WmsHybridSearch.constants.CONTACT,null,null,d,b):c+=WmsHybridSearch.createResultFragment(d.USERID,d.DNAME,$WC.$CUtil.safeHTML($WC.$CUtil.unescapeHTML(WmsContacts.getStatusMsg(d.USERID))),null,e,WmsHybridSearch.constants.CONTACT,null,null,null,b);else if(d._filtertype===WmsHybridSearch.constants.ORGCONTACT)c+=WmsHybridSearch.createResultFragment(d.USERID,d.DNAME,d.EMAILID,null,e,WmsHybridSearch.constants.ORGCONTACT,null,null,null,b);else if(d._filtertype===WmsHybridSearch.constants.GROUP)c+=WmsHybridSearch.createResultFragment(d.ID,d.NAME,d.DESC,null,e,WmsHybridSearch.constants.GROUP,null,null,null,b);else if(d._filtertype===WmsHybridSearch.constants.CHANNEL)e=WmsChannels.isJoinedChannel(d.chid)?WmsHybridSearch.getResultInfo(WmsHybridSearch.constants.CHAT,f):e,c+=WmsHybridSearch.createResultFragment(d.chid,WmsChannels.getChannelName(d.chid),$WC.$CUtil.safeHTML(d.cd),WmsChannels.getChannelImageHTML(d.chid),e,WmsHybridSearch.constants.CHANNEL,null,null,null,b,d.oc_id);else if(d._filtertype===WmsHybridSearch.constants.CHAT){var h=d.TITLE;$WC.$CUtil.isChannelChid(d.CHATID)&&(h=WmsChannels.getChannelName(d.CHATID)||h),c+=WmsHybridSearch.createResultFragment(d.CHATID,h,WmsHybridSearch.createLastMsgInfoHtml(d),WmsHybridSearch.createImageCollageHtml(d),e,WmsHybridSearch.constants.CHAT,d.LMTIME,"",d,b)}}return c},WmsHybridSearch.handleEvent=function(){function a(a){var b=WmsHybridSearch.getNode("resultcontainer"),c,d,e,f;getComputedStyle(WmsHybridSearch.getNode("searchresultdiv")).display==="block"?f=WmsHybridSearch.getNode("searchresultdiv").getElementsByClassName("wms-hysearch-result-select")[0]:f=WmsHybridSearch.getNode("defaultresultdiv").getElementsByClassName("wms-hysearch-result-select")[0];var g=WmsHybridSearch.getNode("inputcontainer").querySelectorAll("[data-type='user'],[data-type='topic']");if(!g.length||a!==WmsConstants.KEYCODES.LEFT&&a!==WmsConstants.KEYCODES.RIGHT){if(f){WmsHybridSearch.resetHover();if(a===WmsConstants.KEYCODES.LEFT||a===WmsConstants.KEYCODES.RIGHT)WmsHybridSearch.getCurrentModule()===WmsHybridSearch.constants.modules.SMARTCHAT?(d=b.firstChild,f&&(d=f.parentNode.parentNode),e=$WC.$CUtil.getConditionalNextNode(d,a,"data-selectable"),e=e.querySelector("[data-resset]"),c=e.querySelector("[data-id]")):c=f;else if(a===WmsConstants.KEYCODES.UP||a===WmsConstants.KEYCODES.DOWN)if(WmsHybridSearch.getCurrentModule()!==WmsHybridSearch.constants.modules.SMARTCHAT&&WmsHybridSearch.getCurrentModule()!==WmsHybridSearch.constants.modules.CONTACTMENU&&WmsHybridSearch.getCurrentModule()!==WmsHybridSearch.constants.modules.CHATMENU||!(f==f.parentNode.querySelector("[data-id]")&&a===WmsConstants.KEYCODES.UP||f==f.parentNode.lastChild&&a===WmsConstants.KEYCODES.DOWN))c=$WC.$CUtil.getConditionalNextNode(f,a,"data-type");else{var j=f.closest("[data-menu]");if(a===WmsConstants.KEYCODES.UP){var k=j&&j.previousSibling;k&&k.id==="wms_menu_pinnedchats"&&(k=k.previousSibling);var l=k&&k.querySelectorAll("[data-type]");c=l&&l[l.length-1]||f}else{var m=j&&j.nextSibling;m&&m.id==="wms_menu_pinnedchats"&&(m=m.nextSibling),c=m&&m.querySelector("[data-type]")||f}}c&&$WC.$CUtil.bringElemToView(c,a)}else WmsHybridSearch.getCurrentModule()===WmsHybridSearch.constants.modules.SMARTCHAT?getComputedStyle(WmsHybridSearch.getNode("searchresultdiv")).display==="block"?c=WmsHybridSearch.getNode("searchresultdiv").firstChild:c=b.firstChild.getElementsByClassName("wms-hysearch-result")[0]:getComputedStyle(WmsHybridSearch.getNode("searchresultdiv")).display==="block"?c=WmsHybridSearch.getNode("searchresultdiv").querySelector("[data-type]"):c=WmsHybridSearch.getNode("defaultresultdiv").querySelector('[data-type][class="wms_menu_item"]');c&&WmsHybridSearch.changeHover(c)}else{var h=WmsHybridSearch.getNode("inputcontainer").querySelector("[data-selected='true']");if(h){WmsHybridSearch.resetChosenClose(),h.setAttribute("data-selected","false");var i=$WC.$CUtil.getConditionalNextNode(h,a,"data-selectable");i.setAttribute("data-selected","true"),h.nodeName==="INPUT"&&(h.blur(),WmsHybridSearch.getNode("fakeinput").focus()),i.nodeName!=="INPUT"?WmsHybridSearch.showCloseIcon(i):i.focus(),$WC.$CUtil.bringElemToView(i,a,!0)}}}return function(b){if(!$WC.$CUtil.isEmptyString(WmsHybridSearch.getSearchText())||b.keyCode!==WmsConstants.KEYCODES.LEFT&&b.keyCode!==WmsConstants.KEYCODES.RIGHT){if(b.keyCode===WmsConstants.KEYCODES.UP||b.keyCode===WmsConstants.KEYCODES.DOWN)a(b.keyCode);else if(WmsHybridSearch.resshowntext===""||WmsHybridSearch.resshowntext!==WmsHybridSearch.getSearchText()||b.keyCode===WmsConstants.KEYCODES.TAB||b.keyCode===WmsConstants.KEYCODES.ENTER||b.keyCode===WmsConstants.KEYCODES.BACKSPACE)WmsHybridSearch.resshowntext=WmsHybridSearch.getSearchText(),WmsHybridSearch.parseTextInput(b.keyCode)}else a(b.keyCode)}}(),WmsHybridSearch.removesearchpart=!1,WmsHybridSearch.handleKeyDown=function(a){WmsHybridSearch.getSearchText()===""&&(WmsHybridSearch.removesearchpart=!0),$WC.$CUtil.preventHandlingTabUpDownEnter(a)},WmsHybridSearch.getPlainSearchText=function(){var a=WmsHybridSearch.getSearchText();return a=a&&(a.startsWith("@")||a.startsWith("#"))?a.slice(1):a,a},WmsHybridSearch.getSearchText=function(){var a=WmsHybridSearch.getNode("inputdiv"),b=a&&(a.value&&a.value.trim()||a.textContent.trim());return b||""},WmsHybridSearch.parseTextInput=function(a){var b=WmsHybridSearch.getSearchText();if(a===WmsConstants.KEYCODES.BACKSPACE&&$WC.$CUtil.isEmptyString(WmsHybridSearch.getSearchText())){var c=WmsHybridSearch.getNode("inputcontainer").getElementsByClassName("wms-hysearch-chosentext-close");if(c.length===1)$WC.$CUtil.removeElement(c[0]),WmsHybridSearch.focusInput(),WmsHybridSearch.getNode("inputdiv").setAttribute("data-selected","true");else if(WmsHybridSearch.removesearchpart===!0){WmsHybridSearch.removesearchpart=!1,WmsHybridSearch.getNode("inputdiv").setAttribute("data-selected","false");var d=WmsHybridSearch.getNode("inputcontainer").querySelectorAll("[data-type]");d.length&&(d[d.length-1].setAttribute("data-selected",!0),$WC.$CUtil.addClass(d[d.length-1],"wms-hysearch-chosentext-close"))}}a===WmsConstants.KEYCODES.ENTER||a===WmsConstants.KEYCODES.TAB&&WmsHybridSearch.getCurrentModule()===WmsHybridSearch.constants.modules.SMARTCHAT?WmsHybridSearch.handleSelection():b?(WmsHybridSearch.getCurrentModule()===WmsHybridSearch.constants.modules.SMARTCHAT&&(WmsHybridSearch.removesearchpart=!1,WmsHybridSearch.resetChosenClose()),WmsHybridSearch.getNode("defaultresultdiv").style.display="none",WmsHybridSearch.getNode("searchresultdiv").style.display="block",typeof WmsMainUI!="undefined"&&WmsMainUI.updateLoadingForPinnedChats(!1),WmsHybridSearch.getNextResultSet(),WmsHybridSearch.getNode("searchresultdiv").firstChild&&WmsHybridSearch.changeHover(WmsHybridSearch.getNode("searchresultdiv").firstChild)):WmsHybridSearch.getNextResultSet()},WmsHybridSearch.handleSelection=function(a){var b=WmsHybridSearch.getSearchText(),c;a||(getComputedStyle(WmsHybridSearch.getNode("searchresultdiv")).display==="block"?a=WmsHybridSearch.getNode("searchresultdiv").getElementsByClassName("wms-hysearch-result-select")[0]:a=WmsHybridSearch.getNode("defaultresultdiv").getElementsByClassName("wms-hysearch-result-select")[0]);var d=a&&+a.getAttribute("data-type");if(a&&a.getAttribute("data-id")==="wms_menu_feedsnotify")ZMSGUI.launchHistory();else if(WmsHybridSearch.getCurrentModule()===WmsHybridSearch.constants.modules.SMARTCHAT){var e=WmsHybridSearch.getNode("inputcontainer").querySelector("[data-type='topic']");if(a&&a.getAttribute("data-retry")==="true")WmsHybridSearch.invokeRetry();else if(d===WmsHybridSearch.constants.CHAT||d===WmsHybridSearch.constants.CHANNEL)WmsHybridSearch.parseAndOpenChat(a,WmsHybridSearch.constants.modules.SMARTCHAT);else if(b.startsWith("#")&&WmsHybridSearch.getChosenUsers().length==1||e&&WmsHybridSearch.getChosenUsers().length==1&&!b.startsWith("@"))WmsHybridSearch.showInfoMessage($WC.$CUtil.getConfig("Resource").getRealValue("Error"),$WC.$CUtil.getConfig("Resource").getRealValue("topic.not.allowed"));else if(a&&b.startsWith("@")){var f=a.getElementsByClassName("wms-hysearch-result-name")[0];f=$WC.$CUtil.getInnerText(f),c=a.getAttribute("data-id"),WmsHybridSearch.getNode("inputdiv").insertAdjacentHTML("beforebegin",WmsHybridSearch.createInnerSearchFragment("@"+f,"user",c)),WmsHybridSearch.getNode("inputdiv").value="",WmsHybridSearch.getNode("inputdiv").focus(),WmsHybridSearch.resshowntext="",WmsHybridSearch.getNextResultSet()}else if(e&&b.startsWith("#"))WmsHybridSearch.showInfoMessage($WC.$CUtil.getConfig("Resource").getRealValue("Error"),$WC.$CUtil.getConfig("Resource").getRealValue("topic.alreadyselected"));else if(e&&WmsHybridSearch.getChosenUsers().length===0)WmsHybridSearch.showInfoMessage($WC.$CUtil.getConfig("Resource").getRealValue("Error"),$WC.$CUtil.getConfig("Resource").getRealValue("topic.nouser"));else if(!e&&b.startsWith("#")){var g=WmsHybridSearch.getNode("inputdiv").value;WmsHybridSearch.getNode("inputdiv").insertAdjacentHTML("beforebegin",WmsHybridSearch.createInnerSearchFragment(g,"topic")),WmsHybridSearch.getNode("inputdiv").value="",WmsHybridSearch.getNode("inputdiv").focus(),WmsHybridSearch.resshowntext="",WmsHybridSearch.getNextResultSet()}else a&&WmsContacts.isInvitedContact(a.getAttribute("data-id"))?(WmsHybridSearch.hideUI(),typeof WmsMainUI!="undefined"&&WmsMainUI.showPendingInvitations()):WmsHybridSearch.parseAndOpenChat(a,WmsHybridSearch.constants.modules.SMARTCHAT)}else if(a&&a.getAttribute("data-retry")==="true")WmsHybridSearch.invokeRetry();else{c=a.getAttribute("data-id");var h=!1;$WC.$CUtil.getConfig("customContacts")&&(h=WmsImplHandler.invokeSynchronously($WC.$CUtil.getConfig("customContacts").customContactClick,c,a)),!h&&!WmsContacts.isInvitedContact(c)&&WmsHybridSearch.parseAndOpenChat(a)}WmsHybridSearch.getNode("inputdiv")&&$WC.$CUtil.bringElemToView(WmsHybridSearch.getNode("inputdiv"),WmsConstants.KEYCODES.RIGHT,!0)},WmsHybridSearch.parseAndOpenChat=function(a,b){var c=WmsHybridSearch.getNode("inputcontainer")&&WmsHybridSearch.getNode("inputcontainer").querySelectorAll("[data-type='user']")||[],d=WmsHybridSearch.getNode("inputcontainer")&&WmsHybridSearch.getNode("inputcontainer").querySelector("[data-type='topic']"),e,f,g,h,i,j,k,l,m,n=[];c.length&&(f=$WC.$CUtil.convertToArray(c).map(function(a){return a.getAttribute("data-id")})),d&&(g=$WC.$CUtil.getInnerText(d).slice(1)),f&&(k=WmsHybridSearch.constants.CONTACT,j=f.join(","),f.length>1&&!g&&(f.forEach(function(a){n.push({zuid:a})}),g=WmsHybridSearch.createChatTitle(n)),e=WmsHybridSearch.getSearchText(),WmsHybridSearch.tempmsgdetails.push(e));if(a)if(+a.getAttribute("data-type")===WmsHybridSearch.constants.CONTACT||+a.getAttribute("data-type")===WmsHybridSearch.constants.ORGCONTACT)j=a.getAttribute("data-id"),k=WmsHybridSearch.constants.CONTACT;else if(+a.getAttribute("data-type")===WmsHybridSearch.constants.GROUP)l=a.getAttribute("data-id"),k=WmsHybridSearch.constants.GROUP;else if(+a.getAttribute("data-type")===WmsHybridSearch.constants.CHAT)h=a.getAttribute("data-id"),k=WmsHybridSearch.constants.CHAT;else if(+a.getAttribute("data-type")===WmsHybridSearch.constants.CHANNEL)i=a.getAttribute("data-id"),m=a.getAttribute("data-oc_id"),k=WmsHybridSearch.constants.CHANNEL;else if(+a.getAttribute("data-type")===WmsHybridSearch.constants.ADDCONTACT){var o=a.closest("[data-operation]");k=WmsHybridSearch.constants.ADDCONTACT}k?(typeof WmsMainUI!="undefined"&&WmsMainUI.scheduleAutoFocus(),WmsHybridSearch.hideUI(),$WC.$CUtil.getConfig("adhocchats")=="disable"&&f&&f.length>1||WmsHybridSearch.checkAndOpenChat(k,j,g,e,l,i,h,o,b,m),typeof WmsMainUI!="undefined"&&WmsMainUI.resetToDefaultUI()):WmsHybridSearch.showInfoMessage($WC.$CUtil.getConfig("Resource").getRealValue("Error"),$WC.$CUtil.getConfig("Resource").getRealValue("selection.none"))},WmsHybridSearch.checkAndOpenChat=function(a,b,c,d,e,f,g,h,i,j){var k,l=WmsContacts.contactslist[b]&&WmsContacts.contactslist[b].CHID;g=g||WebMessanger.ucmap[b]||WebMessanger.ucmap[e]||f,g&&WMSUI.handleChatExist(g),i=i==WmsHybridSearch.constants.modules.SMARTCHAT?"smartchat":"mainui",l?(WMSUI.handleChatExist(l),WebMessanger.join(l)):a===WmsHybridSearch.constants.CONTACT&&(c&&(k=!0),!k&&g&&d?Chat.isExists(g)?Message.send(g,d):(WmsChatCache.remove(g),WebMessanger.openUserChat(b,k,c,d,i)):WebMessanger.openUserChat(b,k,c,d,i));if(a===WmsHybridSearch.constants.GROUP)WebMessanger.openGroupChat(e,c,d,i);else if(a===WmsHybridSearch.constants.CHAT&&g)!$WC.$CUtil.isChannelChid(g)&&(WmsRecentChats.checkPresence(g,WmsUnreadChats.chatlist)||WmsRecentChats.checkPresence(g,WmsUnreadChats.channellist))?WebMessanger.continueChat(g):WebMessanger.attachSession(g,i);else if(a===WmsHybridSearch.constants.CHANNEL&&f)if(WmsChannels.isJoinedChannel(f)===!1){var m='<div class="wms-dialog-txtcont">'+$WC.$CUtil.safeHTML($WC.$CUtil.getConfig("Resource").getRealValue("channel.confirmjoin",WmsChannels.get(f).cn))+"</div>",n={bodyhtml:m,focusbutton:2,operations:[{name:$WC.$CUtil.getConfig("Resource").getRealValue("Join"),action:function(){WmsMainUI.scheduleAutoFocus(),WebMessanger.joinChannel(f),WmsDialog.removeModal()}},{name:$WC.$CUtil.getConfig("Resource").getRealValue("Cancel"),classname:"wms-dialog-rejectbtn",action:function(){WmsDialog.removeModal()}}]};WmsDialog.showModal(n)}else WebMessanger.attachSession(f,i);else if(a===WmsHybridSearch.constants.ADDCONTACT){var o=h.getAttribute("data-email");WmsHybridSearch.inviteMember(o)}},WmsHybridSearch.filter=function(a,b,c,d,e,f,g,h){function l(a){var b=k.filter(a);return h=h||"UC",h==="UC"||h==="lmtime"?b.sort($WC.$CUtil.sortBy(h,!0,Number)):b.sort($WC.$CUtil.sortBy(h,!1,function(a){return a.toLowerCase()})),b.forEach(function(a){k.splice(k.indexOf(a),1)}),b}function u(a,b){return a.map(function(a){a._filterweight=b})}b=b.toLowerCase();var i=[];if($WC.$CUtil.isArray(c))i=c;else for(var j in c)i.push(c[j]);e&&e.forEach(function(a){i=i.filter(function(b){return b[f]!==a?!0:!1})});var k=i.slice(0),m=l(function(c){var d=c[a];d&&d.startsWith("#")&&(d=d.substring(1));if(d&&d.toLowerCase().startsWith(b))return!0}),n=l(function(a){if(a[g]&&a[g].toLowerCase()===b)return!0}),o=l(function(a){if(a[g]&&a[g].toLowerCase().startsWith(b))return!0}),p=l(function(c){if(c[a]&&c[a].toLowerCase().indexOf(" "+b)!==-1)return!0}),q=l(function(a){if(a[g]&&a[g].toLowerCase().indexOf(" "+b)!==-1)return!0}),r=l(function(c){if(c[a]&&c[a].toLowerCase()===b)return!0}),s=l(function(c){var d=/[-~!@%&[\]/{}<>()*+?.,^$|:;'"#\s]/g,e=c[a];if(e){e=e.toLowerCase();var f=b.toLowerCase().split(d),g=f.join(".*");if(e.search(new RegExp(g))!==-1)return!0}}),t=l(function(a){var c=/[-~!@%&[\]/{}<>()*+?.,^$|:;'"#\s]/g,d=a[g];if(d){d=d.toLowerCase();var e=b.toLowerCase().split(c),f=e.join(".*");if(d.search(new RegExp(f))!==-1)return!0}});u(m,1),u(n,2),u(p,3),u(r,4),u(s,5),u(o,6),u(q,7),u(t,8);var v=m.concat(n,p,r,s,o,q,t);return d?v.slice(0,d):v.slice(0)},WmsHybridSearch.createChatTitle=function(a){var b=a.length,c;return b>1&&(c=$WC.$CUtil.getContactName(a[0].zuid,a[0].dname)+", "+$WC.$CUtil.getContactName(a[1].zuid,a[1].dname)+" & ",b===2?c+=WebMessanger.getNickName():b>2&&(c+=b-1+" "+$WC.$CUtil.getConfig("Resource").getRealValue("more"))),c},WmsHybridSearch.getNextResultSet=function(a){var b=a&&a.inpresultset||WmsHybridSearch.decideResultSet(),c=WmsHybridSearch.getNode("searchresultdiv"),d=a&&a.searchtext||WmsHybridSearch.getSearchText(),e;if(b===WmsHybridSearch.constants.EMPTY)c.innerHTML="";else if(b===WmsHybridSearch.constants.EMPTYUSERHINT)c.innerHTML="",WmsHybridSearch.setPlaceHolderHint($WC.$CUtil.getConfig("Resource").getRealValue("hint.chooseuser"));else if(b===WmsHybridSearch.constants.EMPTYTITLEHINT)c.innerHTML="",WmsHybridSearch.setPlaceHolderHint($WC.$CUtil.getConfig("Resource").getRealValue("hint.choosetopic"));else if(b===WmsHybridSearch.constants.EMPTYMSGHINT)c.innerHTML="",WmsHybridSearch.setPlaceHolderHint($WC.$CUtil.getConfig("Resource").getRealValue("hint.sendmessage"));else if(b===WmsHybridSearch.constants.FREQCONTACTS)c.innerHTML=WmsHybridSearch.generateHtml(WmsHybridSearch.generateFreqContactResults());else if(b===WmsHybridSearch.constants.USERLIST||b===WmsHybridSearch.constants.USER_CHANNELLIST){d=a&&a.searchtext||WmsHybridSearch.getPlainSearchText(),e=[],b===WmsHybridSearch.constants.USER_CHANNELLIST&&(e=WmsHybridSearch.generateChannelResults(d,null,null,null));var f=[];if($WC.$CUtil.getConfig("customContacts"))f=WmsHybridSearch.generateCustomContactResults(d),c.innerHTML=WmsHybridSearch.generateCustomContactsListHtml(f);else{f=WmsHybridSearch.generateContactResults(d);var g=f.map(function(a){return a.USERID}),h=f.concat(WmsHybridSearch.generateOrgContactResults(d,!1,g));if(!a||!a.inpresultset)c.innerHTML=WmsHybridSearch.generateHtml(h.concat(e));(h.length<10||$WC.Matcher.check("emailid",d,!0))&&WmsHybridSearch.updateManager("fetch",WmsHybridSearch.constants.ORGCONTACT,null,null,a)}}else if(b===WmsHybridSearch.constants.TITLEHINT||b===WmsHybridSearch.constants.CHANNELLIST){d=WmsHybridSearch.getPlainSearchText();if(d!==""){e=WmsHybridSearch.generateChannelResults(d),WmsHybridSearch.getCurrentModule()===WmsHybridSearch.constants.modules.SMARTCHAT&&b===WmsHybridSearch.constants.TITLEHINT?c.innerHTML=WmsHybridSearch.createResultFragment("",d,"","<span></span>",null,WmsHybridSearch.constants.TITLEHINT)+WmsHybridSearch.generateHtml(e):c.innerHTML=WmsHybridSearch.generateHtml(e);if(e.length<10){var i=b===WmsHybridSearch.constants.TITLEHINT?!0:!1;WmsHybridSearch.updateManager("fetch",WmsHybridSearch.constants.CHANNEL,null,i)}}else c.innerHTML=WmsHybridSearch.generateHtml(WmsHybridSearch.generateChannelResults("",null,!0))}else if(b===WmsHybridSearch.constants.MESSAGEHINT)c.innerHTML=WmsHybridSearch.createResultFragment("",d,"","<span></span>","",WmsHybridSearch.constants.MESSAGEHINT);else if(b===WmsHybridSearch.constants.GENERICLIST){c.innerHTML="";var j=WmsHybridSearch.generateSearchResults(d);c.innerHTML=WmsHybridSearch.generateHtml(j),(j.length<10||$WC.Matcher.check("emailid",d,!0))&&WmsHybridSearch.updateManager("fetch",null,null,!0)}else b===WmsHybridSearch.constants.DEFAULTRESULT&&(WmsHybridSearch.showRotationalHint(),WmsHybridSearch.getCurrentModule()===WmsHybridSearch.constants.modules.SMARTCHAT?WmsHybridSearch.getNode("defaultresultdiv").style.display="table":WmsHybridSearch.getNode("defaultresultdiv").style.display="block",c.style.display="none")},WmsHybridSearch.updatePresence=function(a){var b=document.getElementById("wms_menu_listcontainer");if(b){var c=b.querySelectorAll('[data-id="'+a+'"],[data-userid="'+a+'"]'),d=$WC.$CUtil.unescapeHTML(WmsContacts.getStatusMsg(a));c=$WC.$CUtil.convertToArray(c),c.forEach(function(b){b.firstChild.className="wms_badge_imgwrapper wms_badge_statusicon_"+WmsContacts.getStatusClassName(a),$WC.$CUtil.setInnerText(b.querySelector("[data-smsg]"),d),$WC.$CUtil.setAttribute(b.querySelector("[data-smsg]"),"title",d)})}},WmsHybridSearch.populateContactListInMainUI=function(a,b){if(WmsMainUI.decideRepopulate("contactlist")||a){var c=WmsHybridSearch.getNode("defaultresultdiv",WmsHybridSearch.constants.modules.CONTACTMENU);if($WC.$CUtil.getObjectLength(WmsContacts.contactslist)||$WC.$CUtil.getObjectLength(WmsOrgContacts.contactslist))c.innerHTML="",WmsHybridSearch.populateContactsUsingVirtualList(238,293,54,c,"mainui",b);$WC.$CUtil.loadOriginalImage(WmsMainUI.defaultcontactlist),WmsMainUI.setRePopulateStatus("contactlist",!1)}},WmsHybridSearch.populateCustomContactListInMainUI=function(){var a=WmsHybridSearch.getNode("defaultresultdiv",WmsHybridSearch.constants.modules.CONTACTMENU),b=WmsHybridSearch.generateCustomContactResults(null,!0);if($WC.$CUtil.getObjectLength(b)){a.innerHTML="";var c=WmsHybridSearch.generateCustomContactsListHtml(b);a.innerHTML=c}$WC.$CUtil.loadOriginalImage(WmsMainUI.defaultcontactlist)},WmsHybridSearch.populateGroupResultInMainUI=function(){if(WmsHybridSearch.getCurrentModule()!==WmsHybridSearch.constants.modules.SMARTCHAT&&typeof WmsMainUI!="undefined"&&WmsMainUI.decideRepopulate("grouplist")){var a=WmsHybridSearch.generateHtml(WmsHybridSearch.generateChannelResults("",null,!0));a&&(document.getElementById("wms_menu_grouplist_def").innerHTML=a)}},WmsHybridSearch.decideResultSet=function(){var a=WmsHybridSearch.getSearchText();if(WmsHybridSearch.getCurrentModule()===WmsHybridSearch.constants.modules.CONTACTMENU)return a===""?WmsHybridSearch.constants.DEFAULTRESULT:WmsHybridSearch.constants.USERLIST;if(WmsHybridSearch.getCurrentModule()===WmsHybridSearch.constants.modules.GROUPMENU)return a===""?WmsHybridSearch.constants.DEFAULTRESULT:WmsHybridSearch.constants.CHANNELLIST;var b=WmsHybridSearch.getNode("inputcontainer").querySelectorAll("[data-type]"),c,d;if(b.length&&a==="")return c=WmsHybridSearch.getNode("inputcontainer").querySelectorAll("[data-type='user']"),d=WmsHybridSearch.getNode("inputcontainer").querySelector("[data-type='topic']"),d&&(!c.length||c.length==1)||c.length==1?WmsHybridSearch.constants.EMPTYUSERHINT:d&&c.length>1?WmsHybridSearch.constants.EMPTYMSGHINT:c&&c.length>1?WmsHybridSearch.constants.EMPTYTITLEHINT:WmsHybridSearch.constants.EMPTY;return a===""?WmsHybridSearch.constants.DEFAULTRESULT:(c=WmsHybridSearch.getNode("inputcontainer").querySelector("[data-type='user']"),d=WmsHybridSearch.getNode("inputcontainer").querySelector("[data-type='topic']"),a.startsWith("@")?a.indexOf("#")>0?WmsHybridSearch.constants.CHANNELLIST:WmsHybridSearch.constants.USER_CHANNELLIST:a.startsWith("#")?a.indexOf("@")>0||!c?WmsHybridSearch.constants.CHANNELLIST:d?WmsHybridSearch.constants.EMPTY:WmsHybridSearch.constants.TITLEHINT:c?WmsHybridSearch.constants.MESSAGEHINT:b.length?WmsHybridSearch.constants.EMPTY:WmsHybridSearch.constants.GENERICLIST)},WmsHybridSearch.showInfoMessage=function(){var a;return function(b,c){WmsHybridSearch.hideInfoMessage();var d='<div id="wms-hysearch-infomsg" class="wms-hysearch-infomsg"><div class="wms-shake"><span style="font-weight: bold;">{{heading}}: </span><span>{{msg}}</span></div></div>',e=$WC.template.replace(d,{heading:b,msg:c});WmsHybridSearch.getNode("mainUI").insertAdjacentHTML("beforeend",e),clearTimeout(a),a=setTimeout(WmsHybridSearch.hideInfoMessage,3e3)}}(),WmsHybridSearch.hideInfoMessage=function(){$WC.$CUtil.removeElement(WmsHybridSearch.getNode("infomsgdiv"))},WmsHybridSearch.showRotationalHint=function(){var a=["hint.chatwithmsg","hint.searchtopic"];!$WC.$CUtil.getConfig("isOrgUser")()||$WC.$CUtil.getConfig("channels")=="disable"?a.unshift("search.contactsandchats"):a.unshift("search.commontitle"),$WC.$CUtil.getConfig("adhocchats")!="disable"&&a.push("hint.groupchat"),a[WmsHybridSearch.hintindex]===undefined&&(WmsHybridSearch.hintindex=0);var b=$WC.$CUtil.getConfig("Resource").getRealValue(a[WmsHybridSearch.hintindex]);WmsHybridSearch.setPlaceHolderHint(b)},WmsHybridSearch.setPlaceHolderHint=function(a){$WC.$CUtil.setInnerTextById("wms-hysearch-placeholder",a)},WmsHybridSearch.createLastMsgInfoHtml=function(a){if(a.LASTMSGINFO&&a.LASTMSGINFO.msg){var b="";if(a.LASTMSGINFO.__module){var c=a.LASTMSGINFO.sender===$WC.$CUtil.getConfig("zuid")?!0:!1;return a.LASTMSGINFO.__module==="att"?b=c?$WC.$CUtil.getConfig("Resource").getRealValue("chat.file.shared.you"):$WC.$CUtil.getConfig("Resource").getRealValue("chat.file.shared",$WC.$CUtil.getContactName(a.LASTMSGINFO.sender,a.LASTMSGINFO.dname,!0)):a.LASTMSGINFO.__module==="contact"?b=c?$WC.$CUtil.getConfig("Resource").getRealValue("chat.contact.shared.you"):$WC.$CUtil.getConfig("Resource").getRealValue("chat.contact.shared",$WC.$CUtil.getContactName(a.LASTMSGINFO.sender,a.LASTMSGINFO.dname,!0)):a.LASTMSGINFO.__module==="location"?b=c?$WC.$CUtil.getConfig("Resource").getRealValue("chat.location.shared.you"):$WC.$CUtil.getConfig("Resource").getRealValue("chat.location.shared",$WC.$CUtil.getContactName(a.LASTMSGINFO.sender,a.LASTMSGINFO.dname,!0)):a.LASTMSGINFO.__module==="event"&&(b=c?$WC.$CUtil.getConfig("Resource").getRealValue("chat.event.shared.you"):$WC.$CUtil.getConfig("Resource").getRealValue("chat.event.shared",$WC.$CUtil.getContactName(a.LASTMSGINFO.sender,a.LASTMSGINFO.dname,!0))),b}if(typeof a.LASTMSGINFO.msg=="string")if(a.LASTMSGINFO.msg.indexOf("<img")!==-1)b=$WC.$CUtil.getConfig("Resource").getRealValue("chat.img");else if(a.LASTMSGINFO.msg.indexOf("<hr>")!==-1)b=a.LASTMSGINFO.msg.replace("<hr>","---");else{var d=a.LASTMSGINFO.msg.lastIndexOf("<br>"),e=a.LASTMSGINFO.msg.lastIndexOf("\n");b=a.LASTMSGINFO.msg.substring(d!==-1?d+4:e!==-1?e+1:0),b=Smiley.replace(b,!0),b=$WC.$CUtil.formatMentions(b)}return a.PARTICIPANTSCOUNT==="2"&&a.LASTMSGINFO.sender!==$WC.$CUtil.getConfig("zuid")?b:a.LASTMSGINFO.sender===$WC.$CUtil.getConfig("zuid")?'<span class="wmsgrey">'+$WC.$CUtil.getConfig("Resource").getRealValue("chat.you")+": </span>"+b:'<span class="wmsgrey">'+$WC.$CUtil.getContactName(a.LASTMSGINFO.sender,a.LASTMSGINFO.dname,!0)+": </span>"+b}return a.LASTMSGINFO&&a.LASTMSGINFO.mtype==="63"?'<span class="wms-delmsg">'+$WC.$CUtil.getConfig("Resource").getRealValue("chat.info.deletemsg")+"</span>":a.desc?a.desc:""},WmsHybridSearch.createImageCollageHtml=function(a){var b="",c=[];for(var d=0;d<a.PARTICIPANTS.length;d++)a.PARTICIPANTS[d].zuid!==$WC.$CUtil.getConfig("zuid")&&c.push(a.PARTICIPANTS[d].zuid);if(a.ADDINFO&&a.ADDINFO.indexOf("GROPUID")!==-1){var e=a.ADDINFO.split(":"),f=e[e.indexOf("GROUPID")+1];b='<img class="wms-imgcoll1" src="'+WmsContacts.getGroupLogo(f)+'">'}else c.length===1?a.PHOTO?b='<img class="wms-imgcoll1" src="'+a.PHOTO+'">':c[0].indexOf("b-")!==-1&&WmsContacts.contactslist[c[0]]?b='<img class="wms-imgcollbot" src="'+WmsContacts.contactslist[c[0]].PHOTO+'"><div class="wms-img-badge wms-pos-bot"></div>':b='<img class="wms-imgcoll1" src="'+WmsContacts.getUserPhoto(c[0])+'">':a.PARTICIPANTSCOUNT>5?b='<img class="wms-imgcoll1" src="'+WmsContacts.getUserPhoto(c[0])+'">'+'<img class="wms-imgcoll2" src="'+WmsContacts.getUserPhoto(c[1])+'">'+'<img class="wms-imgcoll3" src="'+WmsContacts.getUserPhoto(c[2])+'">'+'<span class="wms-numcoll">+'+(a.PARTICIPANTSCOUNT-4)+"</span>":c.length===2?b='<img class="wms-imgcoll1" src="'+WmsContacts.getUserPhoto(c[0])+'">'+'<img class="wms-imgcoll4" src="'+WmsContacts.getUserPhoto(c[1])+'">':c.length===3?b='<img class="wms-imgcoll1" src="'+WmsContacts.getUserPhoto(c[0])+'">'+'<img class="wms-imgcoll3" src="'+WmsContacts.getUserPhoto(c[1])+'">'+'<img class="wms-imgcoll4" src="'+WmsContacts.getUserPhoto(c[2])+'">':c.length===4?b='<img class="wms-imgcoll1" src="'+WmsContacts.getUserPhoto(c[0])+'">'+'<img class="wms-imgcoll2" src="'+WmsContacts.getUserPhoto(c[1])+'">'+'<img class="wms-imgcoll3" src="'+WmsContacts.getUserPhoto(c[2])+'">'+'<img class="wms-imgcoll4" src="'+WmsContacts.getUserPhoto(c[3])+'">':typeof a.TITLE=="string"&&a.TITLE.length&&(b='<div class="wms-lettercoll"><span>'+WmsHybridSearch.getBadgeLetters(a.TITLE)+"</span></div>");return'<div class="wms-imgcollage">'+b+"</div>"},WmsHybridSearch.inviteMember=function(a){WMSUI.inviteMember(a)},WmsHybridSearch.clearInvite=function(a){a.status==WmsConstants.CONTACTSTATUS.NOCHAT&&WmsContacts.pendinginvcontactslist.indexOf(a.zuid)===-1?WmsContacts.pendinginvcontactslist.push(a.zuid):a.status!=WmsConstants.CONTACTSTATUS.NOCHAT&&$WC.$CUtil.removeElementFromArray(WmsContacts.pendinginvcontactslist,a.zuid),$WC.$CUtil.removeElementFromArray(WmsContacts.invitedcontactslist,a.zuid),document.getElementById("wms-hysearch")&&WmsHybridSearch.populateFrequentContactsInSmartChat();if(typeof WmsMainUI!="undefined"){var b={};b.suggestions="show_suggestions",WmsHybridSearch.populateContactListInMainUI(!0,b),WmsMainUI.resetToDefaultUI()}},WmsHybridSearch.showInvite=function(a){WmsContacts.invitedcontactslist.indexOf(a.zuid)===-1&&WmsContacts.pendinginvcontactslist.indexOf(a.zuid)===-1&&(WmsContacts.invitedcontactslist.push(a.zuid),WmsContacts.pendinginvcontactslist.push(a.zuid));if(typeof WmsMainUI!="undefined"){WmsMainUI.updateChatInvitationCount();var b={};b.suggestions="show_suggestions",WmsHybridSearch.populateContactListInMainUI(!0,b)}document.getElementById("wms-hysearch")&&WmsHybridSearch.populateFrequentContactsInSmartChat()},WmsHybridSearch.getBadgeLetters=function(a){a.startsWith("#")&&(a=a.slice(1));var b=a.split(" "),c="";return b&&(b.length>1?c=b[0].charAt(0)+b[1].charAt(0):c=a.charAt(0)),c.toUpperCase()},WmsHybridSearch.generateCustomContactResults=function(a,b){var c=[],d=[],e=WmsImplHandler.invokeSynchronously($WC.$CUtil.getConfig("customContacts").customContactsList);if(b){c=WmsImplHandler.invokeSynchronously($WC.$CUtil.getConfig("customContacts").invitationsList),c=c?c:[];if($WC.$CUtil.isArray(e))d=c.concat(e);else if($WC.$CUtil.getObjectLength(e)){var f=[];for(var g in e)if($WC.$CUtil.isArray(e[g])){f.push(g);var h=e[g];h.forEach(function(a){f.push(a)})}d=c.concat(f)}else d=c}else d=WmsImplHandler.invokeSynchronously($WC.$CUtil.getConfig("customContacts").customContactsList,a);return d},WmsHybridSearch.generateCustomContactsListHtml=function(a){function c(a){var b="wms_menu_item",c="",e="",f="",g="",h="",i="",j="",k="",l="";if(typeof a=="string"){var m='<div class="wms_menu_subheading" data-heading="{{heading}}">{{heading}}</div>';return $WC.template.replace(m,{heading:a})}a.time&&(c='<span class="wms_menu_item_time" title="'+MyDate.formatDateWithWords(a.time)+'">'+MyDate.formatTime(a.time)+"</span>"),j='<div class="wms_menu_item_name wms-truncate-ellipsis" title="{{dname}}">{{dname}}</div>',e=d(a);var n=WmsImplHandler.invokeSynchronously($WC.$CUtil.getConfig("customContacts").getUnreadCount,a.id)||!1;n?f='<span style="display:block" class="wms_menu_item_count" data-unreadcount=true>'+n+"</span>":f='<span class="wms_menu_item_count" data-unreadcount=true></span>';var o=WmsImplHandler.invokeSynchronously($WC.$CUtil.getConfig("customContacts").isInvitationPending,a.id)||!1;o?(l=a.statusMsg?a.statusMsg:a.mailId,b="wms_menu_item_invitations"):l=a.statusMsg,g='<div class="wms_menu_item_msg wms-truncate-ellipsis" data-smsg="true" title="'+l+'">'+l+"</div>";if($WC.$CUtil.getConfig("customContacts").getChatOwner){var p=WmsImplHandler.invokeSynchronously($WC.$CUtil.getConfig("customContacts").getChatOwner,a.id);if(p&&p.id!=WebMessanger.zuid)var q=d(p)}o&&(i='<div class="wms_menu_inv" data-dname="{{dname}}"><span data-customoperation="accept" data-id="{{id}}" data-type="{{type}}" title="{{invitationAcceptLabel}}" class="wms_menu_invaccept" > {{invitationAcceptLabel}} </span><span>  |  </span><span data-customoperation="reject" data-id="{{id}}" data-type="{{type}}" title="{{invitationDeclineLabel}}" class="wms_menu_invreject" > {{invitationDeclineLabel}} </span></div>'),q?h='<div class="wms_menu_item_profile_icon_img wms-valign-mid-block" data-zcprofileid="'+a.id+'" style="visibility:visible">'+q+"</div>":n||(h='<div class="wms_menu_item_profile_icon wms-valign-mid-block" data-zcprofileid="'+a.id+'"></div>'),k='<div class="'+b+'" data-id="{{id}}" data-dname="{{dname}}" data-type="{{type}}">'+e+j+c+g+i+f+h+"</div>";var r=$WC.$CUtil.getConfig("customContacts").invitationActions||null,s={id:a.id,time:a.time,type:WmsHybridSearch.constants.CONTACT,dname:$WC.$CUtil.unescapeHTML($WC.$CUtil.getContactName(a.id,a.name)),invitationAcceptLabel:r?r[0].label:$WC.$CUtil.getConfig("Resource").getRealValue("Accept"),invitationDeclineLabel:r?r[1].label:$WC.$CUtil.getConfig("Resource").getRealValue("remind.later")};return $WC.template.replace(k,s)}function d(a){var b="",c=WmsImplHandler.invokeSynchronously($WC.$CUtil.getConfig("customContacts").getStatusClass,a.id)||"";return a.name&&a.photo?b='<img data-zcprofileid="'+a.id+'" src="'+a.photo+'"/>':b='<span data-zcprofileid="'+a.id+'" class="wms_badge_letter">'+WmsHybridSearch.getBadgeLetters(a.name)+"</span>",'<span class="wms_badge_imgwrapper wms_badge_statusicon_'+c+'">'+b+"</span>"}var b="";return a.forEach(function(a){b+=c(a)}),b};var WmsChannels={list:{},reqcache:[],last_fetched_time:null,team_memberslist:{},sync:!1,get_channels_onfocus:!1};WmsChannels.insertTeamMemberslist=function(a,b){WmsChannels.team_memberslist[a]||(WmsChannels.team_memberslist[a]=b)},WmsChannels.getTeamChannelMembers=function(a){var b=WmsChannels.get(a),c={};return b.scid.forEach(function(a){if(WmsChannels.team_memberslist[a]){var b=WmsChannels.team_memberslist[a];for(var d in b)c[d]=b[d]}}),c},WmsChannels.getBotId=function(a){for(var b in WmsContacts.contactslist)if(WmsContacts.contactslist[b].ISBOT&&WmsContacts.contactslist[b].CHID===a)return WmsContacts.contactslist[b].USERID},WmsChannels.isSharedChannel=function(a){var b=WmsChannels.get(a);return b&&b.sc===WmsConstants.CHANNELS.SHARED?!0:!1},WmsChannels.isTeamChannel=function(a){var b=WmsChannels.get(a);return b&&b.sc===WmsConstants.CHANNELS.TEAM?!0:!1},WmsChannels.isUserHasPermission=function(a,b){var c=WmsChannels.get(a);if(c&&!$WC.$CUtil.isEmptyObject(c)&&c.permissions){var d=c.currole,e=c.permissions;return d==WmsConstants.USERROLES.SUPER_ADMIN?!0:d==WmsConstants.USERROLES.ADMIN&&(e.adminp&1<<b)!=0?!0:d==WmsConstants.USERROLES.CREATOR&&(e.crp&1<<b)!=0?!0:d==WmsConstants.USERROLES.MODERATOR&&(e.modp&1<<b)!=0?!0:c.joined==1&&(e.partp&1<<b)!=0?!0:!1}return!0},WmsChannels.initChannels=function(){WmsChannels.last_fetched_time===null?(typeof WmsMainUI!="undefined"&&WmsMainUI.updateLoadingForPinnedChats(!0),$WC.Ajax.requestToChat("getchannels.do","pageload=true&mode=joined&limit=50",WmsChannels.updateList,WmsChannels.handleFailure)):(WmsChannels.sync||WmsChannels.last_fetched_time+216e5<(new Date).getTime())&&WmsChannels.syncChannels()},WmsChannels.getChannels=$WC.$CUtil.debounce(function(){(!$WC.$CUtil.getObjectLength(WmsChannels.list)||WmsChannels.last_fetched_time===null||WmsChannels.sync)&&WmsChannels.initChannels()},null,1e3,!0),WmsChannels.getJoinedChannels=function(a){var b=[];for(var c in WmsChannels.list)WmsChannels.list[c].joined&&b.push(WmsChannels.list[c]);return b.sort($WC.$CUtil.sortBy("lmtime",!0)),b.slice(0,a)},WmsChannels.updateChannel=function(a,b,c){typeof WmsChannels.list[a]=="undefined"&&(WmsChannels.list[a]={}),WmsChannels.list[a][b]=c},WmsChannels.updateList=function(a){WmsChannels.last_fetched_time=(new Date).getTime(),WmsChannels.get_channels_onfocus=!1;var b=a.data;setTimeout(function(){$WC.$CUtil.pubsub.publish("/channels/updatelist",$WC.$CUtil.cloneObject(a.data))},1),b&&b.allowed&&b.allowed.forEach(function(a){WmsChannels.list[a.chid]=a,a.scid.length==1&&(WmsChannels.list[a.chid]._teamname=a.scid_name[a.scid[0]])}),b&&b.joined&&b.joined.forEach(function(a){if(a.st==="1"){WmsChannels.list[a.chid]=a,a.scid.length==1&&(WmsChannels.list[a.chid]._teamname=a.scid_name[a.scid[0]]),WmsChannels.list[a.chid].read&&WmsChannels.list[a.chid].totmsg&&WmsChannels.list[a.chid].read!="-1"&&(WmsChannels.list[a.chid].unreadmsgs=WmsChannels.list[a.chid].totmsg-WmsChannels.list[a.chid].read);if(typeof WindowHandler!="undefined"){var b=WindowHandler.getWinObjById(a.chid);b&&b.setTitle(WmsChannels.getChannelName(a.chid))}}}),typeof WindowHandler!="undefined"&&WindowHandler.updateChannelProperties(),this.opts.callbackargs&&this.opts.callbackargs.params&&WmsChannels.reqcache.push(this.opts.callbackargs.params);var c=this.opts.callbackargs&&this.opts.callbackargs.reqid;$WC.$CUtil.pubsub.publish("/channels/updateui",{reqid:c})},WmsChannels.handleFailure=function(){var a=this.opts.callbackargs&&this.opts.callbackargs.reqid;$WC.$CUtil.pubsub.publish("/channels/updateui",{reqid:a,stat:WmsConstants.REQSTATUS.FAILED})},WmsChannels.getList=function(a,b){var c=WmsHybridSearch.filter("cn",a,WmsChannels.list,null,null,null,"_teamname");return b&&(c=c.filter(function(a){if(a.joined)return!0})),c},WmsChannels.getListByTeamName=function(a){return WmsHybridSearch.filter("_teamname",a,WmsChannels.list)},WmsChannels.getListByChannelName=function(a){return WmsHybridSearch.filter("cn",a,WmsChannels.list)},WmsChannels.getListByTeam_ChannelName=function(a,b){var c=WmsChannels.getListByTeamName(a);return WmsHybridSearch.filter("cn",b,c)},WmsChannels.isCachedRequest=function(a){return WmsChannels.reqcache.indexOf(WmsChannels._constructParams(a))!==-1},WmsChannels._constructParams=function(a){return"limit=20&search="+encodeURIComponent(a)},WmsChannels.fetchFromServer=function(a,b){var c=WmsChannels._constructParams(a);WmsChannels.reqcache.indexOf(c)===-1?$WC.Ajax.requestToChat("getchannels.do",c,WmsChannels.updateList,WmsChannels.handleFailure,{reqid:b,params:c}):$WC.$CUtil.pubsub.publish("/channels/updateui",{reqid:b})},WmsChannels.getChannelImageHTML=function(a){var b=WmsChannels.get(a);if(b){var c="";b.photoid&&(c='<img src="/'+$WC.$CUtil.getConfig("CHATCONT")+"/channel/"+b.photoid+'/photo.do"></img>');var d=b.sc,e;return d==="1"?e="orgchannel":d==="2"?e="orggroup":d==="3"?e="privatechannel":d==="4"&&(e="shared-channel"),c?'<span class="wms_badge_imgwrapper wms_channelimg_badge wms-'+e+'-small">'+c+"</span>":'<span class="wms_badge_imgwrapper wms_channelimg wms-'+e+'-small">'+c+"</span>"}var f="";return b=WmsRecentChats.get(a),b&&b.TITLE?f=b.TITLE:(b=WmsUnreadChats.chatlist.find(function(b){if(b.CHATID==a)return!0}),b&&b.TITLE&&(f=b.TITLE)),'<span class="wms_badge_imgwrapper"><span class="wms_badge_letter">'+WmsHybridSearch.getBadgeLetters(f)+"</span></span>"},WmsChannels.get=function(a){return WmsChannels.list[a]},WmsChannels.isJoinedChannel=function(a){var b=WmsChannels.get(a);return b&&b.joined&&b.joined==1?!0:!1},WmsChannels.getChannelName=function(a){var b=WmsChannels.get(a);if(b){var c=b.dn;return c||(c=b.cn,b._teamname&&(c=c+"@"+b._teamname)),c}},WmsChannels.updateModifiedData=function(){WmsChannels.last_fetched_time=(new Date).getTime(),WmsChannels.get_channels_onfocus=!1,WmsChannels.sync=!1;var a=JSON.parse(this.response)[0].objString;if(this.getResponseHeader("x-zcoperation")==="clearchanneldb")WmsChannels.last_fetched_time=null,WmsChannels.initChannels();else if(a.leftchanneluids||a.deletedchanneluids){var b=a.leftchanneluids||a.deletedchanneluids;for(var c in b){var d=WmsChannels.getChannelByOC_id(c)[0],e=d&&d.chid;delete WmsChannels.list[e]}}else{if(a.newjoinedchannels){var f=a.newjoinedchannels;for(var g in f){var h=f[g].chid;WmsChannels.list[h]=f[g]}}if(a.groupsnamemodified){var i=a.groupsnamemodified,j=WmsHybridSearch.filter("sc",WmsConstants.CHANNELS.TEAM,WmsChannels.list);for(var k in i)j.forEach(function(a){if(a.scid.indexOf(k)!==-1){var b=i[k];a._teamname&&(a._teamname=b),a.scid_name[k]=b}})}if(a.channelidvsdatamodified){var l=a.channelidvsdatamodified;for(var m in l){var n=WmsChannels.getChannelByOC_id(m)[0];if(n){var o=l[m];for(var p in o)n[p]=o[p]}}}}$WC.$CUtil.pubsub.publish("/channels/updateui",{})},WmsChannels.syncChannels=function(){var a="lastsynctime="+WmsChannels.last_fetched_time;$WC.Ajax.requestToChat("synchannels.do",a,WmsChannels.updateModifiedData)},WmsChannels.getChannelByOC_id=function(a){return WmsHybridSearch.filter("oc_id",a,WmsChannels.list)};var WmsOrgContacts={contactslist:{},reqcache:{result:[],noresult:[]}};WmsOrgContacts.updateList=function(a){for(var b in a)WmsOrgContacts.contactslist[b]={USERID:b,DNAME:a[b][0],EMAILID:a[b][1],UC:a[b][3]};this.opts.callbackargs&&this.opts.callbackargs.params&&($WC.$CUtil.isEmptyObject(a)?WmsOrgContacts.reqcache.noresult.push(this.opts.callbackargs.params):WmsOrgContacts.reqcache.result.push(this.opts.callbackargs.params));var c=this.opts.callbackargs&&this.opts.callbackargs.reqid,d=this.opts.callbackargs&&this.opts.callbackargs.topicname;d?(WmsOrgContacts.putContactsListInLocalStorage(),$WC.$CUtil.pubsub.publish("/orgcontacts/"+d,{callbackargs:this.opts.callbackargs,stat:$WC.$CUtil.isEmptyObject(a)?WmsConstants.REQSTATUS.NORESULTS:""})):$WC.$CUtil.pubsub.publish("/orgcontacts/updateui",{reqid:c})},WmsOrgContacts.handleFailure=function(){var a="updateui",b=this.opts.callbackargs&&this.opts.callbackargs.reqid,c=this.opts.callbackargs&&this.opts.callbackargs.chid;this.opts.callbackargs&&this.opts.callbackargs.topicname&&(a=this.opts.callbackargs.topicname);var d=this.opts&&this.opts.callbackargs;$WC.$CUtil.pubsub.publish("/orgcontacts/"+a,{stat:WmsConstants.REQSTATUS.FAILED,chid:c,reqid:b,callbackargs:d})},WmsOrgContacts._constructParams=function(a){var b="limit=50";return b+="&search="+a,b},WmsOrgContacts.getContacts=function(a,b){WmsOrgContacts.fetchFromServer(a,null,"getapi");var c=$WC.$CUtil.pubsub.subscribe("/orgcontacts/getapi",function(){b(),$WC.$CUtil.pubsub.unsubscribe(c)})},WmsOrgContacts.fetchFromServer=function(a,b,c){var d=a&&a.chid,e=a&&a.searchtext||a,f=WmsOrgContacts._constructParams(e),g=a&&a.silentload;c=a&&a.topicname||c;if(WmsOrgContacts.isCachedRequest(e)===!1)$WC.Ajax.requestToChat("getorgusers.do",f,WmsOrgContacts.updateList,WmsOrgContacts.handleFailure,{reqid:b,params:f,topicname:c,chid:d,silentload:g});else if(c){var h={reqid:b,params:f,topicname:c,chid:d,silentload:g};$WC.$CUtil.pubsub.publish("/orgcontacts/"+c,{callbackargs:h})}else $WC.$CUtil.pubsub.publish("/orgcontacts/updateui",{reqid:b})},WmsOrgContacts.isCachedRequest=function(a){var b=a&&a.searchtext||a,c=WmsOrgContacts._constructParams(b);for(var d=0;d<WmsOrgContacts.reqcache.result.length;d++){var e=WmsOrgContacts.reqcache.result[d];if(e.indexOf(c)!==-1)return!0}return WmsOrgContacts.isEmptyResultReq(b)},WmsOrgContacts.checkAndUpdateContactsList=function(){var a=(new Date).getTime(),b=864e5,c=WmsLocalStorage.getItem(WebMessanger.zuid+"_wms_orgcontacts");if(c!=null&&a-c.reqtime>b){WmsOrgContacts.reqcache.result=[],WmsOrgContacts.reqcache.noresult=[],WmsOrgContacts.removeContactsListFromLocalStorage(),WmsOrgContacts.fetchFromServer("","","suggestionui");return}$WC.$CUtil.getObjectLength(WmsOrgContacts.contactslist)==0&&(c!=null?$WC.$CUtil.getObjectLength(c.contacts)>0&&WmsOrgContacts.pullContactsListFromLocalStorage():WmsOrgContacts.fetchFromServer("","","suggestionui"))},WmsOrgContacts.pullContactsListFromLocalStorage=function(){var a=WmsLocalStorage.getItem(WebMessanger.zuid+"_wms_orgcontacts");WmsOrgContacts.contactslist=a.contacts},WmsOrgContacts.putContactsListInLocalStorage=function(){var a={};a.contacts=WmsOrgContacts.contactslist,a.reqtime=(new Date).getTime(),WmsLocalStorage.setItem(WebMessanger.zuid+"_wms_orgcontacts",a)},WmsOrgContacts.removeContactsListFromLocalStorage=function(){WmsLocalStorage.removeItem(WebMessanger.zuid+"_wms_orgcontacts")},WmsOrgContacts.isEmptyResultReq=function(a){var b=WmsOrgContacts._constructParams(a);for(var c=0;c<WmsOrgContacts.reqcache.noresult.length;c++){var d=WmsOrgContacts.reqcache.noresult[c];if(b.startsWith(d))return!0}return!1};var WmsRecentChats={chatlist:[],last_fetched_time:null,constants:{LOADING:1,NOCHATS:2,SUCCESS:3,FAILED:4}},WmsUnreadChats={chatlist:[],channellist:[]},WmsPinnedChats={chatlist:[],last_fetched_time:null},WmsUnreadFeeds={};WmsUnreadFeeds.count=0,WmsUnreadFeeds.wrapObj=function(){var a=[],b={};return b.FEEDSID="wms_menu_feedsnotify",b.PARTICIPANTS=[],b.LMTIME="",b.TITLE=WmsUnreadFeeds.count===1?$WC.$CUtil.getConfig("Resource").getRealValue("chat.feed.you"):$WC.$CUtil.getConfig("Resource").getRealValue("chat.feeds.you",[WmsUnreadFeeds.count]),b.desc=$WC.$CUtil.getConfig("Resource").getRealValue("view.click.here"),a.push(b),a},WmsRecentChats.initRecentChats=function(){WmsRecentChats.last_fetched_time===null&&WmsRecentChats.loadPreviousChatList()},WmsRecentChats.get=function(a){return WmsRecentChats.chatlist.filter(function(b){if(b.CHATID===a)return!0})[0]},WmsRecentChats.updateTitle=function(a,b){var c=WmsRecentChats.get(a);if(!c)return;c.TITLE=b,$WC.$CUtil.pubsub.publish("/recentchats/updateui",WmsConstants.REQSTATUS.SUCCESS)},WmsRecentChats.updatePinnedChatList=function(a){WmsPinnedChats.last_fetched_time=(new Date).getTime();var b=a&&JSON.parse(a);for(var c in b){var d=WmsRecentChats.getFromPinnedChatList(c);if(!d){var e={};e.ADDINFO=b[c].addinfo,e.CHATID=c,e.LASTMSGINFO=b[c].lastmsginfo&&JSON.parse(b[c].lastmsginfo),e.PARTICIPANTS=b[c].recipants&&JSON.parse(b[c].recipants),e.PARTICIPANTSCOUNT=b[c].pcount,e.TITLE=b[c].title,e.LMSGTIME=b[c].lastmsginfo&&JSON.parse(b[c].lastmsginfo).time,WmsPinnedChats.chatlist.push(e);var f=WindowHandler.getWinObjById(c);f&&f.updatePinnedInfo(!0)}}WmsHybridSearch.populateRecentChats()},WmsRecentChats.getFromPinnedChatList=function(a){return WmsPinnedChats.chatlist.find(function(b){if(b.CHATID===a)return!0})},WmsRecentChats.getFromUnreadChatList=function(a){return WmsUnreadChats.chatlist.find(function(b){if(b.CHATID===a)return!0})},WmsRecentChats.updateLastMsgInfo=function(a){function d(b){b.LASTMSGINFO||(b.LASTMSGINFO={}),b.LASTMSGINFO.sender=a.sender,b.LASTMSGINFO.dname=$WC.$CUtil.getContactName(a.sender,a.dname),b.LASTMSGINFO.msg=a.msg,b.LMTIME&&(b.LMTIME=a.lmtime),a.module?b.LASTMSGINFO.__module=a.module:delete b.LASTMSGINFO.__module}var b=WmsRecentChats.getFromPinnedChatList(a.chid)||WmsRecentChats.getFromUnreadChatList(a.chid);b&&(b.LMSGTIME=a.lmtime,d(b));var c=WmsRecentChats.get(a.chid);c&&d(c),typeof WmsMainUI!="undefined"&&$WC.$CUtil.pubsub.publish("/recentchats/updateui",WmsConstants.REQSTATUS.SUCCESS)},WmsRecentChats.removeFromRecentChats=function(a){var b=WmsRecentChats.get(a);if(!b)return;WmsRecentChats.chatlist.splice(WmsRecentChats.chatlist.indexOf(b),1),$WC.$CUtil.pubsub.publish("/recentchats/updateui",WmsConstants.REQSTATUS.SUCCESS)},WmsRecentChats.getChats=function(a){return WmsRecentChats.chatlist.length?(WmsRecentChats.chatlist.sort($WC.$CUtil.sortBy("LMTIME",!0)),a?WmsRecentChats.chatlist.slice(0,a):WmsRecentChats.chatlist.slice(0)):WmsConstants.REQSTATUS.NORESULTS},WmsRecentChats.getChatIdList=function(a){var b=a.map(function(a){return a.CHATID});return b},WmsRecentChats.getRecentChatsFromChatServer=function(a,b){a=a||4;var c="limit="+a;b&&(c="totime="+b+"&limit="+a);var d={"X-XHR-exception":"true","X-ZCSRF-TOKEN":$WC.$CUtil.getCSRF()};$WC.Ajax.requestToChat("v1/chats",c,function(b){WmsRecentChats.last_fetched_time=(new Date).getTime();var c=JSON.parse(b).data,d=c&&c.chats,e=WmsConstants.REQSTATUS.NORESULTS;d&&d.length?(d.forEach(function(a){var b={};b.ADDINFO=a.addinfo,b.CHATID=a.chatid,b.LASTMSGINFO=a.lastmsginfo&&JSON.parse(a.lastmsginfo),b.PARTICIPANTS=a.recipants&&JSON.parse(a.recipants)||[],b.PARTICIPANTSCOUNT=a.pcount,b.LMTIME=a.lmtime,b.TITLE=a.title,$WC.$CUtil.isBotChid(b.CHATID)&&(b.PHOTO=WmsRecentChats.getImageUrl(b.CHATID));var c=WmsRecentChats.get(b.CHATID);c?WmsRecentChats.chatlist[WmsRecentChats.chatlist.indexOf(c)]=b:WmsRecentChats.chatlist.push(b)}),e=WmsConstants.REQSTATUS.SUCCESS):e=WmsConstants.REQSTATUS.INITIALSTATE,$WC.$CUtil.pubsub.publish("/recentchats/updateui",e)},function(){$WC.$CUtil.pubsub.publish("/recentchats/updateui",WmsConstants.REQSTATUS.FAILED)},null,null,d)},WmsRecentChats.getImageUrl=function(a){var b="b-"+a.split("-")[2];if(WmsContacts.contactslist[b]&&WmsContacts.contactslist[b].PHOTO)return WmsContacts.contactslist[b].PHOTO},WmsRecentChats.updateFromActiveChats=function(a){for(var b in a){var c={};c={},c.CHATID=b,c.LASTMSGINFO=JSON.parse(a[b].lmhash),c.PARTICIPANTS=[];var d=JSON.parse(a[b].recipantssummary);for(var e in d)c.PARTICIPANTS.push({zuid:e,dname:d[e]});c.PARTICIPANTSCOUNT=a[b].pcount,c.TITLE=a[b].title,c.ADDINFO=a[b].addinfo,c.LMTIME=a[b].lmtime,$WC.$CUtil.isBotChid(c.CHATID)&&(c.PHOTO=WmsRecentChats.getImageUrl(c.CHATID));var f=WmsRecentChats.get(b),g=WmsRecentChats.getFromPinnedChatList(b);g&&(WmsPinnedChats.chatlist[WmsPinnedChats.chatlist.indexOf(g)]=c),f?WmsRecentChats.chatlist[WmsRecentChats.chatlist.indexOf(f)]=c:WmsRecentChats.chatlist.push(c)}typeof WmsMainUI!="undefined"&&$WC.$CUtil.pubsub.publish("/recentchats/updateui",WmsConstants.REQSTATUS.SUCCESS)},WmsRecentChats.updatePinnedChat=function(a,b){if(b){var c=WmsRecentChats.get(a),d=WmsRecentChats.getFromPinnedChatList(a);if(d)return;if(c)c=JSON.stringify(c),c=JSON.parse(c),c.LMTIME="",c.LMSGTIME=c.LASTMSGINFO.time,WmsPinnedChats.chatlist.push(c);else if(a.indexOf("CT")!=-1&&!$WC.$CUtil.isBotChid(a)){var e=WmsChannels.list[a];if(e){var f={};f.ADDINFO=e.addinfo,f.CHATID=a,f.LASTMSGINFO=e.lminfo&&JSON.parse(e.lminfo),f.PARTICIPANTS=[],f.TITLE=e.cn,f.LMSGTIME=e.lminfo&&JSON.parse(e.lminfo).time,WmsPinnedChats.chatlist.push(f),WmsHybridSearch.populateRecentChats()}}else WebMessanger.getPinnedChats()}else{var g=WmsRecentChats.getFromPinnedChatList(a);g&&WmsPinnedChats.chatlist.splice(WmsPinnedChats.chatlist.indexOf(g),1)}},WmsRecentChats.updateUnReadChats=function(a,b){for(var c in a){var d=WmsRecentChats.wrapUnreadObj(a[c],c),e=WmsRecentChats.checkPresence(d.CHATID,b);e?b[b.indexOf(e)]=d:b.push(d),a[c].mute?WmsMainUI.setMuteStatus(c,!0):WmsMainUI.setMuteStatus(c,!1),WmsMainUI.setUnreadCount(c,d.UNREADMSGS),WindowHandler.checkAndHighlightChat(d.CHATID)}WmsMainUI.updateUnreadChatsCount()},WmsRecentChats.wrapUnreadObj=function(a,b){var c={};c.ADDINFO=a.addinfo,c.CHATID=b||a.chid,c.LASTMSGINFO=a.lastmsginfo&&JSON.parse(a.lastmsginfo)||a.lminfo&&JSON.parse(a.lminfo)||a.lmhash&&JSON.parse(a.lmhash);var d=a.recipantssummary&&JSON.parse(a.recipantssummary),e=[];for(var f in d)e.push({dname:d[f],zuid:f});return c.PARTICIPANTS=e||WmsRecentChats.checkPresence(c.CHATID,WmsRecentChats.chatlist).PARTICIPANTS,c.PARTICIPANTSCOUNT=a.pcount||a.pc,c.LMTIME=a.unreadtime||a.lmtime,c.TITLE=a.title||a.cn,c.UNREADMSGS=a.unreadmsgs?a.unreadmsgs:"1",$WC.$CUtil.isBotChid(c.CHATID)&&(c.PHOTO=WmsRecentChats.getImageUrl(c.CHATID)),c},WmsRecentChats.updateWithUnreadChats=function(a){var b;for(var c=0;c<WmsUnreadChats.chatlist.length;c++)WmsUnreadChats.chatlist[c]&&(b=WmsRecentChats.checkPresence(WmsUnreadChats.chatlist[c].CHATID,a),b?a[a.indexOf(b)].UNREADMSGS="1":a.unshift(WmsUnreadChats.chatlist[c]));return a},WmsRecentChats.removeFromUnreadChats=function(a){var b;for(b=0;b<WmsUnreadChats.chatlist.length;b++)WmsUnreadChats.chatlist[b]&&WmsUnreadChats.chatlist[b].CHATID===a&&WmsUnreadChats.chatlist.splice(b,1)},WmsRecentChats.resetUnreadChats=function(){WmsUnreadChats.chatlist=[],WmsUnreadChats.channellist=[]},WmsRecentChats.checkPresence=function(a,b){for(var c in b)if(b[c].CHATID===a)return b[c];return!1},WmsRecentChats.getList=function(a){return WmsHybridSearch.filter("TITLE",a,WmsRecentChats.chatlist)},WmsRecentChats.loadPreviousChatList=function(){var a=(new Date).getTime();WmsRecentChats.chatlist.length&&(a=WmsRecentChats.chatlist[WmsRecentChats.chatlist.length-1].LMTIME),WmsRecentChats.getRecentChatsFromChatServer(15,a)},WmsRecentChats.getRecentChatTime=function(){var a=WmsRecentChats.chatlist[0]&&WmsRecentChats.chatlist[0].LMTIME;if(a)return+a},$WC.$CUtil.pubsub.subscribe("/channels/updateui",function(){$WC.$CUtil.pubsub.publish("/recentchats/updateui",WmsConstants.REQSTATUS.SUCCESS)});var WmsChats={list:{},reqcache:[]};WmsChats.updateList=function(a){var b=JSON.parse(a).data,c=b&&b.chats;if(c&&c.length){var d=0;while(d<c.length){var e={};e.ADDINFO=c[d].addinfo,e.CHATID=c[d].chatid,e.LASTMSGINFO=c[d].lastmsginfo&&JSON.parse(c[d].lastmsginfo),e.PARTICIPANTS=c[d].recipants&&JSON.parse(c[d].recipants)||[],e.PARTICIPANTSCOUNT=c[d].pcount,e.LMTIME=c[d].lmtime,e.TITLE=c[d].title,WmsChats.list[c[d].chatid]=e,d++}}this.opts.callbackargs&&this.opts.callbackargs.params&&WmsChats.reqcache.push(this.opts.callbackargs.params);var f=this.opts.callbackargs&&this.opts.callbackargs.reqid;$WC.$CUtil.pubsub.publish("/chatlist/updateui",{reqid:f})},WmsChats.handleFailure=function(){var a=this.opts.callbackargs&&this.opts.callbackargs.reqid;$WC.$CUtil.pubsub.publish("/chatlist/updateui",{reqid:a,stat:WmsConstants.REQSTATUS.FAILED})},WmsChats.getList=function(a){return a?WmsHybridSearch.filter("TITLE",a,WmsChats.list):WmsChats.list},WmsChats.isCachedRequest=function(a){return WmsChats.reqcache.indexOf(WmsChats._constructParams(a))!==-1},WmsChats._constructParams=function(a){var b="limit=10";return b+=a?"&title="+a:"",b},WmsChats.fetchFromServer=function(a,b){var c=WmsChats._constructParams(a);if(WmsChats.reqcache.indexOf(c)===-1){var d={"X-XHR-exception":"true","X-ZCSRF-TOKEN":$WC.$CUtil.getCSRF()};$WC.Ajax.requestToChat("v1/chats",c,WmsChats.updateList,WmsChats.handleFailure,{reqid:b,params:c},null,d)}else $WC.$CUtil.pubsub.publish("/chatlist/updateui",{reqid:b})};var WmsDialog={};WmsDialog.showModal=function(a,b){WmsDialog.removeModal(),ZMSGUI.createOverlay();var c=document.createElement("div");c.id="wms-dialog",c.className="wms-dialogparent wms-hvalign",c.style.zIndex=$WC.$CUtil.getConfig("zindex"),b&&c.setAttribute("data-ownerchatid",b),c.onclick=function(a){var b=getEventTarget(a),c=b.getAttribute("tabindex"),d=b.getAttribute("data-operation");d=="close"?WmsDialog.removeModal():c&&WmsDialog.operations[c-1].action.call()},WmsDialog.operations=a.operations;var d='<div class="wms-dialogheader"><span class="wms-dialogclose" data-operation="close"></span></div><div class="wms-dialogcontent"><div class="wms-dialogtext">',e=a.imghtml?a.imghtml:"",f=a.width||"480",g=a.bodyhtml?a.bodyhtml:"",h='</div><div class="wms-dialog-inpcont">';for(var i=0;i<a.operations.length;i++){var j=a.operations[i].classname?a.operations[i].classname:"wms-dialog-acceptbtn",k=a.operations[i].name;h+='<input type="button" class="'+j+'" tabindex="'+(i+1)+'" value="'+k+'"></input>'}h+="</div></div>";var l=d+e+g+h;c.innerHTML=l,c.style.width=f+"px";var m=document.body.appendChild(c);m.querySelector('[tabindex="'+a.focusbutton+'"]').focus()},WmsDialog.removeModal=function(){ZMSGUI.removeOverlay();if(document.getElementById("wms-dialog")){var a=document.getElementById("wms-dialog").getAttribute("data-ownerchatid");$WC.$CUtil.removeElement(document.getElementById("wms-dialog")),a&&WindowHandler.focusChatById(a)}};var WmsBadgeImage={};WmsBadgeImage.getStatusHtml=function(a,b){var c=WmsBadgeImage.getStatusClass(a,b),d="";return c&&(d='<div class="wms-img-badge '+c+'"></div>'),d},WmsBadgeImage.createUserImageHtml=function(a,b){var c='<div class="wms-img-cont">';return b?c+='<img class="wms-hysearch-result-img" src="'+b+'">':c+='<img class="wms-hysearch-result-img" src="'+WmsContacts.getUserPhoto(a)+'">',c+=WmsBadgeImage.getStatusHtml(a,!1)+"</div>",c},WmsBadgeImage.getStatusClass=function(a,b){var c=WmsContacts.status(a),d="";return c!==!1&&(c=+c,c===WmsContacts.userstatus.ONLINE?d=b?"wms-status-online":"wms-pos-online":c===WmsContacts.userstatus.BUSY?d=b?"wms-status-busy":"wms-pos-busy":c===WmsContacts.userstatus.IDLE?d=b?"wms-status-idle":"wms-pos-idle":c===WmsContacts.userstatus.OFFLINE&&(d=b?"wms-status-offline":"wms-pos-offline"),d&&parseInt(WmsContacts.getStatusType(a),10)===WmsContacts.userstatus.MOB_LOGIN?d+="-mobile":a.indexOf("b-")!==-1&&(d="wms-pos-bot")),d};var WmsMediaPlayer={supported_audio_formats:[],supported_video_formats:[],videoelement:"",cache:{},init:function(a,b,c,d){var e=a.target.getAttribute("data-operation")||a.target.getAttribute("data-attr");a.target.parentNode.getAttribute("data-attr")&&(e=a.target.parentNode.getAttribute("data-attr"));var f=WmsMediaPlayer.getCacheObject(c,b,d);e==="fullscreen"?WmsMediaPlayer.fullscreen(c):(e==="pause"||e==="play")&&WmsMediaPlayer.togglePlayAndPause(d,c,f)},initSupportedAudioFormats:function(){var a=new Audio,b=["mp3","mpeg","wav","aac","amr","flac","gsm","tta","wv","x-wav","x-m4a"];for(var c=0,d=b.length;c<d;c++)a.canPlayType("audio/"+b[c])!==""&&a.canPlayType("audio/"+b[c])!=="no"&&this.supported_audio_formats.push("audio/"+b[c])},initSupportedVideoFormats:function(){var a=document.createElement("video");this.IS_VIDEO_TAG_SUPPORTED=!!a.canPlayType;var b=["webm","mkv","flv","ogg","avi","mov","qt","wmv","asf","mp4","3gp","quicktime"];for(var c=0,d=b.length;c<d;c++)a.canPlayType("video/"+b[c])!==""&&a.canPlayType("video/"+b[c])!=="no"&&this.supported_video_formats.push("video/"+b[c])},isSupportedAudioFormat:function(a){return this.supported_audio_formats.indexOf(a)>-1?!0:!1},isSupportedVideoFormat:function(a){return this.supported_video_formats.indexOf(a)>-1?!0:!1},getCacheObject:function(a,b,c){var d=a.getAttribute("source").split("&"),e=d[1]&&d[1].substring(4)||d,f=a.getAttribute("source"),g;return WmsMediaPlayer.cache[b]||(WmsMediaPlayer.cache[b]={}),WmsMediaPlayer.cache[b][c]||(WmsMediaPlayer.cache[b][c]={}),WmsMediaPlayer.cache[b][c][e]?WmsMediaPlayer.cache[b][c][e]:(a.getAttribute("id")==="wms-audioplayer"?g=new Audio(f):(g=a.querySelector("#wms-video"),g.setAttribute("src",f)),WmsMediaPlayer.cache[b][c][e]=g,WmsMediaPlayer.bindEvents(a,g),g)},bindEvents:function(a,b){b.ontimeupdate=function(){var c=WmsMediaPlayer.formatTime(b.currentTime);$WC.$CUtil.setInnerText(a.querySelector('[data-operation="curtime"]'),c);var d=b.duration-b.currentTime;d===0&&(d=b.duration),a.querySelector('[data-operation="remtime"]')&&$WC.$CUtil.setInnerText(a.querySelector('[data-operation="remtime"]'),"- "+WmsMediaPlayer.formatTime(d))},b.onloadedmetadata=function(){var c="/ "+WmsMediaPlayer.formatTime(b.duration);$WC.$CUtil.setInnerText(a.querySelector('[data-operation="duration"]'),c),a.querySelector('[id="wms-videotime"]')&&(a.querySelector('[id="wms-videotime"]').style.display="block"),a.querySelector('[data-operation="remtime"]')&&(a.querySelector('[data-operation="remtime"]').className="wms-audioremtime",$WC.$CUtil.setInnerText(a.querySelector('[data-operation="remtime"]'),"- "+c))},b.onended=function(){WmsMediaPlayer.showPlayPause(a,"play"),$WC.$CUtil.setInnerText(a.querySelector('[data-operation="curtime"]'),"0:00")}},bindFullScreenEvent:function(){var a=["fullscreenchange","mozfullscreenchange","webkitfullscreenchange","msfullscreenchange"];for(var b=0;b<a.length;b++)WmsMediaPlayer.handleFullScreen(a[b])},handleFullScreen:function(a){document.addEventListener(a,function(){WmsMediaPlayer.fullScreen()})},togglePlayAndPause:function(a,b,c){c.paused?(WmsMediaPlayer.stopAllMedia(),WmsMediaPlayer.showPlay(a),WmsMediaPlayer.showPlayPause(b,"pause"),b.querySelector('[id="wms-mediaplaypause"]').setAttribute("data-attr","pause"),b.querySelector('[id="wms-videoscreenplaypause"]')&&setTimeout(function(){b.querySelector('[id="wms-videoscreenplaypause"]').setAttribute("style","display:none")},3e3),c.play()):(WmsMediaPlayer.showPlayPause(b,"play"),b.querySelector('[id="wms-mediaplaypause"]').setAttribute("data-attr","play"),c.pause()),b.querySelector('[id="wms-videoscreenplaypause"]')&&b.querySelector('[id="wms-videoscreenplaypause"]').setAttribute("style","display:block")},formatTime:function(a){var b=Math.floor(a/60),c=Math.floor(a-b*60);return b<10&&(b="0"+b),c<10&&(c="0"+c),b+":"+c},stopPlayingMedia:function(a,b){if(b){if(WmsMediaPlayer.cache[a]){for(var c in WmsMediaPlayer.cache[a][b])WmsMediaPlayer.cache[a][b][c].pause();delete WmsMediaPlayer.cache[a][b]}}else{for(var d in WmsMediaPlayer.cache[a])for(var e in WmsMediaPlayer[a][d])WmsMediaPlayer[a][d][e].pause();delete WmsMediaPlayer.cache[a]}},fullscreen:function(a){a.requestFullscreen?a.requestFullscreen():a.msRequestFullscreen?a.msRequestFullscreen():a.mozRequestFullScreen?a.mozRequestFullScreen():a.webkitRequestFullscreen&&a.webkitRequestFullscreen(),WmsMediaPlayer.videoelement=a,a.querySelector("#wms-videoinfo").className="wms-videoinfofullscreen wms-videoinfo",a.setAttribute("style","height:"+(screen.height-40)+"px;border:none;width:100%"),a.querySelector("#wms-mediaplaypause").setAttribute("style","height:"+(screen.height-40)+"px;background-color:black;"),a.querySelector("#wms-videofullscreen").setAttribute("style","display:none"),a.querySelector("#wms-videofilefrwrd").setAttribute("style","display:none")},stopAllMedia:function(){for(var a in WmsMediaPlayer.cache)for(var b in WmsMediaPlayer.cache[a])for(var c in WmsMediaPlayer.cache[a][b])WmsMediaPlayer.cache[a][b][c].pause()},showPlay:function(a){var b=document.getElementById(a)||document.getElementById("wmschshtransmsg"),c=b.querySelectorAll('[data-operation="play"]'),d=b.querySelectorAll('[data-operation="pause"]'),e=b.querySelectorAll('[id="wms-videocurtime"]');for(var f=0;f<c.length;f++)c[f].style.display="block",d[f].style.display="none";for(var g=0;g<e.length;g++)e[g].innerHTML="00.00"},showPlayPause:function(a,b){var c=a.querySelectorAll('[data-operation="play"]'),d=a.querySelectorAll('[data-operation="pause"]');for(var e=0;e<c.length;e++)c[e].style.display=b==="play"?"block":"none",d[e].style.display=b==="play"?"none":"block"},fullScreen:function(){if(!(document.fullscreen||document.mozFullScreen||document.webkitIsFullScreen||document.msFullscreenElement)){var a=WmsMediaPlayer.videoelement;a&&(a.querySelector("#wms-videoinfo").className="wms-videoinfo",a.querySelector("#wms-mediaplaypause").removeAttribute("style"),a.querySelector("#wms-videofullscreen").setAttribute("style","display:block"),a.querySelector("#wms-videofilefrwrd").setAttribute("style","display:block"),a.setAttribute("style","width:100%"))}}};ListCommon.prototype.getListHTML=function(a,b){var c="",d=a.USERID||a.id,e=$WC.$CUtil.getContactName(d)||a.DNAME||a.name,f=WmsContacts.getEmailId(d)||a.EMAILID||a.description||"",g=a.STATUS||"",h=a.STYPE||"",i=a.STATUSCLASS||"";b?c=a.photo||"":c=a.PHOTO||WmsContacts.getUserPhoto(d);var j='<div class="wms-filefrwrdcontact" data-dname="{{dname}}" data-userid="'+d+'" data-list="true">';return c&&(j+='<span class="wms-filefrwrdcontactspan"><div class="wms-filefrwrdcontactdiv"><img class="wms-filefrwrdcontactimg wms-autocompleteimg" src={{image}}><span class="{{statusclass}}"></span></div></span>'),j+='<span class="wms-filefrwrdcontactdetails wms-truncate-ellipsis" title="{{dname}}">{{dname}}</span><span class="wms-truncate-ellipsis wms-filefrwrddesc" title="{{emailid}}">{{emailid}}</span></div>',h==WmsContacts.userstatus.MOB_LOGIN?g==WmsContacts.userstatus.OFFLINE?i="wms-filefrwrdcontactstatus wms-contactstatus wms-statusicon-offline":g==WmsContacts.userstatus.ONLINE?i="wms-filefrwrdcontactstatus wms-contactstatus wms-statusicon-available-mobile":g==WmsContacts.userstatus.BUSY?i="wms-filefrwrdcontactstatus wms-contactstatus wms-statusicon-busy-mobile":g==WmsContacts.userstatus.IDLE&&(i="wms-filefrwrdcontactstatus wms-contactstatus wms-statusicon-idle-mobile"):g?i="wms-filefrwrdcontactstatus wms-filefrwrdscode-"+g:a.ISBOT&&(i="wms-filefrwrdcontactstatus wms_boticon"),$WC.template.replace(j,{dname:WebMessanger.unescapeHTML(e),emailid:f,statusclass:i,image:c})},ListCommon.prototype.showUI=function(a,b,c,d,e){var f=this,g="";$WC.$CUtil.isArray(a)&&!c?a.forEach(function(a){d?f.container.querySelector('[data-userid="'+a.USERID+'"]')||(g+=f.getListHTML(a,e)):g+=f.getListHTML(a,e)}):c&&(g=a),d?(this.container.innerHTML+=g,c||(this.selectedelem=this.container.querySelector('[class="wms-filefrwrdcontactsel"]'),this.selectElem(this.selectedelem,!0))):(this.container.innerHTML=g,this.container.scrollTop=0,this.selectedelem="",b&&(this.container.firstChild.getAttribute("data-list")?this.selectedelem=this.container.firstChild:this.selectedelem=this.container.firstChild.firstChild,this.selectElem(this.selectedelem,!0)))},ListCommon.prototype.handleKeyMovement=function(a,b){var c=a.keyCode,d=getEventTarget(a),e;if(c!==WmsConstants.KEYCODES.LEFT&&c!==WmsConstants.KEYCODES.RIGHT||WMSUI.curtrigger!==":"){if(c===WmsConstants.KEYCODES.UP||c===WmsConstants.KEYCODES.DOWN)b.selectElem(b.selectedelem,!1),b.selectedelem=b.selectedelem?$WC.$CUtil.getConditionalNextNode(b.selectedelem,c,"data-list"):b.container.firstChild,b.selectElem(b.selectedelem,!0),WMSUI.curtrigger===":"?WMSUI.autoComplete.bringElemToView(b.selectedelem,c):$WC.$CUtil.bringElemToView(b.selectedelem,c),a.preventDefault();else if(c===WmsConstants.KEYCODES.ENTER&&b.selectedelem){if(WMSUI.curtrigger===WmsConstants.TRIGGERS.SLASH||WMSUI.curtrigger==="-"&&d.value.indexOf(WmsConstants.TRIGGERS.SLASH)!=-1)Commands.select(d,b.selectedelem);else if(WMSUI.curtrigger===WmsConstants.TRIGGERS.ATMENTION||WMSUI.curtrigger===WmsConstants.TRIGGERS.ADDMEM||WMSUI.curtrigger===WmsConstants.TRIGGERS.DELMEM)WMSUI.atMentions.select(d,b.selectedelem);else if(WMSUI.curtrigger===WmsConstants.TRIGGERS.SMILEY)WMSUI.autoComplete.select(d,b.selectedelem);else if(b.selectedelem.getAttribute("data-botsuggestion")){var i=b.selectedelem.getAttribute("data-suggestiontext");WindowHandler.sendBotSuggestions(d,i)}a.preventDefault()}}else{b.selectElem(b.selectedelem,!1);var f=b.container.firstChild,g=0;b.selectedelem&&(f=b.selectedelem.parentNode);while(g<f.childElementCount)b.selectedelem===f.childNodes[g]&&(e=g),g++;var h=util.getNextRotationalNode(f,c);b.selectedelem=h.childNodes[e],b.selectElem(b.selectedelem,!0),a.preventDefault()}},ListCommon.prototype.selectElem=function(a,b){if(!a)return;var c=a.getAttribute("class").replace(/sel$/,""),d=b?c+"sel":c;a.setAttribute("class",d)},ListCommon.prototype.handleClick=function(a,b){a=a.closest('[data-list="true"]');if(a.getAttribute("data-botsuggestion")){var c=a.getAttribute("data-suggestiontext");WindowHandler.sendBotSuggestions(b.input,c)}else WMSUI.curtrigger===WmsConstants.TRIGGERS.SLASH||WMSUI.curtrigger==="-"&&b.input.value.indexOf(WmsConstants.TRIGGERS.SLASH)!=-1?Commands.select(b.input,a):WMSUI.curtrigger===WmsConstants.TRIGGERS.ATMENTION||WMSUI.curtrigger===WmsConstants.TRIGGERS.ADDMEM||WMSUI.curtrigger===WmsConstants.TRIGGERS.DELMEM?WMSUI.atMentions.select(b.input,a):WMSUI.curtrigger===WmsConstants.TRIGGERS.SMILEY&&WMSUI.autoComplete.select(b.input,a)},WMSUI.autoComplete={fetchsmileylist:!0,init:function(a,b){WMSUI.atMentions.changeColor(b);var c=b.value.substring(0,b.selectionStart),d="",e=c.lastIndexOf(" "+WmsConstants.TRIGGERS.SMILEY)+1;if(e>0||e===0&&c.indexOf(WmsConstants.TRIGGERS.SMILEY)===0||e===0&&c[c.lastIndexOf(WmsConstants.TRIGGERS.SMILEY)-1]==="\n"){var f=WMSUI.autoComplete.getSearchTerm(a,c);d=WMSUI.autoComplete.populateSmiley(a,f),d&&WMSUI.autoComplete.showUI(a,d,!0,!0)}else WMSUI.autoComplete.hideUI(a)},showUI:function(a,b,c,d){var e=WindowHandler.getWinObjById(a),f=e.autocompletediv,g=e.listcommon;g.showUI(b,c,d),f.style.display="block",e.footernode.style.borderRadius="0px 0px 5px 5px"},hideUI:function(a){var b=WindowHandler.getWinObjById(a);b.autocompletediv.style.display="none",b.editorreplydiv.style.display!=="block"&&(b.footernode.style.borderRadius="5px")},getSearchTerm:function(a,b){var c=/:\w+:/g;b=b.replace(c,"");var d=b.lastIndexOf(WmsConstants.TRIGGERS.SMILEY);if(b[d-1]==="\n"||b[d-1]===" "||d===0)return WMSUI.autoComplete.fetchsmileylist=!0,b.substring(d+1);WMSUI.autoComplete.fetchsmileylist=!1;return},populateSmiley:function(a,b){var c="",d="",e="",f={};if(!WMSUI.autoComplete.fetchsmileylist){WMSUI.autoComplete.hideUI(a);return}if(b){for(var g in Smiley.defaultsmiley_lookup)g.startsWith(":"+b)&&(f[g]=Smiley.defaultsmiley_lookup[g]);for(var h in Smiley.extrasmiley_lookup)h.startsWith(":"+b)&&(f[h]=Smiley.extrasmiley_lookup[h]);b=b.toLowerCase();for(var i in Smiley.extrasmileycode_lookup)Smiley.extrasmileycode_lookup[i].startsWith(b)&&(f[i]=Smiley.extrasmileycode_lookup[i])}else for(var j in Smiley.extrasmileycode_lookup)f[j]=Smiley.extrasmileycode_lookup[j];var k=0;for(var l in f){var m=e.indexOf('<span class="wms-smileyname">'+f[l]+"</span>")!=-1||d.indexOf('<span class="wms-smileyname">'+f[l]+"</span>")!=-1;if(!m){var n=Smiley.extrasmileycode_lookup[l]?":"+f[l]+":":l,o=Smiley.extrasmileycode_lookup[l]?l.replace(/:/g,""):f[l],p=Smiley.extrasmileycode_lookup[l]?f[l]:l;k%2===0?e+='<div class="wms-smileyinnerdiv" data-list="true" data-smileycode="'+n+' "><em class="wmssmils wmssmil-'+o+'"></em><span class="wms-smileyname">'+p+"</span></div>":d+='<div class="wms-smileyinnerdiv" data-list="true" data-smileycode="'+n+' "><em class="wmssmils wmssmil-'+o+'"></em><span class="wms-smileyname">'+p+"</span></div>",k++}}return $WC.$CUtil.getObjectLength(f)?c='<div class="wms-smileylist">'+e+"</div><div>"+d+"</div>":WMSUI.autoComplete.hideUI(a),c},select:function(a,b){var c=a.selectionStart,d=a.getAttribute("chid"),e=document.getElementById(d),f=e.querySelector('[id="wms-editorscrolldiv"]'),g=WindowHandler.getWinObjById(d),h=g.autocompletediv,i=b.getAttribute("data-smileycode"),j=a.value;j=j.substring(0,c);var k=j.lastIndexOf(" "+WmsConstants.TRIGGERS.SMILEY)+1;if(k>0||k===0&&j.indexOf(WmsConstants.TRIGGERS.SMILEY)===0||k===0&&j[j.lastIndexOf(WmsConstants.TRIGGERS.SMILEY)-1]==="\n")j[j.lastIndexOf(WMSUI.curtrigger)-1]==="\n"&&(k=j.lastIndexOf("\n"+WMSUI.curtrigger)+1),a.value=a.value.substring(0,k)+i+a.value.substring(c),util.moveCaretPosition(a,k+i.length,k+i.length),WMSUI.atMentions.setScrollPosition(f,a),WMSUI.atMentions.changeColor(a);g.listcommon.showUI(""),h.style.display="none",WMSUI.currenttrigger="",g.footernode.style.borderRadius="5px"},bringElemToView:function(a,b){if(WMSUI.autoComplete.isViewableInScroll(a)===!1){var c=a.offsetTop-a.parentNode.offsetTop;b===WmsConstants.KEYCODES.UP?a.parentNode.parentNode.scrollTop=c-10:b===WmsConstants.KEYCODES.DOWN&&(a.parentNode.parentNode.scrollTop=c+a.offsetHeight+10-a.parentNode.parentNode.offsetHeight)}},isViewableInScroll:function(a){var b=a.parentNode.parentNode.scrollTop,c=a.parentNode.parentNode.scrollTop+a.parentNode.parentNode.offsetHeight,d=a.offsetTop-a.parentNode.offsetTop,e=d+a.offsetHeight;return d>=b&&e<c?!0:!1}},WMSUI.atMentions={fetchmentionlist:!0,getPartInfo:$WC.$CUtil.debounce(function(a){var b=WindowHandler.getWinObjById(a);b.ctype==="8"&&($WC.$CUtil.getObjectLength(b.partinfo)<b.partcount&&WebMessanger.fetchAndShowChannelMembers(b.objId),WmsChannels.isTeamChannel(a)&&WebMessanger.fetchTeamChannelMembers(a))},null,1e3,!0),init:function(a,b,c){var d=[],e=b.value.substring(0,b.selectionStart),f=e.lastIndexOf(" "+WMSUI.curtrigger)+1,g=WindowHandler.getWinObjById(a),h=g.autocompletediv,i=g.listcommon,j=c&&c.callbackargs&&c.callbackargs.silentload;if(g.disablemembercontrol===!0&&(WMSUI.curtrigger===WmsConstants.TRIGGERS.ADDMEM||WMSUI.curtrigger===WmsConstants.TRIGGERS.DELMEM))return;WMSUI.atMentions.changeColor(b);if(f>0||f==0&&e.indexOf(WMSUI.curtrigger)==0||f==0&&e[e.indexOf(WMSUI.curtrigger)-1]=="\n"){var k=WMSUI.atMentions.getSearchTerm(a,e);WMSUI.atMentions.fetchmentionlist&&(d=WMSUI.atMentions.getContactList(a,k,j))}d&&d.length?(i.showUI(d,!0,null,j),h.style.display="block",g.footernode.style.borderRadius="0px 0px 5px 5px",(d.length<5||$WC.Matcher.check("emailid",k,!0))&&WmsOrgContacts.isCachedRequest(k)===!1&&WmsHybridSearch.getNextResultSet({searchtext:k,inpresultset:WmsHybridSearch.constants.USERLIST,chid:a,topicname:"listview",silentload:!0})):WMSUI.curtrigger===WmsConstants.TRIGGERS.DELMEM&&$WC.$CUtil.getObjectLength(g.partinfo)?Commands.hideLoadingIcon(a):k&&(!c||c.stat!==WmsConstants.REQSTATUS.NORESULTS)?WmsHybridSearch.getNextResultSet({searchtext:k,inpresultset:WmsHybridSearch.constants.USERLIST,chid:a,topicname:"listview"}):WMSUI.autoComplete.hideUI(a)},getDname:function(a,b){if(!b)return;var c=$WC.$CUtil.getContactName(b);if(!c){var d=WindowHandler.getWinObjById(a).partinfo;c=d[b]&&d[b].dname}return c},getSearchTerm:function(a,b){var c=WindowHandler.getWinObjById(a),d=c.atmentions?c.atmentions.split(","):"";$WC.$CUtil.isArray(d)&&d.forEach(function(c){var d=WMSUI.atMentions.getDname(a,c),e='<span class="wms-atmtntext"> '+WMSUI.curtrigger+d+"</span>",f=WMSUI.curtrigger+d;f=f.replace(/(?=[$*+[]() ])/g,"\\");var g=new RegExp(f,"g");b=b.replace(g,e)});var e=/<span class="wms-atmtntext">(.+?)<\/span>/g,f=b.replace(e,""),g=f.lastIndexOf(WMSUI.curtrigger);if(f[g-1]==="\n"||f[g-1]===" "||g===0)return WMSUI.atMentions.fetchmentionlist=!0,f.substring(g+1);WMSUI.atMentions.fetchmentionlist=!1;return},getContactList:function(a,b,c){function j(a){var b=[];if(WindowHandler.getWinObjById(a).atmentions){var c=WindowHandler.getWinObjById(a).atmentions.slice(0,-1).split(",");$WC.$CUtil.isArray(c)&&c.forEach(function(a){b.push(a)})}return b}function k(a,b,c){var d=[],e=[],f;b===WmsConstants.CHANNELS.TEAM?f=WmsChannels.getTeamChannelMembers(a):f=WindowHandler.getWinObjById(a).partinfo;for(var g in f){if(Message.isLocalUser(g))continue;WmsContacts.get(g,!0)?d.push(WmsContacts.get(g,!0)):d.push(WMSUI.atMentions.wrapParticipantsObj(f[g])),e.push(g)}return c?e:d}function l(a){var b=[];return a.filter(function(a){b.push(a.USERID)}),b}function m(a,b){return WmsHybridSearch.filter("DNAME",a,WmsContacts.contactslist,10,b,"USERID","EMAILID")}function n(a,b){return WmsHybridSearch.filter("DNAME",a,WmsOrgContacts.contactslist,10,b,"USERID","EMAILID")}function o(a){return a.filter(function(a){return a.ISBOT?!1:!0})}var d=[],e=[],f=WindowHandler.getWinObjById(a),g=f.ctype,h=g=="8"?!0:!1,i=f.partinfo;WMSUI.atMentions.getPartInfo(a);if(WMSUI.curtrigger===WmsConstants.TRIGGERS.DELMEM&&(!h||WmsChannels.isUserHasPermission(a,WmsConstants.USERPERMISSIONS.REMOVE_MEMBER))){e=j(a);var p=k(a);d=WmsHybridSearch.filter("DNAME",b,p,10,e,"USERID","EMAILID"),WmsOrgContacts.isEmptyResultReq(b)===!1&&!$WC.$CUtil.getObjectLength(i)&&Commands.showLoadingIcon(f.autocompletediv,a);if(p.length>1)return d;$WC.$CUtil.getObjectLength(i)&&Commands.hideLoadingIcon(a)}else{if(WMSUI.curtrigger===WmsConstants.TRIGGERS.ATMENTION&&g!="5"&&(!h||WmsChannels.isUserHasPermission(a,WmsConstants.USERPERMISSIONS.MENTION_USERS))){e=j(a),WmsOrgContacts.isEmptyResultReq(b)===!1&&WmsChannels.isSharedChannel(a)===!1&&!c&&Commands.showLoadingIcon(f.autocompletediv,a),d=WmsHybridSearch.filter("DNAME",b,k(a),10,e,"USERID","EMAILID");if(!h||WmsChannels.isSharedChannel(a)===!1&&$WC.$CUtil.getObjectLength(i))d=d.concat(m(b,k(a,null,!0))),d.length<5&&(d=d.concat(n(b,l(d))));return d}if(WMSUI.curtrigger===WmsConstants.TRIGGERS.ADDMEM&&g!="5"&&(!h||WmsChannels.isUserHasPermission(a,WmsConstants.USERPERMISSIONS.ADD_MEMBER)))return e=j(a).concat(k(a,null,!0)),h&&WmsChannels.isTeamChannel(a)?(c||Commands.showLoadingIcon(f.autocompletediv,a),d=WmsHybridSearch.filter("DNAME",b,k(a,WmsConstants.CHANNELS.TEAM),10,e,"USERID","EMAILID")):(d=o(WmsHybridSearch.filter("DNAME",b,m(b),10,e,"USERID","EMAILID")),d=d.concat(n(b,l(d))),d=WmsHybridSearch.filter("DNAME",b,d,20,null,"USERID","EMAILID")),d}},wrapParticipantsObj:function(a){var b={};return b.DNAME=a.dname||a.DNAME,b.USERID=a.uname||a.ZUID,b.STATUS=a.scode,b.STYPE=a.st,b.EMAILID=a.email||a.EMAILID,b.UC=b.UC||"0",b},select:function(a,b){var c=b.getAttribute("data-userid"),d=a.getAttribute("chid"),e=WebMessanger.unescapeHTML(WMSUI.atMentions.getDname(d,c)||b.getAttribute("data-dname"))+" ",f=a.selectionStart,g=document.getElementById(d),h=g.querySelector('[id="wms-editorscrolldiv"]'),i=WindowHandler.getWinObjById(a.getAttribute("chid")),j=i.autocompletediv,k=a.value;k=k.substring(0,f),WindowHandler.getWinObjById(d).listcommon.showUI(""),j.style.display="none";var l=k.lastIndexOf(" "+WMSUI.curtrigger)+1;if(l>0||l===0&&k.indexOf(WMSUI.curtrigger)===0||l===0&&k[k.lastIndexOf(WMSUI.curtrigger)-1]==="\n")k[k.lastIndexOf(WMSUI.curtrigger)-1]==="\n"&&(l=k.lastIndexOf("\n"+WMSUI.curtrigger)+1),a.value=a.value.substring(0,l+1)+e+a.value.substring(f),util.moveCaretPosition(a,l+e.length+1,l+e.length+1),WMSUI.atMentions.setScrollPosition(h,a),WMSUI.atMentions.insertAtmentions(a.getAttribute("chid"),c),WMSUI.atMentions.changeColor(a);i.footernode.style.borderRadius="5px"},changeColor:function(a){var b=util.escapeHTML(a.value),c=a.getAttribute("chid"),d=WindowHandler.getWinObjById(c),e=d.invisiblediv;d.selectedoptions?e.innerHTML=Commands.format(b,d.selectedoptions,c):d.atmentions&&(e.innerHTML=WMSUI.atMentions.formatAtMentions(b,d.atmentions,c));if(a.getAttribute("data-command")){var f=e.innerHTML;e.innerHTML=f.replace(a.getAttribute("data-command"),'<span class="wms-commandtext">'+a.getAttribute("data-command")+"</span>")}e.scrollTop=a.scrollTop},format:function(a,b){var c="1",d="4",e=function(e,f){a=$WC.Matcher.replace(e,a,function(a,e,g){var h=Message.getDnameFromMetaDataFormat(g),i=g.split(":")[1],j=g.split(":")[2];return b?f+h:'<span class="wms-atmtnlink" '+(j!==c&&j!==d||'data-zcprofileid="'+i+'"')+">"+f+""+h+"</span>"})};e("atmention_for_transcript","@"),e("addmember_for_transcript","+"),e("deletemember_for_transcript","-");var f=function(e,f){a=$WC.Matcher.replace(e,a,function(a,e,g,h){var i=h,j=g,k=e;return b?f+i:'<span class="wms-atmtnlink" '+(j!==c&&j!==d||'data-zcprofileid="'+k+'"')+">"+f+""+i+"</span>"})};return f("atmention","@"),f("addmember","+"),f("deletemember","-"),a},insertAtmentions:function(a,b,c){var d=WindowHandler.getWinObjById(a),e=d.composer.value,f=d.atmentions?d.atmentions.split(","):"";c?(d.atmentions=d.atmentions.replace(b+",",""),d.selectedoptions=d.selectedoptions.replace(WMSUI.atMentions.getDname(a,b)+",","")):f.indexOf(b)<0&&(d.atmentions+=b.concat(","),e.startsWith(WmsConstants.TRIGGERS.SLASH)&&(d.selectedoptions+=WMSUI.curtrigger+WMSUI.atMentions.getDname(a,b).concat(","))),WmsSessionStorage.setChatInfo({chid:a,atmentions:d.atmentions})},formatAtMentions:function(a,b,c,d){var e=Message.getMsgCategory(WindowHandler.getWinObjById(c).invisiblediv.innerHTML),f="";e=="atmentions"||e=="command"?f="@":e=="addmem"?f="+":e=="delmem"?f="-":f=WMSUI.curtrigger,b=b.replace(/,+$/,"");var g=b.split(","),h="";return a=util.escapeHTML(a),$WC.$CUtil.isArray(g)&&g.forEach(function(b){var e=util.escapeHTML(WMSUI.atMentions.getDname(c,b));d?f==="+"?h="{addchatmember:"+b+":1:"+e+":addchatmember}":f==="-"?h="{deletechatmember:"+b+":1:"+e+":deletechatmember}":b.indexOf("b-")===0?h="{mention:"+b+":4:"+e+":mention}":h="{mention:"+b+":1:"+e+":mention}":h='<span class="wms-atmtntext">'+f+e+"</span>";if(e){e=e.replace(/(?=[$*+[]() ])/g,"\\");var g="["+f+"]"+e,i=new RegExp(g,"g");i.test(a)||WMSUI.atMentions.insertAtmentions(c,b,!0),a=a.replace(i,function(){return h})}}),a},setScrollPosition:function(a,b){var c=b.value.substring(0,b.selectionStart);a.innerHTML=util.escapeHTML(c),b.scrollTop=a.scrollHeight,a.innerHTML=""},replaceAtMentionsForHtml:function(a,b){var c=/<span(?:.*?)data-zcprofileid="(.*?)">@(.*?)<\/span>/g,d="";return a.replace(c,function(a,c,e){var f=$WC.$CUtil.getContactName(c,e,b);d+="{mention:"+c+":1:"+f+":mention}"}),d},isLocationAllowedForMentionedBots:function(a){var b=WindowHandler.getWinObjById(a),c=b.atmentions.split(",");return c.some(function(a){if(a.indexOf("b-")!==-1){var b=WmsContacts.contactslist[a];if(b&&b.PERMISSION)return(b.PERMISSION&2)>0}})}};var Commands={};Commands.get=function(a){var b=WmsSessionStorage.getItem("commands")||{};b.listchecksum||(b.listchecksum=-1,b.detailschecksum=-1,WmsSessionStorage.setItem("commands",b));var c={listchecksum:b.listchecksum,detailschecksum:b.detailschecksum},d="listchecksum="+c.listchecksum+"&detailschecksum="+c.detailschecksum+"&"+_WMSCFPARAMNAME+"="+Cookie.getCustomCookie(_WMSCFCOOKIENAME),e=function(){var b=JSON.parse(this.response);b.meta.updatetype&&(b.meta.updatetype===2?(Commands.updateList(b.data,b.meta),Commands.show(a)):b.meta.updatetype===1&&Commands.getSpecifiedCommands(b.data.commands))};$WC.Ajax.requestToChat("v1/commands",d,e)},Commands.showLoadingIcon=function(a,b){var c=WindowHandler.getWinObjById(b),d='<div class="wms-cmdloading"><div class="wms-loadingicon"><img src="https://img.zohostatic.com/ichat/v282_https/images/loading1.gif"></div></div>';c.listcommon.showUI(d,!1,!0),a.style.display="block",c.footernode.style.borderRadius="0px 0px 5px 5px"},Commands.hideLoadingIcon=function(a){var b=WindowHandler.getWinObjById(a),c=b.autocompletediv;b.listcommon.showUI(""),c.style.display="none",b.footernode.style.borderRadius="5px"},Commands.showProgressBar=function(a){Commands.removeProgressBar(a);var b='<div id="loadingline" class="wms-loadinglinediv"><div class="wms-loadingline"></div></div>',c=WindowHandler.getWinObjById(a).autocompletediv;c.insertAdjacentHTML("beforebegin",b)},Commands.removeProgressBar=function(a){var b=document.getElementById(a).querySelector('[id="loadingline"]');$WC.$CUtil.removeElement(b)},Commands.show=function(a,b){var c=WmsSessionStorage.getItem("commands"),d=WindowHandler.getWinObjById(a),e=d.autocompletediv,f=d.composer.value;if(!c){Commands.get(a),c=WmsSessionStorage.getItem("commands"),Commands.showLoadingIcon(e,a);return}Commands.remove(e,a);var g=f.lastIndexOf(" "+WMSUI.curtrigger)+1;if(!b)if(g!=0&&f.indexOf(WMSUI.curtrigger)!=0||!f.startsWith(WMSUI.curtrigger))return;var h='<div class="wms-commandlist" data-command="{{commandname}}" data-list="true"><span class="wms-commandname wms-truncate-ellipsis" title="{{commandname}}">{{commandname}}</span><span title="{{commandhint}}" class="wms-commandhint wms-truncate-ellipsis">{{commandhint}}</span></div>',i="",j=Commands.getSearchTerm(d.composer),k="";if(b){j=j.substring(1),k=f.split(" ")[0],WMSUI.atMentions.changeColor(d.composer,!0);var l=Commands.getByName(k).options,m=d.selectedoptions.split(",");for(var n=0;n<m.length;n++)if(m[n]!==""&&m[n].indexOf(j)!==-1){var o=m[n].substring(1);delete l[o]}for(var p in l){var q=l[p];p.startsWith(j)&&(i+=$WC.template.replace(h,{commandname:"-"+p,commandhint:q}))}}else{WMSUI.atMentions.changeColor(d.composer,!0);for(var r in c.list){k=c.list[r].name;var s=c.list[r].hint;k.startsWith(j)&&(i+=$WC.template.replace(h,{commandname:"/"+k,commandhint:s}))}}CommandSuggestions.init(a,j),i!=""&&(d.listcommon.showUI(i,!0,!0),e.style.display="block",d.footernode.style.borderRadius="0px 0px 5px 5px")},Commands.remove=function(a,b){var c=WindowHandler.getWinObjById(b);c.listcommon.showUI(""),a.style.display="none",c.footernode.style.borderRadius="5px"},Commands.getSearchTerm=function(a){var b=a.selectionStart,c=a.value.substring(1,b);return c.substring(c.lastIndexOf(" "+WMSUI.curtrigger)+1,b)},Commands.isCommandMsg=function(a){return a.startsWith(WmsConstants.TRIGGERS.SLASH)?!0:!1},Commands.getCommandId=function(a){var b=a.substr(0,a.indexOf(" ")),c=Commands.getByName(b);if(c)return c.id},Commands.select=function(a,b){if(b.getAttribute("data-suggestion"))CommandSuggestions.handleClick(a,b);else{var c=b.getAttribute("data-command");a.setAttribute("data-command",c);var d=a.selectionStart,e=a.value.substring(0,d).lastIndexOf(" "+WMSUI.curtrigger)+2,f=a.getAttribute("chid"),g=WindowHandler.getWinObjById(f),h=g.autocompletediv,i=g.invisiblediv;g.selectedoptions+=c.concat(","),i.innerHTML='<span class="wms-commandtext">/'+c.substring(1)+"</span>",Commands.remove(h,f);var j=a.value;a.value=j.substring(0,e)+c.substring(1)+" "+j.substring(d),util.moveCaretPosition(a,e+c.length,e+c.length),WMSUI.atMentions.changeColor(a,!0),CommandSuggestions.init(f,c.substring(1))}},Commands.format=function(a,b,c){var d=WindowHandler.getWinObjById(c);if(b!==""&&a!==""){var e=b.split(",");for(var f=0;f<e.length;f++){var g=new RegExp(util.escapeHTML(e[f]),"g");if(e[f]==="")continue;g.test(a)||(d.selectedoptions=b.replace(e[f]+",","")),a=a.replace(g,'<span class="wms-commandtext">'+e[f]+"</span>")}}return a},Commands.handle=function(a,b,c){var d=WindowHandler.getWinObjById(c),e=!0,f=Commands.getByName(a).id,g=WebMessanger.unescapeHTML(WMSUI.atMentions.formatAtMentions(b.value,d.atmentions,c,!0)),h="&commandid="+f;$WC.$CUtil.isEmptyString(CommandSuggestions.getSelections(c))||(h+="&selections="+CommandSuggestions.getSelections(c));var i=!0;return e=Message.send(c,g,[],f,h,i),d.selectedoptions="",Commands.showProgressBar(c),e},Commands.clear=function(){WmsSessionStorage.removeItem("commands")},Commands.showResponse=function(a,b,c){Commands.removeProgressBar(a);var d=WindowHandler.getWinObjById(a),e=[];c.output||(c.output={}),c.output.sender=b+"command";if(!c.output.meta){c.output.meta={},c.output.meta.usermessagedetails={};var f=Commands.getById(b).name;c.output.meta.usermessagedetails.msg_title=f}if(c.status==="Success"&&c.output){if(!c.output.msg)return;e.push(c.output)}else if(c.status==="Failure")if(!$WC.$CUtil.isEmpty(c.resumeUrl))Commands.showAuthenticationPrompt(c,b);else{var g={sender:c.output.sender,time:c.output.time,meta:c.output.meta,msg:c.errorMsg||WmsResource.getRealValue("commands.exec.error")};e.push(g)}d.updateMessage(e)},Commands.showAuthenticationPrompt=function(a,b){if(document.getElementById("zcwindows")===null){var c=document.createElement("div");c.id="zcwindows",c.className="zcoverlay",c.style.zIndex=WebMessanger.setzindex,document.body.appendChild(c)}var d,e="<b>"+a.connectionDetails.serviceName+"</b>";if($WC.$CUtil.isBotChid(b)){var f=WmsChannels.getBotId(b),g=WmsContacts.contactslist[f].DNAME;d="<b>"+g+"</b>"}else Commands.getById(b)&&(d="<b>"+Commands.getById(b).name+"</b>");$WC.$Dlg.confirm({id:"wms_oauthprompt",bodyhtml:WmsResource.getRealValue("common.access.permission",[d,e]),imagehtml:"<img src="+a.connectionDetails.imageUrl+">",buttons:[{text:WmsResource.getRealValue("common.authenticate"),colour:1,action:function(){window.open(a.resumeUrl)}}]})},Commands.getObject=function(a){var b=WmsSessionStorage.getItem("commands")||{};return b.list[a]},Commands.deleteObj=function(a){var b=WmsSessionStorage.getItem("commands");delete b.list[a.commandid],WmsSessionStorage.setItem("commands",b)},Commands.updateList=function(a,b){b&&b.updatetype===2&&Commands.clear();var c=WmsSessionStorage.getItem("commands")||{},d=c.list||{},e=function(a,b){for(var c in b)if(b.isdefault)if(typeof b[c]=="object"&&b[c].constructor==Object){a[c]||(a[c]={});for(var d in b[c])a[c][d]=typeof b[c][d]=="boolean"?b[c][d]:WmsResource.getRealValue(b[c][d])}else if($WC.$CUtil.isArray(b[c])){a[c]||(a[c]=[]);for(var e=0;e<b[c].length;e++)a[c][e]=typeof b[c][d]=="boolean"?b[c][e]:WmsResource.getRealValue(b[c][e])}else a[c]=typeof b[c]=="boolean"?b[c]:WmsResource.getRealValue(b[c]);else a[c]=b[c];return a},f=function(a){for(var b=0;b<a.length;b++){var c=a[b],f=c.id;d[f]=d[f]||{},d[f]=e(d[f],c)}};f(a.commands),f(a.systemcommands),c.list=WmsHybridSearch.filter("name","",d,"","","","","name"),c.listchecksum=b?b.listchecksum:c.listchecksum,c.detailschecksum=b?b.detailschecksum:c.detailschecksum,WmsSessionStorage.setItem("commands",c)},Commands.getSpecifiedCommands=function(a){var b=WmsSessionStorage.getItem("commands"),c=[];for(var d in b.list)a[d]!=b.list[d].detailschecksum&&c.push(b.list[d].id);if(c.length>0){var e=c.join(","),f=function(){var a=JSON.parse(this.response);Commands.updateList(a.data,a.meta)};$WC.Ajax.postRequestToChat("v1/commands",e,f)}},Commands.getAllowedTriggers=function(a){var b=a.getAttribute("data-command");if(!b)return;return["@","-","/",":"]},Commands.getByName=function(a){var b=WmsSessionStorage.getItem("commands");if(!b)return;a=a.toLowerCase();for(var c in b.list){var d="/"+b.list[c].name.toLowerCase();if(a==d)return b.list[c]}},Commands.getById=function(a){var b=WmsSessionStorage.getItem("commands");if(!b)return;for(var c in b.list)if(a==b.list[c].id)return b.list[c]},Commands.isLocationAllowedForExecution=function(a){var b=Commands.getById(a);return(b.permission&1)>0},Commands.isLocationAllowedForSuggestion=function(a){var b=Commands.getById(a);return(b.permission&2)>0};var CommandSuggestions={};CommandSuggestions.prevSugg=null,CommandSuggestions.suggestiontimer="",CommandSuggestions.execute=function(a,b,c,d){var e="chid="+b+"&message="+encodeURIComponent(c);d&&(e+="&selections="+d);var f=function(){var d=JSON.parse(this.response).data;d.status==="Success"&&CommandSuggestions.prevSugg===c?CommandSuggestions.populate(b,d.result.output):d.status==="Failure"&&(Commands.hideLoadingIcon(b),Commands.showAuthenticationPrompt(d,a))},g=function(){Commands.hideLoadingIcon(b)};Commands.isLocationAllowedForSuggestion(a)?$WC.Ajax.postRequestToChatWithLocation("v1/commands/"+a+"/suggestions",e,f,g):$WC.Ajax.postRequestToChat("v1/commands/"+a+"/suggestions",e,f,g)},CommandSuggestions.populate=function(a,b){if(!b.length){Commands.hideLoadingIcon(a);return}var c="",d=WindowHandler.getWinObjById(a),e=d.autocompletediv,f=b[0],g=f&&f.imageurl&&!f.title&&!f.description;for(var h=0;h<b.length;h++){var i="",j=b[h].id,k=b[h].title,l=b[h].description,m=b[h].imageurl;g?i+='<div data-list="true" class="wms-cmdsuggimgdiv" data-suggestion="true" data-imgurl="{{IMGURL}}"><img src="{{IMGURL}}" class="wms-cmdsuggimg"></div>':k&&(i+='<div class="wms-cmndlist wms-filefrwrdcontact" data-list="true" data-suggestion="true" data-id="{{ID}}" data-title="{{TITLE}}" data-desc="{{DESC}}" data-imgurl="{{IMGURL}}">',m?i+='<img class="wms-filefrwrdcontactimg wms-cmndlistimg" src="{{IMGURL}}"><div class="wms-cmndlistdetails">':i+='<div class="wms-cmndlistdetails wms-valign-mid-block">',i+='<div class="wms-filefrwrdcontactdetails wms-cmndlisttitle wms-truncate-ellipsis" title="{{TITLE}}">{{TITLE}}</div>',l&&(i+='<div class="wms-cmndlistdesc wms-truncate-ellipsis" title="{{DESC}}">{{DESC}}</div>'),i+="</div></div>"),c+=$WC.template.replace(i,{ID:j?j:"",TITLE:k?k:"",DESC:l?l:"",IMGURL:m?m:""})}d.listcommon.showUI(c,!0,!0),e.style.display="block",d.footernode.style.borderRadius="0px 0px 5px 5px"},CommandSuggestions.handleClick=function(a,b){var c=a.value,d=a.getAttribute("chid"),e=WindowHandler.getWinObjById(d),f=!1,g={};e.selectedoptions+=b.getAttribute("data-title")+",",b.getAttribute("data-title")&&(g.title=b.getAttribute("data-title"),f=!0),b.getAttribute("data-desc")&&(g.description=b.getAttribute("data-desc")),b.getAttribute("data-imgurl")&&(g.imageurl=b.getAttribute("data-imgurl")),b.getAttribute("data-id")&&(g.id=b.getAttribute("data-id")),g=$WC.$CUtil.isEmptyObject(g)?"":JSON.stringify([g]);var h=a.getAttribute("data-command"),i=Commands.getByName(h),j=i.id,k="&commandid="+j;$WC.$CUtil.isEmptyObject(g)||(k+="&selections="+encodeURIComponent(g)),CommandSuggestions.format(e,b),CommandSuggestions.init(d,a.value.trim(),CommandSuggestions.getSelections(d)),i.display_props&&i.display_props.clicktosend?(Message.send(d,c,[],j,k,f),e.listcommon.showUI(""),e.autocompletediv.style.display="none",e.footernode.style.borderRadius="5px",a.value="",e.invisiblediv.innerHTML=""):CommandSuggestions.isSelectionLimitReached(i,d)&&(Commands.handle(h,a,d),e.listcommon.showUI(""),e.autocompletediv.style.display="none",e.footernode.style.borderRadius="5px",a.value="",e.invisiblediv.innerHTML="")},CommandSuggestions.format=function(a,b){var c=b.getAttribute("data-title"),d=' <span class="wms-commandtext" data-suggestion=true data-title="'+b.getAttribute("data-title")+'" data-desc="'+b.getAttribute("data-desc")+'" data-imgurl="'+b.getAttribute("data-imgurl")+'" data-id="'+b.getAttribute("data-id")+'">'+b.getAttribute("data-title")+"</span> ",e=a.invisiblediv.childNodes,f="",g="",h=!0;e.forEach(function(a){a.nodeType===Node.TEXT_NODE&&a.textContent!==" "?(f+=c?c:a.textContent.trim()+" ",g+=d,h=!1):a.textContent!==" "&&(f+=a.textContent+" ",g+=" "+a.outerHTML)}),a.invisiblediv.innerHTML=h?g.trim()+d:g.trim(),a.composer.value=h&&c?f+c:f},CommandSuggestions.isSelectionLimitReached=function(a,b){var c=WindowHandler.getWinObjById(b),d="/"+a.name+",",e=new RegExp(d+"|^,\\s*|,\\s*$","g"),f=c.selectedoptions.replace(e,"").split(","),g=f.length,h=a.display_props&&a.display_props.selectionlimit;if(g===h)return!0},CommandSuggestions.getSelections=function(a){var b=WindowHandler.getWinObjById(a),c=[],d=b.invisiblediv.querySelectorAll("[data-suggestion]");for(var e=0;e<d.length;e++){var f={};d[e].getAttribute("data-title")&&(f.title=encodeURIComponent(d[e].getAttribute("data-title"))),d[e].getAttribute("data-desc")&&(f.description=encodeURIComponent(d[e].getAttribute("data-desc"))),d[e].getAttribute("data-imgurl")&&(f.imageurl=encodeURIComponent(d[e].getAttribute("data-imgurl"))),d[e].getAttribute("data-id")&&(f.id=encodeURIComponent(d[e].getAttribute("data-id"))),c.push(f)}return c.length?JSON.stringify(c):""},CommandSuggestions.getFormattedNode=function(a){var b=a.getAttribute("data-title"),c=a.getAttribute("data-desc"),d=a.getAttribute("data-imgurl"),e=a.getAttribute("data-id");return' <span class="wms-commandtext" data-suggestion=true data-title="'+b+'" data-desc="'+c+'" data-imgurl="'+d+'" data-id="'+e+'">'+b+"</span>"},CommandSuggestions.init=function(a,b,c){var d=WindowHandler.getWinObjById(a);if(d.selectedoptions!=""){var e=d.composer.getAttribute("data-command"),f=Commands.getByName(e);if(f&&!f.isdefault&&f.execution_props["suggest.id"]){var g=f.id;CommandSuggestions.prevSugg!=b&&b&&(clearTimeout(CommandSuggestions.suggestiontimer),CommandSuggestions.prevSugg="/"+b,Commands.showLoadingIcon(d.autocompletediv,a),CommandSuggestions.suggestiontimer=setTimeout(function(){CommandSuggestions.execute(g,a,"/"+b,c)},1e3))}}};var $WC=$WC||{};$WC.CMsgUtil={UserMention:1,GroupMention:2,ChannelMention:3,BotMention:4,isCustomMessage:function(a){return a?!$WC.$CUtil.isEmptyObject(a["brief.msg"]):!1},isCustomFormattedMsg:function(a){return a?typeof a["long.msg"]!="undefined"&&a["long.msg"].length>0:!1},getDisplayContent:function(a,b){var c=a.msg;return c?(c=c.trim(),c=this.getMarkedDownContent(c,b),$WC.Matcher.check("atmentiontemplate",c)&&(c=this.getDisplayableMention(a,c,'<span elemtype="{MENTIONELEMTYPE}" hover="true" uid="$1" class="hvrinfo" mentionedid="$1" {MENTIONATTRIBUTES}>$2</span>')),c):""},getDisplayableMention:function(a,b,c){var d=typeof a.ctype!="undefined"?parseInt(a.ctype):1,e=' mention_on="'+d+'"';return $WC.Matcher.replaceWithFlag("atmentiontemplate",b,"g",function(a,b,d,f,g){var h=f.split(":"),i=h[0].slice(1),j=h[1],k=parseInt(h[2]),l="";h=h.slice(3),h.pop();var m=$WC.$CUtil.decodeHTMLEntities(h.join(":"));m=$WC.$CUtil.processXSS(m);if(k===$WC.CMsgUtil.UserMention){var n=i=="addchatmember"?"+":i=="deletechatmember"?"-":"@";m=n+m,l="user"}else k===$WC.CMsgUtil.GroupMention?(m="@"+m,l="group"):k===$WC.CMsgUtil.ChannelMention?l="channel":k===$WC.CMsgUtil.BotMention&&(m="@"+m,l="user");var o=e+' mentiontype="'+k+'"',p=c.replace(/{MENTIONATTRIBUTES}/g,o).replace(/{MENTIONELEMTYPE}/g,l).replace(/\$1/g,j).replace(/\$2/g,$WC.Matcher.replace("escapeReplacementString",m));return p})},getMarkedDownContent:function(a,b){a=a.trim(),a=Smiley.replace(a),a=this.trim(a);if(!b){var c=a.split(" "),d=[];for(var e=0;e<c.length;e++){var f=c[e];f=this.convertLinks(f),f===c[e]&&(f=this.convertMailIds(f)),f=this.getSafeATagTarget(f),f=this.addAttributesToViewableImg(f),d.push(f)}a=d.join(" ")}return a},trim:function(a){return a=a.replace(/<p>/gi,"").replace(/<\/p>/gi,"").replace(/\n/gi,"<br>"),a},convertMailIds:function(a){return a=" "+a,a=$WC.Matcher.replaceWithFlag("mail",a,"gi"),a=a.trim(),a},convertLinks:function(a){return a=" "+a,a=$WC.Matcher.replaceWithFlag("linkRegExp",a,"gi",function(b,c){return b!==a&&$WC.Matcher.check("invalidlink",$WC.$CUtil.decodeHTMLEntities(a))?b:"<a href='"+c+"' target='_blank'>"+c+"</a>"}),a=$WC.Matcher.replaceWithFlag("WWWlinkRegExp",a,"gi",function(b,c,d){return b!==a&&$WC.Matcher.check("invalidlink",$WC.$CUtil.decodeHTMLEntities(a))?b:c+"<a href='http"+""+"://"+d+"' target='_blank'>"+d+"</a>"}),a=$WC.Matcher.replaceWithFlag("twoletterendinglink",a,"gi","$1<a href='http://$2' target='_blank'>$2</a>"),a=$WC.Matcher.replaceWithFlag("threeletterendinglink",a,"gi","$1<a href='http://$2' target='_blank'>$2</a>"),a=a.trim(),a},getSafeATagTarget:function(a){return $WC.Matcher.replacer($WC.Matcher.getRegexToGetAttrValueInHtmlTag("a","href"),null,a,function(a,b,c,d,e,f,g,h){return e.indexOf("mailto:")===0?a:b+e+g+' dataurl="'+$WC.$CUtil.processXSS(e)+'" '+h})},addAttributesToViewableImg:function(a){return $WC.Matcher.replacer($WC.Matcher.getRegexToAddAttrToHtmlTag("img"),null,a,'$1 documentclick="viewattachment" previewelem $3')},getFormattedMsgContent:function(a){function C(a){var b=a.data,c="";for(var d=0;d<b.length;d++)c+="<li>"+$WC.CMsgUtil.getMarkedDownContent(""+b[d])+"</li>";return c}var b="",c=a["long.msg"];for(var d=0;d<c.length;d++){var e=c[d],f=e.buttons,g=f&&f.length?"zccustmsg":"";b+='<div class="msgbox '+g+'" >',b+=e.title?'<div class="msgtitle ellips"><span class="subtitle">'+this.getMarkedDownContent(""+e.title)+"</span></div>":"";if(e.type==="text")b+=['<div class="cntmsgtxt">',"<div>"+this.getMarkedDownContent(e.data)+"</div>","</div>"].join("");else if(e.type==="list"){var h="";e.styles&&(h=e.styles.type);var i=h?h:"non_type";b+=['<div class="msgcntbdy dIB">','<ul class="lst mrgL8 '+i+'">'+C(e)+"</ul>","</div>"].join("")}else if(e.type==="table"){var j=[];e.styles&&e.styles.width&&(j=e.styles.width);var k=j.length?"tblefxed":"";b+='<div class="msgcntbdy dIB">',b+='<div class="msgtble"><div class="msgtblecnt '+k+'">';var l=e.data.rows,m=e.data.headers,j=[];e.styles&&e.styles.width&&(j=e.styles.width),b+='<div class="tblerow">';for(var n=0;n<m.length;n++){var o=j[n]?"style=width:"+j[n]+"%":"";b+='<div class="tblecel" '+o+">"+this.getMarkedDownContent(""+m[n])+"</div>"}b+="</div>";if(l)for(var p=0;p<l.length;p++){var q=l[p];b+='<div class="tblerow">';for(var r=0;r<q.length;r++)b+='<div class="tblecel">'+(q[r]?this.getMarkedDownContent(""+q[r]):"-")+"</div>";b+="</div>"}b+="</div></div></div>"}else if(e.type==="images"){var s=$WC.$CUtil.getAspectRatioFit(e.data[0].width,e.data[0].height,300,200,!1),t="";for(var u=0;u<e.data.length;u++){var v=e.data[u];t+='<img previewelem purpose=custom_image_preview style="height:'+s.height+'px; width: auto;" src="'+v.url+'" />'}b+='<div class="zcimgsldr" style="height:'+s.height+'px;">'+t+"</div>"}else if(e.type==="image"){if($WC.$CUtil.isEmptyObject(e.data))continue;var w=e.data;b+='<div><img previewelem purpose=custom_image_preview style = "max-width:100%; width:'+(w.width?w.width+"px;":"100%;")+" height="+(w.height?w.height+"px;":"224px;")+'" src="'+e.url+'" /></div>'}else if(e.type==="label"){b+='<div class="msgcntbdy dIB"><div class="msgtble"><div class="thmeslabcnt">';var x=e.styles,y="",j="100%";x&&(y=x.short?"dIB":"",j="50%");for(var z=0;z<e.data.length;z++){var A=e.data[z];for(var B in A)b+='<div class="zclblpair '+y+'" style="width:'+j+';"><div class="zcmslble">'+this.getMarkedDownContent(B)+"</div>"+'<div class="zcmsnme">'+this.getMarkedDownContent(A[B])+"</div></div>"}b+="</div></div></div>"}b+=f?$WC.CustomMsgUI.getButtonHTML(a,f,!0):"",b+="</div>",b=b.replace(/PRIMARY_INDEX/g,d)}return b},handleButtons:function(a,b,c,d,e){var f=$WC.CustomMsg.getMsgObj(a,d,e);if(!f)return;var g;if(f["btnindexvsdetails.msg"]){var h=a.getAttribute("btnindex");g=f["btnindexvsdetails.msg"][h]}else{var i=a.parentElement.getAttribute("primaryindex"),h=a.getAttribute("index"),j=i?f["long.msg"][i]:f["brief.msg"];g=j.buttons[h]}var k=g.action,l=k.data;if(typeof l=="undefined")return;var m=k.type,n=k.confirm,d=f.chid,o=f.sender,e=f.time,p;typeof n!="undefined"&&(p=$WC.$CUtil.extend(!0,{},n),p.type="confirm");if(m!=="undefined")if(m==="invoke.function"){if(l.name!=="undefined"){var q=l.name;$WC.$Win.destroy("custommsg"),typeof p!="undefined"?(p.btncallback=function(){typeof c=="function"&&c(q,d,e,a.getAttribute("btnindex"))},$WC.Widgets.construct(p)):typeof c=="function"&&c(q,d,e,a.getAttribute("btnindex"))}}else if(m==="open.url"){if(l.web!=="undefined"){var r=l.web;typeof p!="undefined"?(p.btncallback=function(){window.open(r,"_blank")},$WC.Widgets.construct(p)):window.open(r,"_blank")}}else if(m==="system.api"){var s=l.api;typeof s!="undefined"&&typeof $WC.$CUtil.getConfig("SystemApiHandler")=="function"&&($WC.$Win.destroy("custommsg"),$WC.$CUtil.getConfig("SystemApiHandler")(s,{chid:d,sender:o}))}},getBriefMsgTitle:function(a){var b=a["brief.msg"];return typeof b.title!="undefined"?(b.icon?'<img class="zcprvwicn" src="'+b.icon+'"/>':"")+this.getMarkedDownContent(b.title):""},getMsgObjVersion:function(a){return typeof a.version!="undefined"?a.version:"v0"},getImageUrlFromId:function(a){return $WC.$CUtil.getConfig("CHATCONT")?"/"+$WC.$CUtil.getConfig("CHATCONT")+"/v1/images/"+a:"/v1/images/"+a},convertMsgObj:function(a){var b=$WC.CMsgUtil.getMsgObjVersion(a);switch(b){case"v0":var c=$WC.$CUtil.cloneObject(a),d=$WC.$CUtil.cloneObject(a),e=a.mtype?a.mtype:"12";switch(e){case"12":if(typeof c.meta!="undefined"){var f=c.meta.usermessagedetails;if(typeof f!="undefined"){var g={};typeof f.custom_sender_name!="undefined"&&(g.name=f.custom_sender_name,typeof f.hiddensender!="undefined"&&(g.hiddensender=f.hiddensender)),typeof f.custom_sender_imageurl!="undefined"?g.img=f.custom_sender_imageurl:typeof f.custom_sender_imageid!="undefined"&&(g.img=this.getImageUrlFromId(f.custom_sender_imageid)),typeof f.custom_sender_id!="undefined"&&(g.id=f.custom_sender_id),typeof c.meta.ms!="undefined"&&(g.ms=c.meta.ms),d["custom.sender"]=g;var h={};typeof f.msg_title!="undefined"&&(h.title=f.msg_title),a.meta.usermessagedetails.custom_message&&typeof c.msg!="undefined"&&(h.desc=c.msg),typeof f.thumbnail_url!="undefined"?h.thumbnail=f.thumbnail_url:typeof f.thumbnail_id!="undefined"?h.thumbnail=this.getImageUrlFromId(f.thumbnail_id):typeof f.thumbnail_zuid!="undefined"&&(h.thumbnail=WmsContacts.getUserPhoto(f.thumbnail_zuid)),typeof f.thumbnail_preview_url!="undefined"?h.img=f.thumbnail_preview_url:typeof f.thumbnail_preview_id!="undefined"&&(h.img=this.getImageUrlFromId(f.thumbnail_preview_id)),typeof f.icon_url!="undefined"&&(h.icon=f.icon_url),typeof f.themeid!="undefined"&&(h.themeid=f.themeid),typeof f.buttons!="undefined"&&(h.buttons=f.buttons),d["brief.msg"]=h}typeof c.meta.formattedmsg!="undefined"&&(d["long.msg"]=$WC.$CUtil.cloneArray(c.meta.formattedmsg)),typeof c.meta.config!="undefined"&&(d.config=$WC.$CUtil.cloneObject(c.meta.config)),typeof c.meta.linkdetails!="undefined"&&(d.info={type:"unfurling",linkdetails:$WC.$CUtil.cloneObject(c.meta.linkdetails),quotedlink:c.meta.quotedlink}),typeof c.meta.btnindexvsdetails!="undefined"&&(d["btnindexvsdetails.msg"]=$WC.$CUtil.cloneObject(c.meta.btnindexvsdetails)),typeof c.meta.opr_replydetails!="undefined"&&(d.isreply=!0,d.replied={info:$WC.$CUtil.cloneObject(c.meta.opr_replydetails)}),delete d.meta}typeof c.temp_info!="undefined"&&typeof c.temp_info.suggestions!="undefined"&&(d.botSuggestions=$WC.$CUtil.cloneArray(c.temp_info.suggestions));break;case"16":d.info=$WC.$CUtil.cloneObject(c.msg,!0),delete d.msg,d.info.type="operations",!$WC.$CUtil.isEmpty(d.info.opruser)&&!$WC.$CUtil.isEmptyObject(d.info.opruser)&&(d.sender=d.info.opruser.zuid);break;case"20":typeof c.meta!="undefined"&&typeof c.meta.opr_replydetails!="undefined"&&(d.isreply=!0,d.replied={info:$WC.$CUtil.cloneObject(c.meta.opr_replydetails)},delete d.meta),d.info=$WC.$CUtil.cloneObject(c.msg,!0),delete d.msg,d.info.type="attachments",d.info.mod=c.mod,c.wmsfilesharingtype&&(d.info.wmsfilesharingtype=c.wmsfilesharingtype)}a=d,a.version="v1",typeof a.msgid!="undefined"&&(a.ack=a.msgid),a.id=a.time,delete a.msgid}return a}};var $WC=$WC||{};$WC.WindowObject=function(a){this.id=a.id,this.draggable=typeof a.draggable!="undefined"?a.draggable:!1,this.nav=a.nav===!0,this.sigleton=a.sigleton===!0,this.bg=typeof a.bg!="undefined"?a.bg:!0,this.opencallback=typeof a.openfn!="undefined"?a.openfn:null,this.closecallback=typeof a.closefn!="undefined"?a.closefn:null,this.closebeforecallback=typeof a.closebeforefn!="undefined"?a.closebeforefn:null,this.closeoutside=typeof a.closeoutside!="undefined"?a.closeoutside:!1,this.aligncenter=typeof a.aligncenter!="undefined"?a.aligncenter:!0},$WC.WindowObject.prototype={create:function(a){var b=this.id,c=this.getTemplate(),d=this.aligncenter?" zcalgncntr":"",e='<span id="winclose" title="'+$WC.Resource.getRealValue("common.to.close")+'" class="zchat-close cclose"></span>',f=a.additionalattrs||"";c=c.replace(/{WININDEX}/g,b).replace(/{WINCLASS}/g,typeof a.class!="undefined"?a.class+d:d).replace(/{WINHEADER}/g,typeof a.header!="undefined"?$WC.Matcher.replace("escapeReplacementString",a.header):"").replace(/{WINCLOSE}/g,typeof a.closehtml!="undefined"?$WC.Matcher.replace("escapeReplacementString",a.closehtml):e).replace(/{DRAGGABLE}/g,this.draggable?"drag":"").replace(/{WINADDITIONALATTR}/g,f).replace(/{WINHTML}/g,$WC.Matcher.replace("escapeReplacementString",a.html));var g=document.getElementById("zcwindows");if(!g)return;g.insertAdjacentHTML("beforeend",c);var h=this.getelem(),i=this;return Gator(h).on("mousedown",function(a){i.handleClick(i,a)}),this.getMeFront(),this.focusInputField(),this.opencallback!=null&&this.opencallback(this.id),this.draggable&&Gator(h).on("mousedown",".drag",function(a){i.drag(a,i)}),$WC.$Win.current=b,this.get()},focusInputField:function(){var a=this.getelem();if(!a)return;var b=a.querySelectorAll("input[type=text]");if(b.length)b[0].focus();else{var c=a.querySelectorAll("textarea");c.length&&c[0].focus()}},handleClick:function(a,b){var c=b.target.id,d={winnav:function(){a.sigleton&&$WC.$Win.destroy(a.id)},winclose:function(){$WC.$Win.destroy(a.id)}},e=d[c];typeof e=="function"&&e()},drag:function(a,b){function f(a){a.preventDefault();var b=c.style;b.left=a.clientX-d+"px",b.top=a.clientY-e+"px"}function g(a){Gator(c).off("mousemove"),Gator(c).off("mouseup"),a.preventDefault}if(a.which!=1&&a.target.tagName==="INPUT")return;var c=b.getelem();if(!c)return;var d=a.clientX-c.offsetLeft,e=a.clientY-c.offsetTop;Gator(c).on("mousemove",f),Gator(c).on("mouseup",g)},close:function(){var a=this.getelem();if(!a)return;this.closebeforecallback!=null&&this.closebeforecallback(this.id),a.remove(),this.closecallback!=null&&this.closecallback(this.id)},getelem:function(){return document.getElementById(this.id)},get:function(){return $WC.$CUtil.getConfig("PUREJS")===!0?this.getelem():window.jQuery?jQuery("#"+this.id):$("#"+this.id)},getMeFront:function(){var a=this.getelem();if(!a)return;var b=a.querySelectorAll("#winnav");b.length&&b.remove();if(this.nav&&$WC.$Win.persists()){var c=a.querySelectorAll("#winhead")[0];c.insertAdjacentHTML("afterbegin",'<span id="winnav" title="'+$WC.Resource.getRealValue("common.back")+'" class="zchat-zcheadicn mrgR10 fl_left"></span>')}$WC.$CUtil.removeClass(a,"zcbg_mask"),this.bg&&$WC.$CUtil.addClass(a,"zcbg_mask"),this.handleCloseOutside(),a.parentNode.appendChild(a)},handleCloseOutside:function(){var a=this.getelem(),b=this;this.closeoutside&&(a.insertAdjacentHTML("afterbegin",'<div class="zcbg_mask"></div>'),Gator(a).on("click",".zcbg_mask",function(){$WC.$Win.destroy(b.id)}))},getTemplate:function(){return['<div id="{WININDEX}" type="popup" class="modalwindow {WINCLASS} " {WINADDITIONALATTR}><div>','<div id="winhead" class="mheader {DRAGGABLE}">{WINHEADER}{WINCLOSE}</div>{WINHTML}</div>',"</div>"].join("")}},$WC.$Win=function(){var a={},b=function(b,c){a[b]=c},c={"window-created":[],"window-destroyed":[]};return{isExist:function(b){return a.hasOwnProperty(b)},persists:function(){var a=document.getElementById("zcwindows");if(a)return a.children.length>1},get:function(b){return this.isExist(b)?a[b].get():null},destroy:function(b){if(this.isExist(b)){a[b].close(),delete a[b];var c=document.getElementById("zcwindows").lastChild;this.current=!$WC.$CUtil.isEmpty(c)&&!$WC.$CUtil.isEmptyObject(c)?c.getAttribute("id"):null}this.triggerEvent("window-destroyed")},handleOutsideClose:function(){var b=this.current;b&&this.isExist(b)&&a[b].closeoutside&&$WC.$Win.destroy(b)},getFront:function(b){a[b].getMeFront()},closeAll:function(){var a=document.getElementById("zcwindows");if(a){var b=a.children,c=b.length;if(!b)return;for(var d=0;d<c;d++){var e=b[d].id;this.isExist(e)&&this.destroy(e)}}},handleEscape:function(){var a=document.getElementById("zcwindows");if(a&&a.lastChild){var b=a.lastChild.id;if(this.isExist(b))return this.destroy(b),!0}return!1},create:function(c){var d=c.id;b(d,new $WC.WindowObject(c));var e=a[d].create(c);return this.triggerEvent("window-created"),e},triggerEvent:function(a){if(c.hasOwnProperty(a)){var b=c[a],d=function(a){setTimeout(function(){a()},0)};for(var e=0;e<b.length;e++)typeof b[e]=="function"&&d(b[e])}},on:function(a,b){c.hasOwnProperty(a)&&c[a].push(b)},off:function(a){c.hasOwnProperty(a)&&(c[a]=[])}}}(),$WC.$Dlg={},$WC.$Dlg=function(){function k(){j===!1&&(f={draggable:!0,bg:!0,"class":"zcdalogbx",openfn:function(){},bodyhtml:"",headerhtml:"",version:1,buttons:[]},g={buttons:[{text:$WC.Resource.getRealValue("common.ok"),colour:b}]},h={buttons:[{text:$WC.Resource.getRealValue("common.ok"),colour:c}]},j=!0)}var a={},b=1,c=2,d=3,e=1,f,g,h,i=[1,2],j=!1,l=function(b){a[b.id]={},a[b.id].buttons=b.buttons},m=function(a){return i.includes(a.version)?a.version:1},n=function(a){function d(a,d){switch(a){case 1:return d===c?"buttn_neg":"buttn_pos";case 2:return"zcdlgbtn "+(d===c?"zcdlgbtn-red":d===b?"zcdlgbtn-green":"")}}var f="",g=a.imagehtml?'<div class="zcdlg_lft"><div class="zcpp_dlgltin">'+a.imagehtml+"</div></div>":"",h=m(a),i=a.buttons.length,j=!1;for(var k=0;k<i;k++)j||(e=k+1,j=!0),f+='<button button="'+(k+1)+'" class="'+d(h,a.buttons[k].colour)+'">'+a.buttons[k].text+"</button>";return o(h).replace(/{IMAGE}/g,g).replace(/{MESSAGE}/g,$WC.Matcher.replace("escapeReplacementString",a.bodyhtml)).replace(/{BUTTON}/g,f)},o=function(a){switch(a){case 1:return['<div class="mcontent"><div class="dialogmn">{IMAGE}<div class="zcdlg_rht"><div class="zcdlgmsg">{MESSAGE}</div></div></div><div class="wctxtcent">{BUTTON}</div></div>'].join("");case 2:return['<div class="mcontent"><div class="mcontent_txt_con">{MESSAGE}</div><div class="mcontent_btn_con">{BUTTON}</div></div>'].join("")}},p=function(b){l(b);var c=$WC.$Win.create({id:b.id,header:b.headerhtml,closehtml:'<span id="winclose" title="'+$WC.Resource.getRealValue("common.cancel")+'" class="zchat-close cclose"></span>',html:n(b),"class":b.class,draggable:b.draggable,bg:b.bg,openfn:b.openfn,closefn:function(c){delete a[c],typeof b.closefn=="function"&&b.closefn()}});return typeof jQuery!="undefined"&&c instanceof jQuery&&(c=c[0]),r(c,b.id),c},q=function(a){return a.class+=typeof a.imagehtml=="undefined"?" zcdgimgnone":"",a},r=function(b,c){Gator(b).on("click","[button]",function(b){if($WC.$Dlg.isExist(c)){b.stopPropagation();var d=parseInt(this.getAttribute("button")),e=a[c].buttons[d-1].action;typeof e=="function"&&e.call($WC.$Win.get(c)),$WC.$Win.destroy(c)}})};return{GREEN_BUTTON:1,RED_BUTTON:2,GREY_BUTTON:3,create:function(a){k(),e=1;if(!$WC.$Dlg.isExist(a.id)){a=$WC.$CUtil.extend(!0,{},f,a),a=q(a);var b=p(a),c=b.querySelectorAll('[button="'+e+'"]');return c&&c[0]&&c[0].focus(),b}},alert:function(a){k(),a=$WC.$CUtil.extend(!0,{},g,a),this.create(a)},confirm:function(a){k(),a=$WC.$CUtil.extend(!0,{},h,a),this.create(a)},isExist:function(b){return a.hasOwnProperty(b)},destroy:function(a){$WC.$Win.destroy(a)},frameHeaderHTML:function(a){var b="",c=a&&a.ispositive?"mheader_ttl clr-green":"mheader_ttl",d=a&&a.ispositive?"mheader_p clr-green":"mheader_p";return a&&a.imagehtml&&(b+=a.imagehtml),a&&a.header&&(b+='<div class="'+c+'">'+a.header+"</div>"),a&&a.subheader&&(b+='<div class="'+d+'">'+a.subheader+"</div>"),b},frameBodyInfoHTML:function(a){var b=a&&a.info?a.info.length:0,c=a&&a.infoheader?a.infoheader:$WC.Resource.getRealValue("dialogue.info.header"),d=b>1?'<div class="mcontent_ttl">'+c+"</div>":"";if(b==1)d='<div class="zcdlg_rht">'+a.info[0]+"</div>";else if(b>1)for(var e=0;e<b;e++)d+='<div class="mcontent_p msi-rgtarw">'+a.info[e]+"</div>";return d}}}(),$WC.Widgets=function(){function c(){b===!1&&(a={alert:{"class":"zchat-alrt",title:$WC.Resource.getRealValue("info.warning")},info:{"class":"zchat-hisseld",title:$WC.Resource.getRealValue("info.success")},confirm:{"class":"zchat-question",title:$WC.Resource.getRealValue("info.confirm")}},b=!0)}var a={},b=!1,d=function(a){var b={};return typeof a.btntxt!="undefined"&&(b.text=a.btntxt),typeof a.btncallback!="undefined"&&(b.action=a.btncallback),b.colour=$WC.$Dlg.GREEN_BUTTON,b};return{construct:function(b){c();if(this.isValid(b)){var e='<div class="zcartcnt"><div class="{DLGLASS} wcdIB f40"></div><div class="wcdIB zcfarlt"><div class="zcartnm">{HEADER}</div><div class="clr0">{MSG}</div></div>{INPUT}</div>',f=a[b.type];e=e.replace(/{DLGLASS}/g,f.class).replace(/{HEADER}/g,typeof b.title!="undefined"?$WC.$CUtil.processXSS(b.title):f.title),e=e.replace(/{MSG}/g,$WC.CMsgUtil.convertLinks(b.description)),e=e.replace(/{INPUT}/g,b.input?'<textarea id="buttonconfirminput" placeholder="'+$WC.$CUtil.processXSS(b.input)+'" maxlength="300" class="zcartinp"></textarea>':"");var g=[];b.type==="alert"?(g=[],g.push(d(b)),$WC.$Dlg.alert({id:"widgetalert",bodyhtml:e,buttons:g})):b.type==="confirm"?(g=[],g.push(d(b)),$WC.$Dlg.confirm({id:"widgetconfirm",bodyhtml:e,buttons:g})):b.type==="info"&&(g=[],g.push(d(b)),$WC.$Dlg.alert({id:"widgetinfo",bodyhtml:e,buttons:g}))}},isValid:function(a){c();var b=!1,d=["alert","confirm","prompt","info","poll","photo"];return typeof a.type!="undefined"&&(b=d.indexOf(a.type)!=-1),b}}}();var $WC=$WC||{};$WC.CustomMsg={msgobj:{},storeMsgObj:function(a){if(a["brief.msg"]||a["btnindexvsdetails.msg"])$WC.CustomMsg.msgobj[a.chid]=$WC.CustomMsg.msgobj[a.chid]||{},$WC.CustomMsg.msgobj[a.chid][a.time]=a},removeMsgObj:function(a){delete $WC.CustomMsg.msgobj[a]},getMsgObj:function(a,b,c){var d=a.closest("[chid]")||a;return $WC.CustomMsg.msgobj[b||d.getAttribute("chid")||a.closest("[data-chid]").getAttribute("data-chid")][c||d.getAttribute("time")||a.closest("[data-msgtime]").getAttribute("data-msgtime")]},getTheme:function(a){var b=a["brief.msg"];return b?b.themeid:""}},$WC.CustomMsgUI={button:{text:{theme1:1,theme2:3,theme3:1,theme4:2,theme5:1,theme6:0,theme7:3,theme8:1,theme9:10,theme10:2}},getCustomMessageContent:function(a){var b=a["brief.msg"];return b?($WC.CustomMsg.storeMsgObj(a),['<div class="zcmsg_bx zcmsg_bx'+$WC.CustomMsg.getTheme(a)+'" chid="'+a.chid+'"  time="'+a.time+'" data-sendername="'+$WC.$CUtil.safeHTML(a.dname)+'" customcardmsg>',this.getThemeTemplateObj(a).getlayout(this.getThemeParamObj(a),a),"</div>"].join("")):""},getThemeParamObj:function(a){var b=a["brief.msg"];return{img:this.getThemeImageURL(a),desc:$WC.CMsgUtil.getDisplayContent(a),desctitle:a.msg?a.msg.trim():"",title:b.title?$WC.CMsgUtil.getMarkedDownContent(b.title):"",titletooltip:b.title?$WC.$CUtil.getDirectTextFromHtmlString(b.title):"",icon:b.icon,button:$WC.CustomMsgUI.getButtonHTML(a),chid:a.chid,time:a.time}},getThemeImageURL:function(a){var b=$WC.CustomMsg.getTheme(a),c=a["brief.msg"];return["1","2","4","7"].indexOf(b)>-1?c.thumbnail||c.img:c.img||c.thumbnail},getCustomMsgOverlayHTML:function(a){var b='<div class="zc_cstm_ovrly">';return $WC.CMsgUtil.isCustomMessage(a)&&(b+=$WC.CustomMsgTemplate.getOverlayCustomMsgHTML(a)),$WC.CMsgUtil.isCustomFormattedMsg(a)&&(b+=$WC.CMsgUtil.getFormattedMsgContent(a)),b+"</div>"},getThemeTemplateObj:function(a){return $WC.CustomMsgTemplate["theme_"+$WC.CustomMsg.getTheme(a)]},getButtonHTML:function(a,b,c){var d=a["brief.msg"],e=b?!0:!1;b=b||d.buttons;if(!b||!b.length)return"";var f="",g=b.length,h=$WC.CustomMsg.getTheme(a);btncount=e?5:$WC.CustomMsgUI.button.text["theme"+$WC.CustomMsg.getTheme(a)];for(var i=0;i<g;i++){var j=b[i],k=c?"primaryindex = PRIMARY_INDEX":"";if(i>=btncount){f+=this.constructBtnDropDown(b,a,k,btncount);break}f+=$WC.CustomMsgTemplate.getbutton(j,a,i)}return'<div class="zcntnbx"  '+k+">"+f+"</div>"},constructBtnDropDown:function(a,b,c,d){var e=a.length,f='<div class="zcmorebtn" custom_btn_click><em custom_btn_click></em><ul>';for(var g=d;g<e;g++)f+="<li "+c+">"+$WC.CustomMsgTemplate.getbutton(a[g],b,g)+"</li>";return f+"</ul></div>"},handleMoreMessage:function(a){var b=a.target.getAttribute("custom_message"),c=document.getElementById("cardmainmessage");$WC.$CUtil.addClass(a.target,"zc_dN"),b==="show_more"?(c.style.height=parseInt(c.getAttribute("scrollHeight"))+30+"px",$WC.$CUtil.removeClass(document.querySelectorAll('[custom_message="show_less"]')[0],"zc_dN")):(c.style.height=parseInt(c.getAttribute("clientHeight"))+"px",$WC.$CUtil.removeClass(document.querySelectorAll('[custom_message="show_more"]')[0],"zc_dN"))},handleCustomBoxClick:function(a,b){var c=$WC.CustomMsg.getMsgObj(a);if(b.target.getAttribute("purpose")==="custom_image_preview"){this.showOriginalImage(c["brief.msg"]);return}b.target.tagName.toLowerCase()!=="a"&&$WC.$Win.create({id:"custommsg","class":"cmsgdlg",header:$WC.CMsgUtil.getBriefMsgTitle(c),html:$WC.CustomMsgUI.getCustomMsgOverlayHTML(c),additionalattrs:' chid="'+c.chid+'" time="'+c.time+'"'})},handleOverlayImage:function(a){var b=$WC.CustomMsg.getMsgObj(a),c=b?b["brief.msg"]:{img:a.getAttribute("src")};this.showOriginalImage(c)},showOriginalImage:function(a){$WC.$Win.create({id:"custommsgimgprev","class":"cmsgdlg cmsgprev",html:$WC.CustomMsgTemplate.getImagePreviewHTML(a)})}},$WC.CustomMsgTemplate={theme_0:{getlayout:function(a,b){var c="";return $WC.CMsgUtil.isCustomFormattedMsg(b)&&(c=$WC.CMsgUtil.getFormattedMsgContent(b)),['<div class="zcthm0ctr">',a.title?'<div class="zctitle" title="'+a.titletooltip+'">'+a.title+"</div>":"",a.img?'<img src="'+a.img+'" purpose="custom_image_preview" >':"",'<div class="btncnt">','<div class="zcdesc">'+a.desc+"</div>","</div>",a.button,"</div>","<div>"+c+"</div>"].join("")}},theme_1:{getlayout:function(a){return[a.desc?'<div class="zcdesc"><div>'+a.desc+"</div></div>":"",'<div class="btncnt">',a.img?'<div class="zcimg"><img src="'+a.img+'" purpose="custom_image_preview" ></div>':"",a.title?'<div class="zctitle">'+(a.icon?'<img src="'+a.icon+'">':"")+'<div title="'+a.titletooltip+'">'+a.title+"</div></div>":"",a.button,"</div>"].join("")}},theme_2:{getlayout:function(a){return[a.img?'<img src="'+a.img+'" purpose="custom_image_preview" >':"",'<div class="btncnt">',a.title?'<div class="zctitle" title="'+a.titletooltip+'">'+(a.icon?'<img src="'+a.icon+'">':"")+a.title+"</div>":"",'<div class="zcdesc"><div>'+a.desc+"</div></div>",a.button,"</div>"].join("")}},theme_3:{getlayout:function(a){return['<div class="btncnt">',a.img?'<img src="'+a.img+'" purpose="custom_image_preview" >':"",a.title?'<div class="zctitle" title="'+a.titletooltip+'">'+(a.icon?'<img src="'+a.icon+'">':"")+a.title+"</div>":"",'<div class="zcdesc"><div>'+a.desc+"</div></div>",a.button,"</div>"].join("")}},theme_4:{getlayout:function(a){return['<div class="btncnt">',a.img?'<img src="'+a.img+'" purpose="custom_image_preview" >':"",a.title?'<div class="zctitle" title="'+a.titletooltip+'">'+(a.icon?'<img src="'+a.icon+'">':"")+a.title+"</div>":"",'<div class="zcdesc"><div>'+a.desc+"</div></div>","</div>",a.button].join("")}},theme_5:{getlayout:function(a){return[a.img?'<img src="'+a.img+'" purpose="custom_image_preview" >':"",a.button,'<div class="btncnt">',"<div>",a.title?'<div class="zctitle" title="'+a.titletooltip+'">'+(a.icon?'<img src="'+a.icon+'">':"")+a.title+"</div>":"",'<div class="zcdesc"><div>'+a.desc+"</div></div>","</div>","</div>"].join("")}},theme_6:{getlayout:function(a){var b=a.title||"",c=a.img?"":"zcnobg";return['<div class="btncnt '+c+'" >',a.img?'<img src="'+a.img+'" purpose="custom_image_preview" >':"",b?'<div class="zctitle" title="'+a.titletooltip+'">'+(a.icon?'<img src="'+a.icon+'">':"")+b+"</div>":"","</div>",'<div class="zcbtmbx">','<div class="zcdesc"><div class="ellips">'+a.desc+"</div></div>",a.button,"</div>"].join("")}},theme_7:{getlayout:function(a){return[a.img?'<img src="'+a.img+'" purpose="custom_image_preview" >':"",'<div class="btncnt">',a.title?'<div class="zctitle" title="'+a.titletooltip+'">'+(a.icon?'<img src="'+a.icon+'">':"")+a.title+"</div>":"",'<div class="zcdesc"><div>'+a.desc+"</div></div>","</div>",a.button].join("")}},theme_8:{getlayout:function(a){var b=a.desc;return b=b.replace(/(?:\r\n|\r|\n)/g,"<br />"),[a.img?'<img src="'+a.img+'" purpose="custom_image_preview" >':"","<div>",'<div class="btncnt">',a.title?'<div class="zctitle" title="'+a.titletooltip+'">'+(a.icon?'<img src="'+a.icon+'">':"")+a.title+"</div>":"",'<div class="zcdesc"><div>'+b+"</div></div>","</div>",a.button,"</div>"].join("")}},theme_9:{getlayout:function(a){var b=document.createElement("div");b.innerHTML=a.button;var c=b.querySelectorAll("[btnindex]"),d;return c.length&&(d=c[c.length-1],b.querySelectorAll("[btnindex]:last-child")[0].remove()),['<div class="btncnt">',a.img?'<img src="'+a.img+'" purpose="custom_image_preview" >':"",a.title?'<div class="zctitle" title="'+a.titletooltip+'">'+(a.icon?'<img src="'+a.icon+'">':"")+a.title+"</div>":"",'<div class="zcdesc"><div >'+a.desc+"</div>","</div>","</div>",b.innerHTML,'<div class="zcntrslut">'+(c.length?d.outerHTML:"")+"</div>"].join("")}},theme_10:{getlayout:function(a,b){var c="";return $WC.CMsgUtil.isCustomFormattedMsg(b)&&(c=$WC.CMsgUtil.getFormattedMsgContent(b)),[a.img?'<img src="'+a.img+'" purpose="custom_image_preview" >':"",'<div class="btncnt">',a.title?'<div class="zctitle" title="'+a.titletooltip+'">'+(a.icon?'<img src="'+a.icon+'">':"")+a.title+"</div>":"",'<div class="zcdesc"><div>'+a.desc+"</div></div>","</div>","<div>"+c+"</div>","<div>",a.button,"</div>"].join("")}},formatButton:function(a){return a.label?a:(a.text&&(a.label=a.text,delete a.text),a.click&&(a.action={},a.click["action.type"]&&(a.action.type=a.click["action.type"]),a.click["action.data"]&&(a.action.data=a.click["action.data"]),a.click["action.confirm"]&&(a.action.confirm=a.click["action.confirm"]),delete a.click),a)},getbutton:function(a,b,c){var d=b["btnindexvsdetails.msg"]?b["btnindexvsdetails.msg"][a]:a;d=this.formatButton(d);if(!d.action||!d.label)return"";var e=$WC.$CUtil.processXSS(d.label),f=d.hint?$WC.$CUtil.processXSS(d.hint):e,g=d.type==="+"?"zcok":d.type==="-"?"zccancel":"";return['<a class="zcbtn '+g+'" title="'+f+'" chid="'+b.chid+'" time="'+b.time+'" custombuttonclick_onmsg index="'+c+'" btnindex="'+d.index+'" >','<input type="button" value="'+e+'">',"</a>"].join("")},getImagePreviewHTML:function(a){var b=a.img||a.thumbnail;return['<div class="cmsgimg">','<img src="'+b+'" />',"</div>"].join("")},getOverlayCustomMsgHTML:function(a){var b=a["brief.msg"],c=b.thumbnail||b.img,d=b.buttons,e=d&&d.length?"zccustmsg":"";return['<div class="msgbox zccard-bx '+e+'">','<div class="zccard">',c?'<img src="'+c+'" purpose="custom_image_preview" chid="'+a.chid+'" time="'+a.time+'"/>':"",'<div id="cardmainmessage" class="zccarddesc">'+$WC.CMsgUtil.getDisplayContent(a)+"</div>","</div>",$WC.CustomMsgUI.getButtonHTML(a,d),"</div>"].join("")},getBotSuggestionsContent:function(a){var b='<div botsuggestions class="zcbotsugg">';for(var c=0;c<a.length;c++){var d=a[c],e=$WC.$CUtil.processXSS(d.text);b+='<div suggestionsclick_onmsg text="'+e+'" title="'+e+'">'+(d.icon?'<img src="'+d.icon+'">':"")+'<span class="font14 txtcent bold">'+e+"</span>"+"</div>"}return b+"</div>"}};var ChatTour={};ChatTour.helpTipHtml='<div id="wms_chattour_icon" class="{{ICON}}"></div><h4 class="wms_chattour_title">{{TITLE}}</h4><p>{{CONTENT}}</p><span data-operation="tournext">{{NAVIGATOR}}</span><div data-operation="close" class="{{CLOSE}}"></div>',ChatTour.checkAndScheduleNotifier=function(a){if(WmsSettings.isTourEnabled()&&WmsSettings.isOnboardSeen()===!1&&WebMessanger.isChatPaused()===!1){var b=432e6,c=(new Date).getTime()-a;clearTimeout(ChatTour.notifytimer);var d=b-c;d<0&&(d=0),ChatTour.notifytimer=setTimeout(function(){if(WmsSettings.isOnboardSeen()===!1&&WmsMainUI.getUnreadChatsCount()===0){if(WebMessanger.isCliqUser()===!0)return;ChatTour.insertTourNotifier(document.querySelector('#wms_menubar > [data-menuname="chat"]'))}},d)}},ChatTour.isTourNotificationShown=function(){return this.tournotifier?!0:!1},ChatTour.insertTourNotifier=function(a){if(a){var b=document.createElement("span");b.className="wms_chattour_initial",ChatTour.tournotifier=a.appendChild(b)}},ChatTour.removeTourNotifier=function(){ChatTour.tournotifier&&($WC.$CUtil.removeElement(ChatTour.tournotifier),ChatTour.tournotifier=null)},ChatTour.init=function(a,b){ChatTour.list=a,ChatTour.removeTourNotifier(),ChatTour.tipnum=0;var c=document.getElementById("wms_tourcontainer");if(c===null){var d='<div id="wms_tourcontainer"><div id="wms_touroverlay" class="wms_touroverlay"></div><div id="wms_skiptour" data-operation="tourskip" class="wms_tourskip">'+WmsResource.getRealValue("tour.skip")+"</div>"+"</div>";b.insertAdjacentHTML("beforeend",d);var e='<div id="wms_chattour" class="wms_chattour" style="z-index:'+$WC.$CUtil.getConfig("zindex")+'">'+'<div id="wms_tourpointer" class="wms_tour_pointer wms_tour_pntdown"></div>'+'<div id="wms_chattour_content"></div>'+"</div>";document.body.insertAdjacentHTML("beforeend",e),ChatTour.bindEvents(),ChatTour.showHelpTip()}},ChatTour.bindEvents=function(){var a=document.getElementById("wms_tourcontainer"),b=document.getElementById("wms_chattour");Gator(b).on("click","[data-operation]",function(){var a=this.getAttribute("data-operation");a==="tournext"?ChatTour.tipnum===ChatTour.list.length-1?ChatTour.exit(!0,!0):ChatTour.nextHelpTip():a==="tourprev"?ChatTour.prevHelpTip():a==="close"?ChatTour.exit(!0):a==="visitcliq"&&(window.open(_WMSCHATURL),ChatTour.exit(!0,!0))}),Gator(a).on("click","[data-operation]",function(){var a=this.getAttribute("data-operation");a==="tourskip"&&ChatTour.exit(!0)})},ChatTour.handleKeyMovement=function(a){if(document.getElementById("wms_tourcontainer")!==null){var b=window.event?a.keyCode:a.which;return b===WmsConstants.KEYCODES.LEFT?ChatTour.prevHelpTip():b===WmsConstants.KEYCODES.ENTER||b===WmsConstants.KEYCODES.RIGHT?ChatTour.tipnum!==ChatTour.list.length-1&&ChatTour.nextHelpTip():b===WmsConstants.KEYCODES.ESCAPE&&ChatTour.exit(!0),!0}},ChatTour.prevHelpTip=function(){ChatTour.tipnum>0&&(ChatTour.hidePreviousHighlight(),ChatTour.tipnum--,ChatTour.showHelpTip())},ChatTour.nextHelpTip=function(){ChatTour.hidePreviousHighlight(),ChatTour.tipnum<ChatTour.list.length-1&&(ChatTour.tipnum++,ChatTour.tipnum<ChatTour.list.length&&ChatTour.showHelpTip())},ChatTour.exit=function(a,b){typeof ChatTour.tipnum=="number"&&ChatTour.list&&ChatTour.tipnum<ChatTour.list.length&&ChatTour.hidePreviousHighlight();if(a){var c=b?"0:"+ChatTour.list.length:ChatTour.tipnum+1+":"+ChatTour.list.length;WmsSettings.updateTourSettings(WmsSettings.constants.ONBOARD,c)}ChatTour.removeTourNotifier();var d=document.getElementById("wms_tourcontainer");$WC.$CUtil.removeElement(d);var e=document.getElementById("wms_chattour");$WC.$CUtil.removeElement(e)},ChatTour.showHelpTip=function(){var a=document.getElementById("wms_chattour_content"),b=WmsResource.getRealValue("Next"),c=ChatTour.helpTipHtml,d=ChatTour.list[ChatTour.tipnum];if(ChatTour.tipnum!==0||!d.sethtml)c+='<span data-operation="tourprev" style="float:left">'+WmsResource.getRealValue("tour.back")+"</span>";ChatTour.tipnum===ChatTour.list.length-1&&(b=WmsResource.getRealValue("Finish")),c=$WC.template.replace(c,{ICON:d.icon||"",TITLE:WmsResource.getRealValue(d.title||""),CONTENT:WmsResource.getRealValue(d.content||""),NAVIGATOR:WmsResource.getRealValue(d.navigator)||b,CLOSE:d.sethtml?"":"wms_chattour_close"});var e=document.querySelector("["+d.elemid+"]");a.innerHTML=c;if(d.sethtml){if(d.replacetext)for(var f in d.replacetext){var g={};g[f]=WmsResource.getRealValue(d.replacetext[f]),d.sethtml=$WC.template.replace(d.sethtml,g)}document.getElementById("wms_chattour_icon").insertAdjacentHTML("afterend",d.sethtml)}d.elemid&&$WC.$CUtil.addClass(e,"wms_chattour_elemhighlight"),ChatTour.positionHelpTip(e,d.align,d.position)},ChatTour.positionHelpTip=function(a,b,c){var d=document.getElementById("wms_chattour"),e=document.getElementById("wms_tourpointer"),f=10,g=20,h=0,i=0,j=0;c!=="fixed"&&(d.style.width="",d.style.transform="");if(b==="center")$WC.$CUtil.addClass(d,"wms_chattour_hvalign"),d.style.width="320px",h=document.body.offsetWidth/2-d.offsetWidth/2+g,i=document.body.offsetHeight/2-d.offsetHeight/2,e.style.display="none";else{var k=a.getBoundingClientRect();h=k.left+f,i=document.body.offsetHeight-k.height-d.offsetHeight-g,j=k.width/2-e.offsetWidth/2-f,c==="fixed"&&(h=d.offsetLeft||f,j+=k.left),e.style.display="block",e.style.transform="translateX("+j+"px)"}d.style.transform="translate("+h+"px,"+i+"px)",ChatTour.list[ChatTour.tipnum+1]&&ChatTour.list[ChatTour.tipnum+1].align===ChatTour.list[ChatTour.tipnum].align&&$WC.$CUtil.removeClass(d,"wms_chattour_hvalign")},ChatTour.hidePreviousHighlight=function(){var a=ChatTour.list[ChatTour.tipnum]&&ChatTour.list[ChatTour.tipnum].elemid;if(a){var b=document.querySelector("["+a+"]"),c=document.getElementById("wms_chattour");a&&$WC.$CUtil.removeClass(b,"wms_chattour_elemhighlight"),c&&$WC.$CUtil.removeClass(c,"wms_tourfadeIn")}};var lfromstatic=!0;

function WmsContactImpl(){}function Collaboration(){}function WmsChatUIImpl(){}function ZohoFeedImpl(){}function CustomChat(){}function ZTI(){}function WMSTP(){}function WmsUIImpl(){}function WmsGroupImpl(){}function PubSubImpl(){}function Presence(){}function ChatletImpl(){}WmsContactImpl.handlePresence=function(a,b,c,d,e){},WmsContactImpl.handleAddressBook=function(){},WmsContactImpl.handleInvitations=function(a){},WmsContactImpl.handleInvite=function(a,b,c){},WmsContactImpl.notifyInvite=function(a,b,c){},WmsContactImpl.handleAccept=function(a,b,c){},WmsContactImpl.notifyAccept=function(a,b,c){},WmsContactImpl.handleReject=function(a,b,c){},WmsContactImpl.notifyRemove=function(a,b,c){},WmsContactImpl.handleDelete=function(a,b,c){},WmsContactImpl.handleContactUpdated=function(){},WmsContactImpl.handleStatusMessage=function(a,b){},WmsContactImpl.handeAllStatusMessages=function(){},WmsContactImpl.handleHideContactsUI=function(){},WmsContactImpl.handleShowContactsUI=function(){},WmsContactImpl.handleGetContacts=function(){},WmsContactImpl.handleMPReject=function(a,b,c){},WmsContactImpl.handleMPAccept=function(a,b,c){},WmsContactImpl.handleMPDelete=function(a,b,c){},WmsContactImpl.handleMPAdd=function(a,b,c){},WmsContactImpl.handleMPInvite=function(a,b,c){},WmsContactImpl.handleLogin=function(a,b,c,d){},WmsContactImpl.handleLogout=function(a,b,c,d,e){},WmsContactImpl.handleGetAccounts=function(a){},WmsContactImpl.handleBulkPresence=function(a,b){},Collaboration.handleUserList=function(a,b){},Collaboration.handleMessage=function(a,b,c,d,e){},Collaboration.handlePresence=function(a,b,c,d,e){},Collaboration.join=function(a){WebMessanger.joinCollab(a)},Collaboration.quit=function(a){WebMessanger.quit(a)},Collaboration.serverup=function(){},Collaboration.serverdown=function(){},Collaboration.handleZohoMessage=function(a,b,c,d,e,f,g,h,i,j,k,l){return!1},Collaboration.handleCustomMessage=function(a){},Collaboration.handleCrossProductMessage=function(a,b){},Collaboration.onConnect=function(){},Collaboration.openURL=function(a,b,c,d){return!0},Collaboration.handleCollabAdd=function(a,b,c,d,e){},Collaboration.handleCollabDelete=function(a,b,c,d,e){},Collaboration.handleUserAdd=function(a,b){},Collaboration.handleUserDeleted=function(a,b){},Collaboration.handleIsOnline=function(a){},Collaboration.handleLogout=function(a){},Collaboration.goOffline=function(){},Collaboration.wmsOffline=function(){},Collaboration.handleChatNotifyMessage=function(a,b,c){},Collaboration.getPageTitle=function(){return!1},Collaboration.handleWmsDisable=function(a){},Collaboration.handleComposeMail=function(a,b){return!1},Collaboration.handleServiceMessage=function(a){},Collaboration.handleLanguageChange=function(a){},WmsChatUIImpl.handleUserIdle=function(a,b){},WmsChatUIImpl.handleUserEnteredText=function(a,b){},WmsChatUIImpl.handleUserTyping=function(a,b){},WmsChatUIImpl.handleNewChat=function(a){},WmsChatUIImpl.handleChatMessage=function(a){},WmsChatUIImpl.isActive=function(a){return!1},WmsChatUIImpl.handleTranscript=function(a,b){},ZohoFeedImpl.handleFeedHistory=function(a){},ZohoFeedImpl.handleFeedHistoryCount=function(a){},ZohoFeedImpl.handleUnreadFeeds=function(a){},ZohoFeedImpl.handleFeedsInRange=function(a){},ZohoFeedImpl.handleFeedDelete=function(a){},ZohoFeedImpl.handleFeedHistoryUI=function(){return!1},ZohoFeedImpl.handleUnreadFeedUI=function(){return!1},ZohoFeedImpl.handleLiveFeedsUI=function(a){return!1},CustomChat.handleUserList=function(a,b){},CustomChat.handleMessage=function(a){},CustomChat.handlePresence=function(a,b,c,d,e){},CustomChat.handleUserAdded=function(a,b,c){},CustomChat.handleUserDeleted=function(a,b,c){},CustomChat.handleTranscript=function(a,b){},CustomChat.join=function(a){WebMessanger.join(a)},CustomChat.transcript=function(a,b){},CustomChat.quit=function(a){WebMessanger.quit(a)},CustomChat.handleAttachmentMessage=function(a,b){},CustomChat.handleTitleUpdated=function(a,b){},CustomChat.isActive=function(a,b){return!1},CustomChat.handleCloseWin=function(a){},ZTI.handleFailure=function(a,b){},ZTI.handleCrossProductMessage=function(a){},WMSTP.isVideoEnabled=function(){return!1},WMSTP.isAudioEnabled=function(){return!1},WMSTP.handleNewVideo=function(a,b){},WMSTP.handleNewAudio=function(a,b){},WMSTP.handleAVMessage=function(a){},WmsUIImpl.handleFeedHistory=function(){},WmsUIImpl.handleUnreadFeeds=function(){},WmsUIImpl.handleDocumentIdle=function(){},WmsUIImpl.UIReady=function(){},WmsUIImpl.handleUIShown=function(){},WmsUIImpl.handleUIHidden=function(){},WmsUIImpl.handleChatWindowClose=function(a,b,c){},WmsUIImpl.preventChatWindowOpen=function(a,b){},WmsUIImpl.handleNewMessage=function(a,b,c,d){},WmsUIImpl.handleAnnouncement=function(a,b){return!1},WmsUIImpl.getHeaderHTML=function(a,b,c,d,e){},WmsUIImpl.getStatusHTML=function(a,b,c,d,e){},WmsUIImpl.getChatWindowContainer=function(a,b,c,d,e){},WmsUIImpl.getChatWindowOptions=function(a,b,c,d,e){},WmsUIImpl.getChatBarOptions=function(){},WmsUIImpl.customContactsConfig=function(){},WmsUIImpl.getTranscript=function(a,b,c){},WmsUIImpl.handleKeyMovement=function(a,b){},WmsUIImpl.openChatWindowDropUp=function(a,b,c){},WmsUIImpl.onChatWindowDropUpClick=function(a,b){},WmsUIImpl.restoreChat=function(a){},WmsUIImpl.uploadFile=function(a,b,c){},WmsGroupImpl.handleGetGroups=function(){},PubSubImpl.onConnect=function(){},PubSubImpl.handleSubscribe=function(a){},PubSubImpl.handleUnSubscribe=function(a){},PubSubImpl.handleError=function(a,b,c){},PubSubImpl.handleUserList=function(a,b){},PubSubImpl.handleUserIn=function(a,b){},PubSubImpl.handleUserOut=function(a,b){},PubSubImpl.handleMessage=function(a,b){},Presence.handleUserStatus=function(a,b){},Presence.handleForceLogout=function(a){},Presence.handleMessage=function(a){},Presence.handleUserAdd=function(a){},Presence.handleUserDelete=function(a){},Presence.handleUserList=function(a,b){},Presence.handlePresence=function(a,b,c,d,e){},Presence.handleUserAdded=function(a,b){},Presence.handleUserDeleted=function(a,b){},ChatletImpl.handleURLInvocation=function(a,b){return!1},ChatletImpl.handleUserList=function(a,b){};
