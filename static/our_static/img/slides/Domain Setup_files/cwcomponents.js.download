(function(a){var b=function(b,c){this.$elem=a(b),this.dropobj=c,this.options=c.options};b.prototype={init:function(){this.setHeader(),this.setDropList(),this.bindEventHandlers(),this.$elem.addClass("sqico-drpdwn")},setHeader:function(){var a=this.dropobj;this.$elem.attr("dockeydown","dropdown").html('<em class="req" title="Mandatory"></em><a href="javascript:;" id="dropheader" purpose="'+a.purpose+'">'+a.defaultval+"</a>")},setDropList:function(){var a='<ul id="dropcontent">',b=this.options,c=b.length,d=this.dropobj.purpose;for(var e=0;e<c;e++){var f=b[e],g=f.isClient==0?!1:!0,h=getEscapedText(f.ID||f.value),i=getEscapedText(f.DNAME||f.text),j=getEscapedText(f.NAME||""),k=d==="department"?this.getDeptStatusHTML(f):"";a+=g?'<li val="'+h+'" uniname="'+j+'">'+i+""+k+"</li>":""}this.$elem.append(a+"</ul>"),this.sortList()},sortList:function(){if(this.dropobj.purpose!=="department")return;var b=this.$elem.find("ul"),c=b.find("li");c.sort(function(b,c){return parseInt(a(b).find("span").attr("status"))>parseInt(a(c).find("span").attr("status"))?1:-1}),b.empty().html(c)},getDeptStatusHTML:function(a){var b=""+a.STATUS=="true"?$Support.DEPT_ONLINESTATUES:$Support.DEPT_OFFLINESTATUES;b=""+a.ENGAGED=="true"?$Support.DEPT_ENGAGESTATUES:b;var c=b==="1"?"department.status_"+b:"common.offline";return'<span class="desc deptst_'+b+'" status="'+b+'">'+LSResource.getRealValue(c)+"</span>"},getDeptName:function(a){var b=this.options,c=b.length;for(var d=0;d<c;d++){var e=b[d];if(e.ID===a||e.value===a)return e.DNAME||e.text}},bindEventHandlers:function(){var b=this.$elem,c=this,d={department:function(a,b){$Support.Util.handleDeptChange(a,b)},customdrpdwn:function(a){$Support.Util.handleInputChange(a.parents('div[purpose="custom"]').attr("name"),a.attr("val"))}};b.on("click","a",function(d){if($Support.Util.isPreview())return;var e=a(this).attr("val"),f=a("div.sqico-drpdwn");c.alignDropDown(),f.length>1&&f.removeClass("zindrp").find("ul").hide(),b.addClass("zindrp").find("ul").stop().slideToggle(350,function(){var c=a(this),d=c.find('li[val="'+e+'"]');c.css("overflow",""),d.length?d.addClass("atsel"):c.find("li:first-child").addClass("atsel"),c.is(":hidden")?b.removeClass("zindrp"):c.scrollTop(0)}),b.removeClass("errfield"),$Clickoutside.bindclick(function(){c.hideDropDown()},"dropcontent","dropheader")}).on("click","li",function(e,f){var g=a(this).attr("val");b.children("a").attr("val",g).html(c.getDeptName(g)),c.hideDropDown(),$Support.Util.setTextareaHeight(),b.attr("val",g).removeClass("errfield");var h=d[c.dropobj.purpose];typeof h=="function"&&h(a(this),f)}).on("mouseenter","li",function(){b.find("li.atsel").removeClass("atsel"),a(this).addClass("atsel")}),$Support.contentdiv.on("scroll",function(){b.find("ul:visible").length&&c.alignDropDown()})},alignDropDown:function(){var b=this.$elem,c=b.children("a"),d=b.children("ul"),e=c.offset().top,f=c.outerHeight(),g=a("body").outerHeight();if(e+f+d.outerHeight()>g+$Support.contentdiv.scrollTop()){b.addClass("btmalign"),d.css({top:"auto",bottom:g-e,"z-index":"13"}),d.find("li").removeClass("atsel");return}b.removeClass("btmalign"),d.css({bottom:"auto",top:e+f})},hideDropDown:function(){var a=this.$elem;a.find("ul").slideUp(function(){a.removeClass("zindrp")}).find("li.atsel").removeClass("atsel")}},a.fn.dropdown=function(a){return this.each(function(){(new b(this,a)).init()})}})(jQuery);var $Clickoutside={};$Clickoutside.bindclick=function(){};function getSource(a){return ie?window.event.srcElement:a.target}function getEventSourceId(a){a=a==undefined?window.event:a;var b=a.srcElement!=undefined?a.srcElement.id:a.target.id;return b}function isUndefined(a){return typeof a=="undefined"}function getObjectSize(a){var b=0;for(var c in a)a.hasOwnProperty(c)&&b++;return b}function lsnocachefix(a,b){if(a=="json"){var c={};c.nocache=(new Date).getTime();if(b===!0||b==undefined)c[_CFPARAMNAME]=getLDCSRFToken();return c}return a?"&nocache="+(new Date).getTime():"&"+_CFPARAMNAME+"="+getLDCSRFToken()+"&nocache="+(new Date).getTime()}function zeroUpFront(a){return a>=100&&(a%=100),a<10&&(a=""+a,a="0"+a),a}function shrinkImage(a,b,c,d){var e={WIDTH:b,HEIGHT:a},f=[d/b,c/a];return f=Math.min(f[0],f[1]),f>1?e:(e={WIDTH:b*f,HEIGHT:a*f},e)}function getEncodedText(a){return a&&(a=a.replace(/&#39;|&#x27;/g,"'").replace(/&quot;/g,'"').replace(/&gt;/g,">").replace(/&lt;/g,"<").replace(/&amp;/g,"&").replace(/&#x2F;/g,"/"),a=a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/\//g,"&#x2F;")),a}function getMemSize(a){var b=null;return a>1048576?b=getRoundedDecimals(a*100/1048576/100,2)+" MB":a>1024?b=getRoundedDecimals(a*100/1024/100,2)+" KB":b=getRoundedDecimals(a,2)+" Bytes",b}function getRoundedDecimals(a,b){try{return a.toFixed(b)}catch(c){return a}}function processInput(a,b,c){if(!b)return b;switch(a){case"emailid":b=b.replace(/(\s)|(\/)/g,""),b.charAt(b.length-1)==","&&(b=b.substring(0,b.length-1)),b.match(/@/g)&&b.match(/@/g).length<=1&&(b=b.replace(/,/g,"."));break;case"trimlength":c=c?c:100,b=b.substring(0,c)}return b}function getLDCSRFToken(){return $Support.getParent().$ZSIQCookie.get(_CFCNAME)}function getUnescapedText(a,b){if(isUndefined(a)||!b&&!isEncoded(a))return a;var c=$("<div></div>"),d=c.html(a).text();return c.remove(),d}function getEscapedText(a){return isEncoded(a)?a:$("<div/>").text(a).html()}function isEncoded(a){try{if(!/<|>/.test(a))return!0}catch(b){}return!1}function isPostMessageSupported(){try{return!!window.postMessage}catch(a){}return!1}util={optimizeFontForMozilla:function(a){var b="<FONT";if(a.indexOf(b)!=-1){var c=a.split(b);for(i=0;i<c.length;i++)c[i]=util.insertSpanForColor(c[i]);var d="";if(c.length>1)for(i=0;i<c.length;i++)i==0?d=c[i]:d=d+b+c[i];d!=""&&(a=d)}return a}};var Base64={PadChar:"=",samples:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",getB64:function(a,b){var c=Base64.samples.indexOf(a.charAt(b));if(c==-1)throw"Error";return c},atob:function(a){if(!a)return"";var b,c,d,e=a.length;if(e==0)return a;try{return window.atob(a)}catch(f){if(e%4!=0)throw"Error";b=0,a.charAt(e-1)==Base64.PadChar&&(b=1,a.charAt(e-2)==Base64.PadChar&&(b=2),e-=4);var g=[];for(c=0;c<e;c+=4)d=Base64.getB64(a,c)<<18|Base64.getB64(a,c+1)<<12|Base64.getB64(a,c+2)<<6|Base64.getB64(a,c+3),g.push(String.fromCharCode(d>>16,d>>8&255,d&255));switch(b){case 1:d=Base64.getB64(a,c)<<18|Base64.getB64(a,c+1)<<12|Base64.getB64(a,c+2)<<6,g.push(String.fromCharCode(d>>16,d>>8&255));break;case 2:d=Base64.getB64(a,c)<<18|Base64.getB64(a,c+1)<<12,g.push(String.fromCharCode(d>>16))}return g.join("")}}},CommonUtil={TZOFFSET:(new Date).getTimezoneOffset()*-1,toJSON:function(a){return Object.toJSON?Object.toJSON(a):JSON.stringify(a)},parseToJSON:function(a){try{if(typeof a=="object")return a;a=JSON.parse(a)}catch(b){a=$.parseJSON(a)}return a},getCaptcha:function(a){return a!=undefined?"<img src='/showcaptcha?digest="+a+"'></img>":null},isAllowPasteImage:function(){return this.isAllowFileSharing()&&/chrome/.test(navigator.userAgent.toLowerCase())},isAllowFileSharing:function(){return JSON.parse($Support.EmbedObj.eprops.icfile)&&Licence.verify("filesharing")},isAllowAssist:function(){return JSON.parse($Support.EmbedObj.eprops.isscreenshare)&&CommonUtil.isIntegratedPortal(LDINTEG_ZASSIST)&&Licence.verify("assistallowed")},isAudioCallAllowed:function(){return CommonUtil.isAudiocallEnabledFromPortal()&&JSON.parse($Support.EmbedObj.eprops.isaudiocall)&&Object.keys(SUPPORT_REPS).length<2&&Licence.verify("audiocall")&&CommonUtil.isSecuredSchema()&&avaction.isBrowserSupported(navigator.userAgent)},isScreenSharingAllowed:function(){return CommonUtil.isScreenshareEnabledFromPortal()&&JSON.parse($Support.EmbedObj.eprops.issiqscreenshare)&&Licence.verify("issiqscreenshare")&&this.isAudioCallAllowed()},handleImgLoad:function(a,b,c){a=$(a),CommonUtil.setShrinkImageCSS(a,b,c),a.animate({opacity:1},150)},setShrinkImageCSS:function(a,b,c){var a=$(a),d=a[0],e=a.parent(),f=b||e.height(),g=c||e.width(),h=shrinkImage(d.naturalHeight,d.naturalWidth,f,g);a.css({height:h.HEIGHT,width:h.WIDTH})},wordCapitalize:function(a){return a.toLowerCase().replace(/\b\w/g,function(a){return a.toUpperCase()})},escapeSpecialNotation:function(a){if(a==""||a==undefined)return a;a=""+a;if(a.indexOf("$")!==-1){index=-1,count=0;var b=a.split("");for(var c=0;c<=b.length;c++)if(b[c]==="$")count++,index=parseInt(c);else if(count>1&&index!=-1){dollar="";for(var d=0;d<count-1;d++)dollar+="$";b.splice(index+1,0,dollar),index=-1,count=0}a=b.join("")}return a},handleEscape:function(a){$(a.target).parents(".editfields").length&&$UI.hideUserEditUI()},scrollIntoView:function(a,b){a.scrollTop(b[0].offsetTop-a[0].offsetTop)},getTextFromHeadToCaret:function(a){var b,c,d,a=a[0];if(a.isContentEditable&&document.selection){if(document.selection){a.focus();var d=document.selection.createRange();d.moveStart("character",-a.value.length),b=d.text}}else $(a).focus(),c=a.selectionEnd,typeof c=="number"?b=a.value.substring(0,c):document.selection&&(d=a.createTextRange(),d.moveStart("character",0),d.moveEnd("textedit"),b=d.text);return b},insertAtCaret:function(a,b){if(document.selection){a.focus();var c=document.selection.createRange();c.text=b,a.focus()}else if(a.selectionStart||a.selectionStart===0){var d=a.selectionStart,e=a.selectionEnd,f=a.scrollTop;a.value=b+a.value.substring(e,a.value.length),a.focus(),a.selectionStart=d+b.length,a.selectionEnd=b.length,a.scrollTop=f;return}a.value+=b,a.focus()},handleAddDynamicKey:function(a,b,c){var d=CommonUtil.getTextFromHeadToCaret(b),e=d.lastIndexOf(a);c=d.slice(0,e+1)+c+a+" ",CommonUtil.insertAtCaret(b[0],c)},handleGridNavigation:function(a,b,c){CommonUtil.preventDefaultAndPropagation(b);var d=b.which,e=a.find(c+'[style*="block"]'),f=e.length,g=a.find(".sel"),h=e.index(g),i,j=Math.floor(a.width()/120);if(h===-1)i=e[0];else if(d===37)i=--h===-1?e[f-1]:e[h];else if(d===39)i=++h===f?e[0]:e[h];else if(d===38)if(h-j<=-1){var k=Math.ceil(f/j);h=(k-1)*j+h%j,i=h>=f?e[h-j]:e[h]}else i=e[h-j];else d===40&&(h+j>=f?i=e[h%j]:i=e[h+j]);if(typeof i!="undefined")return i=a.find(i),g.removeClass("sel"),i.addClass("sel"),CommonUtil.scrollToView(i,a),i},scrollToView:function(a,b){typeof b=="string"&&(b=$("#"+b)),typeof a=="string"&&(a=b.find("#"+a));var c=CommonUtil.getParentChildOffset(a,b),d=Math.ceil(b[0].scrollTop);c.elementtop<c.containertop?(d-=c.containertop-c.elementtop,b.scrollTop(d)):c.elementbottom>c.containerbottom&&(d+=c.elementbottom-c.containerbottom,b.scrollTop(d))},getParentChildOffset:function(a,b){var c={};return c.containertop=b.offset().top,c.containerbottom=c.containertop+b[0].clientHeight,c.elementtop=a.offset().top,c.elementbottom=c.elementtop+a.outerHeight(),c},preventDefaultAndPropagation:function(a){a.preventDefault(),a.stopPropagation()},handleFileUpload:function(a){var b=a.callbacks;$.ajax({xhr:function(){var c=new window.XMLHttpRequest;return c.upload.addEventListener("progress",function(c){b.progress&&b.progress(c,a.msgid)},!1),c},url:$Support.getAjaxURL("upload",".ls"),type:"POST",data:a.formdata,contentType:!1,dataType:a.type,processData:!1,success:function(a){b.success&&b.success(a)},complete:function(a){b.complete&&b.complete(a)}})},isIntegratedPortal:function(a){var b=$Support.EmbedObj.integid;if(b=="null"||b=="")return!1;b=JSON.parse(b);var c=[LDINTEG_SDPONDEMAND,LDINTEG_ZOHOSUPPORT,LDINTEG_ZCREATOR];a&&(c=[a]);for(var d=0;d<b.length;d++){var e=b[d];if($.inArray(e,c)!==-1)return!0}return!1},getformattedtext:function(a,b){return a.length>=b?a+"<br>":a},addIfExists:function(a,b,c){if(c)return a[b]=c},isBot:function(a){if(!a||a==-1)return;try{var b=a.split("_")[2],c=/^b/;return c.test(b)}catch(d){return!1}},getBotImageURL:function(){var a=$Support.getParent().$ZSIQChat.getWidgetData(),b=a.embedobj,c=a.commondata.isdev?b.schema+"://"+b.embedserverurl:"";return c+"https://img.zohostatic.com/salesiq/Jul_03_2018_1_https/images/botagent.svg"},isSecuredSchema:function(){return window.location.protocol.indexOf("https")>-1},isAudiocallEnabledFromPortal:function(){return $Support.getParent().$ZSIQChat.getWidgetData().embedobj.isaudiocallallowed=="true"},isScreenshareEnabledFromPortal:function(){return $Support.getParent().$ZSIQChat.getWidgetData().embedobj.issiqscreenshare=="true"},decodeHTML:function(a){return a.replace(/&#x2F;/g,"/").replace(/&#39;|&#x27;/g,"'").replace(/&quot;/g,'"').replace(/&gt;/g,">").replace(/&lt;/g,"<").replace(/&amp;/g,"&")}},Licence={verify:function(a){var b=$Support.EmbedObj.linfo[a];return b&&JSON.parse(b)||!1},isFreePlan:function(){var a=parseInt($Support.EmbedObj.linfo.planid);return a===L_FREE||a===L_FREE1||a===L_FREE2}};var SIGNATURE_CHAT="1",DN_UNSUPPORTED=-1,TRIGGER_SMILEY_KEY=":",THIS_WEEK="0",LAST_WEEK="1",THIS_MONTH="2",LAST_MONTH="3",TODAY="5",YESTERDAY="6",TOMORROW="8",NEXT_WEEK="9",NEXT_MONTH="10",LAST_TWO_WEEKS="11",NEXT_TWO_WEEKS="12",LAST_TWO_MONTHS="13",NEXT_TWO_MONTHS="14",THIS_QUARTER="15",LAST_QUARTER="16",NEXT_QUARTER="17",THIS_YEAR="18",ADDINFO_TRIGGER="8",TRIGGER_SEND_MESSAGE=2,TRIGGER_PLAY_TUNE=9,AVAILABLE="1",IDLE="4",ENGAGED="6",NFY_USER_ENTERED=110,PUSH_MSG=111,CT_NFY_MSG=112,NFY_ENDLIVESUPPORT="113",NFY_LS_OPERATIONS=114,NFY_PUSH_MSG=115,NFY_USER_CONTINUE=116,NFY_USER_TYPING=104,NFY_USER_IDLE=105,RESEND_AUTO="1",RESEND_MANUAL="2",CT_TXT_MSG=12,CT_NFY_USERSTATUS=13,CT_NFY_USERDELETE=15,CT_INF_MSG=16,CT_ATT_MSG=20,CT_NFY_LEAVESUPPORT="35",WM_DNAME_UPDATE=45,WM_WebRTC_MSG=59,WM_AV_MSG=29,WM_CUSTOM=2,L_FREE1=1,L_FREE2=7,L_FREE=12,ONLINE=1,OFFLINE=0,LDINTEG_ZOHOSUPPORT=1,LDINTEG_SDPONDEMAND=4,LDINTEG_ZCREATOR=5,LDINTEG_ZASSIST=13,VERTICAL=0,HORIZONTAL=1,TRIGGER_SEND_MESSAGE=2,TRIGGER_PLAY_TUNE=9,ADDINFO_TRIGGER="8",AUDIOCALL=0,VIDEOCALL=1,AUDIOVIDEOCALL=2,AV_CONNECTED="connected",AV_FAILED="failed",UPSTREAM=1,DOWNSTREAM=2,AV_ACCEPTED=1,AV_REJECTED=2,AV_INITIATE=3,AV_CANDIDATE=4,AV_ENDCALL=5,AV_CONNECTWITHPEER=6,AV_INCOMINGCALL=1,AV_OUTGOINGCALL=2,AV_CONNECTING=3,AV_ONGOING=4,AV_RECONNECTING=5,AV_USERBUSY=6,AV_STARTRECORD=7,AV_RECORDING=8,AV_PLAY=9,CONVERSATION_VIEW=1;var myMsgObj={};Message={trim:function(a){try{a=a.replace(/<p>/gi,""),a=a.replace(/<\/p>/gi,""),a=a.replace(/<a/gi,"<a target='_blank'"),a=a.replace(/\n/gi,"<br>"),a=a.replace(/^\s*$/gi,"")}catch(b){}return a},format:function(a){try{a=" "+a;var b=/(=['"])?([a-z0-9]([a-z0-9_\-+\.]*)@([a-z0-9_\-\.]*)(\.[a-z]{2,22}(\.[a-z]{2}){0,2}))/gi,c=/((?:href|src)=["']?)?((https?:\/\/(?:www\.)?|www\.)[a-z0-9][^@]*?)(?=&quot;|&#x27;|&lt;|[\s"'<]|$)/ig;a=a.replace(c,function(a,b,c,d){var e=d==="www."?"http://"+c:c,f=_SCHEMA+"://"+_EMBEDSERVERURL;return b?a:'<a href="'+getUnescapedText(e)+"\" target='_blank'>"+c+"</a>"}),a=a.replace(b,function(a,b,c){return b?a:'<a href="mailto:'+c+'" class="updatedata" purpose="email">'+c+"</a>"})}catch(d){}return a},getDisplayContent:function(a){return a=Smiley.replace(a),a=Message.trim(a),a},isLocalUser:function(a){return a==myMsgObj.sender},isHeader:function(a,b){return b&&b!=Message.presender},isSameBrowser:function(a){return!a||a==LSMessanger.getSid()},send:function(a,b,c){var d=(new Date).getTime();this.displaySendMessage(a,b,c,d),LSMessanger.sendMessage(a,b,c,d)},displaySendMessage:function(a,b,c,d){b=b.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;"),b=Markdown.apply(b),myMsgObj.chid=a,myMsgObj.msg=b,myMsgObj.scroll=!0,myMsgObj.uniqueid=d,c!=undefined&&c!=""&&(myMsgObj.msg="<span style='"+c+"'>"+b+"</span>"),Message.formatAndDisplay(myMsgObj)},formatAndDisplay:function(a){try{var b=!1,c=a.msg,d=c,e=a.sender,f=a.mod,g=a.istranslated,h="";b=a.scroll==undefined?!0:a.scroll,c=Message.getDisplayContent(c),f!=null&&f=="att"?(c=Message.constructAttUrl(a),h="chatwindow.sharing_a_file_with_you"):(a.msg=c,a.mode==="cannedarticle"&&(d=$FAQ.getHeaderMessage(a.msg)),c=Message.getMessageBlock(a),h="common.says.msg"),Message.display(c,b,a.msgid),$Support.clearEndTimer();if(a.dname&&!Message.isLocalUser(e)){var i=LSResource.getRealValue(h,getUnescapedText(a.dname)+","+d);Message.handleBlinkTitle(i)}Message.presender=e,$Support.Util.setMessageClass();var j=$Support.contentdiv.find("#consentbannerdiv"),k=Message.isLocalUser(e)||a.convvisitorid&&(e=="null"||$Support.Util.isAnnonUser(e));if(g){var l=$Support.EmbedObj,m=$Support.LSDB.get(l.chatID+"_translate");if(!m&&j.length==0){var n=$UI.getTranslateBannerHTML(getUnescapedText(a.dname));$Support.contentdiv.find(".chtcont").after(n),$Support.Util.calculateTextareaHeight()}}!k&&!g&&j.length!=0&&$Support.hidetranslatebanner()}catch(o){}},updateMessageTime:function(a){try{var b=a.sender+"_"+a.msgid,c=$Support.chatdiv||$("#msgdiv"),d=c.find('div[msgid="'+b+'"]');if(d.length==0)return;var e=d.prev().attr("msgtime");if(e){var f=a.lmsgtime;if(e!=f&&f-e>3e3){var g=a.chid;LSMessanger.transcript(g,$EmbedManger.getvwmsid()),LSDebugger.pushDebugInfo(a),LSDebugger.postDebugInfo("Chat transcript mismatched | "+g+" | "+e+" | "+d.prev().text(),null,null,!0);return}}var h=a.time;d.attr("msgtime",h)}catch(i){}},getAVMessageBlock:function(a,b){var c=a.type,d=JSON.parse(a.opruser),e=d.dname,f=a.isvisitoraccess,g="none",h="";!b&&$("#audiocall").length==1&&(g=""),callagain_txt="<span class='sqico-call' style='display: "+g+"' id='audio_callagain' onclick='avimpl.startCall()'>"+LSResource.getRealValue("av.info.callagain")+"</span>";if(a.action==="endcall"){if(a.call_duration!=undefined&&a.call_duration!=""){h=LSResource.getRealValue("av.info.success"," "+a.call_duration)+callagain_txt;if(!b){var i={attenderemail:$Support.EmbedObj.attenderemail,duration:a.call_duration};$Support.Util.handleCallbacks("call.completed",i)}}CallImpl.updateUI(AV_RATING)}return a.action==="missed"&&(h=LSResource.getRealValue("av.info.agent.missed")+callagain_txt,f&&(h=LSResource.getRealValue("av.info.visitor.missed",e)+callagain_txt)),a.action==="terminated"&&(h=LSResource.getRealValue("av.info.visitor.cancelled",e)+callagain_txt,f&&(h=LSResource.getRealValue("av.info.agent.cancelled")+callagain_txt)),a.action==="rejected"&&(h=LSResource.getRealValue("av.info.visitor.declined",e)+callagain_txt,f&&(h=LSResource.getRealValue("av.info.agent.declined")+callagain_txt)),a.action==="busy"&&(h=LSResource.getRealValue("av.info.visitor.declined",e)+callagain_txt,b||avimpl.handleUserBusy()),!b&&a.action!=="busy"&&(a.action!=="missed"||!f)&&(a.action!=="rejected"||!!f)&&avimpl.clear(),h},getMessageBlock:function(a){var b="";try{b=a.msg,sender=a.sender;var c=MyDate.getHoursandMin((new Date).getTime(),!0,"bclient");if(sender=="CT_INF_MSG")b='<div class="inf_msg">'+b+"</div>";else{var d=!1,e=getEscapedText(a.dname);Message.presender&&Message.presender===sender&&(d=!0,e="");var f={sender:sender,dname:e,msg:b,time:c,previoussender:d,uniqueid:a.uniqueid,msgid:a.msgid};a.mode==="cannedarticle"&&(f.msg=b=$FAQ.getCustomCard(a.msg),f.iscannedarticle=!0,f.cardheader=$FAQ.getHeaderMessage(a.msg),$Support.handleNewMessageInConversation(f)),$Support.updateChatCache(f),f.msg=Message.format(b),b=$UI.getMsgHTML(f)}}catch(g){}return b},displayInfo:function(a,b){Message.display($UI.getInfoMsgHTML(a,b),!0)},getInfoHTML:function(a,b,c){var d="",e=a.mode,f=$Support.EmbedObj,g="";if(e=="ACCEPT_TRANSFER"&&a){var h=a.opruser;h.attendername=h.dname,d=LSResource.getRealValue("transcript.info.chattransfer",h.dname),b||(f.attenderimagefkey=h.image_fkey,f.setAttender(h.lsuid),f.attenderaboutme=h.aboutme,$Support.isConversationUIFocussed()||$UI.setInnerHeader(h),f.attendername=getUnescapedText(h.dname),$Support.handleChatTransferInConversationListView());var i=$Support.LSDB.getFromSession((c||f.chatID)+"_transcript")[0];i=$.extend(i,h),$Support.isBotChat&&!c&&$Support.handleBotTransferAccept(),$Support.removeChatCookie(),$Support.setCookie(),$("#audiocall").css("display","");var j=document.querySelectorAll("#audio_callagain");for(var k=0;k<j.length;k++)j[k].style.display="";avimpl.hideCallIcon=!1}else if(e=="ADDSUPPORTREP"&&a)d=LSResource.getRealValue("transcript.info.addrep",a.userlist.dname),avimpl.hideCallIcon=!0;else if(e=="INVITE"){var l=a.type,m=a.opruser,n=m.dname;if(l=="audio")d=LSResource.getRealValue("transcript.info.visitor.requestaudiochat",n);else if(l=="video")d=LSResource.getRealValue("transcript.info.visitor.requestvideochat",n);else if(l=="meeting"){var o=a.opr;m.wmsid==$Support.EmbedObj.vwmsid?(d=LSResource.getRealValue("transcript.info.sameuser.sharedesktop"),myMsgObj.sender&&(d+=" <a href='"+a.start_url+"' target='_blank'>"+LSResource.getRealValue("chatwindow.meeting.share.now")+"</a>")):d="request"==o?LSResource.getRealValue("chatwindow.meeting.request",n)+(myMsgObj.sender?" <a href='"+a.start_url+"' target='_blank' documentclick='openmeeting'>"+LSResource.getRealValue("chatwindow.meeting.share.now")+"</a>":""):LSResource.getRealValue("chatwindow.share.screen",n)+(myMsgObj.sender?" <a href='"+a.join_url+"' target='_blank' documentclick='openmeeting'>"+LSResource.getRealValue("chatwindow.meeting.joinnow")+"</a>":"")}}else if(e==="AVCALL")d=Message.getAVMessageBlock(a,c);else if(e=="CHATMONITOR_JOIN"){$("#audiocall").css("display","none");var j=document.querySelectorAll("#audio_callagain");for(var k=0;k<j.length;k++)j[k].style.display="none";avimpl.hideCallIcon=!0}else if(e=="VISITOR_NAME_CHANGE"&&a.msg){var p=a.changeset,q=a.msgsize,m=a.opruser;g=a.sender,g===f.vwmsid&&(d=q>2?LSResource.getRealValue("transcript.info.visitorchange_vis"):LSResource.getRealValue("transcript.info.visitor"+p+"change_vis"))}return d},constructAttUrl:function(a){var b="";try{var c=a.sender,d=a.msg,e=$Support.EmbedObj,f=Message.presender!=""&&Message.presender==c?!0:!1,g={sender:c,dname:a.dname,msg:d,previoussender:f,file:{size:d.size,url:d.url,fName:d.fName,comment:d.comment},mode:"att"};a.msgid&&(g.file.msgid=a.msgid),$Support.updateChatCache(g),b=$UI.getMsgHTML(g)}catch(h){}return b},display:function(a,b,c){var d=$("#msgdiv");if(d!=null){var e=document.getElementById("msgmaindiv"),f=!0;if(e.scrollHeight-e.scrollTop==e.clientHeight||e.scrollHeight<e.clientHeight)f=!1;ie||(a=util.optimizeFontForMozilla(a));var g=$Support.chatdiv.find('span[msgid="'+c+'"]');if(g.length)g.find(".filedet").replaceWith($(a).find(".filedet")),g.find(".fdload").replaceWith($(a).find(".fdload"));else{var h=$(".zsiq_transferdiv");h.length>0?($(a).insertBefore(h),h.is(":visible")||h.show()):$Support.chatdiv.append(a)}(!f||b)&&Message.scroll(e)}},scroll:function(a){if(!a)return;$(a).animate({scrollTop:a.scrollHeight-a.offsetHeight})},handleBlinkTitle:function(a){if($EmbedManger.isComposerFocused()||parent==self&&$EmbedManger.iswindowfocused())return;Message.blinkTitle(a)},blinkTitle:function(a){var b=$Support;b.isblinking||(b.documenttitle=document.title,b.isblinking=!0),Message.startBlinking(a),$Support.getParent().$ZSIQUtil.blinkTitle(a)},startBlinking:function(a){if(!a)return!1;clearTimeout($Support.blinktimer);var b,c="";$Support.blinktimer=setInterval(function(){b=="title"?(c=a,b="chmsg"):(c=$Support.documenttitle,b="title"),document.title=c},500)},stopBlinking:function(){$Support.getParent().$ZSIQUtil.stopBlinking();if(!$Support.isblinking)return;clearTimeout($Support.blinktimer),$Support.isblinking=!1,document.title=$Support.documenttitle},checkCardMask:function(a){var b=a.split("").map(Number),c=0,d=b.length,e=d%2;for(var f=0;f<b.length;f++){var g=b[f];f%2==e&&(g*=2),g>9&&(g-=9),c+=g}if(c%10==0){var h=a.split("");switch(d){case 13:return h.splice(0,9,"XXX-XXX-XXX-"),h.join("");case 14:return h.splice(0,10,"XXX-XXX-XXXX-"),h.join("");case 15:return h.splice(0,11,"XXX-XXXX-XXXX-"),h.join("");case 16:return h.splice(0,12,"XXXX-XXXX-XXXX-"),h.join("")}}return!1},checkMaskOccurance:function(a,b){var c=/\b(((\d)+([-]|\s)*)+(\d)+)\b/g,d=!1,e=[];e=a.match(c);if(e&&e.length)for(var f=0;f<e.length;f++){var g=e[f].match(/\d+/g).join(""),h=g.length;if(h<13||h>16)continue;var i=Message.checkCardMask(g);i&&(d=!0,a=a.replace(e[f],i))}return b?d:a}};function print(a){try{var b=document.getElementById("debug");b.innerHTML=a+"<br>"+b.innerHTML}catch(c){}}function printtime(){print(new Date)}function LSgetPrd(){return LSMessanger.getPrd()}function LSgetAuthType(){return 0}function LSgetUserName(){return LSMessanger.getUserName()}function LSgetNickName(){return LSMessanger.getNickName()}function LSgetUserId(){return LSMessanger.getUserId()}function LSgetSid(){return LSMessanger.getSid()}function LSplive(){lpt=new Date}function LSMessanger(){var a,b,c,d,e}var dext=".ls",CURCONID=-1,SUPPORT_REPS={};_SUBDOMAIN="zoho.com",_JOINED=!1;var _AGENT_ONLINE=!0,MONITOR_TIMER=0,IGNORE_ENCODE=[CT_TXT_MSG],pmonInterval=15e3,lpt;LSMessanger.init=function(){this.rchid=-1},LSMessanger.setRCHID=function(a){LSMessanger.rchid=a},LSMessanger.getRCHID=function(){return LSMessanger.rchid},LSMessanger.deleteSid=function(){delete LSMessanger.sid},LSMessanger.register=function(a,b){try{setTimeout(function(){LSDebugger.postDebugInfo("Visitor Side before registor : "+b,null,"",!0)},1)}catch(c){}if(!a){$EmbedManger.UI.showProcess(LSResource.getRealValue("common.serverconnectingerror")+" <a href='javascript:void(0)' onclick='window.location.reload()'>"+LSResource.getRealValue("common.reload")+"</a>");return}if(!b)return!1;this.prd=a,this.uname=b,LSMessanger.init(),WmsLite.setNoDomainChange(),WmsLite.setAuthType(0),WmsLite.setJSStaticDomain(_WMSJSSTATICDOMAIN),WmsLite.forceDomainChange();var d=_SCHEMA+"://"+_EMBEDSERVERURL;WmsLite.allowCrossOrigin(d),WmsLite.setWmsContext("salesiq"),WmsLite.setConfig(79),WmsLite.registerAnnon(a,this.uname,this.nname)},LSMessanger.getUserName=function(){return this.uname},LSMessanger.getNickName=function(){return this.nname},LSMessanger.setNickName=function(a){this.nname=a},LSMessanger.getUserId=function(){return this.uid},LSMessanger.getPrd=function(){return this.prd},LSMessanger.getSid=function(){return this.sid},LSMessanger.disable=function(){WmsLite.disablewms=!0},LSMessanger.isdisablewms=function(){return WmsLite.disablewms},LSMessanger.push=function(a,b,c){try{var d=parseInt(a.mtype);d>0&&IGNORE_ENCODE.indexOf(d)===-1&&a.msg&&(a.msg=getEncodedObject(a.msg))}catch(e){}var f=$EmbedManger;if(a==null||_WMSDOWN)return;if(a.mtype==0){var g=this.sid!=undefined,h=a.msg;h&&(this.uid=h.uid,this.sid=h.sid),myMsgObj.sender=this.uname,myMsgObj.nname=this.nname,myMsgObj.dname=this.nname,SUPPORT_REPS={};var i=f.getChatID(),j=f.getVisitorID();try{setTimeout(function(){LSDebugger.postDebugInfo("Visitor Side after registor : "+myMsgObj.sender+" : "+myMsgObj.nname+j,null,"",!0)},1)}catch(e){}if(i!=-1){var k=f.getWaitingCookie();if(!$NE&&k)return;$NE&&b&&$Support.removeCacheCookie(),LSMessanger.joinchat(i,f.getvwmsid(),b,c)}else j!=-1?(_JOINED=!1,f.reJoin()):j==-1&&!g&&f.addVisitor();$Support.setTabOwner()}else if(a.mtype==-3){_JOINED=!1;var i=f.getChatID();LSMessanger.joinchat(i,f.getvwmsid())}else if(a.mtype==10){var h=a.msg,i=h.chid;LSMessanger.setRCHID(i);for(var l=0;l<h.users.length;l++){var m=h.users[l];SUPPORT_REPS[m.uname]=m}h.users.length&&f.UI.showAgentStatus(),LSMessanger.transcript(f.getChatID(),f.getvwmsid())}else if(a.mtype==CT_TXT_MSG){var h=a.msg;LSMessanger.joinchat(f.getChatID(),f.getvwmsid()),EmbedSound.isPlaying("endtimer")&&EmbedSound.stop();if(!Message.isLocalUser(h.sender)){KeyHandler.isWindowFocused()||EmbedSound.play("smessage");var n=h.msg;h.msg=Markdown.apply(h.msg),Message.formatAndDisplay(h);var n=n.replace(/<span[^>]*?>/gi,"").replace(/<\/span>/gi,"").replace(/<br>/gi,"\r\n"),o={visitid:f.getVisitID(),message:n};f.handleCallbacks("visitor.chatmessage",o),Self.status.clear(),($Support.isFloat()&&$Support.getTabOwner()==LSMessanger.getSid()&&parent.$ZSIQWidgetUI.getWidgetState()==parent.$ZSIQWidgetUI.F_BUTTON||$Support.isConversationUIFocussed()||$Support.isFAQUIFocussed())&&$Support.incrementUnreadCount()}else Message.isSameBrowser(h.sid)||Message.formatAndDisplay(h);Message.updateMessageTime(h),$Support.handleOnGoingchatActionsInConversation("newmsg",h)}else if(a.mtype==CT_NFY_USERSTATUS){var h=a.msg;try{SUPPORT_REPS[h.uname]=h,f.UI.showAgentStatus()}catch(e){}}else if(a.mtype===NFY_ENDLIVESUPPORT||a.mtype===CT_NFY_LEAVESUPPORT){var h=a.msg;try{LSDebugger.postDebugInfo("Chat flow debug | End Chat notified to visitor session "+LSMessanger.getSid()+" | "+h.chid,null,null,!0)}catch(e){}avimpl.stopOngoingCallOnChatEnding(),LSMessanger.disable(),_JOINED=!1;if(f.getQuitStatus())return;f.updateChatCookie();if(f.isNewEmbed){f.handleChatEnded(h),$Support.handleOnGoingchatActionsInConversation("endchat",h);return}f.setQuitStatus(!0),a.mtype===CT_NFY_LEAVESUPPORT?(Message.displayInfo(LSResource.getRealValue("visitorchat.supportchat.ended"),"chtend"),f.UI.showFeedback(h.msg)):(Message.displayInfo(""),f.UI.handleEndSupport(h)),f.handleChatEnded(h)}else if(a.mtype==NFY_LS_OPERATIONS){var h=a.msg,p=h.module;p=="audiovideocall"&&(h.msg=JSON.parse(h.msg));if(h.msg&&h.msg.mode==="cannedarticle")Message.formatAndDisplay(h.msg),($Support.isFloat()&&$Support.getTabOwner()==LSMessanger.getSid()&&parent.$ZSIQWidgetUI.getWidgetState()==parent.$ZSIQWidgetUI.F_BUTTON||$Support.isConversationUIFocussed()||$Support.isFAQUIFocussed())&&$Support.incrementUnreadCount(),$Support.isFAQEnabled()&&$FAQ.updateMessageCount("newmsg");else if(p=="mailchimp"){var q=h.msg;q.name&&f.setVisitorName(q.name),q.email&&f.setVisitorEmail(q.email),f.UI.updateVisitorName(q),$Support.storeInCookie("mailchimp",JSON.stringify({email:q.email,name:q.name}),31e4)}else if(p=="desktopsharing"||p=="audiovideocall"||p=="VISITORNAMECHANGE"||p=="acctranschat"||p=="addsupportrep"||p=="transchat"||p=="updatechatparticipant"){f.UI.formatAndDisplayInfo("",h.msg,h.addinfo),f.updateChatCache({msg:h.msg});if(p==="VISITORNAMECHANGE"){var q=h.msg.VISITORDATA;Object.prototype.toString.call(q)==="[object Object]"&&(q.name&&f.setVisitorName(q.name),q.email&&f.setVisitorEmail(q.email),q.phone&&f.setVisitorPhone(q.phone),f.UI.updateVisitorName(q),SupportUI.embeddiv.find("#filedata").html(SupportUI.getSendFileHtml())),f.UI.hideVisitorInfo()}if(p=="acctranschat"){f.UI.hideGroupIcon();var o={visitid:f.getVisitID(),attendername:h.dname,department:h.deptname,attenderemail:h.attenderemail};f.handleCallbacks("agent.accepttransfer",o);var r=document.querySelectorAll("#audio_callagain");if($("#audiocall").length){$("#audiocall").css("display","");var r=document.querySelectorAll("#audio_callagain");for(var l=0;l<r.length;l++)r[l].style.display="";avimpl.clear()}else for(var l=0;l<r.length;l++)r[l].style.display="none"}if(p=="addsupportrep"){f.UI.showGroupIcon(),$("#audiocall").css("display","none");var r=document.querySelectorAll("#audio_callagain");for(var l=0;l<r.length;l++)r[l].style.display="none"}if(p=="transchat"){var s=h.msg,o={visitid:f.getVisitID(),currentuser:s.opruser.dname,transfertype:s.type,transfername:s.transferdetails.transfername};f.handleCallbacks("agent.transferchat",o)}}else if(p=="blockip")f.setIPBlockStatus(!0),(f.getType()=="float"||f.getType()=="personal")&&f.quit();else if(p=="addsupportrep"){var t=h.msg.userlist;SUPPORT_REPS[t.uname]=t,f.UI.showAgentStatus()}else if(p=="updatechatparticipant"){var t=h.msg.userlist;SUPPORT_REPS[t.uname]=t,f.UI.showAgentStatus()}}else if(a.mtype==NFY_USER_IDLE){var o=a.msg;o.msg="",Self.status.update(o),$Support.handleOnGoingchatActionsInConversation("typingstatus",o)}else if(a.mtype==NFY_USER_ENTERED){var o=a.msg;o.msg=f.isNewEmbed?"":LSResource.getRealValue("infomsg.enteredtext",o.dname),Self.status.update(o),$Support.handleOnGoingchatActionsInConversation("typingstatus",o)}else if(a.mtype==NFY_USER_TYPING){var o=a.msg,u=f.isNewEmbed?"ne.infomsg.istyping":"infomsg.istyping";o.msg=LSResource.getRealValue(u,o.dname),Self.status.update(o),$Support.handleOnGoingchatActionsInConversation("typingstatus",o);var v=$Support.EmbedObj,w=o.sender?o.sender.split("_")[2]:"";if(v.attender==w&&v.attendername!=o.nname){var x=$Support.LSDB.get("ZLD"+$Support.getParent().$ZSIQChat.getWidgetData().widgetobj.lsid+"avuid");$Support.LSDB.storeInSession(x+"_conversation",""),$Support.convlistcontainer.find("#pastchatconv").html("");var y="";$Support.convlistcontainer.find("#currchatconv").find(".siqc_cntbody").length==1&&(y=$($Support.convlistcontainer.find("#currchatconv").find(".siqc_cntbody")[0]).attr("chid")),$Support.PopulateConversationList(function(a,b){if(!a.length)return;var c="";a.forEach(function(a){if(y==a.chid)return;a.question=getEscapedText(a.question),c+=$Temp.getConversationHistoryHTML(a)}),b?$Support.convlistcontainer.find("#pastchatconv").prepend($(c)):$Support.convlistcontainer.find("#pastchatconv").append(c)}),$Support.EmbedObj.attendername=o.nname,$("#attname").html(o.nname),$("#convchatattendername").html(o.nname),LSMessanger.transcript($EmbedManger.getChatID(),LSMessanger.getUserId(),!0),$Support.removeCookie("ZLD"+v.livelsid)}}else if(a.mtype==CT_ATT_MSG){var o=a.msg;o.msgid||(o.msgid=(new Date).getTime()),Message.formatAndDisplay(o),f.UI.clearProgress();if(!Message.isLocalUser(o.sender)){KeyHandler.isWindowFocused()||EmbedSound.play("smessage");var z=o.msg,o={visitid:f.getVisitID(),message:LSResource.getRealValue("chatwindow.sharing_a_file_with_you",o.dname),filesize:getMemSize(z.size),filename:z.fName,sender:o.sender,dname:o.dname,content:z.content};f.handleCallbacks("visitor.chatmessage",o),($Support.isFloat()&&$Support.getTabOwner()==LSMessanger.getSid()&&parent.$ZSIQWidgetUI.getWidgetState()==parent.$ZSIQWidgetUI.F_BUTTON||$Support.isConversationUIFocussed()||$Support.isFAQUIFocussed())&&$Support.incrementUnreadCount()}Message.updateMessageTime(o),$Support.handleOnGoingchatActionsInConversation("newmsg",o)}else if(a.mtype==WM_CUSTOM){var A=a.msg,p=A.module;if(p==="pickupsupport"){try{LSDebugger.postDebugInfo("Chat flow debug | Pickup chat notified to visitor session "+LSMessanger.getSid()+" | "+A.visitorid,null,null,!0)}catch(e){}f.handlePickUp(A),$Support.handleOnGoingchatActionsInConversation("pickupchat"),avimpl.checkAttenderBrowser(A)}else if(p==="audiovideo")ZAudioVideo.handleStatus(A);else if(p==="desktopsharing")f.handleDesktopSharing(A),($Support.isFloat()&&$Support.getTabOwner()==LSMessanger.getSid()&&parent.$ZSIQWidgetUI.getWidgetState()==parent.$ZSIQWidgetUI.F_BUTTON||$Support.isConversationUIFocussed()||$Support.isFAQUIFocussed())&&$Support.incrementUnreadCount();else if(p==="actendsession"||p=="endsupport")f.handleEndSession(A);else if(p==="joinproactivechat"){var a=A.data;Message.isSameBrowser(a.sid)||f.handleJoinProActive(a)}else p==="missed"?$Support.handleMissedVisitor(!0):p==="audiovideocall"?avimpl.handleStartChat(a):p==="botbroadcast"?$Support.handleBotBroadcast(a):(p==="text_reply"||p==="context")&&$Support.handleBotMessage(a)}else if(a.mtype==CT_NFY_MSG){var o=a.msg;o.sender!=myMsgObj.sender&&Message.formatAndDisplay(o)}else if(a.mtype==NFY_PUSH_MSG){var o=a.msg;f.UI.handlePushMessage(o),($Support.isFloat()&&$Support.getTabOwner()==LSMessanger.getSid()&&parent.$ZSIQWidgetUI.getWidgetState()==parent.$ZSIQWidgetUI.F_BUTTON||$Support.isConversationUIFocussed()||$Support.isFAQUIFocussed())&&$Support.incrementUnreadCount()}else if(a.mtype==CT_NFY_USERDELETE){var h=a.msg,B=h.users;for(var l=0;l<B.length;l++)delete SUPPORT_REPS[B[l].uname];f.UI.showAgentStatus()}else if(a.mtype==WM_DNAME_UPDATE&&f.getChatID()!="-1"){var C=a.msg.dname;LSMessanger.setNickName(C),myMsgObj.dname=C,f.setVisitorName(C),f.setCookie()}else a.mtype==WM_WebRTC_MSG?(a.msg.msg=JSON.parse(a.msg.msg),a.msg.msg.cbtype==="credential"?"":$Support.LSDB.remove("avcallstatus_"+$Support.EmbedObj.chatID),avaction.init(a.msg)):a.mtype==WM_AV_MSG&&(a.msg.msg=JSON.parse(a.msg.msg),a.msg.msg.cbtype==="credential"?"":$Support.LSDB.remove("avcallstatus_"+$Support.EmbedObj.chatID),avaction.init(a.msg))},LSMessanger.joinchat=function(a,b,c,d){if(_JOINED||a==-1)return;var e=$EmbedManger,f=lsnocachefix("json",!1);f.chid=a,f.sid=encodeURIComponent(LSMessanger.getSid()),e.getuvid()&&e.getVisitorID()===-1&&(f.uvid=e.getuvid()),b&&(f.wmsid=b),f.visitorid=encodeURIComponent(e.getVisitorID()),c&&(f.isntwrkreconnect=c),d&&(f.isserverupwithoutserverdown=d),$Support.proactive&&(f.isproactive=!0),$.ajax({url:$Support.getAjaxURL("joinchat",dext),type:"POST",data:f,dataType:"json",success:function(a){if(!a)return;var b=a[0],c=b.objType,d=b.objString;if(d.chid){_JOINED=!0;return}if(c=="object"&&d.ERROR=="CHATENDED"){var f=d.CHATDETAILS;if(e.getQuitStatus())return;LSMessanger.disable();if(e.isNewEmbed){$Support.Util.showChatUI(),e.handleChatEnded(f),e.updateChatCookie();return}e.setQuitStatus(!0),$("#waitingform").hide(),e.showChatUI(),e.UI.handleEndSupport(f),e.handleChatEnded(f),e.updateChatCookie()}c==="error"&&(e.UI.resizequestion||e.UI.postMessage("size","shrink"),e.removeChatCookie(),document.location.reload())}})},LSMessanger.transcript=function(a,b,c){if(a==-1)return;var d=$EmbedManger,e=d.getType();if(e==null||e=="null")e="embed";e=="personal"&&(e="float");var f="";d.getVisitorID()!==-1?f+="&visitorid="+d.getVisitorID():f+="&uvid="+d.getuvid();var g=$Support.getAjaxURL("getvisitortranscript",dext);g+="?tzoffset="+_TZCOFFSET+"&uid="+b+"&type="+e+f+lsnocachefix(!0)+"&lang="+_LANG,_CCODE&&(g+="&ccode="+_CCODE);var h="";return d.isNewEmbed&&(h="json"),$.get(g,"",function(a){if(!$.trim(a))return;$("#waitingform").hide();var b=d.UI.embeddiv();if(a.indexOf("transcript.try.after.sometime")!=-1){b.find("#embedcontainer").html(""),d.UI.displayInfo(LSResource.getRealValue("transcript.try.after.sometime"));return}$Support.proactive&&$Support.isSessionTranscriptEmpty()?(d.updateChatCache(a,!0),$Support.Util.populateTriggerUI($Support.EmbedObj)):(d.showChatUI(a,c),d.updateChatCache(a,!0));var e=b.find("#msgcntr");e.html(Message.getDisplayContent(a)+d.UI.getDragDropHtml()),e.find(".attabout").attr("title",e.find(".attabout").text()),d.isautotrigger()||d.UI.showVisitorInfo(),avimpl.checkCallIcon(),d.UI.resizeWindow(),Message.scroll(document.getElementById("msgcntr")),LSMessanger.resendMessages(RESEND_AUTO),$Support.isFAQUIFocussed()&&$Support.incrementUnreadCount(),$Support.handleOnGoingchatActionsInConversation("newchat")},h),""},LSMessanger.sendMessage=function(a,b,c,d,e){if(_WMSDOWN||e&&!_JOINED){LSMessanger.handleResendFailed(a,b,c,d,e);return}var f=$EmbedManger;f.setCallbackargs(arguments);if(!b||!$.trim(b))return;b=b.replace(/[\n\r]/gi,"\n");var g={chid:a,sender:myMsgObj.sender,msg:b,sid:LSMessanger.getSid(),dname:getUnescapedText(LSMessanger.getNickName())};g.isbotchat=$Support.isBotChat,g.visitorid=encodeURIComponent($Support.EmbedObj.visitorID),e&&(g.resendtype=parseInt(e)),c&&(g.style=c),$.extend(g,lsnocachefix("json")),$.extend(g,f.UI.getCaptchaValue()),d&&(g.msgid=d),$.ajax({url:$Support.getAjaxURL("sendmessage",dext),type:"POST",data:g,dataType:"json",success:function(g){var h=g[0],i=h.module,j=h.objString;if(i=="error"&&j.digest){f.UI.showCaptcha(j.digest);return}f.setCallbackargs(null),f.UI.hideCaptcha(),e&&(e==RESEND_AUTO?Message.displaySendMessage(a,b,c):e==RESEND_MANUAL&&($("#"+d).removeClass("resend"),$("#resendicon").hide(),$EmbedManger.UI.displayInfo(LSResource.getRealValue("infomsg.msgsent.success")),setTimeout(function(){$EmbedManger.UI.hideInfo()},2e3))),$Support.LSDB.getFromSession($EmbedManger.getChatID()+"_failedmsg")&&LSMessanger.resendMessages(e)},error:function(){LSMessanger.handleResendFailed(a,b,c,d,e)}})},LSMessanger.handleResendFailed=function(a,b,c,d,e){$("#"+d).addClass("resend");var f=e?!0:!1;LSMessanger.storeFailedMessages(a,b,c,d,f),e==RESEND_MANUAL&&($EmbedManger.UI.displayInfo(LSResource.getRealValue("embed.msg.resendfail")),setTimeout(function(){$EmbedManger.UI.hideInfo()},2e3))},LSMessanger.storeFailedMessages=function(a,b,c,d,e){var f=$("#"+d),g=$Support.LSDB.getFromSession($EmbedManger.getChatID()+"_failedmsg"),h={chid:a,msg:b,properties:c,uniqueid:d};g&&g.length>0?e?g.splice(0,0,h):g.push(h):(g=new Array(h),f&&f.find(".msgbx").append($EmbedManger.UI.getResendIcon())),$Support.LSDB.storeInSession($EmbedManger.getChatID()+"_failedmsg",g)},LSMessanger.sendPredictMessage=function(a){if($EmbedManger.getVisitorID()===-1)return;if($.trim(a).length==0)return;var b={chid:$EmbedManger.getChatID(),sender:myMsgObj.sender,msg:a,sid:LSMessanger.getSid(),dname:getUnescapedText(LSMessanger.getNickName())};$.extend(b,lsnocachefix("json")),$.ajax({url:$Support.getAjaxURL("sendprdctmsg",dext),type:"POST",data:b,dataType:"json",success:function(a){}})},LSMessanger.setSubDomain=function(a){_SUBDOMAIN=a},LSMessanger.getSubDomain=function(){return _SUBDOMAIN},LSMessanger.resendMessages=function(a){var b=$EmbedManger.getChatID()+"_failedmsg",c=$Support.LSDB.getFromSession(b);if(!c||c.length<1)return;var d=c.shift();$Support.LSDB.storeInSession(b,c),LSMessanger.sendMessage(d.chid,d.msg,d.properties,d.uniqueid,a)};function DynamicMsg(){this.init()}DynamicMsg.init=function(){DynamicMsg.values={},DynamicMsg.labelsmap={"company.name":"clearbit_reveal_companyname","company.location":"clearbit_reveal_location","company.website":"clearbit_reveal_domain","company.employeecount":"clearbit_reveal_employees","company.annualrevenue":"clearbit_reveal_annualrevenue","company.marketcapital":"clearbit_reveal_marketcap","company.fundraised":"clearbit_reveal_raised","company.type":"clearbit_reveal_type","company.twitterfollowers":"clearbit_reveal_followers","company.facebooklikes":"clearbit_reveal_likes","company.industrytype":"clearbit_reveal_industry","company.sector":"clearbit_reveal_sector","attender.name":"attendername","attender.email":"attenderemail","visitor.name":"name","visitor.id":"visit_id","visitor.email":"email","visitor.phone":"phone","visitor.department":"department","visitor.question":"question","visitor.ip":"ip","visitor.country":"country","visitor.pagetitle":"title","visitor.pageurl":"currentpage","visitor.referrer":"referrer","visitor.timezone":"localtime","visitor.operating.system":"os","visitor.browser":"browser","visitor.browser.version":"browserversion","smart.timenow":"smart_timenow","screen.resolution":"screen","web.embed.name":"embed"},$EmbedManger.isNewEmbed&&(DynamicMsg.updateValues($EmbedManger.getAddinfo()),DynamicMsg.updateValues(Browser.getInfo()))},DynamicMsg.setValues=function(a){DynamicMsg.updateValues($EmbedManger.getAddinfo()),DynamicMsg.updateValues(Browser.getInfo()),DynamicMsg.updateValues(a),DynamicMsg.updateValues($.parseJSON(a.CUSTOMERINFO),"custom."),delete DynamicMsg.values.CUSTOMERINFO},DynamicMsg.updateValues=function(a,b){if(!a){if(b=="custom.")for(var c in DynamicMsg.values)c.split("custom.")[0]==""&&delete DynamicMsg.values[c];return}var d="";for(var e in a)d=b?b+e:e,DynamicMsg.values[d.toLowerCase()]=a[e]},DynamicMsg.getKeyFromMap=function(a){return a.split(".")[0]==="custom"?a.toLowerCase():DynamicMsg.labelsmap[a.toLowerCase()]},DynamicMsg.getValue=function(a){clientkey=DynamicMsg.getKeyFromMap(a),value=DynamicMsg.values[clientkey];if(typeof value=="undefined")return"";if(!clientkey)return a;if(clientkey==="smart_timenow")return DynamicMsg.getSmartTimeNow();if(clientkey==="name"){var b=value.split(" ");return b[0]==="Visitor"||/^\d+$/.test(b[0])?"":CommonUtil.wordCapitalize(value)}if(clientkey==="department"){if(value=="-1")return"";var c=$EmbedManger.getDeptlist();for(var d=0;d<c.length;d++){var e=c[d];if(""+e.ID===value)return e.NAME}}return value},DynamicMsg.updateClearBitValues=function(a){if(a.Reveal)for(var b in a.Reveal)DynamicMsg.updateValue("clearbit_reveal_"+b,a.Reveal[b]);if(a.Enrichment)for(var b in a.Enrichment)DynamicMsg.updateValue("clearbit_enrichment_"+b,a.Enrichment[b])},DynamicMsg.updateValue=function(a,b){DynamicMsg.values[a.toLowerCase()]=b},DynamicMsg.getSmartTimeNow=function(){var a=new Date,b="",c=a.getHours();if(c>=5&&c<12)b="morning";else if(c>=12&&c<17)b="afternoon";else if(c>=17&&c<21)b="evening";else if(c>=21||c<5)b="night";return LSResource.getRealValue("smart.timenow."+b)},DynamicMsg.getSmartTimePeriod=function(a){var b=new Date,c=b.getHours()<10?"0"+b.getHours():b.getHours(),d=b.getMinutes()<10?"0"+b.getMinutes():b.getMinutes();return c+":"+d+" "+LSResource.getRealValue("common.time.hours")},DynamicMsg.fillValues=function(a){var b=new Array,c="",d=0,e="",f="",g=0;if(a.indexOf("&#x25;")!==-1||a.indexOf("&lt;br&#x2f;&gt;")!==-1)a=a.replace(/&#x25;/g,"%"),a=a.replace(/&lt;br&#x2f;&gt;/g," ");while(a.indexOf("%")!=-1){c="",strt=a.indexOf("%",g),last=a.indexOf("%",strt+1);if(strt===-1||last===-1)break;f=e=a.substring(strt+1,last),d=e.indexOf("|"),d!==-1&&(e=f,b=f.split("|"),f=b[0],c=b[1]),val=DynamicMsg.getValue(f),val===f?(e=a.substring(strt+1,last),value="%"+e+"%"):(value=val?val:c,a=a.replace("%"+e+"%",CommonUtil.escapeSpecialNotation(value))),g=strt+value.length-1}return a};function $SupportConfig(a){var b=a.einfo,c=a.pinfo,d=b.embedstatus;this.setEmbedProps(CommonUtil.parseToJSON(b.props)),this.setPortalProps(c.pinfo),this.setAdditionalParams(a.params),this.setLicenceProps(a.linfo);var e=a.name?a.name:a.params&&a.params.name?a.params.name:undefined;this.setVisitorName(e);var f=a.email?a.email:a.params&&a.params.email?a.params.email:undefined;this.setVisitorEmail(f),this.setVisitorID(-1),this.setChatID(-1),this.setPrevCHID(-1),this.setSelectedDept(d.DEPARTMENTID),this.mappeddept=this.department,this.setLiveSupportID(b.embedid),this.setEmbedType(a.params.type),this.setDepartmentList(d.DEPTLIST),this.setEmbedName(a.einfo.uniquename),this.setWaitAction(),a.annonid&&this.setvwmsID(a.annonid),this.setEmbedWaitingTime(b.waitingtime),this.setPortalName(c.screenname),this.setSchema(a.schema),this.setProductCode(a.lsprdcode),this.setEmbedStatus(d.STATUS),this.setSoundConfig(!0),this.setCompanylogo(c.clogo_fkey),this.setCompanyWebsite(c.companywebsite),this.setConfigureMsg(b.props),this.setAddinfo(a.params),this.setBusnsHrStatus(d),this.setErrorFieldInfo(),this.setIntegId(c.integid),this.setIntegProps(a.integprops),this.isBetaPortal=c.isbetaportal,this.setUserDetails(b.userdetails)}$SupportConfig.prototype={booleanprops:["icphoto","icsound","icfile","isscreenshare","issiqscreenshare","ispopout","icmail","icprint","iclogo","isconversation","isaudiocall","showsmiley"],objprops:["isname","isemail","isphoneno","feedback","rating","color","isbotenabled"],setEmbedProps:function(a){this.eprops={};for(var b=0;b<this.booleanprops.length;b++){var c=this.booleanprops[b];this.eprops[c]=this.getBooleanVal(JSON.parse(a[c])[0])}for(var b=0;b<this.objprops.length;b++){var c=this.objprops[b];this.getBooleanValuesForObject(a,c)}},setPortalProps:function(a){this.pprops=a},setAdditionalParams:function(a){this.eparams=a},setLicenceProps:function(a){this.linfo=a},setVisitorName:function(a){var b=this.visitorname;this.visitorname=isUndefined(a)?b:a==="Guest"?LSResource.getRealValue("common.you"):a},setVisitorEmail:function(a){this.visitoremail=isUndefined(a)?this.visitoremail:a},setVisitorID:function(a){this.visitorID=isUndefined(a)?this.visitorID:a},setSelectedDept:function(a){this.department=isUndefined(a)?this.department:a},setChatID:function(a){this.chatID=isUndefined(a)?this.chatID:a},setPrevCHID:function(a){this.lchid=a},setLiveSupportID:function(a){this.livelsid=a},setvwmsID:function(a){this.vwmsid=isUndefined(a)?this.vwmsid:a},setEmbedType:function(a){this.type=a||"float"},setSchema:function(a){_SCHEMA=a},setPortalName:function(a){this.portalname=a},setDepartmentList:function(a){this.deptlist=a},setEmbedWaitingTime:function(a){this.embedwaitingtime=a},setEmbedName:function(a){this.embedname=a},setWaitAction:function(a){this.waitaction="text"},setAttender:function(a){this.attender=a},setVisitID:function(a){this.VISITID=a},setProductCode:function(a){$Support.Util.productCode=a},setAttenderZUID:function(a){this.attenderZUID=a},setAttenderUserAgent:function(a){this.attenderuseragent=a},setVisitorPhone:function(a){this.visitorphone=isUndefined(a)?this.visitorphone:a},setEmbedStatus:function(a){this.status=JSON.parse(a)},setSoundConfig:function(a){this.soundval=a},setCompanylogo:function(a){this.clogo=_SCHEMA+"://"+_EMBEDSERVERURL+"/"+_SCREENNAME+"/clogo/"+a+"/photo.ls"},setConfigureMsg:function(a){this.waitmsg=JSON.parse(a.waitingmsg)[1].msg||LSResource.getRealValue("ne.waitmsg");var b=JSON.parse(a.offlinemsg)[1];this.offlinemessage=b.msg||"",this.offlinerespmsg=b.resmsg||LSResource.getRealValue("ne.offlinerespmsg");var c=JSON.parse(a.busymsg)[1];this.missedmessage=c.msg||LSResource.getRealValue("embed.busymsg"),this.missedrespmsg=c.resmsg||LSResource.getRealValue("ne.offlinerespmsg"),this.thanksmsg=JSON.parse(a.thanksmsg)[1].msg||"";var d=JSON.parse(a.engagedmsg)[1];this.engagedmessage=d.msg||"",this.engagedrespmsg=d.resmsg||LSResource.getRealValue("ne.offlinerespmsg");var e=JSON.parse(a.deptmsg)[1];this.deptofflinemsg=e.msg||"",this.deptofflinerespmsg=e.resmsg||"",this.feedbackcomplete=JSON.parse(a.feedback)[1].msg||"";var f=JSON.parse(a.rating)[1];this.feedbackcomplete1=f.msg1||"",this.feedbackcomplete2=f.msg2||"",this.feedbackcomplete3=f.msg3||"",this.feedbackcomplete4=f.msg4||"",this.feedbackcomplete5=f.msg5||"",this.windowsize=JSON.parse(a.size)[1].val||2,this.faqaccess=JSON.parse(a.faqaccess)||""},setAddinfo:function(a){var b=this.addinfo||{};this.addinfo={name:a.name||b.name,email:a.email||b.email,question:a.question||b.question,autochat:a.autochat||b.autochat,deptname:a.deptname||b.deptname,phone:a.phone||b.phone,country:a.country||b.country,embed:a.embedname||b.embedname,forcefloatingwindow:a.forcefloatingwindow||null}},setBusnsHrStatus:function(a){this.bushrstatus=a.BUSINESSHOURSTATUS},setErrorFieldInfo:function(){this.errorinfo={visname:LSResource.getRealValue("ne.errorinfo.name"),visemail:LSResource.getRealValue("ne.errorinfo.email"),visphone:LSResource.getRealValue("ne.errorinfo.phone"),msgarea:LSResource.getRealValue("ne.errorinfo.question")}},setIntegId:function(a){this.integid=a},setIntegProps:function(a){this.integprops=a},setCompanyWebsite:function(a){a&&(this.companywebsite=a.indexOf("http")==-1?"http://"+a:a)},setUserDetails:function(a){a&&(this.userdetails=a)},getBooleanVal:function(a){return a==1?"true":"false"},getBooleanValuesForObject:function(a,b){this.eprops[b]={};var c=JSON.parse(a[b]);this.eprops[b][0]=this.getBooleanVal(c[0]);if(b=="isname"||b=="isemail"||b=="isphoneno"){var d=c[1];this.eprops[b][1]={ismandatory:this.getBooleanVal(d.ismandatory)}}else if("color"==b){var e=c[1];e.code||(e.code="#238de9"),this.eprops[b][1]=e}else"isbotenabled"==b&&(this.eprops[b][1]=c[1]);b=="rating"?$Support.israting=JSON.parse(this.eprops.rating[0]):b=="feedback"&&($Support.isfeedback=JSON.parse(this.eprops.feedback[0]))}};