jQuery(function(a){function u(b,c){try{var d=a.parseJSON(c);return d.componentOptions?d.componentOptions:(d={content:c},d)}catch(e){return eleOptions={content:c},eleOptions}}function v(b,c){var d="["+c+"]";try{b=b.is(d)?b:a(b.parents(d).get(0))}catch(e){}return b}function x(c){this._windowEle=a(window),this._windowWidth=this._windowEle.width();var d=this;this._windowEle.on("resize."+this.widgetName,function(a){d._windowWidth=d._windowEle.width()}),this._documentEle=a(document),this._documentEle.on("keydown."+this.widgetName,function(a){a.keyCode==27&&F(a)}),a(c).on("buttondisabled",function(b,c){var d=a(c.element),e=d.attr("title");c.disabled?(d.removeAttr("title"),d.data("ztooltip",e)):d.attr("title",d.data("ztooltip"))}),a(c).on("mouseover mouseup",function(c){var e=v(a(c.target),"title"),k=e.attr("title");if(!k)return;if(e.length&&e[0].nodeName.toLowerCase()!=="document"){f&&clearTimeout(f),c.stopPropagation(),c.preventDefault();if(e.attr("disabled")||e.hasClass("ui-state-disabled")||e.hasClass("ui-ztooltip-ignore"))return y(e),F(),!1;w=e,y(e),b=a.extend({},t,u(e,k));var l=e.attr("callout");l!==undefined&&s[l]!==""&&(b.callout=l),a(h).length&&a(h).find(".ui-ztooltip-close").remove(),g=800,A(c,e),i=e,j=k,e.on("click.ztooltip",function(a){F()}),e.off("mouseout.ztooltip").on("mouseout.ztooltip",function(a){b.timeout&&clearTimeout(q),f&&clearTimeout(f),f=setTimeout(function(){b.autohide&&(e.unbind("mousemove"),F(a))},200),y(e,!0)}),d._documentEle.off("mousedown.ztooltip").on("mousedown.ztooltip",function(a){b.autohide&&(e.unbind("mousemove"),F(a)),y(e,!0)}),b.mousetrack&&e.off("mousemove.ztooltip").on("mousemove.ztooltip",function(a){J(a,e)})}})}function y(b,c){var d=c?b.data("parents"):b.parents("[title]");c?b.data("parents",undefined):(d.push(b),b.data("parents",d)),d&&a.each(d,function(b,d){d=a(d);var e="",f=d.attr("title");c?f!=d.data("title")&&f!=""?e=f:e=d.data("title"):d.data("title",f),d.attr("title",e)})}function z(f){var o=h?!0:!1,p="ui-corner-all",q=b.ajaxContent?"ui-ztooltip-ajaxcontent ":b.autohide?"ui-ztooltip-content ":"ui-ztooltip-contentwithclose ";if(!o){h=a("<div>").attr("class","ui-ztooltip ui-widget"),m=undefined;var s=a("<div>").attr("class","ui-ztooltip-overlaydiv ui-corner-all");k=a("<div>").attr("class","ui-ztooltip-header ui-corner-top"),l=a("<div>").attr({"class":q+p,id:"ui-ztooltip-content"}),n=a("<span>").attr("class","ui-ztooltip-img "+b.iconclass).appendTo(s),k.appendTo(s),l.appendTo(s),s.appendTo(h),a("body").append(h)}else g=0;k.css("display",""),n.css("display",""),b.iconclass&&n.css({display:"inline-block"}),b.title&&(k.text(b.title),p="ui-corner-bottom",k.css({display:"inline-block"}));if(!b.autohide){var t=a("<span>").attr("class","ui-ztooltip-close ui-icon ui-components-icon").on("click",function(b){a(i).off("mousemove"),F(b),a(i).attr("title",j)});t.appendTo(h),a(i).attr("noAutoHide",!0)}l.attr("class",q+" "+p);if(!b.ajaxContent){e=b.content;var u=b.contentType=="html";if(u&&b.isContentElementId){var v=a("<div>").append(a("#"+b.content).show());e=v.html()}if(r&&a.ui&&a.ui.shortcutkeys&&r.showShortcutKey){f=f.is("label.ui-button")?f.prev("input"):f;var w=a(document).shortcutkeys("getShortcutKey",f);w&&(e=e+" ("+w+")")}}c&&c.remove(),c=h.clone(),a("body").append(c);var u=b.contentType=="html";return c.removeAttr("style").hide(),c.find("#ui-ztooltip-content").removeAttr("style"),c.find("#ui-ztooltip-content")[u?"html":"text"](e),b.callout&&!b.ajaxContent?(m||(m=a("<div>").attr("class","ui-ztooltip-callout").appendTo(h)),d=C(b.callout,m,h)):m=undefined,h}function A(f,i){var j=b.contentType=="html";if(b.mouseEnter===!0||b.mousetrack===!0)b.callout="northwest";var k=z(i);if(k){var n=undefined;f.originalEvent?n=b.callout&&!b.ajaxContent?E(f):{left:f.pageX+10,top:f.pageY+10}:(n=i.offset(),n.left+=i.width(),n.top+=i.height()),n=B(n,i,c),clearTimeout(o),clearTimeout(p),o=setTimeout(function(){if(i.is(":visible")||i.is("option")){if(b.ajaxContent){var c=a("<div>").attr("class","ui-ztooltip-content-loading");a(h).find(".ui-ztooltip-ajaxcontent").append(c),p=setTimeout(function(){a.ajax({type:"GET",url:b.ajaxContent,data:"",success:function(b){a(h).find(".ui-ztooltip-ajaxcontent").html(b)},error:function(){a(h).find(".ui-ztooltip-ajaxcontent").empty()}})})}b.timeout&&b.autohide&&(q=setTimeout(function(){F(f)},parseInt(b.timeout))),k.show(1,function(){l[j?"html":"text"](e),m.css(d),n=G(f,k,n,i),n&&k.css(n),b.calloutHideMode&&h.find(".ui-ztooltip-callout").hide()})}},g)}}function B(a,c,d,e){var f=b.callout?b.callout:e,g=c.offset(),h=g.left,i=g.top;return c.is("option")&&(h=c.parent("select").offset().left,i=c.parent("select").offset().top+c.offset.top),f&&(f.indexOf("north")!=-1?(!b.mouseEnter&&!b.mousetrack&&(f==="northwest"?a.left=h:f==="northeast"?a.left=h-(d.width()-c.outerWidth()):a.left=h-8-(d.width()/2-8)+c.outerWidth()/2),a.top=i+c.outerHeight()+9):f.indexOf("south")!=-1?(f==="southwest"?a.left=h:f==="southeast"?a.left=h-(d.width()-c.outerWidth()):a.left=h-8-(d.width()/2-8)+c.outerWidth()/2,a.top=i-d.outerHeight()-9):f==="west"?(a.left=parseInt(h+c.outerWidth()+9),a.top=i-d.height()/2+c.outerHeight()/2):f==="east"&&(a.left=parseInt(h-d.width()-9),a.top=i-d.height()/2+c.outerHeight()/2)),a}function C(a,b){if(!h)return!1;var d={};b.removeAttr("class").attr("class","ui-ztooltip-callout ui-ztooltip-callout-"+s[a]);var e=b.outerWidth(),f=b.outerHeight(),g=c.width(),i=c.height();switch(a){case"north":d={left:g/2-e/2+"px",top:"-"+(f-1)+"px"};break;case"west":d={left:"-"+(e-1)+"px",top:i/2-f/2+"px"};break;case"east":d={left:g-1+"px",top:i/2-f/2+"px"};break;case"south":d={left:g/2-e/2+"px",top:i-1+"px"};break;case"northeast":d={left:g-e*2+"px",top:"-"+(f-1)+"px"};break;case"northwest":d={left:e+"px",top:"-"+(f-1)+"px"};break;case"southwest":d={left:e+"px",top:i-1+"px"};break;case"southeast":d={left:g-e*2+"px",top:i-1+"px"};break;default:b.addClass("ui-ztooltip-callout-top"),d={left:e+"px",top:"-"+(f-1)+"px"}}return d}function E(a){a.tooltipWidth=h.outerWidth(),a.tooltipHeight=h.height();var c={};a._OFFSET=10;if(!h)return!1;var d=h.find(".ui-ztooltip-callout");a.calloutWidth=d.outerWidth(),a.calloutHeight=d.outerHeight();var e=D[b.callout];return e||(e=D.defaultFn),e(a)}function F(c){h&&(b.contentType==="html"&&b.isContentElementId&&a(h).find("#"+b.content).appendTo("body").hide(),a(h).remove(),h=undefined)}function G(a,c,d,e){if(c&&d){var f=d.top-this._documentEle.scrollTop(),g=d.left-this._documentEle.scrollLeft(),h=g+c.width(),i=f+c.height(),j=undefined,k=5,l;h>=this._windowWidth?(d.left=this._windowWidth-(c.outerWidth(!0)+k),d.left+c.width()-e.offset().left<=15&&(b.callout="east"),j=b.callout):g<0&&(d.left=d.left+k-g,e.offset().left+e.width()-this._documentEle.scrollLeft()<=20&&(b.callout="west"),j=b.callout),i>=this._windowEle.height()?(d.top=e.offset().top-c.outerHeight()-9,j="south",l=f):f<0&&(d.top=e.offset().top+e.outerHeight()+9,j="north",l=f);if(j){var m=c.find(".ui-ztooltip-callout");H(a,j,m,c,d,g,l)}}return d}function H(a,c,d,e,f,g,h){var i=b.callout?b.callout:c;switch(c){case"north":i=i=="south"?"north":i=="southeast"?"northeast":i=="southwest"?"northwest":i;break;case"south":i=i=="north"?"south":i=="northeast"?"southeast":i=="northwest"?"southwest":i;break;case"west":i=i=="east"?"west":i;break;case"east":i=i=="west"?"east":i}return I(a,i,d,e,c,f,g,h)}function I(c,d,e,f,g,h,i,j){if(e){b.callout=d;var k=e.position();j&&(k=C(d,e),k||(k=e.position())),d==="east"||d==="west"?(k=C(d,e),h=B(h,a(c.target),f,g)):d==="northwest"||d==="northeast"||d==="southwest"||d==="southeast"?k=C(d,e):i<0?(k.left=f.width()/2-e.outerWidth()/2+i-5,k.left<=10&&(k.left=10)):(k.left=f.width()/2-e.outerWidth()/2+(i-h.left),f.width()-k.left<=20&&(k.left=f.width()-20)),k&&e.css(k)}return h}function J(c,d){var e=a(h),f=e.width(),g=e.height(),i=b.callout&&!b.ajaxContent?E(c):{left:c.pageX+5,top:c.pageY+5};i=G(c,h,i,d),e.width()+parseInt(i.left)>this._windowWidth&&e.width(this._windowWidth-(parseInt(i.left)+50)),e.css(i)}function K(b,c,d){var e=a(this);r=a.extend({},t,typeof b=="object"&&b);var f=e.data("z-ztooltip");f?b==="remove"&&F():(x(e),e.data("z-ztooltip",!0))}var b={},c=undefined,d,e,f=undefined,g=800,h=undefined,i=undefined,j=undefined,k=undefined,l=undefined,m=undefined,n=undefined,o=undefined,p=undefined,q=undefined,r={},s={northwest:"top",north:"top",northeast:"top",west:"left",east:"right",southwest:"bottom",south:"bottom",southeast:"bottom"},t={callout:"north",autohide:!0,mousetrack:!1,mouseEnter:!1,showShortcutKey:!0,contentType:"text",positionAlterable:!0,calloutHideMode:!1},w=undefined,D={north:function(a){return{left:a.pageX-a.tooltipWidth/2,top:a.pageY+(a.calloutHeight+a._OFFSET)}},west:function(a){return{left:a.pageX+(a.calloutWidth+a._OFFSET),top:a.pageY-a.tooltipHeight/2}},east:function(a){return{left:a.pageX-(a.calloutWidth+a._OFFSET)-a.tooltipWidth,top:a.pageY-a.tooltipHeight/2}},south:function(a){return{left:a.pageX-a.tooltipWidth/2,top:a.pageY-(a.calloutHeight+a._OFFSET)-a.tooltipHeight}},northeast:function(a){return{left:a.pageX-(a.tooltipWidth-(a.calloutWidth+a.calloutWidth/2)),top:a.pageY+a.calloutHeight+a._OFFSET}},northwest:function(a){return{left:a.pageX-(a.calloutWidth+a.calloutWidth/2),top:a.pageY+a.calloutHeight+a._OFFSET}},southwest:function(a){return{left:a.pageX-(a.calloutWidth+a.calloutWidth/2),top:a.pageY-(a.calloutHeight+a._OFFSET)-a.tooltipHeight}},southeast:function(a){return{left:a.pageX-(a.tooltipWidth-(a.calloutWidth+a.calloutWidth/2)),top:a.pageY-(a.calloutHeight+a._OFFSET)-a.tooltipHeight}},defaultFn:function(a){return D.north(a,a.calloutHeight,a.calloutWidth)}};a.fn.ztooltip=K,$Support.isMobileWidth()||a(document).ztooltip()});LSDragDrop={onDropEvent:function(a,b,c){if(a==-1)return;try{b.preventDefault();var d=c||b.dataTransfer.files;this.nooffiles=d.length,this.pos=0,this.uploadFile(a,d)}catch(e){}},uploadFile:function(a,b){function g(){$UI.hideUploadProgress(d),$Support.Util.handleCallbacks("chat.file",{}),c.pos<c.nooffiles&&(d=(new Date).getTime(),c.uploadFileUsingPost(a,b,c.pos,f,d),c.pos++)}var c=this,d=(new Date).getTime(),e=function(){c.uploadFile(a,b)},f={progress:function(a,d){$UI.showUploadProgress({fileobj:b[c.pos-1],prgval:a,msgid:d})},complete:function(){g()},success:function(){g()}};c.uploadFileUsingPost(a,b,c.pos,f,d),c.pos++},getFormData:function(a,b){var c=new FormData;return $.each(a,function(a,b){c.append(a,b)}),c},uploadFileUsingPost:function(a,b,c,d,e){try{var f=b[c],g=this,h=$Support.EmbedObj;if(f.size<=52428800){var i=g.getFormData({chid:a,dname:h.visitorname,mod:"att",sid:LSMessanger.getSid(),lsid:h.livelsid,sender:h.vwmsid,msgid:e,file1:f});try{CommonUtil.handleFileUpload({callbacks:d,formdata:i,type:f.type,msgid:e})}catch(j){}return}var k=f.name;k=k==undefined||k==null?"file1":k,g.pos=c+1;if(b[g.pos]==undefined&&b[g.pos]==null){$UI.showBanner(LSResource.getRealValue("infomsg.filesharing.sizeexceed",k+",50"),!0),$UI.hideUploadProgress(e);return}if(!confirm(LSResource.getRealValue("infomsg.filesharing.sizeexceedproceednext",k+",50")))return;g.uploadFileUsingPost(a,b,g.pos,d,e)}catch(j){}}};var PasteImage={};PasteImage={isUser:!1,setIsUser:function(a){this.isUser=a},onPaste:function(a,b){if(!$Support.isChatExist())return;this.txtarea=b?b:null;if(window.clipboardData&&window.clipboardData.getData("Text"))return a.preventDefault(),this.insertText(e);var c=(a.originalEvent||a).clipboardData;if(c){a.preventDefault();var d=c.items;d&&this.handlePaste(d);var e=c.getData("text/plain");if(e&&this.files.length==0)return this.insertText(e)}return!1},getHTMLTemplet:function(){return this.isUser?"<div id='fileintex-FILEINDEX' purpose='fileupload' CLASS><input type='text' value='' class='file-name' purp='name'/><div id='pasteimage' class='pasteimage'></div><textarea class='pasteimgcomment' id='pasteimgcomment' purp='comment' placeholder='"+LSResource.getRealValue("transferchat.comment.placeholder")+"'></textarea>"+"</div>":$EmbedManger.UI.getPrevHTML()},getEmbPrevHTML:function(){return'<div id="fileintex-FILEINDEX" purpose="fileupload"><div class="imgshr_head txtelips" title="'+getEncodedText(Support.attendername)+'">'+LSResource.getRealValue("common.sharewith",getEncodedText(Support.attendername))+"</div>"+"<input type='text' value='' class='file-name' purp='name'/>"+'<div class="embd_pstimgdiv" id="pasteimage"></div>'+'<textarea id="pasteimgcomment" purp="comment" placeholder="'+LSResource.getRealValue("common.comment.placeholder")+'"></textarea>'+'<div class="pstimg_btns">'+'<span id="uploadimage" class="txtelips strtbtn drkdclr">'+LSResource.getRealValue("banner.share")+"</span>"+'<span id="cancelupload" class="txtelips cnsl">'+LSResource.getRealValue("common.cancel")+"</span>"+"</div>"+"</div>"},getHTML:function(){var a="<div class='pstimg-main' id='pstimg-main'>",b=this.files.length,c=b>2?"class='mult-imgs mrgn-bt18'":b==2?"class='mult-imgs'":"";for(var d=0;d<b;d++){var e=this.getHTMLTemplet();e=e.replace(/FILEINDEX/g,d),e=e.replace(/CLASS/g,c),a+=e}return a+"</div>"},insertText:function(a){var b=document.getSelection();return window.clipboardData?(document.selection.createRange().pasteHTML(a),!0):document.queryCommandEnabled("insertText")&&b.rangeCount>0&&document.execCommand("insertText",!1,a)?!0:!1},checkAndShowUI:function(){if(this.files.length>0){if(this.isUser){this.showPortalUI();return}$EmbedManger.UI.showPasteUI()}},handlePaste:function(a){this.files=[],itemlen=a.length;var b=this,c=function(a){var c=document.createElement("DIV");c.innerHTML=a;var d=c.getElementsByTagName("img");d&&d.length==0&&(b.files=[])};for(var d=0;d<itemlen;d++){var e=a[d].type,f=a[d].getAsFile();/^image\/.+$/.test(e)&&f&&this.files.push(f),$Support.isMacOS()||a[d].getAsString(c)}this.checkAndShowUI()},updateDetailes:function(a){var b=0,c=this.files,d=c.length;for(;b<d;b++){var e=c[b],f=e.name,g="",h=a.find("#fileintex-"+b);f||(f=this.generateName(e,b));var i=f.lastIndexOf(".");i!==-1?g=f.substring(i):i=f.length,f=f.substring(0,i),f=f.replace(/[`~!\$%\^&\|\\\"<>\?\/]/g,"-"),f=f.substring(0,100),this.Filename=f,this.ext=g,h.attr("fileextn",g),h.find(".file-name").val(f),h.find("#pasteimgcomment").focus(),this.bindHandler(h),this.setPreview(h,e)}},bindHandler:function(a){a.find(".file-name").on("blur",function(){var a=$(this).val();if(a==""){$(this).val(PasteImage.Filename);return}PasteImage.Filename=$(this).val()}).on("keydown",function(){$(this).removeClass("bdrbot_red")})},generateName:function(a,b){var c=a.type,d=c.substring(c.indexOf("/")+1,c.length);return"Image - "+this.getcurrTime()+"."+d},getcurrTime:function(){var a=new Date,b="",c=a.getHours(),d=a.getMinutes(),e=c>12?c-12:c==0?"12":c;return b+=(e<10?"0":"")+e,b+=(d<10?":0":":")+d,b+=c>=12?" PM":" AM",b},showEmbedUI:function(a){var b=$("#embedcontainer").find(".flcontainer"),c=this.getHTML();b.find(".pstimg-main").remove(),b.append(c).find(".pstimg-main").show(),b.find("#uploadimage").on("click",function(){PasteImage.uploadImage(b)}),b.find("#cancelupload").on("click",function(){PasteImage.hideUI()}),this.updateDetailes(b)},validate:function(a){var b=PasteImage.files;for(var c=0,d=b.length;c<d;c++){var e=a.find("#fileintex-"+c),f=e.find("[purp='name']"),g=e.find("[purp='comment']"),h=$.trim(f.val());if(/^[`~!\$%\^&\|\\\"<>\?\/]$/.test(h)||h=="")return!1;if(h.length>100)return!1;if(g.val().length>200)return!1}return!0},uploadImage:function(a){if(!PasteImage.validate(a))return;var b=0,c=PasteImage.files,d={},e=[];for(;b<c.length;b++){var f=c[b],g=[],h=a.find("#fileintex-"+b),i=h.find("[purp='name']").val(),j=this.comment=h.find("[purp='comment']").val(),k=h.attr("fileextn");g.push(f),g.push(b+1+"_"+i+k),j!==""&&(d[b+1]=j),e.push(g)}this.handleUploadAjax(e,d),$EmbedManger.UI.hidePasteUI()},handleUploadAjax:function(a,b){var c={},d=this.isUser,e=d?"upload.do":"upload.ls",f="";e==="upload.do"&&(c=lsnocachefix("json",!0)),c.chid=d?WindowHandler.getCurrentWinChatID():$EmbedManger.getChatID(),c.dname=d?CurrentUser.getDisplayname():$EmbedManger.getVisitorName(),c.mod="att",c.sid=d?LSMessanger.getSid():$EmbedManger.getLiveSupportID(),c.comment=JSON.stringify({}),getObjectSize(b)!=0&&(c.comment=JSON.stringify(b));if(!d)c.lsid=$EmbedManger.getLiveSupportID(),c.sender=$EmbedManger.getvwmsid(),c.msgid=f=(new Date).getTime();else{var g=$("#"+c.chid).find("#chatstatus");g.text(LSResource.getRealValue("infomsg.sharingfiles"))}c=this.getFormData(c,"file1",a);var h=d?!1:$EmbedManger.isNewEmbed,i={progress:function(b,c){if(!h)return;$UI.showUploadProgress({fileobj:a[0][0],prgval:b,msgid:c,filename:PasteImage.Filename+PasteImage.ext,comment:PasteImage.comment})},complete:function(){if(!h)return;$UI.hideUploadProgress(f)},success:function(){if(!h){$UI.hideUploadProgress(f);return}PasteImage.isUser&&g.text("")}};try{CommonUtil.handleFileUpload({callbacks:i,formdata:c,type:a.type,msgid:f})}catch(j){}},isFileorBlob:function(a){return a instanceof Blob},getFormData:function(a,b,c){var d=new FormData;for(var e in a)d.append(e,a[e]);for(var f=0,g=c.length;f<g;f++){var h=c[f];this.isFileorBlob(h[0])&&d.append(b,h[0],h[1])}return d},showPortalUI:function(a){var b=Visitors.getVisitorName(WindowHandler.getVistorID(WindowHandler.getCurrentWinChatID())),c=$(this.txtarea),d=Dialog.show({title:LSResource.getRealValue("common.sharewith",getEncodedText(b)),desc:this.getHTML(),i18n:!1,ok:{text:LSResource.getRealValue("banner.share"),callback:function(){PasteImage.uploadImage(d),c.focus()}},cancel:{}}).addClass("pasteimg_srn").center();this.updateDetailes(d)},hideUI:function(){$("#pstimg-main").fadeOut(300,function(){$(this).remove()}),$(this.txtarea).focus()},setPreview:function(a,b){var c=new FileReader,d=a.find("#pasteimage");c.onload=function(a){d.html('<img src="'+a.target.result+'" />')},c.readAsDataURL(b)},handlepasteimage:function(a){var b=parseInt(a.attr("mcount")),c=b-a.val().length,d=c<0?" redtxt":"",e=c<0?LSResource.getRealValue("common.count.error",""+b):c+" ";a.parent().find(".messagecount").show().removeClass("redtxt").addClass(d).text(e)}};(function(){$Clickoutside={callbackfn:null,dest:null,src:null,ignoreesckey:null,bindclick:function(a,b,c,d){this.callbackfn!=null&&this.dest!=b&&this.callbackfn(),this.callbackfn=a,this.dest=b,this.src=c,this.ignoreesckey=d},handledclick:function(a){var b=getEventSourceId(a);if(this.callbackfn==null||this.src==b)return;var c=$(getSource(a)).parents();for(i=0;i<c.length;i++)if($(c[i]).attr("id")==this.src||$(c[i]).attr("id")==this.dest)return;this.callbackfn(),this.callbackfn=null,this.dest=null,this.src=null},handleEscape:function(a){if(this.ignoreesckey||this.callbackfn==null)return;return this.callbackfn(),this.callbackfn=null,this.dest=null,this.src=null,!0}}})(),$(document).on("click",function(a){$Clickoutside.handledclick(a)});